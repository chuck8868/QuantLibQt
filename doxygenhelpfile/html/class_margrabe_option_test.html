<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>QuantLib: MargrabeOptionTest Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">QuantLib
   &#160;<span id="projectnumber">1.3</span>
   </div>
   <div id="projectbrief">ql1-3</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="dynsections.js"></script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('class_margrabe_option_test.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-static-methods">Static Public Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">MargrabeOptionTest Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="MargrabeOptionTest" -->
<p><code>#include &lt;<a class="el" href="test-suite_2margrabeoption_8hpp_source.html">margrabeoption.hpp</a>&gt;</code></p>

<p><a href="class_margrabe_option_test-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_margrabe_option_test.html#a73b3f9ca4091638d3f267a9ac9650128">testEuroExchangeTwoAssets</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_margrabe_option_test.html#a8b62e69b3587c993610cd5ea66d56128">testAmericanExchangeTwoAssets</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_margrabe_option_test.html#a4d8d8f5676580538c231f9ba9d085e1f">testGreeks</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <br class="typebreak"/>
boost::unit_test_framework::test_suite *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_margrabe_option_test.html#afd685bc88ef297e5067ae6b2c1914cb1">suite</a> ()</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="test-suite_2margrabeoption_8hpp_source.html#l00025">25</a> of file <a class="el" href="test-suite_2margrabeoption_8hpp_source.html">margrabeoption.hpp</a>.</p>
</div><hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="afd685bc88ef297e5067ae6b2c1914cb1"></a><!-- doxytag: member="MargrabeOptionTest::suite" ref="afd685bc88ef297e5067ae6b2c1914cb1" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">test_suite * <a class="el" href="class_margrabe_option_test.html#afd685bc88ef297e5067ae6b2c1914cb1">MargrabeOptionTest::suite</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2margrabeoption_8cpp_source.html#l00606">606</a> of file <a class="el" href="test-suite_2margrabeoption_8cpp_source.html">margrabeoption.cpp</a>.</p>

<p>References <a class="el" href="test-suite_2utilities_8hpp_source.html#l00061">QUANTLIB_TEST_CASE</a>, <a class="el" href="test-suite_2margrabeoption_8cpp_source.html#l00495">testAmericanExchangeTwoAssets()</a>, <a class="el" href="test-suite_2margrabeoption_8cpp_source.html#l00122">testEuroExchangeTwoAssets()</a>, and <a class="el" href="test-suite_2margrabeoption_8cpp_source.html#l00314">testGreeks()</a>.</p>

<p>Referenced by <a class="el" href="quantlibtestsuite_8cpp_source.html#l00206">init_unit_test_suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                      {
    test_suite* <a class="code" href="class_margrabe_option_test.html#afd685bc88ef297e5067ae6b2c1914cb1">suite</a> = BOOST_TEST_SUITE(<span class="stringliteral">&quot;Exchange option tests&quot;</span>);
    suite-&gt;add(
        <a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(&amp;<a class="code" href="class_margrabe_option_test.html#a73b3f9ca4091638d3f267a9ac9650128">MargrabeOptionTest::testEuroExchangeTwoAssets</a>));
    suite-&gt;add(
        <a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(&amp;<a class="code" href="class_margrabe_option_test.html#a8b62e69b3587c993610cd5ea66d56128">MargrabeOptionTest::testAmericanExchangeTwoAssets</a>));
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(&amp;<a class="code" href="class_margrabe_option_test.html#a4d8d8f5676580538c231f9ba9d085e1f">MargrabeOptionTest::testGreeks</a>));
    <span class="keywordflow">return</span> <a class="code" href="class_margrabe_option_test.html#afd685bc88ef297e5067ae6b2c1914cb1">suite</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8b62e69b3587c993610cd5ea66d56128"></a><!-- doxytag: member="MargrabeOptionTest::testAmericanExchangeTwoAssets" ref="a8b62e69b3587c993610cd5ea66d56128" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_margrabe_option_test.html#a8b62e69b3587c993610cd5ea66d56128">MargrabeOptionTest::testAmericanExchangeTwoAssets</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2margrabeoption_8cpp_source.html#l00495">495</a> of file <a class="el" href="test-suite_2margrabeoption_8cpp_source.html">margrabeoption.cpp</a>.</p>

<p>References <a class="el" href="settings_8hpp_source.html#l00153">QuantLib::Settings::evaluationDate()</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00058">QuantLib::flatRate()</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00086">QuantLib::flatVol()</a>, <a class="el" href="class_quant_lib_1_1_singleton.html#ab79257029fa4841505227497a56cbd93">QuantLib::Singleton&lt; Settings &gt;::instance()</a>, <a class="el" href="test-suite_2utilities_8hpp_source.html#l00039">LENGTH</a>, <a class="el" href="instrument_8hpp_source.html#l00186">QuantLib::Instrument::NPV()</a>, <a class="el" href="test-suite_2margrabeoption_8cpp_source.html#l00032">REPORT_FAILURE</a>, <a class="el" href="instrument_8hpp_source.html#l00133">QuantLib::Instrument::setPricingEngine()</a>, <a class="el" href="quantlibbenchmark_8cpp_source.html#l00150">anonymous_namespace{quantlibbenchmark.cpp}::t</a>, and <a class="el" href="test-suite_2gaussianquadratures_8cpp_source.html#l00032">anonymous_namespace{gaussianquadratures.cpp}::tolerance</a>.</p>

<p>Referenced by <a class="el" href="test-suite_2margrabeoption_8cpp_source.html#l00606">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                                       {

    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing American one-asset-for-another option...&quot;</span>);

    MargrabeAmericanOptionTwoData values[] = {
        <span class="comment">//Simplification : we assume that the option always exchanges S2 for S1</span>
        <span class="comment">//s1, s2, Q1, Q2, q1, q2, r, t, v1, v2, rho, result, tol</span>
        <span class="comment">// data from Haug</span>

        {22.0, 20.0, 1, 1, 0.06, 0.04, 0.10, 0.10, 0.20, 0.15, -0.50, 2.1357, 1.0e-3},
        {22.0, 20.0, 1, 1, 0.06, 0.04, 0.10, 0.10, 0.20, 0.20, -0.50, 2.2074, 1.0e-3},
        {22.0, 20.0, 1, 1, 0.06, 0.04, 0.10, 0.10, 0.20, 0.25, -0.50, 2.2902, 1.0e-3},

        {22.0, 20.0, 1, 1, 0.06, 0.04, 0.10, 0.10, 0.20, 0.15, 0.00, 2.0592, 1.0e-3},
        {22.0, 20.0, 1, 1, 0.06, 0.04, 0.10, 0.10, 0.20, 0.20, 0.00, 2.1032, 1.0e-3},
        {22.0, 20.0, 1, 1, 0.06, 0.04, 0.10, 0.10, 0.20, 0.25, 0.00, 2.1618, 1.0e-3},

        {22.0, 20.0, 1, 1, 0.06, 0.04, 0.10, 0.10, 0.20, 0.15, 0.50, 2.0001, 1.0e-3},
        {22.0, 20.0, 1, 1, 0.06, 0.04, 0.10, 0.10, 0.20, 0.20, 0.50, 2.0110, 1.0e-3},
        {22.0, 20.0, 1, 1, 0.06, 0.04, 0.10, 0.10, 0.20, 0.25, 0.50, 2.0359, 1.0e-3},

        {22.0, 20.0, 1, 1, 0.06, 0.04, 0.10, 0.50, 0.20, 0.15, -0.50, 2.8051, 1.0e-3},
        {22.0, 20.0, 1, 1, 0.06, 0.04, 0.10, 0.50, 0.20, 0.20, -0.50, 3.0288, 1.0e-3},
        {22.0, 20.0, 1, 1, 0.06, 0.04, 0.10, 0.50, 0.20, 0.25, -0.50, 3.2664, 1.0e-3},

        {22.0, 20.0, 1, 1, 0.06, 0.04, 0.10, 0.50, 0.20, 0.15, 0.00, 2.5282, 1.0e-3},
        {22.0, 20.0, 1, 1, 0.06, 0.04, 0.10, 0.50, 0.20, 0.20, 0.00, 2.6945, 1.0e-3},
        {22.0, 20.0, 1, 1, 0.06, 0.04, 0.10, 0.50, 0.20, 0.25, 0.00, 2.8893, 1.0e-3},

        {22.0, 20.0, 1, 1, 0.06, 0.04, 0.10, 0.50, 0.20, 0.15, 0.50, 2.2053, 1.0e-3},
        {22.0, 20.0, 1, 1, 0.06, 0.04, 0.10, 0.50, 0.20, 0.20, 0.50, 2.2906, 1.0e-3},
        {22.0, 20.0, 1, 1, 0.06, 0.04, 0.10, 0.50, 0.20, 0.25, 0.50, 2.4261, 1.0e-3}
    };

    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> today = Settings::instance().evaluationDate();
    <a class="code" href="class_quant_lib_1_1_day_counter.html" title="day counter class">DayCounter</a> dc = <a class="code" href="class_quant_lib_1_1_actual360.html" title="Actual/360 day count convention.">Actual360</a>();
    boost::shared_ptr&lt;SimpleQuote&gt; spot1(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(0.0));
    boost::shared_ptr&lt;SimpleQuote&gt; spot2(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(0.0));

    boost::shared_ptr&lt;SimpleQuote&gt; qRate1(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(0.0));
    boost::shared_ptr&lt;YieldTermStructure&gt; qTS1 = <a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(today, qRate1, dc);
    boost::shared_ptr&lt;SimpleQuote&gt; qRate2(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(0.0));
    boost::shared_ptr&lt;YieldTermStructure&gt; qTS2 = <a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(today, qRate2, dc);

    boost::shared_ptr&lt;SimpleQuote&gt; rRate(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(0.0));
    boost::shared_ptr&lt;YieldTermStructure&gt; rTS = <a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(today, rRate, dc);

    boost::shared_ptr&lt;SimpleQuote&gt; vol1(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(0.0));
    boost::shared_ptr&lt;BlackVolTermStructure&gt; volTS1 = <a class="code" href="namespace_quant_lib.html#a589d5c4b0b60b0bdd42ae07d820b2ed3">flatVol</a>(today, vol1, dc);
    boost::shared_ptr&lt;SimpleQuote&gt; vol2(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(0.0));
    boost::shared_ptr&lt;BlackVolTermStructure&gt; volTS2 = <a class="code" href="namespace_quant_lib.html#a589d5c4b0b60b0bdd42ae07d820b2ed3">flatVol</a>(today, vol2, dc);

    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(values); i++) {

        <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> exDate = today + <a class="code" href="namespace_quant_lib.html#a8ac1a45a37d8d3dda438a2e59e222620" title="integer number">Integer</a>(values[i].<a class="code" href="namespaceanonymous__namespace_02quantlibbenchmark_8cpp_03.html#a7a969063fde0030bd36b46055e824c34">t</a>*360+0.5);
        boost::shared_ptr&lt;Exercise&gt; exercise(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_american_exercise.html" title="American exercise.">AmericanExercise</a>(today, exDate));

        spot1 -&gt;setValue(values[i].s1);
        spot2 -&gt;setValue(values[i].s2);
        qRate1-&gt;setValue(values[i].q1);
        qRate2-&gt;setValue(values[i].q2);
        rRate -&gt;setValue(values[i].r );
        vol1  -&gt;setValue(values[i].v1);
        vol2  -&gt;setValue(values[i].v2);

        boost::shared_ptr&lt;BlackScholesMertonProcess&gt; stochProcess1(<span class="keyword">new</span>
            <a class="code" href="class_quant_lib_1_1_black_scholes_merton_process.html" title="Merton (1973) extension to the Black-Scholes stochastic process.">BlackScholesMertonProcess</a>(<a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;Quote&gt;</a>(spot1),
                                      <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a>(qTS1),
                                      <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a>(rTS),
                                      <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;BlackVolTermStructure&gt;</a>(volTS1)));

        boost::shared_ptr&lt;BlackScholesMertonProcess&gt; stochProcess2(<span class="keyword">new</span>
            <a class="code" href="class_quant_lib_1_1_black_scholes_merton_process.html" title="Merton (1973) extension to the Black-Scholes stochastic process.">BlackScholesMertonProcess</a>(<a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;Quote&gt;</a>(spot2),
                                      <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a>(qTS2),
                                      <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a>(rTS),
                                      <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;BlackVolTermStructure&gt;</a>(volTS2)));

        std::vector&lt;boost::shared_ptr&lt;StochasticProcess1D&gt; &gt; procs;
        procs.push_back(stochProcess1);
        procs.push_back(stochProcess2);

        <a class="code" href="class_quant_lib_1_1_matrix.html" title="Matrix used in linear algebra.">Matrix</a> correlationMatrix(2,2, values[i].rho);
        <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#a8ac1a45a37d8d3dda438a2e59e222620" title="integer number">Integer</a> j=0; j &lt; 2; j++) {
            correlationMatrix[j][j] = 1.0;
        }

        boost::shared_ptr&lt;PricingEngine&gt; <a class="code" href="class_quant_lib_1_1engine.html">engine</a>(
                             <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_analytic_american_margrabe_engine.html" title="Analytic engine for American Margrabe option.">AnalyticAmericanMargrabeEngine</a>(stochProcess1,
                                                                stochProcess2,
                                                                values[i].rho));

        <a class="code" href="class_quant_lib_1_1_margrabe_option.html" title="Margrabe option on two assets.">MargrabeOption</a> margrabeOption(values[i].Q1, values[i].Q2, exercise);

        <span class="comment">// analytic engine</span>
        margrabeOption.setPricingEngine(<a class="code" href="class_quant_lib_1_1engine.html">engine</a>);

        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> calculated = margrabeOption.NPV();
        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> expected = values[i].result;
        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> error = std::fabs(calculated-expected);
        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> <a class="code" href="namespaceanonymous__namespace_02gaussianquadratures_8cpp_03.html#a0f4d3028fdc8cebd7d9c568c16754cab">tolerance</a> = values[i].tol;
        <span class="keywordflow">if</span> (error &gt; tolerance) {
            <a class="code" href="test-suite_2margrabeoption_8cpp.html#a70e16a2269fe13b353dd372de576d551">REPORT_FAILURE</a>(<span class="stringliteral">&quot;value&quot;</span>, exercise,
                             values[i].s1, values[i].s2, values[i].Q1,
                             values[i].Q2, values[i].q1, values[i].q2,
                             values[i].r, today, values[i].v1,
                             values[i].v2, values[i].rho, expected,
                             calculated, error, tolerance);
        }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a73b3f9ca4091638d3f267a9ac9650128"></a><!-- doxytag: member="MargrabeOptionTest::testEuroExchangeTwoAssets" ref="a73b3f9ca4091638d3f267a9ac9650128" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_margrabe_option_test.html#a73b3f9ca4091638d3f267a9ac9650128">MargrabeOptionTest::testEuroExchangeTwoAssets</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2margrabeoption_8cpp_source.html#l00122">122</a> of file <a class="el" href="test-suite_2margrabeoption_8cpp_source.html">margrabeoption.cpp</a>.</p>

<p>References <a class="el" href="ql_2experimental_2exoticoptions_2margrabeoption_8cpp_source.html#l00032">QuantLib::MargrabeOption::delta1()</a>, <a class="el" href="ql_2experimental_2exoticoptions_2margrabeoption_8cpp_source.html#l00038">QuantLib::MargrabeOption::delta2()</a>, <a class="el" href="settings_8hpp_source.html#l00153">QuantLib::Settings::evaluationDate()</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00058">QuantLib::flatRate()</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00086">QuantLib::flatVol()</a>, <a class="el" href="ql_2experimental_2exoticoptions_2margrabeoption_8cpp_source.html#l00044">QuantLib::MargrabeOption::gamma1()</a>, <a class="el" href="ql_2experimental_2exoticoptions_2margrabeoption_8cpp_source.html#l00050">QuantLib::MargrabeOption::gamma2()</a>, <a class="el" href="class_quant_lib_1_1_singleton.html#ab79257029fa4841505227497a56cbd93">QuantLib::Singleton&lt; Settings &gt;::instance()</a>, <a class="el" href="test-suite_2utilities_8hpp_source.html#l00039">LENGTH</a>, <a class="el" href="instrument_8hpp_source.html#l00186">QuantLib::Instrument::NPV()</a>, <a class="el" href="test-suite_2margrabeoption_8cpp_source.html#l00032">REPORT_FAILURE</a>, <a class="el" href="multiassetoption_8cpp_source.html#l00062">QuantLib::MultiAssetOption::rho()</a>, <a class="el" href="instrument_8hpp_source.html#l00133">QuantLib::Instrument::setPricingEngine()</a>, <a class="el" href="quantlibbenchmark_8cpp_source.html#l00150">anonymous_namespace{quantlibbenchmark.cpp}::t</a>, <a class="el" href="multiassetoption_8cpp_source.html#l00050">QuantLib::MultiAssetOption::theta()</a>, and <a class="el" href="test-suite_2gaussianquadratures_8cpp_source.html#l00032">anonymous_namespace{gaussianquadratures.cpp}::tolerance</a>.</p>

<p>Referenced by <a class="el" href="test-suite_2margrabeoption_8cpp_source.html#l00606">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                                   {

    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing European one-asset-for-another option...&quot;</span>);

    <span class="comment">/*</span>
<span class="comment">        Exchange-One-Asset-for-Another European Options</span>
<span class="comment">    */</span>
    MargrabeOptionTwoData values[] = {
        <span class="comment">//Simplification : we assume that the option always exchanges S2 for S1</span>
        <span class="comment">//s1,  s2,  Q1,  Q2,  q1,  q2,  r,  t,  v1,  v2,  rho,  result,</span>
                   <span class="comment">//delta1,  delta2,  gamma1,  gamma2,  theta, rho, tol</span>
        <span class="comment">// data from &quot;given article p.52&quot;</span>
        {22.0, 20.0, 1, 1, 0.06, 0.04, 0.10, 0.10, 0.20, 0.15, -0.50, 2.125, 0.841, -0.818, 0.112, 0.135, -2.043, 0.0, 1.0e-3},
        {22.0, 20.0, 1, 1, 0.06, 0.04, 0.10, 0.10, 0.20, 0.20, -0.50, 2.199, 0.813, -0.784, 0.109, 0.132, -2.723, 0.0, 1.0e-3},
        {22.0, 20.0, 1, 1, 0.06, 0.04, 0.10, 0.10, 0.20, 0.25, -0.50, 2.283, 0.788, -0.753, 0.105, 0.126, -3.419, 0.0, 1.0e-3},

        {22.0, 20.0, 1, 1, 0.06, 0.04, 0.10, 0.10, 0.20, 0.15, 0.00, 2.045, 0.883, -0.870, 0.108, 0.131, -1.168, 0.0, 1.0e-3},
        {22.0, 20.0, 1, 1, 0.06, 0.04, 0.10, 0.10, 0.20, 0.20, 0.00, 2.091, 0.857, -0.838, 0.112, 0.135, -1.698, 0.0, 1.0e-3},
        {22.0, 20.0, 1, 1, 0.06, 0.04, 0.10, 0.10, 0.20, 0.25, 0.00, 2.152, 0.830, -0.805, 0.111, 0.134, -2.302, 0.0, 1.0e-3},

        {22.0, 20.0, 1, 1, 0.06, 0.04, 0.10, 0.10, 0.20, 0.15, 0.50, 1.974, 0.946, -0.942, 0.079, 0.096, -0.126, 0.0, 1.0e-3},
        {22.0, 20.0, 1, 1, 0.06, 0.04, 0.10, 0.10, 0.20, 0.20, 0.50, 1.989, 0.929, -0.922, 0.092, 0.111, -0.398, 0.0, 1.0e-3},
        {22.0, 20.0, 1, 1, 0.06, 0.04, 0.10, 0.10, 0.20, 0.25, 0.50, 2.019, 0.902, -0.891, 0.104, 0.125, -0.838, 0.0, 1.0e-3},

        {22.0, 20.0, 1, 1, 0.06, 0.04, 0.10, 0.50, 0.20, 0.15, -0.50, 2.762, 0.672, -0.602, 0.072, 0.087, -1.207, 0.0, 1.0e-3},
        {22.0, 20.0, 1, 1, 0.06, 0.04, 0.10, 0.50, 0.20, 0.20, -0.50, 2.989, 0.661, -0.578, 0.064, 0.078, -1.457, 0.0, 1.0e-3},
        {22.0, 20.0, 1, 1, 0.06, 0.04, 0.10, 0.50, 0.20, 0.25, -0.50, 3.228, 0.653, -0.557, 0.058, 0.070, -1.712, 0.0, 1.0e-3},

        {22.0, 20.0, 1, 1, 0.06, 0.04, 0.10, 0.50, 0.20, 0.15, 0.00, 2.479, 0.695, -0.640, 0.085, 0.102, -0.874, 0.0, 1.0e-3},
        {22.0, 20.0, 1, 1, 0.06, 0.04, 0.10, 0.50, 0.20, 0.20, 0.00, 2.650, 0.680, -0.616, 0.077, 0.093, -1.078, 0.0, 1.0e-3},
        {22.0, 20.0, 1, 1, 0.06, 0.04, 0.10, 0.50, 0.20, 0.25, 0.00, 2.847, 0.668, -0.592, 0.069, 0.083, -1.302, 0.0, 1.0e-3},

        {22.0, 20.0, 1, 1, 0.06, 0.04, 0.10, 0.50, 0.20, 0.15, 0.50, 2.138, 0.746, -0.713, 0.106, 0.128, -0.416, 0.0, 1.0e-3},
        {22.0, 20.0, 1, 1, 0.06, 0.04, 0.10, 0.50, 0.20, 0.20, 0.50, 2.231, 0.728, -0.689, 0.099, 0.120, -0.550, 0.0, 1.0e-3},
        {22.0, 20.0, 1, 1, 0.06, 0.04, 0.10, 0.50, 0.20, 0.25, 0.50, 2.374, 0.707, -0.659, 0.090, 0.109, -0.741, 0.0, 1.0e-3},

        <span class="comment">//Quantity tests from Excel calcuations</span>
        {22.0, 10.0, 1, 2, 0.06, 0.04, 0.10, 0.50, 0.20, 0.15, 0.50, 2.138, 0.746, -1.426, 0.106, 0.255, -0.987, 0.0, 1.0e-3},
        {11.0, 20.0, 2, 1, 0.06, 0.04, 0.10, 0.50, 0.20, 0.20, 0.50, 2.231, 1.455, -0.689, 0.198, 0.120, 0.410, 0.0, 1.0e-3},
        {11.0, 10.0, 2, 2, 0.06, 0.04, 0.10, 0.50, 0.20, 0.25, 0.50, 2.374, 1.413, -1.317, 0.181, 0.219, -0.336, 0.0, 1.0e-3}
    };

    <a class="code" href="class_quant_lib_1_1_day_counter.html" title="day counter class">DayCounter</a> dc = <a class="code" href="class_quant_lib_1_1_actual360.html" title="Actual/360 day count convention.">Actual360</a>();
    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> today = Settings::instance().evaluationDate();

    boost::shared_ptr&lt;SimpleQuote&gt; spot1(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(0.0));
    boost::shared_ptr&lt;SimpleQuote&gt; spot2(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(0.0));

    boost::shared_ptr&lt;SimpleQuote&gt; qRate1(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(0.0));
    boost::shared_ptr&lt;YieldTermStructure&gt; qTS1 = <a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(today, qRate1, dc);
    boost::shared_ptr&lt;SimpleQuote&gt; qRate2(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(0.0));
    boost::shared_ptr&lt;YieldTermStructure&gt; qTS2 = <a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(today, qRate2, dc);

    boost::shared_ptr&lt;SimpleQuote&gt; rRate(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(0.0));
    boost::shared_ptr&lt;YieldTermStructure&gt; rTS = <a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(today, rRate, dc);

    boost::shared_ptr&lt;SimpleQuote&gt; vol1(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(0.0));
    boost::shared_ptr&lt;BlackVolTermStructure&gt; volTS1 = <a class="code" href="namespace_quant_lib.html#a589d5c4b0b60b0bdd42ae07d820b2ed3">flatVol</a>(today, vol1, dc);
    boost::shared_ptr&lt;SimpleQuote&gt; vol2(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(0.0));
    boost::shared_ptr&lt;BlackVolTermStructure&gt; volTS2 = <a class="code" href="namespace_quant_lib.html#a589d5c4b0b60b0bdd42ae07d820b2ed3">flatVol</a>(today, vol2, dc);

    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(values); i++) {

        <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> exDate = today + <a class="code" href="namespace_quant_lib.html#a8ac1a45a37d8d3dda438a2e59e222620" title="integer number">Integer</a>(values[i].<a class="code" href="namespaceanonymous__namespace_02quantlibbenchmark_8cpp_03.html#a7a969063fde0030bd36b46055e824c34">t</a>*360+0.5);
        boost::shared_ptr&lt;Exercise&gt; exercise(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_european_exercise.html" title="European exercise.">EuropeanExercise</a>(exDate));

        spot1 -&gt;setValue(values[i].s1);
        spot2 -&gt;setValue(values[i].s2);
        qRate1-&gt;setValue(values[i].q1);
        qRate2-&gt;setValue(values[i].q2);
        rRate -&gt;setValue(values[i].r );
        vol1  -&gt;setValue(values[i].v1);
        vol2  -&gt;setValue(values[i].v2);

        boost::shared_ptr&lt;BlackScholesMertonProcess&gt; stochProcess1(<span class="keyword">new</span>
            <a class="code" href="class_quant_lib_1_1_black_scholes_merton_process.html" title="Merton (1973) extension to the Black-Scholes stochastic process.">BlackScholesMertonProcess</a>(<a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;Quote&gt;</a>(spot1),
                                      <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a>(qTS1),
                                      <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a>(rTS),
                                      <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;BlackVolTermStructure&gt;</a>(volTS1)));

        boost::shared_ptr&lt;BlackScholesMertonProcess&gt; stochProcess2(<span class="keyword">new</span>
            <a class="code" href="class_quant_lib_1_1_black_scholes_merton_process.html" title="Merton (1973) extension to the Black-Scholes stochastic process.">BlackScholesMertonProcess</a>(<a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;Quote&gt;</a>(spot2),
                                      <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a>(qTS2),
                                      <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a>(rTS),
                                      <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;BlackVolTermStructure&gt;</a>(volTS2)));

        std::vector&lt;boost::shared_ptr&lt;StochasticProcess1D&gt; &gt; procs;
        procs.push_back(stochProcess1);
        procs.push_back(stochProcess2);

        <a class="code" href="class_quant_lib_1_1_matrix.html" title="Matrix used in linear algebra.">Matrix</a> correlationMatrix(2,2, values[i].rho);
        <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#a8ac1a45a37d8d3dda438a2e59e222620" title="integer number">Integer</a> j=0; j &lt; 2; j++) {
            correlationMatrix[j][j] = 1.0;
        }

        boost::shared_ptr&lt;PricingEngine&gt; <a class="code" href="class_quant_lib_1_1engine.html">engine</a>(
                             <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_analytic_european_margrabe_engine.html" title="Analytic engine for European Margrabe option.">AnalyticEuropeanMargrabeEngine</a>(stochProcess1,
                                                                stochProcess2,
                                                                values[i].rho));

        <a class="code" href="class_quant_lib_1_1_margrabe_option.html" title="Margrabe option on two assets.">MargrabeOption</a> margrabeOption(values[i].Q1, values[i].Q2, exercise);

        <span class="comment">// analytic engine</span>
        margrabeOption.setPricingEngine(<a class="code" href="class_quant_lib_1_1engine.html">engine</a>);

        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> calculated = margrabeOption.NPV();
        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> expected = values[i].result;
        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> error = std::fabs(calculated-expected);
        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> <a class="code" href="namespaceanonymous__namespace_02gaussianquadratures_8cpp_03.html#a0f4d3028fdc8cebd7d9c568c16754cab">tolerance</a> = values[i].tol;
        <span class="keywordflow">if</span> (error &gt; tolerance) {
            <a class="code" href="test-suite_2margrabeoption_8cpp.html#a70e16a2269fe13b353dd372de576d551">REPORT_FAILURE</a>(<span class="stringliteral">&quot;value&quot;</span>, exercise,
                             values[i].s1, values[i].s2, values[i].Q1,
                             values[i].Q2, values[i].q1, values[i].q2,
                             values[i].r, today, values[i].v1,
                             values[i].v2, values[i].rho, expected,
                             calculated, error, tolerance);
        }

        calculated = margrabeOption.delta1();
        expected = values[i].delta1;
        error= std::fabs(calculated-expected);
        <span class="keywordflow">if</span> (error&gt;tolerance) {
            <a class="code" href="test-suite_2margrabeoption_8cpp.html#a70e16a2269fe13b353dd372de576d551">REPORT_FAILURE</a>(<span class="stringliteral">&quot;delta1&quot;</span>, exercise,
                             values[i].s1, values[i].s2, values[i].Q1,
                             values[i].Q2, values[i].q1, values[i].q2,
                             values[i].r, today, values[i].v1,
                             values[i].v2, values[i].rho, expected,
                             calculated, error, tolerance);
        }

        calculated = margrabeOption.delta2();
        expected = values[i].delta2;
        error= std::fabs(calculated-expected);
        <span class="keywordflow">if</span> (error&gt;tolerance) {
            <a class="code" href="test-suite_2margrabeoption_8cpp.html#a70e16a2269fe13b353dd372de576d551">REPORT_FAILURE</a>(<span class="stringliteral">&quot;delta2&quot;</span>, exercise,
                             values[i].s1, values[i].s2, values[i].Q1,
                             values[i].Q2, values[i].q1, values[i].q2,
                             values[i].r, today, values[i].v1,
                             values[i].v2, values[i].rho, expected,
                             calculated, error, tolerance);
        }

        calculated = margrabeOption.gamma1();
        expected = values[i].gamma1;
        error= std::fabs(calculated-expected);
        <span class="keywordflow">if</span> (error&gt;tolerance) {
            <a class="code" href="test-suite_2margrabeoption_8cpp.html#a70e16a2269fe13b353dd372de576d551">REPORT_FAILURE</a>(<span class="stringliteral">&quot;gamma1&quot;</span>, exercise,
                             values[i].s1, values[i].s2, values[i].Q1,
                             values[i].Q2, values[i].q1, values[i].q2,
                             values[i].r, today, values[i].v1,
                             values[i].v2, values[i].rho, expected,
                             calculated, error, tolerance);
        }

        calculated = margrabeOption.gamma2();
        expected = values[i].gamma2;
        error= std::fabs(calculated-expected);
        <span class="keywordflow">if</span> (error&gt;tolerance) {
            <a class="code" href="test-suite_2margrabeoption_8cpp.html#a70e16a2269fe13b353dd372de576d551">REPORT_FAILURE</a>(<span class="stringliteral">&quot;gamma2&quot;</span>, exercise,
                             values[i].s1, values[i].s2, values[i].Q1,
                             values[i].Q2, values[i].q1, values[i].q2,
                             values[i].r, today, values[i].v1,
                             values[i].v2, values[i].rho, expected,
                             calculated, error, tolerance);
        }

        calculated = margrabeOption.theta();
        expected = values[i].theta;
        error= std::fabs(calculated-expected);
        <span class="keywordflow">if</span> (error&gt;tolerance) {
            <a class="code" href="test-suite_2margrabeoption_8cpp.html#a70e16a2269fe13b353dd372de576d551">REPORT_FAILURE</a>(<span class="stringliteral">&quot;theta&quot;</span>, exercise,
                             values[i].s1, values[i].s2, values[i].Q1,
                             values[i].Q2, values[i].q1, values[i].q2,
                             values[i].r, today, values[i].v1,
                             values[i].v2, values[i].rho, expected,
                             calculated, error, tolerance);
        }

        calculated = margrabeOption.rho();
        expected = values[i].rho_greek;
        error= std::fabs(calculated-expected);
        <span class="keywordflow">if</span> (error&gt;tolerance) {
            <a class="code" href="test-suite_2margrabeoption_8cpp.html#a70e16a2269fe13b353dd372de576d551">REPORT_FAILURE</a>(<span class="stringliteral">&quot;rho_greek&quot;</span>, exercise,
                             values[i].s1, values[i].s2, values[i].Q1,
                             values[i].Q2, values[i].q1, values[i].q2,
                             values[i].r, today, values[i].v1,
                             values[i].v2, values[i].rho, expected,
                             calculated, error, tolerance);
        }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a4d8d8f5676580538c231f9ba9d085e1f"></a><!-- doxytag: member="MargrabeOptionTest::testGreeks" ref="a4d8d8f5676580538c231f9ba9d085e1f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_margrabe_option_test.html#a4d8d8f5676580538c231f9ba9d085e1f">MargrabeOptionTest::testGreeks</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2margrabeoption_8cpp_source.html#l00314">314</a> of file <a class="el" href="test-suite_2margrabeoption_8cpp_source.html">margrabeoption.cpp</a>.</p>

<p>References <a class="el" href="option_8hpp_source.html#l00039">QuantLib::Option::Call</a>, <a class="el" href="ql_2experimental_2exoticoptions_2margrabeoption_8cpp_source.html#l00032">QuantLib::MargrabeOption::delta1()</a>, <a class="el" href="ql_2experimental_2exoticoptions_2margrabeoption_8cpp_source.html#l00038">QuantLib::MargrabeOption::delta2()</a>, <a class="el" href="settings_8hpp_source.html#l00153">QuantLib::Settings::evaluationDate()</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00058">QuantLib::flatRate()</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00086">QuantLib::flatVol()</a>, <a class="el" href="ql_2experimental_2exoticoptions_2margrabeoption_8cpp_source.html#l00044">QuantLib::MargrabeOption::gamma1()</a>, <a class="el" href="ql_2experimental_2exoticoptions_2margrabeoption_8cpp_source.html#l00050">QuantLib::MargrabeOption::gamma2()</a>, <a class="el" href="class_quant_lib_1_1_singleton.html#ab79257029fa4841505227497a56cbd93">QuantLib::Singleton&lt; Settings &gt;::instance()</a>, <a class="el" href="test-suite_2utilities_8hpp_source.html#l00039">LENGTH</a>, <a class="el" href="instrument_8hpp_source.html#l00186">QuantLib::Instrument::NPV()</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00115">QuantLib::relativeError()</a>, <a class="el" href="test-suite_2margrabeoption_8cpp_source.html#l00056">REPORT_FAILURE2</a>, <a class="el" href="multiassetoption_8cpp_source.html#l00062">QuantLib::MultiAssetOption::rho()</a>, <a class="el" href="instrument_8hpp_source.html#l00133">QuantLib::Instrument::setPricingEngine()</a>, <a class="el" href="multiassetoption_8cpp_source.html#l00050">QuantLib::MultiAssetOption::theta()</a>, <a class="el" href="test-suite_2blackdeltacalculator_8cpp_source.html#l00037">anonymous_namespace{blackdeltacalculator.cpp}::timeToDays()</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00124">anonymous_namespace{marketmodel.cpp}::todaysDate</a>, <a class="el" href="test-suite_2gaussianquadratures_8cpp_source.html#l00032">anonymous_namespace{gaussianquadratures.cpp}::tolerance</a>, and <a class="el" href="daycounter_8hpp_source.html#l00126">QuantLib::DayCounter::yearFraction()</a>.</p>

<p>Referenced by <a class="el" href="test-suite_2margrabeoption_8cpp_source.html#l00606">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                    {

    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing analytic European exchange option greeks...&quot;</span>);

    <a class="code" href="class_quant_lib_1_1_saved_settings.html">SavedSettings</a> backup;

    std::map&lt;std::string,Real&gt; calculated, expected, <a class="code" href="namespaceanonymous__namespace_02gaussianquadratures_8cpp_03.html#a0f4d3028fdc8cebd7d9c568c16754cab">tolerance</a>;
    tolerance[<span class="stringliteral">&quot;delta1&quot;</span>]  = 1.0e-5;
    tolerance[<span class="stringliteral">&quot;delta2&quot;</span>]  = 1.0e-5;
    tolerance[<span class="stringliteral">&quot;gamma1&quot;</span>]  = 1.0e-5;
    tolerance[<span class="stringliteral">&quot;gamma2&quot;</span>]  = 1.0e-5;
    tolerance[<span class="stringliteral">&quot;theta&quot;</span>]   = 1.0e-5;
    tolerance[<span class="stringliteral">&quot;rho&quot;</span>]     = 1.0e-5;

    <a class="code" href="class_quant_lib_1_1_option.html#abaee7fc605354c444867545492cd5845">Option::Type</a> types[] = {Option::Call};
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> underlyings1[]  = { 22.0 };
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> underlyings2[]  = { 20.0 };
    <a class="code" href="namespace_quant_lib.html#a919ba3567cc89fca373f8d6b8e80126b" title="interest rates">Rate</a> qRates1[]       = { 0.06, 0.16, 0.04 };
    <a class="code" href="namespace_quant_lib.html#a919ba3567cc89fca373f8d6b8e80126b" title="interest rates">Rate</a> qRates2[]       = { 0.04, 0.14, 0.02 };
    <a class="code" href="namespace_quant_lib.html#a919ba3567cc89fca373f8d6b8e80126b" title="interest rates">Rate</a> rRates[]        = { 0.1, 0.2, 0.08 };
    <a class="code" href="class_time.html">Time</a> residualTimes[] = { 0.1, 0.5 };
    <a class="code" href="namespace_quant_lib.html#ae3abfa256de5aa2b506ab6bda014e4dc" title="volatility">Volatility</a> vols1[]   = { 0.20 };
    <a class="code" href="namespace_quant_lib.html#ae3abfa256de5aa2b506ab6bda014e4dc" title="volatility">Volatility</a> vols2[]   = { 0.15, 0.20, 0.25};

    <a class="code" href="class_quant_lib_1_1_day_counter.html" title="day counter class">DayCounter</a> dc = <a class="code" href="class_quant_lib_1_1_actual360.html" title="Actual/360 day count convention.">Actual360</a>();
    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> today = <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#ae1b42c838cf0f4cf17262f0b22bac899">Date::todaysDate</a>();
    Settings::instance().evaluationDate() = today;

    boost::shared_ptr&lt;SimpleQuote&gt; spot1(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(0.0));
    boost::shared_ptr&lt;SimpleQuote&gt; spot2(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(0.0));

    boost::shared_ptr&lt;SimpleQuote&gt; qRate1(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(0.0));
    boost::shared_ptr&lt;YieldTermStructure&gt; qTS1 = <a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(qRate1, dc);
    boost::shared_ptr&lt;SimpleQuote&gt; qRate2(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(0.0));
    boost::shared_ptr&lt;YieldTermStructure&gt; qTS2 = <a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(qRate2, dc);

    boost::shared_ptr&lt;SimpleQuote&gt; rRate(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(0.0));
    boost::shared_ptr&lt;YieldTermStructure&gt; rTS = <a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(rRate, dc);

    boost::shared_ptr&lt;SimpleQuote&gt; vol1(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(0.0));
    boost::shared_ptr&lt;BlackVolTermStructure&gt; volTS1 = <a class="code" href="namespace_quant_lib.html#a589d5c4b0b60b0bdd42ae07d820b2ed3">flatVol</a>(vol1, dc);
    boost::shared_ptr&lt;SimpleQuote&gt; vol2(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(0.0));
    boost::shared_ptr&lt;BlackVolTermStructure&gt; volTS2 = <a class="code" href="namespace_quant_lib.html#a589d5c4b0b60b0bdd42ae07d820b2ed3">flatVol</a>(vol2, dc);

    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(types); i++) {
        <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> k=0; k&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(residualTimes); k++) {
          <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> exDate = today + <a class="code" href="namespaceanonymous__namespace_02blackdeltacalculator_8cpp_03.html#adb9863ae5d45b223207febc073db33c9">timeToDays</a>(residualTimes[k]);
          boost::shared_ptr&lt;Exercise&gt; exercise(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_european_exercise.html" title="European exercise.">EuropeanExercise</a>(exDate));

          <span class="comment">// option to check</span>
          boost::shared_ptr&lt;BlackScholesMertonProcess&gt; stochProcess1(<span class="keyword">new</span>
              <a class="code" href="class_quant_lib_1_1_black_scholes_merton_process.html" title="Merton (1973) extension to the Black-Scholes stochastic process.">BlackScholesMertonProcess</a>(<a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;Quote&gt;</a>(spot1),
                                      <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a>(qTS1),
                                      <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a>(rTS),
                                      <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;BlackVolTermStructure&gt;</a>(volTS1)));

          boost::shared_ptr&lt;BlackScholesMertonProcess&gt; stochProcess2(<span class="keyword">new</span>
              <a class="code" href="class_quant_lib_1_1_black_scholes_merton_process.html" title="Merton (1973) extension to the Black-Scholes stochastic process.">BlackScholesMertonProcess</a>(<a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;Quote&gt;</a>(spot2),
                                      <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a>(qTS2),
                                      <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a>(rTS),
                                      <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;BlackVolTermStructure&gt;</a>(volTS2)));

          std::vector&lt;boost::shared_ptr&lt;StochasticProcess1D&gt; &gt; procs;
          procs.push_back(stochProcess1);
          procs.push_back(stochProcess2);

          <span class="comment">//The correlation -0.5 can be different real between -1 and 1 for more tests</span>
          <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> correlation = -0.5;
          <a class="code" href="class_quant_lib_1_1_matrix.html" title="Matrix used in linear algebra.">Matrix</a> correlationMatrix(2,2, correlation);
          <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#a8ac1a45a37d8d3dda438a2e59e222620" title="integer number">Integer</a> j=0; j &lt; 2; j++) {
              correlationMatrix[j][j] = 1.0;

          boost::shared_ptr&lt;PricingEngine&gt; <a class="code" href="class_quant_lib_1_1engine.html">engine</a>(
                             <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_analytic_european_margrabe_engine.html" title="Analytic engine for European Margrabe option.">AnalyticEuropeanMargrabeEngine</a>(stochProcess1,
                                                                stochProcess2,
                                                                correlation));

          <span class="comment">//The quantities of S1 and S2 can be different from 1 &amp; 1 for more tests</span>
          <a class="code" href="class_quant_lib_1_1_margrabe_option.html" title="Margrabe option on two assets.">MargrabeOption</a> margrabeOption(1, 1, exercise);

          <span class="comment">// analytic engine</span>
          margrabeOption.setPricingEngine(<a class="code" href="class_quant_lib_1_1engine.html">engine</a>);

              <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> l=0; l&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(underlyings1); l++) {
                <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> m=0; m&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(qRates1); m++) {
                  <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> n=0; n&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(rRates); n++) {
                    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> p=0; p&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(vols1); p++) {
                      <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> u1 = underlyings1[l],
                           u2 = underlyings2[l],
                           u;
                      <a class="code" href="namespace_quant_lib.html#a919ba3567cc89fca373f8d6b8e80126b" title="interest rates">Rate</a> q1 = qRates1[m],
                           q2 = qRates2[m],
                           r = rRates[n];
                      <a class="code" href="namespace_quant_lib.html#ae3abfa256de5aa2b506ab6bda014e4dc" title="volatility">Volatility</a> v1 = vols1[p],
                                 v2 = vols2[p];

                      spot1 -&gt;setValue(u1);
                      spot2 -&gt;setValue(u2);
                      qRate1-&gt;setValue(q1);
                      qRate2-&gt;setValue(q2);
                      rRate -&gt;setValue(r);
                      vol1  -&gt;setValue(v1);
                      vol2  -&gt;setValue(v2);

                      <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> value = margrabeOption.NPV();

                      calculated[<span class="stringliteral">&quot;delta1&quot;</span>]  = margrabeOption.delta1();
                      calculated[<span class="stringliteral">&quot;delta2&quot;</span>]  = margrabeOption.delta2();
                      calculated[<span class="stringliteral">&quot;gamma1&quot;</span>]  = margrabeOption.gamma1();
                      calculated[<span class="stringliteral">&quot;gamma2&quot;</span>]  = margrabeOption.gamma2();
                      calculated[<span class="stringliteral">&quot;theta&quot;</span>]   = margrabeOption.theta();
                      calculated[<span class="stringliteral">&quot;rho&quot;</span>]     = margrabeOption.rho();

                      <span class="keywordflow">if</span> (value &gt; spot1-&gt;value()*1.0e-5) {
                          <span class="comment">// perturb spot and get delta1 and gamma</span>
                          u = u1;
                          <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> du = u*1.0e-4;
                          spot1-&gt;setValue(u+du);
                          <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> value_p = margrabeOption.NPV(),
                               delta_p = margrabeOption.delta1();
                          spot1-&gt;setValue(u-du);
                          <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> value_m = margrabeOption.NPV(),
                               delta_m = margrabeOption.delta1();
                          spot1-&gt;setValue(u);
                          expected[<span class="stringliteral">&quot;delta1&quot;</span>] = (value_p - value_m)/(2*du);
                          expected[<span class="stringliteral">&quot;gamma1&quot;</span>] = (delta_p - delta_m)/(2*du);

                          u = u2;
                          spot2-&gt;setValue(u+du);
                               value_p = margrabeOption.NPV();
                               delta_p = margrabeOption.delta2();
                          spot2-&gt;setValue(u-du);
                               value_m = margrabeOption.NPV();
                               delta_m = margrabeOption.delta2();
                          spot2-&gt;setValue(u);
                          expected[<span class="stringliteral">&quot;delta2&quot;</span>] = (value_p - value_m)/(2*du);
                          expected[<span class="stringliteral">&quot;gamma2&quot;</span>] = (delta_p - delta_m)/(2*du);

                          <span class="comment">// perturb rates and get rho</span>
                          <a class="code" href="namespace_quant_lib.html#ad61d2e1a3f01154233de0d5fbb85177c" title="spreads on interest rates">Spread</a> dr = r*1.0e-4;
                          rRate-&gt;setValue(r+dr);
                               value_p = margrabeOption.NPV();
                          rRate-&gt;setValue(r-dr);
                               value_m = margrabeOption.NPV();
                          rRate-&gt;setValue(r);
                          expected[<span class="stringliteral">&quot;rho&quot;</span>] = (value_p - value_m)/(2*dr);

                          <span class="comment">// perturb date and get theta</span>
                          <a class="code" href="class_time.html">Time</a> dT = dc.<a class="code" href="class_quant_lib_1_1_day_counter.html#aba442c829252ee786e1b4ea3d0f04bd9" title="Returns the period between two dates as a fraction of year.">yearFraction</a>(today-1, today+1);
                          Settings::instance().evaluationDate() = today-1;
                               value_m = margrabeOption.NPV();
                          Settings::instance().evaluationDate() = today+1;
                               value_p = margrabeOption.NPV();
                          Settings::instance().evaluationDate() = today;
                          expected[<span class="stringliteral">&quot;theta&quot;</span>] = (value_p - value_m)/dT;

                          <span class="comment">// compare</span>
                          std::map&lt;std::string,Real&gt;::iterator it;
                          <span class="keywordflow">for</span> (it = calculated.begin();
                               it != calculated.end(); ++it) {
                              std::string greek = it-&gt;first;
                              <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> expct = expected  [greek],
                                   calcl = calculated[greek],
                                   tol   = tolerance [greek];
                              <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> error = <a class="code" href="namespace_quant_lib.html#aafcda44785eaeebddfc54147a234d11a">relativeError</a>(expct,calcl,u1);
                              <span class="keywordflow">if</span> (error&gt;tol) {
                                  <a class="code" href="test-suite_2margrabeoption_8cpp.html#af533e39f9dbf987d4fe524f6d765cef8">REPORT_FAILURE2</a>(greek, exercise,
                                                 u1, u2, q1, q2, r, today, v1, v2,
                                                 expct, calcl, error, tol);
                              }
                          }
                      }
                    }
                  }
                }
              }
          }
        }
    }
}
</pre></div>
</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/home/deriversatile/QuantLib/QuantLibQt/test-suite/<a class="el" href="test-suite_2margrabeoption_8hpp_source.html">margrabeoption.hpp</a></li>
<li>/home/deriversatile/QuantLib/QuantLibQt/test-suite/<a class="el" href="test-suite_2margrabeoption_8cpp_source.html">margrabeoption.cpp</a></li>
</ul>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="class_margrabe_option_test.html">MargrabeOptionTest</a>      </li>

    <li class="footer">Generated on Sat Aug 25 2012 13:51:01 for QuantLib by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
