<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>QuantLib: InflationTest Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">QuantLib
   &#160;<span id="projectnumber">1.3</span>
   </div>
   <div id="projectbrief">ql1-3</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="dynsections.js"></script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('class_inflation_test.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-static-methods">Static Public Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">InflationTest Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="InflationTest" -->
<p><code>#include &lt;<a class="el" href="inflation_8hpp_source.html">inflation.hpp</a>&gt;</code></p>

<p><a href="class_inflation_test-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_inflation_test.html#a292759fea18617b5f0da834321b4d274">testPeriod</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_inflation_test.html#a6420ac50fb2e3c047cd8d594ceec9b68">testZeroIndex</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_inflation_test.html#a35dc83600662f55a18638234009d48f4">testZeroTermStructure</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_inflation_test.html#a63791c1574037018b6b085b6c71536ba">testYYIndex</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_inflation_test.html#a79a67811375f249c5052b759f8e13172">testYYTermStructure</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <br class="typebreak"/>
boost::unit_test_framework::test_suite *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_inflation_test.html#a7b15ec18e1beb64257931ed684fe0e77">suite</a> ()</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="inflation_8hpp_source.html#l00028">28</a> of file <a class="el" href="inflation_8hpp_source.html">inflation.hpp</a>.</p>
</div><hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a7b15ec18e1beb64257931ed684fe0e77"></a><!-- doxytag: member="InflationTest::suite" ref="a7b15ec18e1beb64257931ed684fe0e77" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">test_suite * <a class="el" href="class_inflation_test.html#a7b15ec18e1beb64257931ed684fe0e77">InflationTest::suite</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="inflation_8cpp_source.html#l00953">953</a> of file <a class="el" href="inflation_8cpp_source.html">inflation.cpp</a>.</p>

<p>References <a class="el" href="test-suite_2utilities_8hpp_source.html#l00061">QUANTLIB_TEST_CASE</a>, <a class="el" href="inflation_8cpp_source.html#l00928">testPeriod()</a>, <a class="el" href="inflation_8cpp_source.html#l00615">testYYIndex()</a>, <a class="el" href="inflation_8cpp_source.html#l00768">testYYTermStructure()</a>, <a class="el" href="inflation_8cpp_source.html#l00093">testZeroIndex()</a>, and <a class="el" href="inflation_8cpp_source.html#l00179">testZeroTermStructure()</a>.</p>

<p>Referenced by <a class="el" href="quantlibtestsuite_8cpp_source.html#l00206">init_unit_test_suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                 {

    test_suite* <a class="code" href="class_inflation_test.html#a7b15ec18e1beb64257931ed684fe0e77">suite</a> = BOOST_TEST_SUITE(<span class="stringliteral">&quot;Inflation tests&quot;</span>);

    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(&amp;<a class="code" href="class_inflation_test.html#a292759fea18617b5f0da834321b4d274">InflationTest::testPeriod</a>));

    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(&amp;<a class="code" href="class_inflation_test.html#a6420ac50fb2e3c047cd8d594ceec9b68">InflationTest::testZeroIndex</a>));
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(&amp;<a class="code" href="class_inflation_test.html#a35dc83600662f55a18638234009d48f4">InflationTest::testZeroTermStructure</a>));

    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(&amp;<a class="code" href="class_inflation_test.html#a63791c1574037018b6b085b6c71536ba">InflationTest::testYYIndex</a>));
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(&amp;<a class="code" href="class_inflation_test.html#a79a67811375f249c5052b759f8e13172">InflationTest::testYYTermStructure</a>));

    <span class="keywordflow">return</span> <a class="code" href="class_inflation_test.html#a7b15ec18e1beb64257931ed684fe0e77">suite</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a292759fea18617b5f0da834321b4d274"></a><!-- doxytag: member="InflationTest::testPeriod" ref="a292759fea18617b5f0da834321b4d274" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_inflation_test.html#a292759fea18617b5f0da834321b4d274">InflationTest::testPeriod</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="inflation_8cpp_source.html#l00928">928</a> of file <a class="el" href="inflation_8cpp_source.html">inflation.cpp</a>.</p>

<p>References <a class="el" href="frequency_8hpp_source.html#l00039">QuantLib::Annual</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00137">anonymous_namespace{marketmodel.cpp}::d</a>, <a class="el" href="interpolations_8cpp_source.html#l01615">anonymous_namespace{interpolations.cpp}::f()</a>, <a class="el" href="inflationtermstructure_8cpp_source.html#l00283">QuantLib::inflationPeriod()</a>, <a class="el" href="frequency_8hpp_source.html#l00044">QuantLib::Monthly</a>, <a class="el" href="frequency_8hpp_source.html#l00042">QuantLib::Quarterly</a>, and <a class="el" href="frequency_8hpp_source.html#l00040">QuantLib::Semiannual</a>.</p>

<p>Referenced by <a class="el" href="inflation_8cpp_source.html#l00953">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                               {
    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing inflation period...&quot;</span>);

    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a06d0bee201af9d379ec8f9563ecf7f66">d</a>;
    <a class="code" href="namespace_quant_lib.html#abfa020992bcf412e2bc99f56d4381b4a" title="Frequency of events.">Frequency</a> <a class="code" href="namespaceanonymous__namespace_02interpolations_8cpp_03.html#a31ee7b72e39dd85ef76ba20ca21a3018">f</a>;
    std::pair&lt;Date,Date&gt; res;

    <span class="comment">// fails by crashing out</span>
    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=1; i&lt;=12; i++){
        d = <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(1,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4" title="Month names.">Month</a>(i),2009);

        f = <a class="code" href="namespace_quant_lib.html#abfa020992bcf412e2bc99f56d4381b4aa4880ecc06ab77951b9e412bffce54bcc" title="once a month">Monthly</a>;
        res = <a class="code" href="namespace_quant_lib.html#a375f5896d4cba24bbe748bf6911e140d" title="utility function giving the inflation period for a given date">inflationPeriod</a> (d,f);

        f = <a class="code" href="namespace_quant_lib.html#abfa020992bcf412e2bc99f56d4381b4aa128af3894a995861df674f940dfc9182" title="every third month">Quarterly</a>;
        res = <a class="code" href="namespace_quant_lib.html#a375f5896d4cba24bbe748bf6911e140d" title="utility function giving the inflation period for a given date">inflationPeriod</a> (d,f);

        f = <a class="code" href="namespace_quant_lib.html#abfa020992bcf412e2bc99f56d4381b4aa42f77cc0a4f660a207fe2e743601350b" title="twice a year">Semiannual</a>;
        res = <a class="code" href="namespace_quant_lib.html#a375f5896d4cba24bbe748bf6911e140d" title="utility function giving the inflation period for a given date">inflationPeriod</a> (d,f);

        f = <a class="code" href="namespace_quant_lib.html#abfa020992bcf412e2bc99f56d4381b4aac6003519ba84c016466307b35221e4cf" title="once a year">Annual</a>;
        res = <a class="code" href="namespace_quant_lib.html#a375f5896d4cba24bbe748bf6911e140d" title="utility function giving the inflation period for a given date">inflationPeriod</a> (d,f);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a63791c1574037018b6b085b6c71536ba"></a><!-- doxytag: member="InflationTest::testYYIndex" ref="a63791c1574037018b6b085b6c71536ba" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_inflation_test.html#a63791c1574037018b6b085b6c71536ba">InflationTest::testYYIndex</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="inflation_8cpp_source.html#l00615">615</a> of file <a class="el" href="inflation_8cpp_source.html">inflation.cpp</a>.</p>

<p>References <a class="el" href="calendar_8cpp_source.html#l00045">QuantLib::Calendar::adjust()</a>, <a class="el" href="calendar_8cpp_source.html#l00073">QuantLib::Calendar::advance()</a>, <a class="el" href="date_8hpp_source.html#l00052">QuantLib::August</a>, <a class="el" href="inflationindex_8hpp_source.html#l00240">QuantLib::InflationIndex::availabilityLag()</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00137">anonymous_namespace{marketmodel.cpp}::d</a>, <a class="el" href="settings_8hpp_source.html#l00153">QuantLib::Settings::evaluationDate()</a>, <a class="el" href="inflationindex_8hpp_source.html#l00236">QuantLib::InflationIndex::frequency()</a>, <a class="el" href="ql_2time_2schedule_8cpp_source.html#l00453">QuantLib::MakeSchedule::from()</a>, <a class="el" href="inflationtermstructure_8cpp_source.html#l00283">QuantLib::inflationPeriod()</a>, <a class="el" href="class_quant_lib_1_1_singleton.html#ab79257029fa4841505227497a56cbd93">QuantLib::Singleton&lt; Settings &gt;::instance()</a>, <a class="el" href="inflationindex_8hpp_source.html#l00232">QuantLib::InflationIndex::interpolated()</a>, <a class="el" href="date_8hpp_source.html#l00045">QuantLib::January</a>, <a class="el" href="test-suite_2utilities_8hpp_source.html#l00039">LENGTH</a>, <a class="el" href="businessdayconvention_8hpp_source.html#l00044">QuantLib::ModifiedFollowing</a>, <a class="el" href="frequency_8hpp_source.html#l00044">QuantLib::Monthly</a>, <a class="el" href="timeunit_8hpp_source.html#l00039">QuantLib::Months</a>, <a class="el" href="inflationindex_8hpp_source.html#l00212">QuantLib::InflationIndex::name()</a>, <a class="el" href="inflationindex_8hpp_source.html#l00253">QuantLib::YoYInflationIndex::ratio()</a>, <a class="el" href="inflationindex_8hpp_source.html#l00228">QuantLib::InflationIndex::revised()</a>, <a class="el" href="ql_2time_2schedule_8hpp_source.html#l00058">QuantLib::Schedule::size()</a>, <a class="el" href="ql_2time_2schedule_8cpp_source.html#l00458">QuantLib::MakeSchedule::to()</a>, <a class="el" href="ql_2time_2schedule_8cpp_source.html#l00473">QuantLib::MakeSchedule::withCalendar()</a>, <a class="el" href="ql_2time_2schedule_8cpp_source.html#l00478">QuantLib::MakeSchedule::withConvention()</a>, <a class="el" href="ql_2time_2schedule_8cpp_source.html#l00463">QuantLib::MakeSchedule::withTenor()</a>, and <a class="el" href="timeunit_8hpp_source.html#l00040">QuantLib::Years</a>.</p>

<p>Referenced by <a class="el" href="inflation_8cpp_source.html#l00953">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                {
    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing year-on-year inflation indices...&quot;</span>);

    <a class="code" href="class_quant_lib_1_1_saved_settings.html">SavedSettings</a> backup;
    <a class="code" href="class_quant_lib_1_1_index_history_cleaner.html">IndexHistoryCleaner</a> cleaner;

    <a class="code" href="class_quant_lib_1_1_y_y_e_u_h_i_c_p.html" title="Genuine year-on-year EU HICP (i.e. not a ratio of EU HICP)">YYEUHICP</a> yyeuhicp(<span class="keyword">true</span>);
    <span class="keywordflow">if</span> (yyeuhicp.name() != <span class="stringliteral">&quot;EU YY_HICP&quot;</span>
        || yyeuhicp.frequency() != <a class="code" href="namespace_quant_lib.html#abfa020992bcf412e2bc99f56d4381b4aa4880ecc06ab77951b9e412bffce54bcc" title="once a month">Monthly</a>
        || yyeuhicp.revised()
        || !yyeuhicp.interpolated()
        || yyeuhicp.ratio()
        || yyeuhicp.availabilityLag() != 1*<a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3a3d158b618e2bf6e66da9aca81f706dae">Months</a>) {
        BOOST_ERROR(<span class="stringliteral">&quot;wrong year-on-year EU HICP data (&quot;</span>
                    &lt;&lt; yyeuhicp.name() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
                    &lt;&lt; yyeuhicp.frequency() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
                    &lt;&lt; yyeuhicp.revised() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
                    &lt;&lt; yyeuhicp.interpolated() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
                    &lt;&lt; yyeuhicp.ratio() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
                    &lt;&lt; yyeuhicp.availabilityLag() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);
    }

    <a class="code" href="class_quant_lib_1_1_y_y_e_u_h_i_c_pr.html" title="Fake year-on-year EU HICP (i.e. a ratio of EU HICP)">YYEUHICPr</a> yyeuhicpr(<span class="keyword">true</span>);
    <span class="keywordflow">if</span> (yyeuhicpr.name() != <span class="stringliteral">&quot;EU YYR_HICP&quot;</span>
        || yyeuhicpr.frequency() != <a class="code" href="namespace_quant_lib.html#abfa020992bcf412e2bc99f56d4381b4aa4880ecc06ab77951b9e412bffce54bcc" title="once a month">Monthly</a>
        || yyeuhicpr.revised()
        || !yyeuhicpr.interpolated()
        || !yyeuhicpr.ratio()
        || yyeuhicpr.availabilityLag() != 1*<a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3a3d158b618e2bf6e66da9aca81f706dae">Months</a>) {
        BOOST_ERROR(<span class="stringliteral">&quot;wrong year-on-year EU HICPr data (&quot;</span>
                    &lt;&lt; yyeuhicpr.name() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
                    &lt;&lt; yyeuhicpr.frequency() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
                    &lt;&lt; yyeuhicpr.revised() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
                    &lt;&lt; yyeuhicpr.interpolated() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
                    &lt;&lt; yyeuhicpr.ratio() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
                    &lt;&lt; yyeuhicpr.availabilityLag() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);
    }

    <a class="code" href="class_quant_lib_1_1_y_y_u_k_r_p_i.html" title="Genuine year-on-year UK RPI (i.e. not a ratio of UK RPI)">YYUKRPI</a> yyukrpi(<span class="keyword">false</span>);
    <span class="keywordflow">if</span> (yyukrpi.name() != <span class="stringliteral">&quot;UK YY_RPI&quot;</span>
        || yyukrpi.frequency() != <a class="code" href="namespace_quant_lib.html#abfa020992bcf412e2bc99f56d4381b4aa4880ecc06ab77951b9e412bffce54bcc" title="once a month">Monthly</a>
        || yyukrpi.revised()
        || yyukrpi.interpolated()
        || yyukrpi.ratio()
        || yyukrpi.availabilityLag() != 1*<a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3a3d158b618e2bf6e66da9aca81f706dae">Months</a>) {
        BOOST_ERROR(<span class="stringliteral">&quot;wrong year-on-year UK RPI data (&quot;</span>
                    &lt;&lt; yyukrpi.name() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
                    &lt;&lt; yyukrpi.frequency() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
                    &lt;&lt; yyukrpi.revised() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
                    &lt;&lt; yyukrpi.interpolated() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
                    &lt;&lt; yyukrpi.ratio() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
                    &lt;&lt; yyukrpi.availabilityLag() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);
    }

    <a class="code" href="class_quant_lib_1_1_y_y_u_k_r_p_ir.html" title="Fake year-on-year UK RPI (i.e. a ratio of UK RPI)">YYUKRPIr</a> yyukrpir(<span class="keyword">false</span>);
    <span class="keywordflow">if</span> (yyukrpir.name() != <span class="stringliteral">&quot;UK YYR_RPI&quot;</span>
        || yyukrpir.frequency() != <a class="code" href="namespace_quant_lib.html#abfa020992bcf412e2bc99f56d4381b4aa4880ecc06ab77951b9e412bffce54bcc" title="once a month">Monthly</a>
        || yyukrpir.revised()
        || yyukrpir.interpolated()
        || !yyukrpir.ratio()
        || yyukrpir.availabilityLag() != 1*<a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3a3d158b618e2bf6e66da9aca81f706dae">Months</a>) {
        BOOST_ERROR(<span class="stringliteral">&quot;wrong year-on-year UK RPIr data (&quot;</span>
                    &lt;&lt; yyukrpir.name() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
                    &lt;&lt; yyukrpir.frequency() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
                    &lt;&lt; yyukrpir.revised() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
                    &lt;&lt; yyukrpir.interpolated() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
                    &lt;&lt; yyukrpir.ratio() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
                    &lt;&lt; yyukrpir.availabilityLag() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);
    }


    <span class="comment">// Retrieval test.</span>
    <span class="comment">//----------------</span>
    <span class="comment">// make sure of the evaluation date</span>
    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> evaluationDate(13, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>, 2007);
    evaluationDate = <a class="code" href="class_quant_lib_1_1_united_kingdom.html" title="United Kingdom calendars.">UnitedKingdom</a>().<a class="code" href="class_quant_lib_1_1_calendar.html#a0c62d180f6bed87f598320cd67e44b70">adjust</a>(evaluationDate);
    Settings::instance().evaluationDate() = evaluationDate;

    <span class="comment">// fixing data</span>
    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> from(1, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a2c2c73e76831dec3bfead45af4e7e293">January</a>, 2005);
    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> to(13, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>, 2007);
    <a class="code" href="class_quant_lib_1_1_schedule.html" title="Payment schedule.">Schedule</a> rpiSchedule = <a class="code" href="class_quant_lib_1_1_make_schedule.html" title="helper class">MakeSchedule</a>().<a class="code" href="class_quant_lib_1_1_make_schedule.html#add57ea43db5c17ebad4888a9b92aadcb">from</a>(from).<a class="code" href="class_quant_lib_1_1_make_schedule.html#ad0013dce5b61be709a7b09e66f3c2b3e">to</a>(to)
    .<a class="code" href="class_quant_lib_1_1_make_schedule.html#a4171b3ab3218660704b4697a4b6a8c53">withTenor</a>(1*<a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3a3d158b618e2bf6e66da9aca81f706dae">Months</a>)
    .<a class="code" href="class_quant_lib_1_1_make_schedule.html#a577b0ca13a87e6cd6b4c502b6eed0a0d">withCalendar</a>(<a class="code" href="class_quant_lib_1_1_united_kingdom.html" title="United Kingdom calendars.">UnitedKingdom</a>())
    .<a class="code" href="class_quant_lib_1_1_make_schedule.html#a7187a198c205f6577b8e2dcca0aba3e6">withConvention</a>(<a class="code" href="namespace_quant_lib.html#ac95a4b5bc8017f1eb4ad0b54a9af3881aaa730fc5548402fd95e95f1c57f9a535">ModifiedFollowing</a>);

    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> fixData[] = { 189.9, 189.9, 189.6, 190.5, 191.6, 192.0,
        192.2, 192.2, 192.6, 193.1, 193.3, 193.6,
        194.1, 193.4, 194.2, 195.0, 196.5, 197.7,
        198.5, 198.5, 199.2, 200.1, 200.4, 201.1,
        202.7, 201.6, 203.1, 204.4, 205.4, 206.2,
        207.3 };

    <span class="keywordtype">bool</span> interp = <span class="keyword">false</span>;
    boost::shared_ptr&lt;YYUKRPIr&gt; iir(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_y_y_u_k_r_p_ir.html" title="Fake year-on-year UK RPI (i.e. a ratio of UK RPI)">YYUKRPIr</a>(interp));
    boost::shared_ptr&lt;YYUKRPIr&gt; iirYES(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_y_y_u_k_r_p_ir.html" title="Fake year-on-year UK RPI (i.e. a ratio of UK RPI)">YYUKRPIr</a>(<span class="keyword">true</span>));
    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(fixData);i++) {
        iir-&gt;addFixing(rpiSchedule[i], fixData[i]);
        iirYES-&gt;addFixing(rpiSchedule[i], fixData[i]);
    }

    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> todayMinusLag = evaluationDate - iir-&gt;availabilityLag();
    std::pair&lt;Date,Date&gt; lim = <a class="code" href="namespace_quant_lib.html#a375f5896d4cba24bbe748bf6911e140d" title="utility function giving the inflation period for a given date">inflationPeriod</a>(todayMinusLag, iir-&gt;frequency());
    todayMinusLag = lim.second + 1 - 2*<a class="code" href="class_quant_lib_1_1_period.html">Period</a>(iir-&gt;frequency());

    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> eps = 1.0e-8;

    <span class="comment">// Interpolation tests</span>
    <span class="comment">//--------------------</span>
    <span class="comment">// (no TS so can&#39;t forecast).</span>
    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=13; i&lt;rpiSchedule.<a class="code" href="class_quant_lib_1_1_schedule.html#a3f9f67b0f8653cb82f87eaeef9bfbbd8">size</a>();i++) {
        std::pair&lt;Date,Date&gt; lim = <a class="code" href="namespace_quant_lib.html#a375f5896d4cba24bbe748bf6911e140d" title="utility function giving the inflation period for a given date">inflationPeriod</a>(rpiSchedule[i],
                                                   iir-&gt;frequency());
        std::pair&lt;Date,Date&gt; limBef = <a class="code" href="namespace_quant_lib.html#a375f5896d4cba24bbe748bf6911e140d" title="utility function giving the inflation period for a given date">inflationPeriod</a>(rpiSchedule[i-12],
                                                      iir-&gt;frequency());
        <span class="keywordflow">for</span> (<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a06d0bee201af9d379ec8f9563ecf7f66">d</a>=lim.first; <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a06d0bee201af9d379ec8f9563ecf7f66">d</a>&lt;=lim.second; <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a06d0bee201af9d379ec8f9563ecf7f66">d</a>++) {
            <span class="keywordflow">if</span> (<a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a06d0bee201af9d379ec8f9563ecf7f66">d</a> &lt; todayMinusLag) {
                <a class="code" href="namespace_quant_lib.html#a919ba3567cc89fca373f8d6b8e80126b" title="interest rates">Rate</a> expected = fixData[i]/fixData[i-12] - 1.0;
                <a class="code" href="namespace_quant_lib.html#a919ba3567cc89fca373f8d6b8e80126b" title="interest rates">Rate</a> calculated = iir-&gt;fixing(<a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a06d0bee201af9d379ec8f9563ecf7f66">d</a>);
                BOOST_CHECK_MESSAGE(std::fabs(calculated - expected) &lt; eps,
                                    <span class="stringliteral">&quot;Non-interpolated fixings not constant within a period: &quot;</span>
                                    &lt;&lt; calculated
                                    &lt;&lt; <span class="stringliteral">&quot;, should be &quot;</span>
                                    &lt;&lt; expected);

                <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> dp= lim.second + 1- lim.first;
                <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> dpBef=limBef.second + 1 - limBef.first;
                <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> dl = <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a06d0bee201af9d379ec8f9563ecf7f66">d</a>-lim.first;
                <span class="comment">// potentially does not work on 29th Feb</span>
                <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> dlBef = <a class="code" href="class_quant_lib_1_1_null_calendar.html" title="Calendar for reproducing theoretical calculations.">NullCalendar</a>().<a class="code" href="class_quant_lib_1_1_calendar.html#a1b8d9da28e4f012b89b00bf0ef388cc9">advance</a>(<a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a06d0bee201af9d379ec8f9563ecf7f66">d</a>, -1*<a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3ae2d856134531729a1696e66bebeafb32">Years</a>, <a class="code" href="namespace_quant_lib.html#ac95a4b5bc8017f1eb4ad0b54a9af3881aaa730fc5548402fd95e95f1c57f9a535">ModifiedFollowing</a>)
                -limBef.first;

                <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> linearNow = fixData[i] + (fixData[i+1]-fixData[i])*dl/dp;
                <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> linearBef = fixData[i-12] + (fixData[i+1-12]-fixData[i-12])*dlBef/dpBef;
                <a class="code" href="namespace_quant_lib.html#a919ba3567cc89fca373f8d6b8e80126b" title="interest rates">Rate</a> expectedYES = linearNow / linearBef - 1.0;
                <a class="code" href="namespace_quant_lib.html#a919ba3567cc89fca373f8d6b8e80126b" title="interest rates">Rate</a> calculatedYES = iirYES-&gt;fixing(<a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a06d0bee201af9d379ec8f9563ecf7f66">d</a>);
                BOOST_CHECK_MESSAGE(fabs(expectedYES-calculatedYES)&lt;eps,
                                    <span class="stringliteral">&quot;Error in interpolated fixings: expect &quot;</span>&lt;&lt;expectedYES
                                    &lt;&lt;<span class="stringliteral">&quot; see &quot;</span> &lt;&lt; calculatedYES
                                    &lt;&lt;<span class="stringliteral">&quot; flat &quot;</span> &lt;&lt; calculated
                                    &lt;&lt;<span class="stringliteral">&quot;, data: &quot;</span>&lt;&lt; fixData[i-12] &lt;&lt;<span class="stringliteral">&quot;, &quot;</span>&lt;&lt; fixData[i+1-12]
                                    &lt;&lt;<span class="stringliteral">&quot;, &quot;</span>&lt;&lt;    fixData[i] &lt;&lt;<span class="stringliteral">&quot;, &quot;</span>&lt;&lt; fixData[i+1]
                                    &lt;&lt;<span class="stringliteral">&quot;, fac: &quot;</span>&lt;&lt; dp &lt;&lt;<span class="stringliteral">&quot;, &quot;</span>&lt;&lt; dl
                                    &lt;&lt;<span class="stringliteral">&quot;, &quot;</span>&lt;&lt; dpBef &lt;&lt;<span class="stringliteral">&quot;, &quot;</span>&lt;&lt; dlBef
                                    &lt;&lt;<span class="stringliteral">&quot;, to: &quot;</span>&lt;&lt;linearNow&lt;&lt;<span class="stringliteral">&quot;, &quot;</span>&lt;&lt;linearBef
                                    );
            }
        }
    }

}
</pre></div>
</div>
</div>
<a class="anchor" id="a79a67811375f249c5052b759f8e13172"></a><!-- doxytag: member="InflationTest::testYYTermStructure" ref="a79a67811375f249c5052b759f8e13172" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_inflation_test.html#a79a67811375f249c5052b759f8e13172">InflationTest::testYYTermStructure</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="inflation_8cpp_source.html#l00768">768</a> of file <a class="el" href="inflation_8cpp_source.html">inflation.cpp</a>.</p>

<p>References <a class="el" href="calendar_8cpp_source.html#l00045">QuantLib::Calendar::adjust()</a>, <a class="el" href="date_8hpp_source.html#l00052">QuantLib::August</a>, <a class="el" href="ql_2time_2schedule_8cpp_source.html#l00499">QuantLib::MakeSchedule::backwards()</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00128">anonymous_namespace{marketmodel.cpp}::calendar</a>, <a class="el" href="settings_8hpp_source.html#l00153">QuantLib::Settings::evaluationDate()</a>, <a class="el" href="yearonyearinflationswap_8cpp_source.html#l00141">QuantLib::YearOnYearInflationSwap::fairRate()</a>, <a class="el" href="ql_2time_2schedule_8cpp_source.html#l00453">QuantLib::MakeSchedule::from()</a>, <a class="el" href="class_quant_lib_1_1_singleton.html#ab79257029fa4841505227497a56cbd93">QuantLib::Singleton&lt; Settings &gt;::instance()</a>, <a class="el" href="date_8hpp_source.html#l00045">QuantLib::January</a>, <a class="el" href="ql_2instruments_2swap_8hpp_source.html#l00071">QuantLib::Swap::legNPV()</a>, <a class="el" href="test-suite_2utilities_8hpp_source.html#l00039">LENGTH</a>, <a class="el" href="handle_8hpp_source.html#l00191">QuantLib::RelinkableHandle&lt; T &gt;::linkTo()</a>, <a class="el" href="inflation_8cpp_source.html#l00064">anonymous_namespace{inflation.cpp}::makeHelpers()</a>, <a class="el" href="businessdayconvention_8hpp_source.html#l00044">QuantLib::ModifiedFollowing</a>, <a class="el" href="timeunit_8hpp_source.html#l00039">QuantLib::Months</a>, <a class="el" href="inflation_8cpp_source.html#l00057">anonymous_namespace{inflation.cpp}::nominalTermStructure()</a>, <a class="el" href="instrument_8hpp_source.html#l00186">QuantLib::Instrument::NPV()</a>, <a class="el" href="yearonyearinflationswap_8hpp_source.html#l00053">QuantLib::YearOnYearInflationSwap::Payer</a>, <a class="el" href="yearonyearinflationswap_8hpp_source.html#l00194">QuantLib::YearOnYearInflationSwap::paymentConvention()</a>, <a class="el" href="dataformatters_8hpp_source.html#l00129">QuantLib::io::rate()</a>, <a class="el" href="instrument_8hpp_source.html#l00133">QuantLib::Instrument::setPricingEngine()</a>, <a class="el" href="ql_2time_2schedule_8cpp_source.html#l00458">QuantLib::MakeSchedule::to()</a>, <a class="el" href="businessdayconvention_8hpp_source.html#l00057">QuantLib::Unadjusted</a>, <a class="el" href="ql_2time_2schedule_8cpp_source.html#l00473">QuantLib::MakeSchedule::withCalendar()</a>, <a class="el" href="ql_2time_2schedule_8cpp_source.html#l00478">QuantLib::MakeSchedule::withConvention()</a>, <a class="el" href="ql_2time_2schedule_8cpp_source.html#l00463">QuantLib::MakeSchedule::withTenor()</a>, and <a class="el" href="timeunit_8hpp_source.html#l00040">QuantLib::Years</a>.</p>

<p>Referenced by <a class="el" href="inflation_8cpp_source.html#l00953">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                        {
    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing year-on-year inflation term structure...&quot;</span>);

    <a class="code" href="class_quant_lib_1_1_saved_settings.html">SavedSettings</a> backup;
    <a class="code" href="class_quant_lib_1_1_index_history_cleaner.html">IndexHistoryCleaner</a> cleaner;

    <span class="comment">// try the YY UK</span>
    <a class="code" href="class_quant_lib_1_1_calendar.html" title="calendar class">Calendar</a> <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a86803e870514df19c0cf3863edb2b8f8">calendar</a> = <a class="code" href="class_quant_lib_1_1_united_kingdom.html" title="United Kingdom calendars.">UnitedKingdom</a>();
    <a class="code" href="namespace_quant_lib.html#ac95a4b5bc8017f1eb4ad0b54a9af3881" title="Business Day conventions.">BusinessDayConvention</a> bdc = <a class="code" href="namespace_quant_lib.html#ac95a4b5bc8017f1eb4ad0b54a9af3881aaa730fc5548402fd95e95f1c57f9a535">ModifiedFollowing</a>;
    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> evaluationDate(13, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>, 2007);
    evaluationDate = calendar.<a class="code" href="class_quant_lib_1_1_calendar.html#a0c62d180f6bed87f598320cd67e44b70">adjust</a>(evaluationDate);
    Settings::instance().evaluationDate() = evaluationDate;


    <span class="comment">// fixing data</span>
    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> from(1, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a2c2c73e76831dec3bfead45af4e7e293">January</a>, 2005);
    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> to(13, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>, 2007);
    <a class="code" href="class_quant_lib_1_1_schedule.html" title="Payment schedule.">Schedule</a> rpiSchedule = <a class="code" href="class_quant_lib_1_1_make_schedule.html" title="helper class">MakeSchedule</a>().<a class="code" href="class_quant_lib_1_1_make_schedule.html#add57ea43db5c17ebad4888a9b92aadcb">from</a>(from).<a class="code" href="class_quant_lib_1_1_make_schedule.html#ad0013dce5b61be709a7b09e66f3c2b3e">to</a>(to)
    .<a class="code" href="class_quant_lib_1_1_make_schedule.html#a4171b3ab3218660704b4697a4b6a8c53">withTenor</a>(1*<a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3a3d158b618e2bf6e66da9aca81f706dae">Months</a>)
    .<a class="code" href="class_quant_lib_1_1_make_schedule.html#a577b0ca13a87e6cd6b4c502b6eed0a0d">withCalendar</a>(<a class="code" href="class_quant_lib_1_1_united_kingdom.html" title="United Kingdom calendars.">UnitedKingdom</a>())
    .<a class="code" href="class_quant_lib_1_1_make_schedule.html#a7187a198c205f6577b8e2dcca0aba3e6">withConvention</a>(<a class="code" href="namespace_quant_lib.html#ac95a4b5bc8017f1eb4ad0b54a9af3881aaa730fc5548402fd95e95f1c57f9a535">ModifiedFollowing</a>);
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> fixData[] = { 189.9, 189.9, 189.6, 190.5, 191.6, 192.0,
        192.2, 192.2, 192.6, 193.1, 193.3, 193.6,
        194.1, 193.4, 194.2, 195.0, 196.5, 197.7,
        198.5, 198.5, 199.2, 200.1, 200.4, 201.1,
        202.7, 201.6, 203.1, 204.4, 205.4, 206.2,
        207.3 };

    <a class="code" href="class_quant_lib_1_1_relinkable_handle.html">RelinkableHandle&lt;YoYInflationTermStructure&gt;</a> hy;
    <span class="keywordtype">bool</span> interp = <span class="keyword">false</span>;
    boost::shared_ptr&lt;YYUKRPIr&gt; iir(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_y_y_u_k_r_p_ir.html" title="Fake year-on-year UK RPI (i.e. a ratio of UK RPI)">YYUKRPIr</a>(interp, hy));
    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(fixData); i++) {
        iir-&gt;addFixing(rpiSchedule[i], fixData[i]);
    }



    boost::shared_ptr&lt;YieldTermStructure&gt; nominalTS = <a class="code" href="namespaceanonymous__namespace_02inflation_8cpp_03.html#a80203bfc7215454dcec74ae038a0e436">nominalTermStructure</a>();

    <span class="comment">// now build the YoY inflation curve</span>
    Datum yyData[] = {
        { <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(13, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>, 2008), 2.95 },
        { <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(13, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>, 2009), 2.95 },
        { <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(13, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>, 2010), 2.93 },
        { <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(15, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>, 2011), 2.955 },
        { <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(13, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>, 2012), 2.945 },
        { <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(13, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>, 2013), 2.985 },
        { <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(13, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>, 2014), 3.01 },
        { <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(13, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>, 2015), 3.035 },
        { <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(13, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>, 2016), 3.055 },  <span class="comment">// note that</span>
        { <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(13, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>, 2017), 3.075 },  <span class="comment">// some dates will be on</span>
        { <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(13, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>, 2019), 3.105 },  <span class="comment">// holidays but the payment</span>
        { <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(15, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>, 2022), 3.135 },  <span class="comment">// calendar will roll them</span>
        { <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(13, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>, 2027), 3.155 },
        { <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(13, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>, 2032), 3.145 },
        { <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(13, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>, 2037), 3.145 }
    };

    <a class="code" href="class_quant_lib_1_1_period.html">Period</a> observationLag = <a class="code" href="class_quant_lib_1_1_period.html">Period</a>(2,<a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3a3d158b618e2bf6e66da9aca81f706dae">Months</a>);
    <a class="code" href="class_quant_lib_1_1_day_counter.html" title="day counter class">DayCounter</a> dc = <a class="code" href="class_quant_lib_1_1_thirty360.html" title="30/360 day count convention">Thirty360</a>();

    <span class="comment">// now build the helpers ...</span>
    std::vector&lt;boost::shared_ptr&lt;BootstrapHelper&lt;YoYInflationTermStructure&gt; &gt; &gt; helpers =
    <a class="code" href="namespaceanonymous__namespace_02inflation_8cpp_03.html#a728a3a5b80654ff196e0eb5095a857cd">makeHelpers</a>&lt;<a class="code" href="class_quant_lib_1_1_yo_y_inflation_term_structure.html" title="Base class for year-on-year inflation term structures.">YoYInflationTermStructure</a>,<a class="code" href="class_quant_lib_1_1_year_on_year_inflation_swap_helper.html" title="Year-on-year inflation-swap bootstrap helper.">YearOnYearInflationSwapHelper</a>,
    <a class="code" href="class_quant_lib_1_1_yo_y_inflation_index.html" title="Base class for year-on-year inflation indices.">YoYInflationIndex</a>&gt;(yyData, <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(yyData), iir,
                        observationLag,
                        <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a86803e870514df19c0cf3863edb2b8f8">calendar</a>, bdc, dc);

    <a class="code" href="namespace_quant_lib.html#a919ba3567cc89fca373f8d6b8e80126b" title="interest rates">Rate</a> baseYYRate = yyData[0].rate/100.0;
    boost::shared_ptr&lt;PiecewiseYoYInflationCurve&lt;Linear&gt; &gt; pYYTS(
        <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_piecewise_yo_y_inflation_curve.html" title="Piecewise year-on-year inflation term structure.">PiecewiseYoYInflationCurve&lt;Linear&gt;</a>(
                evaluationDate, calendar, dc, observationLag,
                iir-&gt;frequency(),iir-&gt;interpolated(), baseYYRate,
                <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a>(nominalTS), helpers));
    pYYTS-&gt;recalculate();

    <span class="comment">// validation</span>
    <span class="comment">// yoy swaps should reprice to zero</span>
    <span class="comment">// yy rates should not equal yySwap rates</span>
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> eps = 0.000001;
    <span class="comment">// usual swap engine</span>
    <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> hTS(nominalTS);
    boost::shared_ptr&lt;PricingEngine&gt; sppe(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_discounting_swap_engine.html">DiscountingSwapEngine</a>(hTS));

    <span class="comment">// make sure that the index has the latest yoy term structure</span>
    hy.<a class="code" href="class_quant_lib_1_1_relinkable_handle.html#acceb0d87ae2ecfbad21e0862e6d2e87d">linkTo</a>(pYYTS);

    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> j = 1; j &lt; <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(yyData); j++) {

        from = nominalTS-&gt;referenceDate();
        to = yyData[j].date;
        <a class="code" href="class_quant_lib_1_1_schedule.html" title="Payment schedule.">Schedule</a> yoySchedule = <a class="code" href="class_quant_lib_1_1_make_schedule.html" title="helper class">MakeSchedule</a>().<a class="code" href="class_quant_lib_1_1_make_schedule.html#add57ea43db5c17ebad4888a9b92aadcb">from</a>(from).<a class="code" href="class_quant_lib_1_1_make_schedule.html#ad0013dce5b61be709a7b09e66f3c2b3e">to</a>(to)
        .<a class="code" href="class_quant_lib_1_1_make_schedule.html#a7187a198c205f6577b8e2dcca0aba3e6">withConvention</a>(<a class="code" href="namespace_quant_lib.html#ac95a4b5bc8017f1eb4ad0b54a9af3881a6a9f8f55985b149ed0c336c23bf03667">Unadjusted</a>) <span class="comment">// fixed leg gets calendar from</span>
        .<a class="code" href="class_quant_lib_1_1_make_schedule.html#a577b0ca13a87e6cd6b4c502b6eed0a0d">withCalendar</a>(calendar)     <span class="comment">// schedule</span>
        .<a class="code" href="class_quant_lib_1_1_make_schedule.html#a4171b3ab3218660704b4697a4b6a8c53">withTenor</a>(1*<a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3ae2d856134531729a1696e66bebeafb32">Years</a>)
        .<a class="code" href="class_quant_lib_1_1_make_schedule.html#a0163e84a42bbc17fbf45f4f33eab1d15">backwards</a>()
        ;

        <a class="code" href="class_quant_lib_1_1_year_on_year_inflation_swap.html" title="Year-on-year inflation-indexed swap.">YearOnYearInflationSwap</a> yyS2(YearOnYearInflationSwap::Payer,
                                        1000000.0,
                                        yoySchedule,<span class="comment">//fixed schedule, but same as yoy</span>
                                        yyData[j].<a class="code" href="group__manips.html#gac9152aad6a69c41f5d30bb1dcb9b2236" title="output rates and spreads as percentages">rate</a>/100.0,
                                        dc,
                                        yoySchedule,
                                        iir,
                                        observationLag,
                                        0.0,        <span class="comment">//spread on index</span>
                                        dc,
                                        <a class="code" href="class_quant_lib_1_1_united_kingdom.html" title="United Kingdom calendars.">UnitedKingdom</a>());

        yyS2.setPricingEngine(sppe);



        BOOST_CHECK_MESSAGE(fabs(yyS2.NPV())&lt;eps,<span class="stringliteral">&quot;fresh yoy swap NPV!=0 from TS &quot;</span>
                &lt;&lt;<span class="stringliteral">&quot;swap quote for pt &quot;</span> &lt;&lt; j
                &lt;&lt; <span class="stringliteral">&quot;, is &quot;</span> &lt;&lt; yyData[j].<a class="code" href="group__manips.html#gac9152aad6a69c41f5d30bb1dcb9b2236" title="output rates and spreads as percentages">rate</a>/100.0
                &lt;&lt;<span class="stringliteral">&quot; vs YoY rate &quot;</span>&lt;&lt; pYYTS-&gt;yoyRate(yyData[j].date-observationLag)
                &lt;&lt;<span class="stringliteral">&quot; at quote date &quot;</span>&lt;&lt;(yyData[j].date-observationLag)
                &lt;&lt;<span class="stringliteral">&quot;, NPV of a fresh yoy swap is &quot;</span> &lt;&lt; yyS2.NPV()
                &lt;&lt;<span class="stringliteral">&quot;\n      fair rate &quot;</span> &lt;&lt; yyS2.fairRate()
                &lt;&lt;<span class="stringliteral">&quot; payment &quot;</span>&lt;&lt;yyS2.paymentConvention());
    }

    <a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> jj=3;
    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> k = 0; k &lt; 14; k++) {

        from = nominalTS-&gt;referenceDate() - k*<a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3a3d158b618e2bf6e66da9aca81f706dae">Months</a>;
        to = yyData[jj].date - k*<a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3a3d158b618e2bf6e66da9aca81f706dae">Months</a>;
        <a class="code" href="class_quant_lib_1_1_schedule.html" title="Payment schedule.">Schedule</a> yoySchedule = <a class="code" href="class_quant_lib_1_1_make_schedule.html" title="helper class">MakeSchedule</a>().<a class="code" href="class_quant_lib_1_1_make_schedule.html#add57ea43db5c17ebad4888a9b92aadcb">from</a>(from).<a class="code" href="class_quant_lib_1_1_make_schedule.html#ad0013dce5b61be709a7b09e66f3c2b3e">to</a>(to)
        .<a class="code" href="class_quant_lib_1_1_make_schedule.html#a7187a198c205f6577b8e2dcca0aba3e6">withConvention</a>(<a class="code" href="namespace_quant_lib.html#ac95a4b5bc8017f1eb4ad0b54a9af3881a6a9f8f55985b149ed0c336c23bf03667">Unadjusted</a>) <span class="comment">// fixed leg gets calendar from</span>
        .<a class="code" href="class_quant_lib_1_1_make_schedule.html#a577b0ca13a87e6cd6b4c502b6eed0a0d">withCalendar</a>(calendar)     <span class="comment">// schedule</span>
        .<a class="code" href="class_quant_lib_1_1_make_schedule.html#a4171b3ab3218660704b4697a4b6a8c53">withTenor</a>(1*<a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3ae2d856134531729a1696e66bebeafb32">Years</a>)
        .<a class="code" href="class_quant_lib_1_1_make_schedule.html#a0163e84a42bbc17fbf45f4f33eab1d15">backwards</a>()
        ;

        <a class="code" href="class_quant_lib_1_1_year_on_year_inflation_swap.html" title="Year-on-year inflation-indexed swap.">YearOnYearInflationSwap</a> yyS3(YearOnYearInflationSwap::Payer,
                                    1000000.0,
                                    yoySchedule,<span class="comment">//fixed schedule, but same as yoy</span>
                                    yyData[jj].<a class="code" href="group__manips.html#gac9152aad6a69c41f5d30bb1dcb9b2236" title="output rates and spreads as percentages">rate</a>/100.0,
                                    dc,
                                    yoySchedule,
                                    iir,
                                    observationLag,
                                    0.0,        <span class="comment">//spread on index</span>
                                    dc,
                                    <a class="code" href="class_quant_lib_1_1_united_kingdom.html" title="United Kingdom calendars.">UnitedKingdom</a>());

        yyS3.setPricingEngine(sppe);

        BOOST_CHECK_MESSAGE(fabs(yyS3.NPV())&lt; 20000.0,
                            <span class="stringliteral">&quot;unexpected size of aged YoY swap, aged &quot;</span>
                            &lt;&lt;k&lt;&lt;<span class="stringliteral">&quot; months: YY aged NPV = &quot;</span> &lt;&lt; yyS3.NPV()
                            &lt;&lt;<span class="stringliteral">&quot;, legs &quot;</span>&lt;&lt; yyS3.legNPV(0) &lt;&lt; <span class="stringliteral">&quot; and &quot;</span> &lt;&lt; yyS3.legNPV(1)
                            );
    }
    <span class="comment">// remove circular refernce</span>
    hy.<a class="code" href="class_quant_lib_1_1_relinkable_handle.html#acceb0d87ae2ecfbad21e0862e6d2e87d">linkTo</a>(boost::shared_ptr&lt;YoYInflationTermStructure&gt;());
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6420ac50fb2e3c047cd8d594ceec9b68"></a><!-- doxytag: member="InflationTest::testZeroIndex" ref="a6420ac50fb2e3c047cd8d594ceec9b68" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_inflation_test.html#a6420ac50fb2e3c047cd8d594ceec9b68">InflationTest::testZeroIndex</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="inflation_8cpp_source.html#l00093">93</a> of file <a class="el" href="inflation_8cpp_source.html">inflation.cpp</a>.</p>

<p>References <a class="el" href="calendar_8cpp_source.html#l00045">QuantLib::Calendar::adjust()</a>, <a class="el" href="date_8hpp_source.html#l00052">QuantLib::August</a>, <a class="el" href="inflationindex_8hpp_source.html#l00240">QuantLib::InflationIndex::availabilityLag()</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00137">anonymous_namespace{marketmodel.cpp}::d</a>, <a class="el" href="settings_8hpp_source.html#l00153">QuantLib::Settings::evaluationDate()</a>, <a class="el" href="inflationindex_8hpp_source.html#l00236">QuantLib::InflationIndex::frequency()</a>, <a class="el" href="ql_2time_2schedule_8cpp_source.html#l00453">QuantLib::MakeSchedule::from()</a>, <a class="el" href="inflationtermstructure_8cpp_source.html#l00283">QuantLib::inflationPeriod()</a>, <a class="el" href="class_quant_lib_1_1_singleton.html#ab79257029fa4841505227497a56cbd93">QuantLib::Singleton&lt; Settings &gt;::instance()</a>, <a class="el" href="inflationindex_8hpp_source.html#l00232">QuantLib::InflationIndex::interpolated()</a>, <a class="el" href="date_8hpp_source.html#l00045">QuantLib::January</a>, <a class="el" href="test-suite_2utilities_8hpp_source.html#l00039">LENGTH</a>, <a class="el" href="businessdayconvention_8hpp_source.html#l00044">QuantLib::ModifiedFollowing</a>, <a class="el" href="frequency_8hpp_source.html#l00044">QuantLib::Monthly</a>, <a class="el" href="timeunit_8hpp_source.html#l00039">QuantLib::Months</a>, <a class="el" href="inflationindex_8hpp_source.html#l00212">QuantLib::InflationIndex::name()</a>, <a class="el" href="inflationindex_8hpp_source.html#l00228">QuantLib::InflationIndex::revised()</a>, <a class="el" href="ql_2time_2schedule_8hpp_source.html#l00058">QuantLib::Schedule::size()</a>, <a class="el" href="ql_2time_2schedule_8cpp_source.html#l00458">QuantLib::MakeSchedule::to()</a>, <a class="el" href="ql_2time_2schedule_8cpp_source.html#l00473">QuantLib::MakeSchedule::withCalendar()</a>, <a class="el" href="ql_2time_2schedule_8cpp_source.html#l00478">QuantLib::MakeSchedule::withConvention()</a>, and <a class="el" href="ql_2time_2schedule_8cpp_source.html#l00463">QuantLib::MakeSchedule::withTenor()</a>.</p>

<p>Referenced by <a class="el" href="inflation_8cpp_source.html#l00953">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                  {
    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing zero inflation indices...&quot;</span>);

    <a class="code" href="class_quant_lib_1_1_saved_settings.html">SavedSettings</a> backup;
    <a class="code" href="class_quant_lib_1_1_index_history_cleaner.html">IndexHistoryCleaner</a> cleaner;

    <a class="code" href="class_quant_lib_1_1_e_u_h_i_c_p.html" title="EU HICP index.">EUHICP</a> euhicp(<span class="keyword">true</span>);
    <span class="keywordflow">if</span> (euhicp.name() != <span class="stringliteral">&quot;EU HICP&quot;</span>
        || euhicp.frequency() != <a class="code" href="namespace_quant_lib.html#abfa020992bcf412e2bc99f56d4381b4aa4880ecc06ab77951b9e412bffce54bcc" title="once a month">Monthly</a>
        || euhicp.revised()
        || !euhicp.interpolated()
        || euhicp.availabilityLag() != 1*<a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3a3d158b618e2bf6e66da9aca81f706dae">Months</a>) {
        BOOST_ERROR(<span class="stringliteral">&quot;wrong EU HICP data (&quot;</span>
                    &lt;&lt; euhicp.name() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
                    &lt;&lt; euhicp.frequency() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
                    &lt;&lt; euhicp.revised() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
                    &lt;&lt; euhicp.interpolated() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
                    &lt;&lt; euhicp.availabilityLag() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);
    }

    <a class="code" href="class_quant_lib_1_1_u_k_r_p_i.html" title="UK Retail Price Inflation Index.">UKRPI</a> ukrpi(<span class="keyword">false</span>);
    <span class="keywordflow">if</span> (ukrpi.name() != <span class="stringliteral">&quot;UK RPI&quot;</span>
        || ukrpi.frequency() != <a class="code" href="namespace_quant_lib.html#abfa020992bcf412e2bc99f56d4381b4aa4880ecc06ab77951b9e412bffce54bcc" title="once a month">Monthly</a>
        || ukrpi.revised()
        || ukrpi.interpolated()
        || ukrpi.availabilityLag() != 1*<a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3a3d158b618e2bf6e66da9aca81f706dae">Months</a>) {
        BOOST_ERROR(<span class="stringliteral">&quot;wrong UK RPI data (&quot;</span>
                    &lt;&lt; ukrpi.name() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
                    &lt;&lt; ukrpi.frequency() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
                    &lt;&lt; ukrpi.revised() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
                    &lt;&lt; ukrpi.interpolated() &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
                    &lt;&lt; ukrpi.availabilityLag() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);
    }

    <span class="comment">// Retrieval test.</span>
    <span class="comment">//----------------</span>
    <span class="comment">// make sure of the evaluation date</span>
    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> evaluationDate(13, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>, 2007);
    evaluationDate = <a class="code" href="class_quant_lib_1_1_united_kingdom.html" title="United Kingdom calendars.">UnitedKingdom</a>().<a class="code" href="class_quant_lib_1_1_calendar.html#a0c62d180f6bed87f598320cd67e44b70">adjust</a>(evaluationDate);
    Settings::instance().evaluationDate() = evaluationDate;

    <span class="comment">// fixing data</span>
    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> from(1, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a2c2c73e76831dec3bfead45af4e7e293">January</a>, 2005);
    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> to(13, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>, 2007);
    <a class="code" href="class_quant_lib_1_1_schedule.html" title="Payment schedule.">Schedule</a> rpiSchedule = <a class="code" href="class_quant_lib_1_1_make_schedule.html" title="helper class">MakeSchedule</a>().<a class="code" href="class_quant_lib_1_1_make_schedule.html#add57ea43db5c17ebad4888a9b92aadcb">from</a>(from).<a class="code" href="class_quant_lib_1_1_make_schedule.html#ad0013dce5b61be709a7b09e66f3c2b3e">to</a>(to)
    .<a class="code" href="class_quant_lib_1_1_make_schedule.html#a4171b3ab3218660704b4697a4b6a8c53">withTenor</a>(1*<a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3a3d158b618e2bf6e66da9aca81f706dae">Months</a>)
    .<a class="code" href="class_quant_lib_1_1_make_schedule.html#a577b0ca13a87e6cd6b4c502b6eed0a0d">withCalendar</a>(<a class="code" href="class_quant_lib_1_1_united_kingdom.html" title="United Kingdom calendars.">UnitedKingdom</a>())
    .<a class="code" href="class_quant_lib_1_1_make_schedule.html#a7187a198c205f6577b8e2dcca0aba3e6">withConvention</a>(<a class="code" href="namespace_quant_lib.html#ac95a4b5bc8017f1eb4ad0b54a9af3881aaa730fc5548402fd95e95f1c57f9a535">ModifiedFollowing</a>);

    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> fixData[] = { 189.9, 189.9, 189.6, 190.5, 191.6, 192.0,
        192.2, 192.2, 192.6, 193.1, 193.3, 193.6,
        194.1, 193.4, 194.2, 195.0, 196.5, 197.7,
        198.5, 198.5, 199.2, 200.1, 200.4, 201.1,
        202.7, 201.6, 203.1, 204.4, 205.4, 206.2,
        207.3, 206.1 };

    <span class="keywordtype">bool</span> interp = <span class="keyword">false</span>;
    boost::shared_ptr&lt;UKRPI&gt; iir(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_u_k_r_p_i.html" title="UK Retail Price Inflation Index.">UKRPI</a>(interp));
    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(fixData); i++) {
        iir-&gt;addFixing(rpiSchedule[i], fixData[i]);
    }

    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> todayMinusLag = evaluationDate - iir-&gt;availabilityLag();
    std::pair&lt;Date,Date&gt; lim = <a class="code" href="namespace_quant_lib.html#a375f5896d4cba24bbe748bf6911e140d" title="utility function giving the inflation period for a given date">inflationPeriod</a>(todayMinusLag, iir-&gt;frequency());
    todayMinusLag = lim.first;

    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> eps = 1.0e-8;

    <span class="comment">// -1 because last value not yet available,</span>
    <span class="comment">// (no TS so can&#39;t forecast).</span>
    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i&lt;rpiSchedule.<a class="code" href="class_quant_lib_1_1_schedule.html#a3f9f67b0f8653cb82f87eaeef9bfbbd8">size</a>()-1;i++) {
        std::pair&lt;Date,Date&gt; lim = <a class="code" href="namespace_quant_lib.html#a375f5896d4cba24bbe748bf6911e140d" title="utility function giving the inflation period for a given date">inflationPeriod</a>(rpiSchedule[i],
                                                   iir-&gt;frequency());
        <span class="keywordflow">for</span> (<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a06d0bee201af9d379ec8f9563ecf7f66">d</a>=lim.first; <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a06d0bee201af9d379ec8f9563ecf7f66">d</a>&lt;=lim.second; <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a06d0bee201af9d379ec8f9563ecf7f66">d</a>++) {
            <span class="keywordflow">if</span> (<a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a06d0bee201af9d379ec8f9563ecf7f66">d</a> &lt; <a class="code" href="namespace_quant_lib.html#a375f5896d4cba24bbe748bf6911e140d" title="utility function giving the inflation period for a given date">inflationPeriod</a>(todayMinusLag,iir-&gt;frequency()).first) {
                <span class="keywordflow">if</span> (std::fabs(iir-&gt;fixing(<a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a06d0bee201af9d379ec8f9563ecf7f66">d</a>) - fixData[i]) &gt; eps)
                    BOOST_ERROR(<span class="stringliteral">&quot;Fixings not constant within a period: &quot;</span>
                                &lt;&lt; iir-&gt;fixing(<a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a06d0bee201af9d379ec8f9563ecf7f66">d</a>)
                                &lt;&lt; <span class="stringliteral">&quot;, should be &quot;</span> &lt;&lt; fixData[i]);
            }
        }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a35dc83600662f55a18638234009d48f4"></a><!-- doxytag: member="InflationTest::testZeroTermStructure" ref="a35dc83600662f55a18638234009d48f4" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_inflation_test.html#a35dc83600662f55a18638234009d48f4">InflationTest::testZeroTermStructure</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="inflation_8cpp_source.html#l00179">179</a> of file <a class="el" href="inflation_8cpp_source.html">inflation.cpp</a>.</p>

<p>References <a class="el" href="calendar_8cpp_source.html#l00045">QuantLib::Calendar::adjust()</a>, <a class="el" href="indexedcashflow_8cpp_source.html#l00025">QuantLib::IndexedCashFlow::amount()</a>, <a class="el" href="date_8hpp_source.html#l00048">QuantLib::April</a>, <a class="el" href="date_8hpp_source.html#l00052">QuantLib::August</a>, <a class="el" href="indexedcashflow_8hpp_source.html#l00062">QuantLib::IndexedCashFlow::baseDate()</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00128">anonymous_namespace{marketmodel.cpp}::calendar</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00137">anonymous_namespace{marketmodel.cpp}::d</a>, <a class="el" href="timeunit_8hpp_source.html#l00037">QuantLib::Days</a>, <a class="el" href="date_8hpp_source.html#l00056">QuantLib::December</a>, <a class="el" href="settings_8hpp_source.html#l00153">QuantLib::Settings::evaluationDate()</a>, <a class="el" href="date_8hpp_source.html#l00046">QuantLib::February</a>, <a class="el" href="indexedcashflow_8hpp_source.html#l00063">QuantLib::IndexedCashFlow::fixingDate()</a>, <a class="el" href="ql_2time_2schedule_8cpp_source.html#l00453">QuantLib::MakeSchedule::from()</a>, <a class="el" href="inflationtermstructure_8cpp_source.html#l00283">QuantLib::inflationPeriod()</a>, <a class="el" href="class_quant_lib_1_1_singleton.html#ab79257029fa4841505227497a56cbd93">QuantLib::Singleton&lt; Settings &gt;::instance()</a>, <a class="el" href="date_8hpp_source.html#l00045">QuantLib::January</a>, <a class="el" href="date_8hpp_source.html#l00051">QuantLib::July</a>, <a class="el" href="date_8hpp_source.html#l00050">QuantLib::June</a>, <a class="el" href="ql_2instruments_2swap_8hpp_source.html#l00071">QuantLib::Swap::legNPV()</a>, <a class="el" href="test-suite_2utilities_8hpp_source.html#l00039">LENGTH</a>, <a class="el" href="handle_8hpp_source.html#l00191">QuantLib::RelinkableHandle&lt; T &gt;::linkTo()</a>, <a class="el" href="inflation_8cpp_source.html#l00064">anonymous_namespace{inflation.cpp}::makeHelpers()</a>, <a class="el" href="date_8hpp_source.html#l00047">QuantLib::March</a>, <a class="el" href="zerocouponinflationswap_8hpp_source.html#l00091">QuantLib::ZeroCouponInflationSwap::maturityDate()</a>, <a class="el" href="date_8hpp_source.html#l00049">QuantLib::May</a>, <a class="el" href="businessdayconvention_8hpp_source.html#l00044">QuantLib::ModifiedFollowing</a>, <a class="el" href="frequency_8hpp_source.html#l00044">QuantLib::Monthly</a>, <a class="el" href="timeunit_8hpp_source.html#l00039">QuantLib::Months</a>, <a class="el" href="inflation_8cpp_source.html#l00057">anonymous_namespace{inflation.cpp}::nominalTermStructure()</a>, <a class="el" href="indexedcashflow_8hpp_source.html#l00061">QuantLib::IndexedCashFlow::notional()</a>, <a class="el" href="date_8hpp_source.html#l00055">QuantLib::November</a>, <a class="el" href="instrument_8hpp_source.html#l00186">QuantLib::Instrument::NPV()</a>, <a class="el" href="date_8hpp_source.html#l00054">QuantLib::October</a>, <a class="el" href="zerocouponinflationswap_8hpp_source.html#l00068">QuantLib::ZeroCouponInflationSwap::Payer</a>, <a class="el" href="analyticgjrgarchengine_8cpp_source.html#l00040">QuantLib::anonymous_namespace{analyticgjrgarchengine.cpp}::pow()</a>, <a class="el" href="errors_8hpp_source.html#l00086">QL_REQUIRE</a>, <a class="el" href="dataformatters_8hpp_source.html#l00129">QuantLib::io::rate()</a>, <a class="el" href="date_8hpp_source.html#l00053">QuantLib::September</a>, <a class="el" href="instrument_8hpp_source.html#l00133">QuantLib::Instrument::setPricingEngine()</a>, <a class="el" href="ql_2time_2schedule_8hpp_source.html#l00058">QuantLib::Schedule::size()</a>, <a class="el" href="quantlibbenchmark_8cpp_source.html#l00150">anonymous_namespace{quantlibbenchmark.cpp}::t</a>, <a class="el" href="ql_2time_2schedule_8cpp_source.html#l00458">QuantLib::MakeSchedule::to()</a>, <a class="el" href="ql_2time_2schedule_8cpp_source.html#l00473">QuantLib::MakeSchedule::withCalendar()</a>, <a class="el" href="ql_2time_2schedule_8cpp_source.html#l00478">QuantLib::MakeSchedule::withConvention()</a>, <a class="el" href="ql_2time_2schedule_8cpp_source.html#l00463">QuantLib::MakeSchedule::withTenor()</a>, and <a class="el" href="date_8cpp_source.html#l00072">QuantLib::Date::year()</a>.</p>

<p>Referenced by <a class="el" href="inflation_8cpp_source.html#l00953">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                          {
    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing zero inflation term structure...&quot;</span>);

    <a class="code" href="class_quant_lib_1_1_saved_settings.html">SavedSettings</a> backup;
    <a class="code" href="class_quant_lib_1_1_index_history_cleaner.html">IndexHistoryCleaner</a> cleaner;

    <span class="comment">// try the Zero UK</span>
    <a class="code" href="class_quant_lib_1_1_calendar.html" title="calendar class">Calendar</a> <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a86803e870514df19c0cf3863edb2b8f8">calendar</a> = <a class="code" href="class_quant_lib_1_1_united_kingdom.html" title="United Kingdom calendars.">UnitedKingdom</a>();
    <a class="code" href="namespace_quant_lib.html#ac95a4b5bc8017f1eb4ad0b54a9af3881" title="Business Day conventions.">BusinessDayConvention</a> bdc = <a class="code" href="namespace_quant_lib.html#ac95a4b5bc8017f1eb4ad0b54a9af3881aaa730fc5548402fd95e95f1c57f9a535">ModifiedFollowing</a>;
    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> evaluationDate(13, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>, 2007);
    evaluationDate = calendar.<a class="code" href="class_quant_lib_1_1_calendar.html#a0c62d180f6bed87f598320cd67e44b70">adjust</a>(evaluationDate);
    Settings::instance().evaluationDate() = evaluationDate;

    <span class="comment">// fixing data</span>
    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> from(1, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a2c2c73e76831dec3bfead45af4e7e293">January</a>, 2005);
    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> to(13, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>, 2007);
    <a class="code" href="class_quant_lib_1_1_schedule.html" title="Payment schedule.">Schedule</a> rpiSchedule = <a class="code" href="class_quant_lib_1_1_make_schedule.html" title="helper class">MakeSchedule</a>().<a class="code" href="class_quant_lib_1_1_make_schedule.html#add57ea43db5c17ebad4888a9b92aadcb">from</a>(from).<a class="code" href="class_quant_lib_1_1_make_schedule.html#ad0013dce5b61be709a7b09e66f3c2b3e">to</a>(to)
    .<a class="code" href="class_quant_lib_1_1_make_schedule.html#a4171b3ab3218660704b4697a4b6a8c53">withTenor</a>(1*<a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3a3d158b618e2bf6e66da9aca81f706dae">Months</a>)
    .<a class="code" href="class_quant_lib_1_1_make_schedule.html#a577b0ca13a87e6cd6b4c502b6eed0a0d">withCalendar</a>(<a class="code" href="class_quant_lib_1_1_united_kingdom.html" title="United Kingdom calendars.">UnitedKingdom</a>())
    .<a class="code" href="class_quant_lib_1_1_make_schedule.html#a7187a198c205f6577b8e2dcca0aba3e6">withConvention</a>(<a class="code" href="namespace_quant_lib.html#ac95a4b5bc8017f1eb4ad0b54a9af3881aaa730fc5548402fd95e95f1c57f9a535">ModifiedFollowing</a>);

    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> fixData[] = { 189.9, 189.9, 189.6, 190.5, 191.6, 192.0,
        192.2, 192.2, 192.6, 193.1, 193.3, 193.6,
        194.1, 193.4, 194.2, 195.0, 196.5, 197.7,
        198.5, 198.5, 199.2, 200.1, 200.4, 201.1,
        202.7, 201.6, 203.1, 204.4, 205.4, 206.2,
        207.3};

    <a class="code" href="class_quant_lib_1_1_relinkable_handle.html">RelinkableHandle&lt;ZeroInflationTermStructure&gt;</a> hz;
    <span class="keywordtype">bool</span> interp = <span class="keyword">false</span>;
    boost::shared_ptr&lt;UKRPI&gt; iiUKRPI(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_u_k_r_p_i.html" title="UK Retail Price Inflation Index.">UKRPI</a>(interp, hz));
    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(fixData); i++) {
        iiUKRPI-&gt;addFixing(rpiSchedule[i], fixData[i]);
    }

    boost::shared_ptr&lt;ZeroInflationIndex&gt; ii = boost::dynamic_pointer_cast&lt;<a class="code" href="class_quant_lib_1_1_zero_inflation_index.html" title="Base class for zero inflation indices.">ZeroInflationIndex</a>&gt;(iiUKRPI);
    boost::shared_ptr&lt;YieldTermStructure&gt; nominalTS = <a class="code" href="namespaceanonymous__namespace_02inflation_8cpp_03.html#a80203bfc7215454dcec74ae038a0e436">nominalTermStructure</a>();

    <span class="comment">// now build the zero inflation curve</span>
    Datum zcData[] = {
        { <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(13, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>, 2008), 2.93 },
        { <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(13, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>, 2009), 2.95 },
        { <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(13, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>, 2010), 2.965 },
        { <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(15, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>, 2011), 2.98 },
        { <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(13, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>, 2012), 3.0 },
        { <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(13, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>, 2014), 3.06 },
        { <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(13, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>, 2017), 3.175 },
        { <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(13, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>, 2019), 3.243 },
        { <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(15, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>, 2022), 3.293 },
        { <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>, 2027), 3.338 },
        { <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(13, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>, 2032), 3.348 },
        { <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(15, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>, 2037), 3.348 },
        { <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(13, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>, 2047), 3.308 },
        { <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(13, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>, 2057), 3.228 }
    };

    <a class="code" href="class_quant_lib_1_1_period.html">Period</a> observationLag = <a class="code" href="class_quant_lib_1_1_period.html">Period</a>(2,<a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3a3d158b618e2bf6e66da9aca81f706dae">Months</a>);
    <a class="code" href="class_quant_lib_1_1_day_counter.html" title="day counter class">DayCounter</a> dc = <a class="code" href="class_quant_lib_1_1_thirty360.html" title="30/360 day count convention">Thirty360</a>();
    <a class="code" href="namespace_quant_lib.html#abfa020992bcf412e2bc99f56d4381b4a" title="Frequency of events.">Frequency</a> frequency = <a class="code" href="namespace_quant_lib.html#abfa020992bcf412e2bc99f56d4381b4aa4880ecc06ab77951b9e412bffce54bcc" title="once a month">Monthly</a>;
    std::vector&lt;boost::shared_ptr&lt;BootstrapHelper&lt;ZeroInflationTermStructure&gt; &gt; &gt; helpers =
    <a class="code" href="namespaceanonymous__namespace_02inflation_8cpp_03.html#a728a3a5b80654ff196e0eb5095a857cd">makeHelpers</a>&lt;<a class="code" href="class_quant_lib_1_1_zero_inflation_term_structure.html" title="Interface for zero inflation term structures.">ZeroInflationTermStructure</a>,<a class="code" href="class_quant_lib_1_1_zero_coupon_inflation_swap_helper.html" title="Zero-coupon inflation-swap bootstrap helper.">ZeroCouponInflationSwapHelper</a>,
                <a class="code" href="class_quant_lib_1_1_zero_inflation_index.html" title="Base class for zero inflation indices.">ZeroInflationIndex</a>&gt;(zcData, <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(zcData), ii,
                                    observationLag,
                                    <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a86803e870514df19c0cf3863edb2b8f8">calendar</a>, bdc, dc);

    <a class="code" href="namespace_quant_lib.html#a919ba3567cc89fca373f8d6b8e80126b" title="interest rates">Rate</a> baseZeroRate = zcData[0].rate/100.0;
    boost::shared_ptr&lt;PiecewiseZeroInflationCurve&lt;Linear&gt; &gt; pZITS(
                        <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_piecewise_zero_inflation_curve.html" title="Piecewise zero-inflation term structure.">PiecewiseZeroInflationCurve&lt;Linear&gt;</a>(
                        evaluationDate, calendar, dc, observationLag,
                        frequency, ii-&gt;interpolated(), baseZeroRate,
                        <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a>(nominalTS), helpers));
    pZITS-&gt;recalculate();

    <span class="comment">// first check that the zero rates on the curve match the data</span>
    <span class="comment">// and that the helpers give the correct impled rates</span>
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> eps = 0.00000001;
    <span class="keywordtype">bool</span> forceLinearInterpolation = <span class="keyword">false</span>;
    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(zcData); i++) {
        BOOST_REQUIRE_MESSAGE(std::fabs(zcData[i].<a class="code" href="group__manips.html#gac9152aad6a69c41f5d30bb1dcb9b2236" title="output rates and spreads as percentages">rate</a>/100.0
            - pZITS-&gt;zeroRate(zcData[i].date, observationLag, forceLinearInterpolation)) &lt; eps,
            <span class="stringliteral">&quot;ZITS zeroRate != instrument &quot;</span>
            &lt;&lt; pZITS-&gt;zeroRate(zcData[i].date, observationLag, forceLinearInterpolation)
            &lt;&lt; <span class="stringliteral">&quot; vs &quot;</span> &lt;&lt; zcData[i].rate/100.0
            &lt;&lt; <span class="stringliteral">&quot; interpolation: &quot;</span> &lt;&lt; ii-&gt;interpolated()
            &lt;&lt; <span class="stringliteral">&quot; forceLinearInterpolation &quot;</span> &lt;&lt; forceLinearInterpolation);
        BOOST_REQUIRE_MESSAGE(std::fabs(helpers[i]-&gt;impliedQuote()
            - zcData[i].<a class="code" href="group__manips.html#gac9152aad6a69c41f5d30bb1dcb9b2236" title="output rates and spreads as percentages">rate</a>/100.0) &lt; eps,
            <span class="stringliteral">&quot;ZITS implied quote != instrument &quot;</span>
            &lt;&lt; helpers[i]-&gt;impliedQuote()
            &lt;&lt; <span class="stringliteral">&quot; vs &quot;</span> &lt;&lt; zcData[i].<a class="code" href="group__manips.html#gac9152aad6a69c41f5d30bb1dcb9b2236" title="output rates and spreads as percentages">rate</a>/100.0);
    }


    <span class="comment">// now test the forecasting capability of the index.</span>
    hz.<a class="code" href="class_quant_lib_1_1_relinkable_handle.html#acceb0d87ae2ecfbad21e0862e6d2e87d">linkTo</a>(pZITS);
    from = hz-&gt;baseDate();
    to = hz-&gt;maxDate()-1*<a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3a3d158b618e2bf6e66da9aca81f706dae">Months</a>; <span class="comment">// a bit of margin for adjustments</span>
    <a class="code" href="class_quant_lib_1_1_schedule.html" title="Payment schedule.">Schedule</a> testIndex = <a class="code" href="class_quant_lib_1_1_make_schedule.html" title="helper class">MakeSchedule</a>().<a class="code" href="class_quant_lib_1_1_make_schedule.html#add57ea43db5c17ebad4888a9b92aadcb">from</a>(from).<a class="code" href="class_quant_lib_1_1_make_schedule.html#ad0013dce5b61be709a7b09e66f3c2b3e">to</a>(to)
                            .<a class="code" href="class_quant_lib_1_1_make_schedule.html#a4171b3ab3218660704b4697a4b6a8c53">withTenor</a>(1*<a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3a3d158b618e2bf6e66da9aca81f706dae">Months</a>)
                            .<a class="code" href="class_quant_lib_1_1_make_schedule.html#a577b0ca13a87e6cd6b4c502b6eed0a0d">withCalendar</a>(<a class="code" href="class_quant_lib_1_1_united_kingdom.html" title="United Kingdom calendars.">UnitedKingdom</a>())
                            .<a class="code" href="class_quant_lib_1_1_make_schedule.html#a7187a198c205f6577b8e2dcca0aba3e6">withConvention</a>(<a class="code" href="namespace_quant_lib.html#ac95a4b5bc8017f1eb4ad0b54a9af3881aaa730fc5548402fd95e95f1c57f9a535">ModifiedFollowing</a>);


    <span class="comment">// we are testing UKRPI which is not interpolated</span>
    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> bd = hz-&gt;baseDate();
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> bf = ii-&gt;fixing(bd);
    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i&lt;testIndex.<a class="code" href="class_quant_lib_1_1_schedule.html#a3f9f67b0f8653cb82f87eaeef9bfbbd8">size</a>();i++) {
        <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a06d0bee201af9d379ec8f9563ecf7f66">d</a> = testIndex[i];
        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> z = hz-&gt;zeroRate(d, <a class="code" href="class_quant_lib_1_1_period.html">Period</a>(0,<a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3ac2d73aad1a6496a6481563e7b5e62b36">Days</a>));
        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> <a class="code" href="namespaceanonymous__namespace_02quantlibbenchmark_8cpp_03.html#a7a969063fde0030bd36b46055e824c34">t</a> = hz-&gt;dayCounter().yearFraction(bd, d);
        <span class="keywordflow">if</span>(!ii-&gt;interpolated()) <span class="comment">// because fixing constant over period</span>
            t = hz-&gt;dayCounter().yearFraction(bd,
                <a class="code" href="namespace_quant_lib.html#a375f5896d4cba24bbe748bf6911e140d" title="utility function giving the inflation period for a given date">inflationPeriod</a>(d, ii-&gt;frequency()).first);
        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> calc = bf * <a class="code" href="namespace_quant_lib_1_1anonymous__namespace_02analyticgjrgarchengine_8cpp_03.html#a3011339a7df8a9688c1a29a9b6cff359">pow</a>( 1+z, t);
        <span class="keywordflow">if</span> (t&lt;=0)
            calc = ii-&gt;fixing(d,<span class="keyword">false</span>); <span class="comment">// still historical</span>
        <span class="keywordflow">if</span> (std::fabs(calc - ii-&gt;fixing(d,<span class="keyword">true</span>))/10000.0 &gt; eps)
            BOOST_ERROR(<span class="stringliteral">&quot;ZC index does not forecast correctly for date &quot;</span> &lt;&lt; d
                        &lt;&lt; <span class="stringliteral">&quot; from base date &quot;</span> &lt;&lt; bd
                        &lt;&lt; <span class="stringliteral">&quot; with fixing &quot;</span> &lt;&lt; bf
                        &lt;&lt; <span class="stringliteral">&quot;, correct:  &quot;</span> &lt;&lt; calc
                        &lt;&lt; <span class="stringliteral">&quot;, fix: &quot;</span> &lt;&lt; ii-&gt;fixing(d,<span class="keyword">true</span>)
                        &lt;&lt; <span class="stringliteral">&quot;, t &quot;</span> &lt;&lt; <a class="code" href="namespaceanonymous__namespace_02quantlibbenchmark_8cpp_03.html#a7a969063fde0030bd36b46055e824c34">t</a>);
    }


    <span class="comment">//===========================================================================================</span>
    <span class="comment">// Test zero-inflation-indexed (i.e. cpi ratio) cashflow</span>
    <span class="comment">// just ordinary indexed cashflow with a zero inflation index</span>

    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> baseDate(1, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a2c2c73e76831dec3bfead45af4e7e293">January</a>, 2006);
    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> fixDate(1, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>, 2014);
    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> payDate=<a class="code" href="class_quant_lib_1_1_united_kingdom.html" title="United Kingdom calendars.">UnitedKingdom</a>().<a class="code" href="class_quant_lib_1_1_calendar.html#a0c62d180f6bed87f598320cd67e44b70">adjust</a>(fixDate+<a class="code" href="class_quant_lib_1_1_period.html">Period</a>(3,<a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3a3d158b618e2bf6e66da9aca81f706dae">Months</a>),<a class="code" href="namespace_quant_lib.html#ac95a4b5bc8017f1eb4ad0b54a9af3881aaa730fc5548402fd95e95f1c57f9a535">ModifiedFollowing</a>);
    boost::shared_ptr&lt;Index&gt; ind = boost::dynamic_pointer_cast&lt;<a class="code" href="class_quant_lib_1_1_index.html" title="purely virtual base class for indexes">Index</a>&gt;(ii);
    BOOST_REQUIRE_MESSAGE(ind,<span class="stringliteral">&quot;dynamic_pointer_cast to Index from InflationIndex failed&quot;</span>);

    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> notional = 1000000.0;<span class="comment">//1m</span>
    <a class="code" href="class_quant_lib_1_1_indexed_cash_flow.html" title="Cash flow dependent on an index ratio.">IndexedCashFlow</a> iicf(notional,ind,baseDate,fixDate,payDate);
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> correctIndexed = ii-&gt;fixing(iicf.fixingDate())/ii-&gt;fixing(iicf.baseDate());
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> calculatedIndexed = iicf.amount()/iicf.notional();
    BOOST_REQUIRE_MESSAGE(std::fabs(correctIndexed - calculatedIndexed) &lt; eps,
               <span class="stringliteral">&quot;IndexedCashFlow indexing wrong: &quot;</span> &lt;&lt; calculatedIndexed &lt;&lt; <span class="stringliteral">&quot; vs correct = &quot;</span>
               &lt;&lt; correctIndexed);


    <span class="comment">//===========================================================================================</span>
    <span class="comment">// Test zero coupon swap</span>

    <span class="comment">// first make one ...</span>

    boost::shared_ptr&lt;ZeroInflationIndex&gt; zii = boost::dynamic_pointer_cast&lt;<a class="code" href="class_quant_lib_1_1_zero_inflation_index.html" title="Base class for zero inflation indices.">ZeroInflationIndex</a>&gt;(ii);
    BOOST_REQUIRE_MESSAGE(zii,<span class="stringliteral">&quot;dynamic_pointer_cast to ZeroInflationIndex from UKRPI failed&quot;</span>);
    <a class="code" href="class_quant_lib_1_1_zero_coupon_inflation_swap.html" title="Zero-coupon inflation-indexed swap.">ZeroCouponInflationSwap</a> nzcis(ZeroCouponInflationSwap::Payer,
                                     1000000.0,
                                     evaluationDate,
                                     zcData[6].date,    <span class="comment">// end date = maturity</span>
                                     calendar, bdc, dc, zcData[6].<a class="code" href="group__manips.html#gac9152aad6a69c41f5d30bb1dcb9b2236" title="output rates and spreads as percentages">rate</a>/100.0, <span class="comment">// fixed rate</span>
                                     zii, observationLag);

    <span class="comment">// N.B. no coupon pricer because it is not a coupon, effect of inflation curve via</span>
    <span class="comment">//      inflation curve attached to the inflation index.</span>
    <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> hTS(nominalTS);
    boost::shared_ptr&lt;PricingEngine&gt; sppe(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_discounting_swap_engine.html">DiscountingSwapEngine</a>(hTS));
    nzcis.setPricingEngine(sppe);

    <span class="comment">// ... and price it, should be zero</span>
    BOOST_CHECK_MESSAGE(fabs(nzcis.NPV())&lt;0.00001,<span class="stringliteral">&quot;ZCIS does not reprice to zero &quot;</span>
                        &lt;&lt; nzcis.NPV()
                        &lt;&lt; evaluationDate &lt;&lt; <span class="stringliteral">&quot; to &quot;</span> &lt;&lt; zcData[6].date &lt;&lt; <span class="stringliteral">&quot; becoming &quot;</span> &lt;&lt; nzcis.maturityDate()
                        &lt;&lt; <span class="stringliteral">&quot; rate &quot;</span> &lt;&lt; zcData[6].rate
                        &lt;&lt; <span class="stringliteral">&quot; fixed leg &quot;</span> &lt;&lt; nzcis.legNPV(0)
                        &lt;&lt; <span class="stringliteral">&quot; indexed-predicted inflated leg &quot;</span> &lt;&lt; nzcis.legNPV(1)
                        &lt;&lt; <span class="stringliteral">&quot; discount &quot;</span> &lt;&lt; nominalTS-&gt;discount(nzcis.maturityDate())
                        );


    <span class="comment">//===========================================================================================</span>
    <span class="comment">// Test multiplicative seasonality in price</span>
    <span class="comment">//</span>

    <span class="comment">//Seasonality factors NOT normalized</span>
    <span class="comment">//and UKRPI is not interpolated</span>
    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> trueBaseDate = <a class="code" href="namespace_quant_lib.html#a375f5896d4cba24bbe748bf6911e140d" title="utility function giving the inflation period for a given date">inflationPeriod</a>(hz-&gt;baseDate(), ii-&gt;frequency()).second;
    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> seasonallityBaseDate(31,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a2c2c73e76831dec3bfead45af4e7e293">January</a>,trueBaseDate.<a class="code" href="class_quant_lib_1_1_date.html#a5870de89027afdcde31fd95cb9eedd73">year</a>());
    std::vector&lt;Rate&gt; seasonalityFactors(12);
    seasonalityFactors[0] = 1.003245;
    seasonalityFactors[1] = 1.000000;
    seasonalityFactors[2] = 0.999715;
    seasonalityFactors[3] = 1.000495;
    seasonalityFactors[4] = 1.000929;
    seasonalityFactors[5] = 0.998687;
    seasonalityFactors[6] = 0.995949;
    seasonalityFactors[7] = 0.994682;
    seasonalityFactors[8] = 0.995949;
    seasonalityFactors[9] = 1.000519;
    seasonalityFactors[10] = 1.003705;
    seasonalityFactors[11] = 1.004186;

    <span class="comment">//Creating two different seasonality objects</span>
    <span class="comment">//</span>
    boost::shared_ptr&lt;MultiplicativePriceSeasonality&gt; seasonality_1(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_multiplicative_price_seasonality.html" title="Multiplicative seasonality in the price index (CPI/RPI/HICP/etc).">MultiplicativePriceSeasonality</a>());
    std::vector&lt;Rate&gt; seasonalityFactors_1(12, 1.0);
    seasonality_1-&gt;set(seasonallityBaseDate,<a class="code" href="namespace_quant_lib.html#abfa020992bcf412e2bc99f56d4381b4aa4880ecc06ab77951b9e412bffce54bcc" title="once a month">Monthly</a>,seasonalityFactors_1);

    boost::shared_ptr&lt;MultiplicativePriceSeasonality&gt; seasonality_real(
        <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_multiplicative_price_seasonality.html" title="Multiplicative seasonality in the price index (CPI/RPI/HICP/etc).">MultiplicativePriceSeasonality</a>(seasonallityBaseDate,<a class="code" href="namespace_quant_lib.html#abfa020992bcf412e2bc99f56d4381b4aa4880ecc06ab77951b9e412bffce54bcc" title="once a month">Monthly</a>,seasonalityFactors));
    <span class="comment">//Testing seasonality correction when seasonality factors are = 1</span>
    <span class="comment">//</span>
    <a class="code" href="namespace_quant_lib.html#a919ba3567cc89fca373f8d6b8e80126b" title="interest rates">Rate</a> fixing[] = {
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a2c2c73e76831dec3bfead45af4e7e293">January</a>  ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a3f87835e65eb79538ed8df9dac30e8e9">February</a> ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a982c9e93cf4b41f4b71b5c256df6191c">March</a>    ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a5a127587551e502c20dd25f3cb95c670">April</a>    ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4ab7f0de9de43d10d9740019f24a55b001">May</a>      ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a88068fdc3953ea6e86797179bb2f7d70">June</a>     ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a6e2eb13b444eddc908b702f9e3030b15">July</a>     ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>   ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4ad4e26bc88f6e25cf9e31ba9400771d49">September</a>,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a11958aa29b8f50ce93f5d5f6f86c545f">October</a>  ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4acb4e488d1e8bac8be4f273d27e102b61">November</a> ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4ad4988bf6760edb92c088bb47d4b61dc5">December</a> ,2013),<span class="keyword">true</span>)
    };

    hz-&gt;setSeasonality(seasonality_1);
    <a class="code" href="errors_8hpp.html#a7a9bcab8006882bc7d5302a0861ab1a6" title="throw an error if the given pre-condition is not verified">QL_REQUIRE</a>(hz-&gt;hasSeasonality(),<span class="stringliteral">&quot;[44] incorrectly believes NO seasonality correction&quot;</span>);

    <a class="code" href="namespace_quant_lib.html#a919ba3567cc89fca373f8d6b8e80126b" title="interest rates">Rate</a> seasonalityFixing_1[] = {
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a2c2c73e76831dec3bfead45af4e7e293">January</a>  ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a3f87835e65eb79538ed8df9dac30e8e9">February</a> ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a982c9e93cf4b41f4b71b5c256df6191c">March</a>    ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a5a127587551e502c20dd25f3cb95c670">April</a>    ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4ab7f0de9de43d10d9740019f24a55b001">May</a>      ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a88068fdc3953ea6e86797179bb2f7d70">June</a>     ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a6e2eb13b444eddc908b702f9e3030b15">July</a>     ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>   ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4ad4e26bc88f6e25cf9e31ba9400771d49">September</a>,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a11958aa29b8f50ce93f5d5f6f86c545f">October</a>  ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4acb4e488d1e8bac8be4f273d27e102b61">November</a> ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4ad4988bf6760edb92c088bb47d4b61dc5">December</a> ,2013),<span class="keyword">true</span>)

    };

    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;12;i++){
        <span class="keywordflow">if</span>(std::fabs(fixing[i] - seasonalityFixing_1[i]) &gt; eps) {
            BOOST_ERROR(<span class="stringliteral">&quot;Seasonality doesn&#39;t work correctly when seasonality factors are set = 1&quot;</span>);
        }
    }

    <span class="comment">//Testing seasonality correction when seasonality factors are different from 1</span>
    <span class="comment">//</span>
    <span class="comment">//0.998687 is the seasonality factor corresponding to June (the base CPI curve month)</span>
    <span class="comment">//</span>
    <a class="code" href="namespace_quant_lib.html#a919ba3567cc89fca373f8d6b8e80126b" title="interest rates">Rate</a> expectedFixing[] = {
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a2c2c73e76831dec3bfead45af4e7e293">January</a>  ,2013),<span class="keyword">true</span>) * 1.003245/0.998687,
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a3f87835e65eb79538ed8df9dac30e8e9">February</a> ,2013),<span class="keyword">true</span>) * 1.000000/0.998687,
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a982c9e93cf4b41f4b71b5c256df6191c">March</a>    ,2013),<span class="keyword">true</span>) * 0.999715/0.998687,
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a5a127587551e502c20dd25f3cb95c670">April</a>    ,2013),<span class="keyword">true</span>) * 1.000495/0.998687,
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4ab7f0de9de43d10d9740019f24a55b001">May</a>      ,2013),<span class="keyword">true</span>) * 1.000929/0.998687,
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a88068fdc3953ea6e86797179bb2f7d70">June</a>     ,2013),<span class="keyword">true</span>) * 0.998687/0.998687,
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a6e2eb13b444eddc908b702f9e3030b15">July</a>     ,2013),<span class="keyword">true</span>) * 0.995949/0.998687,
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>   ,2013),<span class="keyword">true</span>) * 0.994682/0.998687,
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4ad4e26bc88f6e25cf9e31ba9400771d49">September</a>,2013),<span class="keyword">true</span>) * 0.995949/0.998687,
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a11958aa29b8f50ce93f5d5f6f86c545f">October</a>  ,2013),<span class="keyword">true</span>) * 1.000519/0.998687,
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4acb4e488d1e8bac8be4f273d27e102b61">November</a> ,2013),<span class="keyword">true</span>) * 1.003705/0.998687,
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4ad4988bf6760edb92c088bb47d4b61dc5">December</a> ,2013),<span class="keyword">true</span>) * 1.004186/0.998687
    };

    hz-&gt;setSeasonality(seasonality_real);

    <a class="code" href="namespace_quant_lib.html#a919ba3567cc89fca373f8d6b8e80126b" title="interest rates">Rate</a> seasonalityFixing_real[] = {
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a2c2c73e76831dec3bfead45af4e7e293">January</a>  ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a3f87835e65eb79538ed8df9dac30e8e9">February</a> ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a982c9e93cf4b41f4b71b5c256df6191c">March</a>    ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a5a127587551e502c20dd25f3cb95c670">April</a>    ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4ab7f0de9de43d10d9740019f24a55b001">May</a>      ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a88068fdc3953ea6e86797179bb2f7d70">June</a>     ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a6e2eb13b444eddc908b702f9e3030b15">July</a>     ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>   ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4ad4e26bc88f6e25cf9e31ba9400771d49">September</a>,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a11958aa29b8f50ce93f5d5f6f86c545f">October</a>  ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4acb4e488d1e8bac8be4f273d27e102b61">November</a> ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4ad4988bf6760edb92c088bb47d4b61dc5">December</a> ,2013),<span class="keyword">true</span>)
    };

    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;12;i++){
        <span class="keywordflow">if</span>(std::fabs(expectedFixing[i] - seasonalityFixing_real[i]) &gt; 0.01) {
            BOOST_ERROR(<span class="stringliteral">&quot;Seasonality doesn&#39;t work correctly when considering seasonality factors != 1 &quot;</span>
                        &lt;&lt; expectedFixing[i] &lt;&lt; <span class="stringliteral">&quot; vs &quot;</span> &lt;&lt; seasonalityFixing_real[i]);
        }
    }

    <span class="comment">//Testing Unset function</span>
    <span class="comment">//</span>
    <a class="code" href="errors_8hpp.html#a7a9bcab8006882bc7d5302a0861ab1a6" title="throw an error if the given pre-condition is not verified">QL_REQUIRE</a>(hz-&gt;hasSeasonality(),<span class="stringliteral">&quot;[4] incorrectly believes NO seasonality correction&quot;</span>);
    hz-&gt;setSeasonality();
    <a class="code" href="errors_8hpp.html#a7a9bcab8006882bc7d5302a0861ab1a6" title="throw an error if the given pre-condition is not verified">QL_REQUIRE</a>(!hz-&gt;hasSeasonality(),<span class="stringliteral">&quot;[5] incorrectly believes HAS seasonality correction&quot;</span>);

    <a class="code" href="namespace_quant_lib.html#a919ba3567cc89fca373f8d6b8e80126b" title="interest rates">Rate</a> seasonalityFixing_unset[] = {
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a2c2c73e76831dec3bfead45af4e7e293">January</a>  ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a3f87835e65eb79538ed8df9dac30e8e9">February</a> ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a982c9e93cf4b41f4b71b5c256df6191c">March</a>    ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a5a127587551e502c20dd25f3cb95c670">April</a>    ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4ab7f0de9de43d10d9740019f24a55b001">May</a>      ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a88068fdc3953ea6e86797179bb2f7d70">June</a>     ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a6e2eb13b444eddc908b702f9e3030b15">July</a>     ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a296c9233a021e0f88646d10cfba16888">August</a>   ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4ad4e26bc88f6e25cf9e31ba9400771d49">September</a>,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a11958aa29b8f50ce93f5d5f6f86c545f">October</a>  ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4acb4e488d1e8bac8be4f273d27e102b61">November</a> ,2013),<span class="keyword">true</span>),
        ii-&gt;fixing(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4ad4988bf6760edb92c088bb47d4b61dc5">December</a> ,2013),<span class="keyword">true</span>)
    };

    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;12;i++){
        <span class="keywordflow">if</span>(std::fabs(seasonalityFixing_unset[i] - seasonalityFixing_1[i]) &gt; eps) {
            BOOST_ERROR(<span class="stringliteral">&quot;UnsetSeasonality doesn&#39;t work correctly &quot;</span>
                        &lt;&lt; seasonalityFixing_unset[i] &lt;&lt; <span class="stringliteral">&quot; vs &quot;</span> &lt;&lt; seasonalityFixing_1[i]);
        }
    }



    <span class="comment">//==============================================================================</span>
    <span class="comment">// now do an INTERPOLATED index, i.e. repeat everything on a fake version of</span>
    <span class="comment">// UKRPI (to save making another term structure)</span>

    <span class="keywordtype">bool</span> interpYES = <span class="keyword">true</span>;
    boost::shared_ptr&lt;UKRPI&gt; iiUKRPIyes(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_u_k_r_p_i.html" title="UK Retail Price Inflation Index.">UKRPI</a>(interpYES, hz));
    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(fixData);i++) {
        iiUKRPIyes-&gt;addFixing(rpiSchedule[i], fixData[i]);
    }

    boost::shared_ptr&lt;ZeroInflationIndex&gt; iiyes
        = boost::dynamic_pointer_cast&lt;<a class="code" href="class_quant_lib_1_1_zero_inflation_index.html" title="Base class for zero inflation indices.">ZeroInflationIndex</a>&gt;(iiUKRPIyes);

    <span class="comment">// now build the zero inflation curve</span>
    <span class="comment">// same data, bigger lag or it will be a self-contradiction</span>
    <a class="code" href="class_quant_lib_1_1_period.html">Period</a> observationLagyes = <a class="code" href="class_quant_lib_1_1_period.html">Period</a>(3,<a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3a3d158b618e2bf6e66da9aca81f706dae">Months</a>);
    std::vector&lt;boost::shared_ptr&lt;BootstrapHelper&lt;ZeroInflationTermStructure&gt; &gt; &gt; helpersyes =
    <a class="code" href="namespaceanonymous__namespace_02inflation_8cpp_03.html#a728a3a5b80654ff196e0eb5095a857cd">makeHelpers</a>&lt;ZeroInflationTermStructure,ZeroCouponInflationSwapHelper,
    <a class="code" href="class_quant_lib_1_1_zero_inflation_index.html" title="Base class for zero inflation indices.">ZeroInflationIndex</a>&gt;(zcData, <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(zcData), iiyes,
                        observationLagyes,
                        <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a86803e870514df19c0cf3863edb2b8f8">calendar</a>, bdc, dc);

    boost::shared_ptr&lt;PiecewiseZeroInflationCurve&lt;Linear&gt; &gt; pZITSyes(
            <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_piecewise_zero_inflation_curve.html" title="Piecewise zero-inflation term structure.">PiecewiseZeroInflationCurve&lt;Linear&gt;</a>(
            evaluationDate, calendar, dc, observationLagyes,
            frequency, iiyes-&gt;interpolated(), baseZeroRate,
            <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a>(nominalTS), helpersyes));
    pZITSyes-&gt;recalculate();

    <span class="comment">// first check that the zero rates on the curve match the data</span>
    <span class="comment">// and that the helpers give the correct impled rates</span>
    forceLinearInterpolation = <span class="keyword">false</span>;   <span class="comment">// still</span>
    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(zcData); i++) {
        BOOST_CHECK_MESSAGE(std::fabs(zcData[i].<a class="code" href="group__manips.html#gac9152aad6a69c41f5d30bb1dcb9b2236" title="output rates and spreads as percentages">rate</a>/100.0
                    - pZITSyes-&gt;zeroRate(zcData[i].date, observationLagyes, forceLinearInterpolation)) &lt; eps,
                    <span class="stringliteral">&quot;ZITS INTERPOLATED zeroRate != instrument &quot;</span>
                    &lt;&lt; pZITSyes-&gt;zeroRate(zcData[i].date, observationLagyes, forceLinearInterpolation)
                    &lt;&lt; <span class="stringliteral">&quot; date &quot;</span> &lt;&lt; zcData[i].date &lt;&lt; <span class="stringliteral">&quot; observationLagyes &quot;</span> &lt;&lt; observationLagyes
                    &lt;&lt; <span class="stringliteral">&quot; vs &quot;</span> &lt;&lt; zcData[i].rate/100.0
                    &lt;&lt; <span class="stringliteral">&quot; interpolation: &quot;</span> &lt;&lt; iiyes-&gt;interpolated()
                    &lt;&lt; <span class="stringliteral">&quot; forceLinearInterpolation &quot;</span> &lt;&lt; forceLinearInterpolation);
        BOOST_CHECK_MESSAGE(std::fabs(helpersyes[i]-&gt;impliedQuote()
                        - zcData[i].<a class="code" href="group__manips.html#gac9152aad6a69c41f5d30bb1dcb9b2236" title="output rates and spreads as percentages">rate</a>/100.0) &lt; eps,
                    <span class="stringliteral">&quot;ZITS INTERPOLATED implied quote != instrument &quot;</span>
                    &lt;&lt; helpersyes[i]-&gt;impliedQuote()
                    &lt;&lt; <span class="stringliteral">&quot; vs &quot;</span> &lt;&lt; zcData[i].<a class="code" href="group__manips.html#gac9152aad6a69c41f5d30bb1dcb9b2236" title="output rates and spreads as percentages">rate</a>/100.0);
    }


    <span class="comment">//======================================================================================</span>
    <span class="comment">// now test the forecasting capability of the index.</span>
    hz.<a class="code" href="class_quant_lib_1_1_relinkable_handle.html#acceb0d87ae2ecfbad21e0862e6d2e87d">linkTo</a>(pZITSyes);
    from = hz-&gt;baseDate()+1*<a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3a3d158b618e2bf6e66da9aca81f706dae">Months</a>; <span class="comment">// to avoid historical linear bit for rest of base month</span>
    to = hz-&gt;maxDate()-1*<a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3a3d158b618e2bf6e66da9aca81f706dae">Months</a>; <span class="comment">// a bit of margin for adjustments</span>
    testIndex = <a class="code" href="class_quant_lib_1_1_make_schedule.html" title="helper class">MakeSchedule</a>().<a class="code" href="class_quant_lib_1_1_make_schedule.html#add57ea43db5c17ebad4888a9b92aadcb">from</a>(from).<a class="code" href="class_quant_lib_1_1_make_schedule.html#ad0013dce5b61be709a7b09e66f3c2b3e">to</a>(to)
    .<a class="code" href="class_quant_lib_1_1_make_schedule.html#a4171b3ab3218660704b4697a4b6a8c53">withTenor</a>(1*<a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3a3d158b618e2bf6e66da9aca81f706dae">Months</a>)
    .<a class="code" href="class_quant_lib_1_1_make_schedule.html#a577b0ca13a87e6cd6b4c502b6eed0a0d">withCalendar</a>(<a class="code" href="class_quant_lib_1_1_united_kingdom.html" title="United Kingdom calendars.">UnitedKingdom</a>())
    .<a class="code" href="class_quant_lib_1_1_make_schedule.html#a7187a198c205f6577b8e2dcca0aba3e6">withConvention</a>(<a class="code" href="namespace_quant_lib.html#ac95a4b5bc8017f1eb4ad0b54a9af3881aaa730fc5548402fd95e95f1c57f9a535">ModifiedFollowing</a>);

    <span class="comment">// we are testing UKRPI which is FAKE interpolated for testing here</span>
    bd = hz-&gt;baseDate();
    bf = iiyes-&gt;fixing(bd);
    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i&lt;testIndex.<a class="code" href="class_quant_lib_1_1_schedule.html#a3f9f67b0f8653cb82f87eaeef9bfbbd8">size</a>();i++) {
        <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> d = testIndex[i];
        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> z = hz-&gt;zeroRate(d, <a class="code" href="class_quant_lib_1_1_period.html">Period</a>(0,<a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3ac2d73aad1a6496a6481563e7b5e62b36">Days</a>));
        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> t = hz-&gt;dayCounter().yearFraction(bd, d);
        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> calc = bf * <a class="code" href="namespace_quant_lib_1_1anonymous__namespace_02analyticgjrgarchengine_8cpp_03.html#a3011339a7df8a9688c1a29a9b6cff359">pow</a>( 1+z, t);
        <span class="keywordflow">if</span> (t&lt;=0) calc = iiyes-&gt;fixing(d); <span class="comment">// still historical</span>
        <span class="keywordflow">if</span> (std::fabs(calc - iiyes-&gt;fixing(d)) &gt; eps)
            BOOST_ERROR(<span class="stringliteral">&quot;ZC INTERPOLATED index does not forecast correctly for date &quot;</span> &lt;&lt; d
                        &lt;&lt; <span class="stringliteral">&quot; from base date &quot;</span> &lt;&lt; bd
                        &lt;&lt; <span class="stringliteral">&quot; with fixing &quot;</span> &lt;&lt; bf
                        &lt;&lt; <span class="stringliteral">&quot;, correct:  &quot;</span> &lt;&lt; calc
                        &lt;&lt; <span class="stringliteral">&quot;, fix: &quot;</span> &lt;&lt; iiyes-&gt;fixing(d)
                        &lt;&lt; <span class="stringliteral">&quot;, t &quot;</span> &lt;&lt; t
                        &lt;&lt; <span class="stringliteral">&quot;, zero &quot;</span> &lt;&lt; z);
    }



    <span class="comment">//===========================================================================================</span>
    <span class="comment">// Test zero coupon swap</span>

    boost::shared_ptr&lt;ZeroInflationIndex&gt; ziiyes = boost::dynamic_pointer_cast&lt;<a class="code" href="class_quant_lib_1_1_zero_inflation_index.html" title="Base class for zero inflation indices.">ZeroInflationIndex</a>&gt;(iiyes);
    BOOST_REQUIRE_MESSAGE(ziiyes,<span class="stringliteral">&quot;dynamic_pointer_cast to ZeroInflationIndex from UKRPI-I failed&quot;</span>);
    <a class="code" href="class_quant_lib_1_1_zero_coupon_inflation_swap.html" title="Zero-coupon inflation-indexed swap.">ZeroCouponInflationSwap</a> nzcisyes(ZeroCouponInflationSwap::Payer,
                                     1000000.0,
                                     evaluationDate,
                                     zcData[6].date,    <span class="comment">// end date = maturity</span>
                                     calendar, bdc, dc, zcData[6].<a class="code" href="group__manips.html#gac9152aad6a69c41f5d30bb1dcb9b2236" title="output rates and spreads as percentages">rate</a>/100.0, <span class="comment">// fixed rate</span>
                                     ziiyes, observationLagyes);

    <span class="comment">// N.B. no coupon pricer because it is not a coupon, effect of inflation curve via</span>
    <span class="comment">//      inflation curve attached to the inflation index.</span>
    nzcisyes.setPricingEngine(sppe);

    <span class="comment">// ... and price it, should be zero</span>
    BOOST_CHECK_MESSAGE(fabs(nzcisyes.NPV())&lt;0.00001,<span class="stringliteral">&quot;ZCIS-I does not reprice to zero &quot;</span>
                        &lt;&lt; nzcisyes.NPV()
                        &lt;&lt; evaluationDate &lt;&lt; <span class="stringliteral">&quot; to &quot;</span> &lt;&lt; zcData[6].date &lt;&lt; <span class="stringliteral">&quot; becoming &quot;</span> &lt;&lt; nzcisyes.maturityDate()
                        &lt;&lt; <span class="stringliteral">&quot; rate &quot;</span> &lt;&lt; zcData[6].rate
                        &lt;&lt; <span class="stringliteral">&quot; fixed leg &quot;</span> &lt;&lt; nzcisyes.legNPV(0)
                        &lt;&lt; <span class="stringliteral">&quot; indexed-predicted inflated leg &quot;</span> &lt;&lt; nzcisyes.legNPV(1)
                        &lt;&lt; <span class="stringliteral">&quot; discount &quot;</span> &lt;&lt; nominalTS-&gt;discount(nzcisyes.maturityDate())
                        );

    <span class="comment">// remove circular refernce</span>
    hz.<a class="code" href="class_quant_lib_1_1_relinkable_handle.html#acceb0d87ae2ecfbad21e0862e6d2e87d">linkTo</a>(boost::shared_ptr&lt;ZeroInflationTermStructure&gt;());
}
</pre></div>
</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/home/deriversatile/QuantLib/QuantLibQt/test-suite/<a class="el" href="inflation_8hpp_source.html">inflation.hpp</a></li>
<li>/home/deriversatile/QuantLib/QuantLibQt/test-suite/<a class="el" href="inflation_8cpp_source.html">inflation.cpp</a></li>
</ul>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="class_inflation_test.html">InflationTest</a>      </li>

    <li class="footer">Generated on Sat Aug 25 2012 13:51:01 for QuantLib by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
