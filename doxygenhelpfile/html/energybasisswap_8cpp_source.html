<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>QuantLib: /home/deriversatile/QuantLib/QuantLibQt/ql/experimental/commodities/energybasisswap.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">QuantLib
   &#160;<span id="projectnumber">1.3</span>
   </div>
   <div id="projectbrief">ql1-3</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="dynsections.js"></script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('energybasisswap_8cpp.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">energybasisswap.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="energybasisswap_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* -*- mode: c++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- */</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="comment">/*</span>
<a name="l00004"></a>00004 <span class="comment"> Copyright (C) 2008 J. Erik Radmall</span>
<a name="l00005"></a>00005 <span class="comment"></span>
<a name="l00006"></a>00006 <span class="comment"> This file is part of QuantLib, a free-software/open-source library</span>
<a name="l00007"></a>00007 <span class="comment"> for financial quantitative analysts and developers - http://quantlib.org/</span>
<a name="l00008"></a>00008 <span class="comment"></span>
<a name="l00009"></a>00009 <span class="comment"> QuantLib is free software: you can redistribute it and/or modify it</span>
<a name="l00010"></a>00010 <span class="comment"> under the terms of the QuantLib license.  You should have received a</span>
<a name="l00011"></a>00011 <span class="comment"> copy of the license along with this program; if not, please email</span>
<a name="l00012"></a>00012 <span class="comment"> &lt;quantlib-dev@lists.sf.net&gt;. The license is also available online at</span>
<a name="l00013"></a>00013 <span class="comment"> &lt;http://quantlib.org/license.shtml&gt;.</span>
<a name="l00014"></a>00014 <span class="comment"></span>
<a name="l00015"></a>00015 <span class="comment"> This program is distributed in the hope that it will be useful, but WITHOUT</span>
<a name="l00016"></a>00016 <span class="comment"> ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</span>
<a name="l00017"></a>00017 <span class="comment"> FOR A PARTICULAR PURPOSE.  See the license for more details.</span>
<a name="l00018"></a>00018 <span class="comment">*/</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="preprocessor">#include &lt;<a class="code" href="energybasisswap_8hpp.html" title="Energy basis swap.">ql/experimental/commodities/energybasisswap.hpp</a>&gt;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &lt;<a class="code" href="commoditysettings_8hpp.html" title="commodity settings">ql/experimental/commodities/commoditysettings.hpp</a>&gt;</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="keyword">namespace </span>QuantLib {
<a name="l00024"></a>00024 
<a name="l00025"></a><a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#a050b1940a34d2211eabb18691b74ca1a">00025</a>     <a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#a050b1940a34d2211eabb18691b74ca1a">EnergyBasisSwap::EnergyBasisSwap</a>(
<a name="l00026"></a>00026                     <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_calendar.html" title="calendar class">Calendar</a>&amp; <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a86803e870514df19c0cf3863edb2b8f8">calendar</a>,
<a name="l00027"></a>00027                     <span class="keyword">const</span> boost::shared_ptr&lt;CommodityIndex&gt;&amp; spreadIndex,
<a name="l00028"></a>00028                     <span class="keyword">const</span> boost::shared_ptr&lt;CommodityIndex&gt;&amp; payIndex,
<a name="l00029"></a>00029                     <span class="keyword">const</span> boost::shared_ptr&lt;CommodityIndex&gt;&amp; receiveIndex,
<a name="l00030"></a>00030                     <span class="keywordtype">bool</span> spreadToPayLeg,
<a name="l00031"></a>00031                     <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_currency.html" title="Currency specification">Currency</a>&amp; payCurrency,
<a name="l00032"></a>00032                     <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_currency.html" title="Currency specification">Currency</a>&amp; receiveCurrency,
<a name="l00033"></a>00033                     <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a6151f217f309ebe62118119d2f175e17">PricingPeriods</a>&amp; pricingPeriods,
<a name="l00034"></a>00034                     <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_commodity_unit_cost.html">CommodityUnitCost</a>&amp; basis,
<a name="l00035"></a>00035                     <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_commodity_type.html" title="commodity type">CommodityType</a>&amp; commodityType,
<a name="l00036"></a>00036                     <span class="keyword">const</span> boost::shared_ptr&lt;SecondaryCosts&gt;&amp; secondaryCosts,
<a name="l00037"></a>00037                     <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a>&amp; payLegTermStructure,
<a name="l00038"></a>00038                     <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a>&amp; receiveLegTermStructure,
<a name="l00039"></a>00039                     <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a>&amp; discountTermStructure)
<a name="l00040"></a>00040     : <a class="code" href="class_quant_lib_1_1_energy_swap.html">EnergySwap</a>(calendar, payCurrency, receiveCurrency,
<a name="l00041"></a>00041                  pricingPeriods, commodityType, secondaryCosts),
<a name="l00042"></a>00042       spreadIndex_(spreadIndex), payIndex_(payIndex),
<a name="l00043"></a>00043       receiveIndex_(receiveIndex), spreadToPayLeg_(spreadToPayLeg),
<a name="l00044"></a>00044       basis_(basis), payLegTermStructure_(payLegTermStructure),
<a name="l00045"></a>00045       receiveLegTermStructure_(receiveLegTermStructure),
<a name="l00046"></a>00046       discountTermStructure_(discountTermStructure) {
<a name="l00047"></a>00047         <a class="code" href="errors_8hpp.html#a7a9bcab8006882bc7d5302a0861ab1a6" title="throw an error if the given pre-condition is not verified">QL_REQUIRE</a>(<a class="code" href="class_quant_lib_1_1_energy_swap.html#a5dbb46c3cddb628ec0e67a09fbfc25ea">pricingPeriods_</a>.size() &gt; 0, <span class="stringliteral">&quot;no payment dates&quot;</span>);
<a name="l00048"></a>00048         <a class="code" href="class_quant_lib_1_1_observer.html#a4c9f4fc7a6b55b246566c40462b95121">registerWith</a>(<a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#a6e4b3e018914072c072b0a13ab0cb277">spreadIndex_</a>);
<a name="l00049"></a>00049         <a class="code" href="class_quant_lib_1_1_observer.html#a4c9f4fc7a6b55b246566c40462b95121">registerWith</a>(<a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#a8cc1546319b38deb2967f5bce9e913a3">payIndex_</a>);
<a name="l00050"></a>00050         <a class="code" href="class_quant_lib_1_1_observer.html#a4c9f4fc7a6b55b246566c40462b95121">registerWith</a>(<a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#abcac555c0460d135e7c53f7f0bf44472">receiveIndex_</a>);
<a name="l00051"></a>00051     }
<a name="l00052"></a>00052 
<a name="l00053"></a><a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#a802319379455493e0d7b898dae1dcc77">00053</a>     <span class="keywordtype">void</span> <a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#a802319379455493e0d7b898dae1dcc77">EnergyBasisSwap::performCalculations</a>()<span class="keyword"> const </span>{
<a name="l00054"></a>00054 
<a name="l00055"></a>00055         <span class="keywordflow">try</span> {
<a name="l00056"></a>00056 
<a name="l00057"></a>00057             <span class="keywordflow">if</span> (<a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#a8cc1546319b38deb2967f5bce9e913a3">payIndex_</a>-&gt;empty()) {
<a name="l00058"></a>00058                 <span class="keywordflow">if</span> (<a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#a8cc1546319b38deb2967f5bce9e913a3">payIndex_</a>-&gt;forwardCurveEmpty()) {
<a name="l00059"></a>00059                     <a class="code" href="errors_8hpp.html#a8efe9cb3e67c8d0585e57b4d53c5d2fe" title="throw an error (possibly with file and line information)">QL_FAIL</a>(<span class="stringliteral">&quot;index [&quot;</span> + <a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#a8cc1546319b38deb2967f5bce9e913a3">payIndex_</a>-&gt;name() +
<a name="l00060"></a>00060                             <span class="stringliteral">&quot;] does not have any quotes or forward prices&quot;</span>);
<a name="l00061"></a>00061                 } <span class="keywordflow">else</span> {
<a name="l00062"></a>00062                     <a class="code" href="class_quant_lib_1_1_commodity.html#abdac21754ab0b8245d4501ca10d5c156">addPricingError</a>(<a class="code" href="struct_quant_lib_1_1_pricing_error.html#ab3dfb4c4ca0772113718ec41c601f8f4a7b106ed9120f4fdb2e9d30d0f49e70a2">PricingError::Warning</a>,
<a name="l00063"></a>00063                                     <span class="stringliteral">&quot;index [&quot;</span> + <a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#a8cc1546319b38deb2967f5bce9e913a3">payIndex_</a>-&gt;name() +
<a name="l00064"></a>00064                                     <span class="stringliteral">&quot;] does not have any quotes; &quot;</span>
<a name="l00065"></a>00065                                     <span class="stringliteral">&quot;using forward prices from [&quot;</span> +
<a name="l00066"></a>00066                                     <a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#a8cc1546319b38deb2967f5bce9e913a3">payIndex_</a>-&gt;forwardCurve()-&gt;name() + <span class="stringliteral">&quot;]&quot;</span>);
<a name="l00067"></a>00067                 }
<a name="l00068"></a>00068             }
<a name="l00069"></a>00069             <span class="keywordflow">if</span> (<a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#abcac555c0460d135e7c53f7f0bf44472">receiveIndex_</a>-&gt;empty()) {
<a name="l00070"></a>00070                 <span class="keywordflow">if</span> (<a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#abcac555c0460d135e7c53f7f0bf44472">receiveIndex_</a>-&gt;forwardCurveEmpty()) {
<a name="l00071"></a>00071                     <a class="code" href="errors_8hpp.html#a8efe9cb3e67c8d0585e57b4d53c5d2fe" title="throw an error (possibly with file and line information)">QL_FAIL</a>(<span class="stringliteral">&quot;index [&quot;</span> + <a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#abcac555c0460d135e7c53f7f0bf44472">receiveIndex_</a>-&gt;name() +
<a name="l00072"></a>00072                             <span class="stringliteral">&quot;] does not have any quotes or forward prices&quot;</span>);
<a name="l00073"></a>00073                 } <span class="keywordflow">else</span> {
<a name="l00074"></a>00074                     <a class="code" href="class_quant_lib_1_1_commodity.html#abdac21754ab0b8245d4501ca10d5c156">addPricingError</a>(<a class="code" href="struct_quant_lib_1_1_pricing_error.html#ab3dfb4c4ca0772113718ec41c601f8f4a7b106ed9120f4fdb2e9d30d0f49e70a2">PricingError::Warning</a>,
<a name="l00075"></a>00075                                     <span class="stringliteral">&quot;index [&quot;</span> + <a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#abcac555c0460d135e7c53f7f0bf44472">receiveIndex_</a>-&gt;name() +
<a name="l00076"></a>00076                                     <span class="stringliteral">&quot;] does not have any quotes; &quot;</span>
<a name="l00077"></a>00077                                     <span class="stringliteral">&quot;using forward prices from [&quot;</span> +
<a name="l00078"></a>00078                                     <a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#abcac555c0460d135e7c53f7f0bf44472">receiveIndex_</a>-&gt;forwardCurve()-&gt;name() +
<a name="l00079"></a>00079                                     <span class="stringliteral">&quot;]&quot;</span>);
<a name="l00080"></a>00080                 }
<a name="l00081"></a>00081             }
<a name="l00082"></a>00082 
<a name="l00083"></a>00083             <a class="code" href="class_quant_lib_1_1_instrument.html#a997663780100d30ae59b14ac0285322d">NPV_</a> = 0.0;
<a name="l00084"></a>00084             <a class="code" href="class_quant_lib_1_1_instrument.html#a2b512754fc243f4bb7a960c7bf8c92a6">additionalResults_</a>.clear();
<a name="l00085"></a>00085             <a class="code" href="class_quant_lib_1_1_energy_swap.html#a895b110618214562444410a93896c683">dailyPositions_</a>.clear();
<a name="l00086"></a>00086             <a class="code" href="class_quant_lib_1_1_energy_swap.html#a7b349d8dfa7895c623e0162e28cf5a2a">paymentCashFlows_</a>.clear();
<a name="l00087"></a>00087 
<a name="l00088"></a>00088             <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> evaluationDate = <a class="code" href="class_quant_lib_1_1_singleton.html#ab79257029fa4841505227497a56cbd93" title="access to the unique instance">Settings::instance</a>().<a class="code" href="class_quant_lib_1_1_settings.html#a908ff4717a9706c4329fb316a49a5720" title="the date at which pricing is to be performed.">evaluationDate</a>();
<a name="l00089"></a>00089 
<a name="l00090"></a>00090             <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_currency.html" title="Currency specification">Currency</a>&amp; baseCurrency =
<a name="l00091"></a>00091                 <a class="code" href="class_quant_lib_1_1_singleton.html#ab79257029fa4841505227497a56cbd93" title="access to the unique instance">CommoditySettings::instance</a>().<a class="code" href="class_quant_lib_1_1_commodity_settings.html#a18c4dc483b90cca740872ec86db11151">currency</a>();
<a name="l00092"></a>00092             <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_unit_of_measure.html" title="Unit of measure specification">UnitOfMeasure</a> baseUnitOfMeasure =
<a name="l00093"></a>00093                 <a class="code" href="class_quant_lib_1_1_singleton.html#ab79257029fa4841505227497a56cbd93" title="access to the unique instance">CommoditySettings::instance</a>().<a class="code" href="class_quant_lib_1_1_commodity_settings.html#a8809cd981175b9a6937b909f928b5b10">unitOfMeasure</a>();
<a name="l00094"></a>00094 
<a name="l00095"></a>00095             <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> quantityUomConversionFactor =
<a name="l00096"></a>00096                 <a class="code" href="class_quant_lib_1_1_energy_commodity.html#a3fbad4a24fa5d6d54a8f783db96bc231">calculateUomConversionFactor</a>(
<a name="l00097"></a>00097                                <a class="code" href="class_quant_lib_1_1_energy_swap.html#a5dbb46c3cddb628ec0e67a09fbfc25ea">pricingPeriods_</a>[0]-&gt;<a class="code" href="class_quant_lib_1_1_energy_swap.html#adbfad551c30913cb4c082bcb29528bcc">quantity</a>().<a class="code" href="class_quant_lib_1_1_energy_swap.html#a79e9854ff8c0d04e9d7ad2f1b8be5023">commodityType</a>(),
<a name="l00098"></a>00098                                baseUnitOfMeasure,
<a name="l00099"></a>00099                                <a class="code" href="class_quant_lib_1_1_energy_swap.html#a5dbb46c3cddb628ec0e67a09fbfc25ea">pricingPeriods_</a>[0]-&gt;<a class="code" href="class_quant_lib_1_1_energy_swap.html#adbfad551c30913cb4c082bcb29528bcc">quantity</a>().unitOfMeasure());
<a name="l00100"></a>00100             <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> payIndexUomConversionFactor =
<a name="l00101"></a>00101                 <a class="code" href="class_quant_lib_1_1_energy_commodity.html#a3fbad4a24fa5d6d54a8f783db96bc231">calculateUomConversionFactor</a>(<a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#a8cc1546319b38deb2967f5bce9e913a3">payIndex_</a>-&gt;commodityType(),
<a name="l00102"></a>00102                                              <a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#a8cc1546319b38deb2967f5bce9e913a3">payIndex_</a>-&gt;unitOfMeasure(),
<a name="l00103"></a>00103                                              baseUnitOfMeasure);
<a name="l00104"></a>00104             <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> receiveIndexUomConversionFactor =
<a name="l00105"></a>00105                 <a class="code" href="class_quant_lib_1_1_energy_commodity.html#a3fbad4a24fa5d6d54a8f783db96bc231">calculateUomConversionFactor</a>(<a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#abcac555c0460d135e7c53f7f0bf44472">receiveIndex_</a>-&gt;commodityType(),
<a name="l00106"></a>00106                                              <a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#abcac555c0460d135e7c53f7f0bf44472">receiveIndex_</a>-&gt;unitOfMeasure(),
<a name="l00107"></a>00107                                              baseUnitOfMeasure);
<a name="l00108"></a>00108 
<a name="l00109"></a>00109             <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> payIndexFxConversionFactor =
<a name="l00110"></a>00110                 <a class="code" href="class_quant_lib_1_1_energy_commodity.html#ac335664bdcbf1625417715d264e6b8cc">calculateFxConversionFactor</a>(<a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#a8cc1546319b38deb2967f5bce9e913a3">payIndex_</a>-&gt;currency(),
<a name="l00111"></a>00111                                             baseCurrency, evaluationDate);
<a name="l00112"></a>00112             <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> receiveIndexFxConversionFactor =
<a name="l00113"></a>00113                 <a class="code" href="class_quant_lib_1_1_energy_commodity.html#ac335664bdcbf1625417715d264e6b8cc">calculateFxConversionFactor</a>(<a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#abcac555c0460d135e7c53f7f0bf44472">receiveIndex_</a>-&gt;currency(),
<a name="l00114"></a>00114                                             baseCurrency, evaluationDate);
<a name="l00115"></a>00115             <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> payLegFxConversionFactor =
<a name="l00116"></a>00116                 <a class="code" href="class_quant_lib_1_1_energy_commodity.html#ac335664bdcbf1625417715d264e6b8cc">calculateFxConversionFactor</a>(baseCurrency, <a class="code" href="class_quant_lib_1_1_energy_swap.html#a4b1bfe253fba4a3b4d4f9623f3bdc625">payCurrency_</a>,
<a name="l00117"></a>00117                                             evaluationDate);
<a name="l00118"></a>00118             <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> receiveLegFxConversionFactor =
<a name="l00119"></a>00119                 <a class="code" href="class_quant_lib_1_1_energy_commodity.html#ac335664bdcbf1625417715d264e6b8cc">calculateFxConversionFactor</a>(baseCurrency, <a class="code" href="class_quant_lib_1_1_energy_swap.html#a7cb375c42d60be87f0fe29e03e89708b">receiveCurrency_</a>,
<a name="l00120"></a>00120                                             evaluationDate);
<a name="l00121"></a>00121 
<a name="l00122"></a>00122             <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> basisUomConversionFactor =
<a name="l00123"></a>00123                 <a class="code" href="class_quant_lib_1_1_energy_commodity.html#a3fbad4a24fa5d6d54a8f783db96bc231">calculateUomConversionFactor</a>(
<a name="l00124"></a>00124                                <a class="code" href="class_quant_lib_1_1_energy_swap.html#a5dbb46c3cddb628ec0e67a09fbfc25ea">pricingPeriods_</a>[0]-&gt;<a class="code" href="class_quant_lib_1_1_energy_swap.html#adbfad551c30913cb4c082bcb29528bcc">quantity</a>().<a class="code" href="class_quant_lib_1_1_energy_swap.html#a79e9854ff8c0d04e9d7ad2f1b8be5023">commodityType</a>(),
<a name="l00125"></a>00125                                <a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#adc8bab5b1ec109182fedcaff837e01dc">basis_</a>.<a class="code" href="class_quant_lib_1_1_commodity_unit_cost.html#a02fde7fa9c955207ad120f36c25f9e87">unitOfMeasure</a>(), baseUnitOfMeasure);
<a name="l00126"></a>00126             <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> basisFxConversionFactor =
<a name="l00127"></a>00127                 <a class="code" href="class_quant_lib_1_1_energy_commodity.html#ac335664bdcbf1625417715d264e6b8cc">calculateFxConversionFactor</a>(baseCurrency,
<a name="l00128"></a>00128                                             <a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#adc8bab5b1ec109182fedcaff837e01dc">basis_</a>.<a class="code" href="class_quant_lib_1_1_commodity_unit_cost.html#a2f66a994104c5e28edf7c43c65f2ca96">amount</a>().<a class="code" href="class_quant_lib_1_1_money.html#a89690ab87e7bd43d11a0242a3d7e5269">currency</a>(),
<a name="l00129"></a>00129                                             evaluationDate);
<a name="l00130"></a>00130 
<a name="l00131"></a>00131             <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> basisValue = <a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#adc8bab5b1ec109182fedcaff837e01dc">basis_</a>.<a class="code" href="class_quant_lib_1_1_commodity_unit_cost.html#a2f66a994104c5e28edf7c43c65f2ca96">amount</a>().<a class="code" href="class_quant_lib_1_1_money.html#aeec4146aabca60056db8b1ed76188043">value</a>() *
<a name="l00132"></a>00132                 basisUomConversionFactor * basisFxConversionFactor;
<a name="l00133"></a>00133 
<a name="l00134"></a>00134             <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> lastPayIndexQuoteDate = <a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#a8cc1546319b38deb2967f5bce9e913a3">payIndex_</a>-&gt;lastQuoteDate();
<a name="l00135"></a>00135             <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> lastReceiveIndexQuoteDate = <a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#abcac555c0460d135e7c53f7f0bf44472">receiveIndex_</a>-&gt;lastQuoteDate();
<a name="l00136"></a>00136 
<a name="l00137"></a>00137             <span class="keywordflow">if</span> (lastPayIndexQuoteDate &lt; evaluationDate - 1) {
<a name="l00138"></a>00138                 std::ostringstream message;
<a name="l00139"></a>00139                 message &lt;&lt; <span class="stringliteral">&quot;index [&quot;</span> &lt;&lt; <a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#a8cc1546319b38deb2967f5bce9e913a3">payIndex_</a>-&gt;name()
<a name="l00140"></a>00140                         &lt;&lt; <span class="stringliteral">&quot;] has last quote date of &quot;</span>
<a name="l00141"></a>00141                         &lt;&lt; <a class="code" href="group__manips.html#ga0921b3ae46195feff93b2a4388e05d63" title="output dates in ISO format (yyyy-mm-dd)">io::iso_date</a>(lastPayIndexQuoteDate);
<a name="l00142"></a>00142                 <a class="code" href="class_quant_lib_1_1_commodity.html#abdac21754ab0b8245d4501ca10d5c156">addPricingError</a>(<a class="code" href="struct_quant_lib_1_1_pricing_error.html#ab3dfb4c4ca0772113718ec41c601f8f4a7b106ed9120f4fdb2e9d30d0f49e70a2">PricingError::Warning</a>, message.str());
<a name="l00143"></a>00143             }
<a name="l00144"></a>00144             <span class="keywordflow">if</span> (lastReceiveIndexQuoteDate &lt; evaluationDate - 1) {
<a name="l00145"></a>00145                 std::ostringstream message;
<a name="l00146"></a>00146                 message &lt;&lt; <span class="stringliteral">&quot;index [&quot;</span> &lt;&lt; <a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#abcac555c0460d135e7c53f7f0bf44472">receiveIndex_</a>-&gt;name()
<a name="l00147"></a>00147                         &lt;&lt; <span class="stringliteral">&quot;] has last quote date of &quot;</span>
<a name="l00148"></a>00148                         &lt;&lt; <a class="code" href="group__manips.html#ga0921b3ae46195feff93b2a4388e05d63" title="output dates in ISO format (yyyy-mm-dd)">io::iso_date</a>(lastReceiveIndexQuoteDate);
<a name="l00149"></a>00149                 <a class="code" href="class_quant_lib_1_1_commodity.html#abdac21754ab0b8245d4501ca10d5c156">addPricingError</a>(<a class="code" href="struct_quant_lib_1_1_pricing_error.html#ab3dfb4c4ca0772113718ec41c601f8f4a7b106ed9120f4fdb2e9d30d0f49e70a2">PricingError::Warning</a>, message.str());
<a name="l00150"></a>00150             }
<a name="l00151"></a>00151 
<a name="l00152"></a>00152             <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> lastQuoteDate = std::min(lastPayIndexQuoteDate,
<a name="l00153"></a>00153                                           lastReceiveIndexQuoteDate);
<a name="l00154"></a>00154 
<a name="l00155"></a>00155             <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> totalQuantityAmount = 0;
<a name="l00156"></a>00156 
<a name="l00157"></a>00157             <span class="comment">// price each period</span>
<a name="l00158"></a>00158             <span class="keywordflow">for</span> (PricingPeriods::const_iterator pi = <a class="code" href="class_quant_lib_1_1_energy_swap.html#a5dbb46c3cddb628ec0e67a09fbfc25ea">pricingPeriods_</a>.begin();
<a name="l00159"></a>00159                  pi != <a class="code" href="class_quant_lib_1_1_energy_swap.html#a5dbb46c3cddb628ec0e67a09fbfc25ea">pricingPeriods_</a>.end(); pi++) {
<a name="l00160"></a>00160                 <span class="keyword">const</span> boost::shared_ptr&lt;PricingPeriod&gt;&amp; pricingPeriod = *pi;
<a name="l00161"></a>00161 
<a name="l00162"></a>00162                 <a class="code" href="namespace_quant_lib.html#a8ac1a45a37d8d3dda438a2e59e222620" title="integer number">Integer</a> periodDayCount = 0;
<a name="l00163"></a>00163 
<a name="l00164"></a>00164                 <span class="comment">// get the index quotes</span>
<a name="l00165"></a>00165                 <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> periodStartDate =
<a name="l00166"></a>00166                     <a class="code" href="class_quant_lib_1_1_energy_swap.html#a79073e91009c7785c1c4c8bd23ecc035">calendar_</a>.<a class="code" href="class_quant_lib_1_1_calendar.html#a0c62d180f6bed87f598320cd67e44b70">adjust</a>(pricingPeriod-&gt;startDate());
<a name="l00167"></a>00167                 <span class="keywordflow">for</span> (<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> stepDate = periodStartDate;
<a name="l00168"></a>00168                      stepDate &lt;= pricingPeriod-&gt;endDate();
<a name="l00169"></a>00169                      stepDate = <a class="code" href="class_quant_lib_1_1_energy_swap.html#a79073e91009c7785c1c4c8bd23ecc035">calendar_</a>.<a class="code" href="class_quant_lib_1_1_calendar.html#a1b8d9da28e4f012b89b00bf0ef388cc9">advance</a>(stepDate, 1*<a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3ac2d73aad1a6496a6481563e7b5e62b36">Days</a>)) {
<a name="l00170"></a>00170 
<a name="l00171"></a>00171                     <span class="keywordtype">bool</span> unrealized = stepDate &gt; evaluationDate;
<a name="l00172"></a>00172                     <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> payQuoteValue = 0;
<a name="l00173"></a>00173                     <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> receiveQuoteValue = 0;
<a name="l00174"></a>00174 
<a name="l00175"></a>00175                     <span class="keywordflow">if</span> (stepDate &lt;= lastQuoteDate) {
<a name="l00176"></a>00176                         payQuoteValue = <a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#a8cc1546319b38deb2967f5bce9e913a3">payIndex_</a>-&gt;price(stepDate);
<a name="l00177"></a>00177                         receiveQuoteValue = <a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#abcac555c0460d135e7c53f7f0bf44472">receiveIndex_</a>-&gt;price(stepDate);
<a name="l00178"></a>00178                     } <span class="keywordflow">else</span> {
<a name="l00179"></a>00179                         payQuoteValue = <a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#a8cc1546319b38deb2967f5bce9e913a3">payIndex_</a>-&gt;forwardPrice(stepDate);
<a name="l00180"></a>00180                         receiveQuoteValue =
<a name="l00181"></a>00181                             <a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#abcac555c0460d135e7c53f7f0bf44472">receiveIndex_</a>-&gt;forwardPrice(stepDate);
<a name="l00182"></a>00182                     }
<a name="l00183"></a>00183 
<a name="l00184"></a>00184                     <span class="keywordflow">if</span> (payQuoteValue == 0) {
<a name="l00185"></a>00185                         std::ostringstream message;
<a name="l00186"></a>00186                         message &lt;&lt; <span class="stringliteral">&quot;pay quote value for curve [&quot;</span>
<a name="l00187"></a>00187                                 &lt;&lt; <a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#a8cc1546319b38deb2967f5bce9e913a3">payIndex_</a>-&gt;name() &lt;&lt; <span class="stringliteral">&quot;] is 0 for date &quot;</span>
<a name="l00188"></a>00188                                 &lt;&lt; <a class="code" href="group__manips.html#ga0921b3ae46195feff93b2a4388e05d63" title="output dates in ISO format (yyyy-mm-dd)">io::iso_date</a>(stepDate);
<a name="l00189"></a>00189                         <a class="code" href="class_quant_lib_1_1_commodity.html#abdac21754ab0b8245d4501ca10d5c156">addPricingError</a>(<a class="code" href="struct_quant_lib_1_1_pricing_error.html#ab3dfb4c4ca0772113718ec41c601f8f4a7b106ed9120f4fdb2e9d30d0f49e70a2">PricingError::Warning</a>, message.str());
<a name="l00190"></a>00190                     }
<a name="l00191"></a>00191                     <span class="keywordflow">if</span> (receiveQuoteValue == 0) {
<a name="l00192"></a>00192                         std::ostringstream message;
<a name="l00193"></a>00193                         message &lt;&lt; <span class="stringliteral">&quot;receive quote value for curve [&quot;</span>
<a name="l00194"></a>00194                                 &lt;&lt; <a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#abcac555c0460d135e7c53f7f0bf44472">receiveIndex_</a>-&gt;name() &lt;&lt; <span class="stringliteral">&quot;] is 0 for date &quot;</span>
<a name="l00195"></a>00195                                 &lt;&lt; <a class="code" href="group__manips.html#ga0921b3ae46195feff93b2a4388e05d63" title="output dates in ISO format (yyyy-mm-dd)">io::iso_date</a>(stepDate);
<a name="l00196"></a>00196                         <a class="code" href="class_quant_lib_1_1_commodity.html#abdac21754ab0b8245d4501ca10d5c156">addPricingError</a>(<a class="code" href="struct_quant_lib_1_1_pricing_error.html#ab3dfb4c4ca0772113718ec41c601f8f4a7b106ed9120f4fdb2e9d30d0f49e70a2">PricingError::Warning</a>, message.str());
<a name="l00197"></a>00197                     }
<a name="l00198"></a>00198 
<a name="l00199"></a>00199                     <a class="code" href="errors_8hpp.html#a7a9bcab8006882bc7d5302a0861ab1a6" title="throw an error if the given pre-condition is not verified">QL_REQUIRE</a>(payQuoteValue != <a class="code" href="class_quant_lib_1_1_null.html">Null&lt;Real&gt;</a>(),
<a name="l00200"></a>00200                                <span class="stringliteral">&quot;curve [&quot;</span> &lt;&lt; <a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#a8cc1546319b38deb2967f5bce9e913a3">payIndex_</a>-&gt;name() &lt;&lt;
<a name="l00201"></a>00201                                <span class="stringliteral">&quot;] missing value for pricing date: &quot;</span>
<a name="l00202"></a>00202                                &lt;&lt; stepDate);
<a name="l00203"></a>00203                     <a class="code" href="errors_8hpp.html#a7a9bcab8006882bc7d5302a0861ab1a6" title="throw an error if the given pre-condition is not verified">QL_REQUIRE</a>(receiveQuoteValue != <a class="code" href="class_quant_lib_1_1_null.html">Null&lt;Real&gt;</a>(),
<a name="l00204"></a>00204                                <span class="stringliteral">&quot;curve [&quot;</span> &lt;&lt; <a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#abcac555c0460d135e7c53f7f0bf44472">receiveIndex_</a>-&gt;name() &lt;&lt;
<a name="l00205"></a>00205                                <span class="stringliteral">&quot;] missing value for pricing date: &quot;</span>
<a name="l00206"></a>00206                                &lt;&lt; stepDate);
<a name="l00207"></a>00207 
<a name="l00208"></a>00208                     <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> payLegPriceValue =
<a name="l00209"></a>00209                         payQuoteValue * payIndexUomConversionFactor *
<a name="l00210"></a>00210                         payIndexFxConversionFactor;
<a name="l00211"></a>00211                     <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> receiveLegPriceValue =
<a name="l00212"></a>00212                         receiveQuoteValue * receiveIndexUomConversionFactor *
<a name="l00213"></a>00213                         receiveIndexFxConversionFactor;
<a name="l00214"></a>00214 
<a name="l00215"></a>00215                     <span class="keywordflow">if</span> (<a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#aa435df0ac2669d839dc77ddb72555759">spreadToPayLeg_</a>)
<a name="l00216"></a>00216                         payLegPriceValue += basisValue;
<a name="l00217"></a>00217                     <span class="keywordflow">else</span>
<a name="l00218"></a>00218                         receiveLegPriceValue += basisValue;
<a name="l00219"></a>00219 
<a name="l00220"></a>00220                     <a class="code" href="class_quant_lib_1_1_energy_swap.html#a895b110618214562444410a93896c683">dailyPositions_</a>[stepDate] =
<a name="l00221"></a>00221                         <a class="code" href="struct_quant_lib_1_1_energy_daily_position.html">EnergyDailyPosition</a>(stepDate, payLegPriceValue,
<a name="l00222"></a>00222                                             receiveLegPriceValue, unrealized);
<a name="l00223"></a>00223                     periodDayCount++;
<a name="l00224"></a>00224                 }
<a name="l00225"></a>00225 
<a name="l00226"></a>00226                 <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> periodQuantityAmount =
<a name="l00227"></a>00227                     pricingPeriod-&gt;quantity().amount() *
<a name="l00228"></a>00228                     quantityUomConversionFactor;
<a name="l00229"></a>00229                 totalQuantityAmount += periodQuantityAmount;
<a name="l00230"></a>00230 
<a name="l00231"></a>00231                 <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> avgDailyQuantityAmount =
<a name="l00232"></a>00232                     periodDayCount == 0 ? 0 :
<a name="l00233"></a>00233                                           periodQuantityAmount / periodDayCount;
<a name="l00234"></a>00234 
<a name="l00235"></a>00235                 <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> payLegValue = 0;
<a name="l00236"></a>00236                 <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> receiveLegValue = 0;
<a name="l00237"></a>00237                 <span class="keywordflow">for</span> (std::map&lt;Date, EnergyDailyPosition&gt;::iterator dpi =
<a name="l00238"></a>00238                          <a class="code" href="class_quant_lib_1_1_energy_swap.html#a895b110618214562444410a93896c683">dailyPositions_</a>.find(periodStartDate);
<a name="l00239"></a>00239                      dpi != <a class="code" href="class_quant_lib_1_1_energy_swap.html#a895b110618214562444410a93896c683">dailyPositions_</a>.end() &amp;&amp;
<a name="l00240"></a>00240                          dpi-&gt;first &lt;= pricingPeriod-&gt;endDate(); dpi++) {
<a name="l00241"></a>00241                     <a class="code" href="struct_quant_lib_1_1_energy_daily_position.html">EnergyDailyPosition</a>&amp; dailyPosition = dpi-&gt;second;
<a name="l00242"></a>00242                     dailyPosition.<a class="code" href="struct_quant_lib_1_1_energy_daily_position.html#a7c2199130f23362d16294b034f10e50e">quantityAmount</a> = avgDailyQuantityAmount;
<a name="l00243"></a>00243                     dailyPosition.<a class="code" href="struct_quant_lib_1_1_energy_daily_position.html#ae14e1dc9ca8fd247903644e2576dad2d">riskDelta</a> =
<a name="l00244"></a>00244                         (-dailyPosition.<a class="code" href="struct_quant_lib_1_1_energy_daily_position.html#a30405f12c7f636e58c1f9fd9ea13a0c7">payLegPrice</a> + dailyPosition.<a class="code" href="struct_quant_lib_1_1_energy_daily_position.html#afd915a3d1c9b2becd0cf389d363dd73b">receiveLegPrice</a>) * avgDailyQuantityAmount;
<a name="l00245"></a>00245                     payLegValue += -dailyPosition.<a class="code" href="struct_quant_lib_1_1_energy_daily_position.html#a30405f12c7f636e58c1f9fd9ea13a0c7">payLegPrice</a> * avgDailyQuantityAmount;
<a name="l00246"></a>00246                     receiveLegValue += dailyPosition.<a class="code" href="struct_quant_lib_1_1_energy_daily_position.html#afd915a3d1c9b2becd0cf389d363dd73b">receiveLegPrice</a> * avgDailyQuantityAmount;
<a name="l00247"></a>00247                 }
<a name="l00248"></a>00248 
<a name="l00249"></a>00249                 <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> discountFactor = 1;
<a name="l00250"></a>00250                 <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> payLegDiscountFactor = 1;
<a name="l00251"></a>00251                 <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> receiveLegDiscountFactor = 1;
<a name="l00252"></a>00252                 <span class="keywordflow">if</span> (pricingPeriod-&gt;paymentDate() &gt;= evaluationDate + 2 <span class="comment">/* settlement days*/</span>) {
<a name="l00253"></a>00253                     discountFactor =
<a name="l00254"></a>00254                         <a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#a4f026d82a90a6411199ac1f5c5555317">discountTermStructure_</a>-&gt;discount(
<a name="l00255"></a>00255                                                 pricingPeriod-&gt;paymentDate());
<a name="l00256"></a>00256                     payLegDiscountFactor =
<a name="l00257"></a>00257                         <a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#a04b7c964b0ad733e9ad2bd92573ed71d">payLegTermStructure_</a>-&gt;discount(
<a name="l00258"></a>00258                                                 pricingPeriod-&gt;paymentDate());
<a name="l00259"></a>00259                     receiveLegDiscountFactor =
<a name="l00260"></a>00260                         <a class="code" href="class_quant_lib_1_1_energy_basis_swap.html#a78e5eca5e15cb2295e314a8d0e7d5d84">receiveLegTermStructure_</a>-&gt;discount(
<a name="l00261"></a>00261                                                 pricingPeriod-&gt;paymentDate());
<a name="l00262"></a>00262                 }
<a name="l00263"></a>00263 
<a name="l00264"></a>00264                 <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> uDelta = receiveLegValue + payLegValue;
<a name="l00265"></a>00265                 <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> dDelta = (receiveLegValue * receiveLegDiscountFactor) +
<a name="l00266"></a>00266                     (payLegValue * payLegDiscountFactor);
<a name="l00267"></a>00267                 <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> pmtFxConversionFactor =
<a name="l00268"></a>00268                     (dDelta &gt; 0) ? payLegFxConversionFactor : receiveLegFxConversionFactor;
<a name="l00269"></a>00269                 <a class="code" href="class_quant_lib_1_1_currency.html" title="Currency specification">Currency</a> pmtCurrency =
<a name="l00270"></a>00270                     (dDelta  &gt; 0) ? <a class="code" href="class_quant_lib_1_1_energy_swap.html#a7cb375c42d60be87f0fe29e03e89708b">receiveCurrency_</a> : <a class="code" href="class_quant_lib_1_1_energy_swap.html#a4b1bfe253fba4a3b4d4f9623f3bdc625">payCurrency_</a>;
<a name="l00271"></a>00271                 <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> pmtDiscountFactor =
<a name="l00272"></a>00272                     (dDelta  &gt; 0) ? receiveLegDiscountFactor : payLegDiscountFactor;
<a name="l00273"></a>00273 
<a name="l00274"></a>00274                 <a class="code" href="class_quant_lib_1_1_energy_swap.html#a7b349d8dfa7895c623e0162e28cf5a2a">paymentCashFlows_</a>[pricingPeriod-&gt;paymentDate()] =
<a name="l00275"></a>00275                     boost::shared_ptr&lt;CommodityCashFlow&gt; (
<a name="l00276"></a>00276                            <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_commodity_cash_flow.html">CommodityCashFlow</a>(pricingPeriod-&gt;paymentDate(),
<a name="l00277"></a>00277                                                  <a class="code" href="class_quant_lib_1_1_money.html" title="amount of cash">Money</a>(baseCurrency,
<a name="l00278"></a>00278                                                        uDelta * discountFactor),
<a name="l00279"></a>00279                                                  <a class="code" href="class_quant_lib_1_1_money.html" title="amount of cash">Money</a>(baseCurrency, uDelta),
<a name="l00280"></a>00280                                                  <a class="code" href="class_quant_lib_1_1_money.html" title="amount of cash">Money</a>(pmtCurrency,
<a name="l00281"></a>00281                                                        dDelta * pmtFxConversionFactor),
<a name="l00282"></a>00282                                                  <a class="code" href="class_quant_lib_1_1_money.html" title="amount of cash">Money</a>(pmtCurrency,
<a name="l00283"></a>00283                                                        uDelta * pmtFxConversionFactor),
<a name="l00284"></a>00284                                                  discountFactor,
<a name="l00285"></a>00285                                                  pmtDiscountFactor,
<a name="l00286"></a>00286                                                  pricingPeriod-&gt;paymentDate() &lt;= evaluationDate));
<a name="l00287"></a>00287 
<a name="l00288"></a>00288                 <a class="code" href="class_quant_lib_1_1_energy_commodity.html#a74800e7f1d3883c71a15472115d05107">calculateSecondaryCostAmounts</a>(
<a name="l00289"></a>00289                                <a class="code" href="class_quant_lib_1_1_energy_swap.html#a5dbb46c3cddb628ec0e67a09fbfc25ea">pricingPeriods_</a>[0]-&gt;<a class="code" href="class_quant_lib_1_1_energy_swap.html#adbfad551c30913cb4c082bcb29528bcc">quantity</a>().<a class="code" href="class_quant_lib_1_1_energy_swap.html#a79e9854ff8c0d04e9d7ad2f1b8be5023">commodityType</a>(),
<a name="l00290"></a>00290                                totalQuantityAmount, evaluationDate);
<a name="l00291"></a>00291 
<a name="l00292"></a>00292                 <a class="code" href="class_quant_lib_1_1_instrument.html#a997663780100d30ae59b14ac0285322d">NPV_</a> += dDelta;
<a name="l00293"></a>00293             }
<a name="l00294"></a>00294 
<a name="l00295"></a>00295             <a class="code" href="errors_8hpp.html#a7a9bcab8006882bc7d5302a0861ab1a6" title="throw an error if the given pre-condition is not verified">QL_REQUIRE</a>(<a class="code" href="class_quant_lib_1_1_energy_swap.html#a7b349d8dfa7895c623e0162e28cf5a2a">paymentCashFlows_</a>.size() &gt; 0, <span class="stringliteral">&quot;no cashflows&quot;</span>);
<a name="l00296"></a>00296 
<a name="l00297"></a>00297             <span class="keywordflow">for</span> (SecondaryCostAmounts::const_iterator i =
<a name="l00298"></a>00298                      <a class="code" href="class_quant_lib_1_1_commodity.html#a14b8c3757abcfaf131f4953dd022808f">secondaryCostAmounts_</a>.begin();
<a name="l00299"></a>00299                  i != <a class="code" href="class_quant_lib_1_1_commodity.html#a14b8c3757abcfaf131f4953dd022808f">secondaryCostAmounts_</a>.end(); i++) {
<a name="l00300"></a>00300                 <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> amount = i-&gt;second.value();
<a name="l00301"></a>00301                 <a class="code" href="class_quant_lib_1_1_instrument.html#a997663780100d30ae59b14ac0285322d">NPV_</a> -= amount;
<a name="l00302"></a>00302             }
<a name="l00303"></a>00303 
<a name="l00304"></a>00304             <a class="code" href="class_quant_lib_1_1_instrument.html#a2b512754fc243f4bb7a960c7bf8c92a6">additionalResults_</a>[<span class="stringliteral">&quot;dailyPositions&quot;</span>] = <a class="code" href="class_quant_lib_1_1_energy_swap.html#a895b110618214562444410a93896c683">dailyPositions_</a>;
<a name="l00305"></a>00305           
<a name="l00306"></a>00306         } <span class="keywordflow">catch</span> (<span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_error.html" title="Base error class.">QuantLib::Error</a>&amp; e) {
<a name="l00307"></a>00307             <a class="code" href="class_quant_lib_1_1_commodity.html#abdac21754ab0b8245d4501ca10d5c156">addPricingError</a>(<a class="code" href="struct_quant_lib_1_1_pricing_error.html#ab3dfb4c4ca0772113718ec41c601f8f4a1df75fdd5fd34764e2c6c545d35ebcc4">PricingError::Error</a>, e.<a class="code" href="class_quant_lib_1_1_error.html#ad56b72dca7f13984cb064891f2e64fc6" title="returns the error message.">what</a>());
<a name="l00308"></a>00308             <span class="keywordflow">throw</span>;
<a name="l00309"></a>00309         } <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception&amp; e) {
<a name="l00310"></a>00310             <a class="code" href="class_quant_lib_1_1_commodity.html#abdac21754ab0b8245d4501ca10d5c156">addPricingError</a>(<a class="code" href="struct_quant_lib_1_1_pricing_error.html#ab3dfb4c4ca0772113718ec41c601f8f4a1df75fdd5fd34764e2c6c545d35ebcc4">PricingError::Error</a>, e.what());
<a name="l00311"></a>00311             <span class="keywordflow">throw</span>;
<a name="l00312"></a>00312         }
<a name="l00313"></a>00313     }
<a name="l00314"></a>00314 
<a name="l00315"></a>00315 }
<a name="l00316"></a>00316 
</pre></div></div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="energybasisswap_8cpp.html">energybasisswap.cpp</a>      </li>

    <li class="footer">Generated on Sat Aug 25 2012 13:50:43 for QuantLib by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
