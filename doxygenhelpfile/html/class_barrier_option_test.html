<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>QuantLib: BarrierOptionTest Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">QuantLib
   &#160;<span id="projectnumber">1.3</span>
   </div>
   <div id="projectbrief">ql1-3</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="dynsections.js"></script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('class_barrier_option_test.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-static-methods">Static Public Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">BarrierOptionTest Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="BarrierOptionTest" -->
<p><code>#include &lt;<a class="el" href="test-suite_2barrieroption_8hpp_source.html">barrieroption.hpp</a>&gt;</code></p>

<p><a href="class_barrier_option_test-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_barrier_option_test.html#ace4b984e559303de3b03127c3aa7cf69">testHaugValues</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_barrier_option_test.html#af7234f5ebe4fff94b2389bb2975d92ea">testBabsiriValues</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_barrier_option_test.html#afef922c45e056d38756c03dc8966789c">testBeagleholeValues</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_barrier_option_test.html#a9d851e6ca8b667ddcecdcec4ac5c855a">testPerturbative</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_barrier_option_test.html#a9f004e352fd11be6e5e289f6b452bb9f">testLocalVolAndHestonComparison</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <br class="typebreak"/>
boost::unit_test_framework::test_suite *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_barrier_option_test.html#a193cc3696652799b6c40da8ca8154f28">suite</a> ()</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="test-suite_2barrieroption_8hpp_source.html#l00028">28</a> of file <a class="el" href="test-suite_2barrieroption_8hpp_source.html">barrieroption.hpp</a>.</p>
</div><hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a193cc3696652799b6c40da8ca8154f28"></a><!-- doxytag: member="BarrierOptionTest::suite" ref="a193cc3696652799b6c40da8ca8154f28" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">test_suite * <a class="el" href="class_barrier_option_test.html#a193cc3696652799b6c40da8ca8154f28">BarrierOptionTest::suite</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2barrieroption_8cpp_source.html#l00702">702</a> of file <a class="el" href="test-suite_2barrieroption_8cpp_source.html">barrieroption.cpp</a>.</p>

<p>References <a class="el" href="test-suite_2utilities_8hpp_source.html#l00061">QUANTLIB_TEST_CASE</a>, <a class="el" href="test-suite_2barrieroption_8cpp_source.html#l00281">testBabsiriValues()</a>, <a class="el" href="test-suite_2barrieroption_8cpp_source.html#l00386">testBeagleholeValues()</a>, <a class="el" href="test-suite_2barrieroption_8cpp_source.html#l00110">testHaugValues()</a>, <a class="el" href="test-suite_2barrieroption_8cpp_source.html#l00568">testLocalVolAndHestonComparison()</a>, and <a class="el" href="test-suite_2barrieroption_8cpp_source.html#l00483">testPerturbative()</a>.</p>

<p>Referenced by <a class="el" href="quantlibtestsuite_8cpp_source.html#l00206">init_unit_test_suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                     {
    test_suite* <a class="code" href="class_barrier_option_test.html#a193cc3696652799b6c40da8ca8154f28">suite</a> = BOOST_TEST_SUITE(<span class="stringliteral">&quot;Barrier option tests&quot;</span>);
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(&amp;<a class="code" href="class_barrier_option_test.html#ace4b984e559303de3b03127c3aa7cf69">BarrierOptionTest::testHaugValues</a>));
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(&amp;<a class="code" href="class_barrier_option_test.html#af7234f5ebe4fff94b2389bb2975d92ea">BarrierOptionTest::testBabsiriValues</a>));
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(&amp;<a class="code" href="class_barrier_option_test.html#afef922c45e056d38756c03dc8966789c">BarrierOptionTest::testBeagleholeValues</a>));
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(&amp;<a class="code" href="class_barrier_option_test.html#a9d851e6ca8b667ddcecdcec4ac5c855a">BarrierOptionTest::testPerturbative</a>));
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(
                        &amp;<a class="code" href="class_barrier_option_test.html#a9f004e352fd11be6e5e289f6b452bb9f">BarrierOptionTest::testLocalVolAndHestonComparison</a>));
    <span class="keywordflow">return</span> <a class="code" href="class_barrier_option_test.html#a193cc3696652799b6c40da8ca8154f28">suite</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="af7234f5ebe4fff94b2389bb2975d92ea"></a><!-- doxytag: member="BarrierOptionTest::testBabsiriValues" ref="af7234f5ebe4fff94b2389bb2975d92ea" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_barrier_option_test.html#af7234f5ebe4fff94b2389bb2975d92ea">BarrierOptionTest::testBabsiriValues</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2barrieroption_8cpp_source.html#l00281">281</a> of file <a class="el" href="test-suite_2barrieroption_8cpp_source.html">barrieroption.cpp</a>.</p>

<p>References <a class="el" href="option_8hpp_source.html#l00039">QuantLib::Option::Call</a>, <a class="el" href="barriertype_8hpp_source.html#l00036">QuantLib::Barrier::DownIn</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00058">QuantLib::flatRate()</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00086">QuantLib::flatVol()</a>, <a class="el" href="test-suite_2utilities_8hpp_source.html#l00039">LENGTH</a>, <a class="el" href="instrument_8hpp_source.html#l00186">QuantLib::Instrument::NPV()</a>, <a class="el" href="test-suite_2barrieroption_8cpp_source.html#l00045">REPORT_FAILURE</a>, <a class="el" href="instrument_8hpp_source.html#l00133">QuantLib::Instrument::setPricingEngine()</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00124">anonymous_namespace{marketmodel.cpp}::todaysDate</a>, <a class="el" href="barriertype_8hpp_source.html#l00036">QuantLib::Barrier::UpIn</a>, <a class="el" href="dataformatters_8hpp_source.html#l00133">QuantLib::io::volatility()</a>, <a class="el" href="mcbarrierengine_8hpp_source.html#l00299">QuantLib::MakeMCBarrierEngine&lt; RNG, S &gt;::withBrownianBridge()</a>, <a class="el" href="mcbarrierengine_8hpp_source.html#l00334">QuantLib::MakeMCBarrierEngine&lt; RNG, S &gt;::withMaxSamples()</a>, <a class="el" href="mcbarrierengine_8hpp_source.html#l00313">QuantLib::MakeMCBarrierEngine&lt; RNG, S &gt;::withSamples()</a>, and <a class="el" href="mcbarrierengine_8hpp_source.html#l00348">QuantLib::MakeMCBarrierEngine&lt; RNG, S &gt;::withSeed()</a>.</p>

<p>Referenced by <a class="el" href="quantlibbenchmark_8cpp_source.html#l00222">init_unit_test_suite()</a>, and <a class="el" href="test-suite_2barrieroption_8cpp_source.html#l00702">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                          {

    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing barrier options against Babsiri&#39;s values...&quot;</span>);

    <span class="comment">/*</span>
<span class="comment">        Data from</span>
<span class="comment">        &quot;Simulating Path-Dependent Options: A New Approach&quot;</span>
<span class="comment">          - M. El Babsiri and G. Noel</span>
<span class="comment">            Journal of Derivatives; Winter 1998; 6, 2</span>
<span class="comment">    */</span>
    BarrierOptionData values[] = {
        { Barrier::DownIn, 0.10,   100,       90,   0.07187,  0.0 },
        { Barrier::DownIn, 0.15,   100,       90,   0.60638,  0.0 },
        { Barrier::DownIn, 0.20,   100,       90,   1.64005,  0.0 },
        { Barrier::DownIn, 0.25,   100,       90,   2.98495,  0.0 },
        { Barrier::DownIn, 0.30,   100,       90,   4.50952,  0.0 },
        { Barrier::UpIn,   0.10,   100,      110,   4.79148,  0.0 },
        { Barrier::UpIn,   0.15,   100,      110,   7.08268,  0.0 },
        { Barrier::UpIn,   0.20,   100,      110,   9.11008,  0.0 },
        { Barrier::UpIn,   0.25,   100,      110,  11.06148,  0.0 },
        { Barrier::UpIn,   0.30,   100,      110,  12.98351,  0.0 }
    };

    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> underlyingPrice = 100.0;
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> rebate = 0.0;
    <a class="code" href="namespace_quant_lib.html#a919ba3567cc89fca373f8d6b8e80126b" title="interest rates">Rate</a> r = 0.05;
    <a class="code" href="namespace_quant_lib.html#a919ba3567cc89fca373f8d6b8e80126b" title="interest rates">Rate</a> q = 0.02;

    <a class="code" href="class_quant_lib_1_1_day_counter.html" title="day counter class">DayCounter</a> dc = <a class="code" href="class_quant_lib_1_1_actual360.html" title="Actual/360 day count convention.">Actual360</a>();
    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> today = <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#ae1b42c838cf0f4cf17262f0b22bac899">Date::todaysDate</a>();
    boost::shared_ptr&lt;SimpleQuote&gt; underlying(
                                            <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(underlyingPrice));

    boost::shared_ptr&lt;SimpleQuote&gt; qH_SME(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(q));
    boost::shared_ptr&lt;YieldTermStructure&gt; qTS = <a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(today, qH_SME, dc);

    boost::shared_ptr&lt;SimpleQuote&gt; rH_SME(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(r));
    boost::shared_ptr&lt;YieldTermStructure&gt; rTS = <a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(today, rH_SME, dc);

    boost::shared_ptr&lt;SimpleQuote&gt; <a class="code" href="group__manips.html#ga9890b88f8d11494a518492be973b9046" title="output volatilities as percentages">volatility</a>(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(0.10));
    boost::shared_ptr&lt;BlackVolTermStructure&gt; volTS =
        <a class="code" href="namespace_quant_lib.html#a589d5c4b0b60b0bdd42ae07d820b2ed3">flatVol</a>(today, <a class="code" href="group__manips.html#ga9890b88f8d11494a518492be973b9046" title="output volatilities as percentages">volatility</a>, dc);

    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> exDate = today+360;
    boost::shared_ptr&lt;Exercise&gt; exercise(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_european_exercise.html" title="European exercise.">EuropeanExercise</a>(exDate));

    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(values); i++) {
        <a class="code" href="group__manips.html#ga9890b88f8d11494a518492be973b9046" title="output volatilities as percentages">volatility</a>-&gt;setValue(values[i].<a class="code" href="group__manips.html#ga9890b88f8d11494a518492be973b9046" title="output volatilities as percentages">volatility</a>);

        boost::shared_ptr&lt;StrikedTypePayoff&gt; callPayoff(<span class="keyword">new</span>
            <a class="code" href="class_quant_lib_1_1_plain_vanilla_payoff.html" title="Plain-vanilla payoff.">PlainVanillaPayoff</a>(Option::Call, values[i].strike));

        boost::shared_ptr&lt;BlackScholesMertonProcess&gt; stochProcess(<span class="keyword">new</span>
            <a class="code" href="class_quant_lib_1_1_black_scholes_merton_process.html" title="Merton (1973) extension to the Black-Scholes stochastic process.">BlackScholesMertonProcess</a>(<a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;Quote&gt;</a>(underlying),
                                      <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a>(qTS),
                                      <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a>(rTS),
                                      <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;BlackVolTermStructure&gt;</a>(volTS)));


        boost::shared_ptr&lt;PricingEngine&gt; <a class="code" href="class_quant_lib_1_1engine.html">engine</a>(
                                     <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_analytic_barrier_engine.html" title="Pricing engine for barrier options using analytical formulae.">AnalyticBarrierEngine</a>(stochProcess));

        <span class="comment">// analytic</span>
        <a class="code" href="class_quant_lib_1_1_barrier_option.html" title="Barrier option on a single asset.">BarrierOption</a> barrierCallOption(
                values[i].<a class="code" href="class_traits_1_1template_01curve_1_1type.html">type</a>,
                values[i].barrier,
                rebate,
                callPayoff,
                exercise);
        barrierCallOption.setPricingEngine(<a class="code" href="class_quant_lib_1_1engine.html">engine</a>);
        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> calculated = barrierCallOption.NPV();
        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> expected = values[i].callValue;
        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> error = std::fabs(calculated-expected);
        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> maxErrorAllowed = 1.0e-5;
        <span class="keywordflow">if</span> (error&gt;maxErrorAllowed) {
            <a class="code" href="test-suite_2barrieroption_8cpp.html#a622c348e4784d8cba117febdf58d4f6a">REPORT_FAILURE</a>(<span class="stringliteral">&quot;value&quot;</span>, values[i].<a class="code" href="class_traits_1_1template_01curve_1_1type.html">type</a>, values[i].barrier,
                           rebate, callPayoff, exercise, underlyingPrice,
                           q, r, today, values[i].volatility,
                           expected, calculated, error, maxErrorAllowed);
        }

        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> maxMcRelativeErrorAllowed = 2.0e-2;

        boost::shared_ptr&lt;PricingEngine&gt; mcEngine =
            <a class="code" href="class_quant_lib_1_1_make_m_c_barrier_engine.html" title="Monte Carlo barrier-option engine factory.">MakeMCBarrierEngine&lt;LowDiscrepancy&gt;</a>(stochProcess)
            .withStepsPerYear(1)
            .<a class="code" href="class_quant_lib_1_1_make_m_c_barrier_engine.html#af3991ca5ed1a77a8758feba621fc1e48">withBrownianBridge</a>()
            .<a class="code" href="class_quant_lib_1_1_make_m_c_barrier_engine.html#a8bac556b1a9df061f8dd459a66d06b6e">withSamples</a>(131071) <span class="comment">// 2^17-1</span>
            .<a class="code" href="class_quant_lib_1_1_make_m_c_barrier_engine.html#aa699bfed7e288151ae94cb6bacad1508">withMaxSamples</a>(1048575) <span class="comment">// 2^20-1</span>
            .<a class="code" href="class_quant_lib_1_1_make_m_c_barrier_engine.html#a9a8118b5a8877af72e41336a9a1727ad">withSeed</a>(5);

        barrierCallOption.setPricingEngine(mcEngine);
        calculated = barrierCallOption.NPV();
        error = std::fabs(calculated-expected)/expected;
        <span class="keywordflow">if</span> (error&gt;maxMcRelativeErrorAllowed) {
            <a class="code" href="test-suite_2barrieroption_8cpp.html#a622c348e4784d8cba117febdf58d4f6a">REPORT_FAILURE</a>(<span class="stringliteral">&quot;value&quot;</span>, values[i].<a class="code" href="class_traits_1_1template_01curve_1_1type.html">type</a>, values[i].barrier,
                           rebate, callPayoff, exercise, underlyingPrice,
                           q, r, today, values[i].volatility,
                           expected, calculated, error,
                           maxMcRelativeErrorAllowed);
        }

    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="afef922c45e056d38756c03dc8966789c"></a><!-- doxytag: member="BarrierOptionTest::testBeagleholeValues" ref="afef922c45e056d38756c03dc8966789c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_barrier_option_test.html#afef922c45e056d38756c03dc8966789c">BarrierOptionTest::testBeagleholeValues</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2barrieroption_8cpp_source.html#l00386">386</a> of file <a class="el" href="test-suite_2barrieroption_8cpp_source.html">barrieroption.cpp</a>.</p>

<p>References <a class="el" href="option_8hpp_source.html#l00039">QuantLib::Option::Call</a>, <a class="el" href="barriertype_8hpp_source.html#l00036">QuantLib::Barrier::DownOut</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00058">QuantLib::flatRate()</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00086">QuantLib::flatVol()</a>, <a class="el" href="test-suite_2utilities_8hpp_source.html#l00039">LENGTH</a>, <a class="el" href="instrument_8hpp_source.html#l00186">QuantLib::Instrument::NPV()</a>, <a class="el" href="test-suite_2barrieroption_8cpp_source.html#l00045">REPORT_FAILURE</a>, <a class="el" href="instrument_8hpp_source.html#l00133">QuantLib::Instrument::setPricingEngine()</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00124">anonymous_namespace{marketmodel.cpp}::todaysDate</a>, <a class="el" href="dataformatters_8hpp_source.html#l00133">QuantLib::io::volatility()</a>, <a class="el" href="mcbarrierengine_8hpp_source.html#l00299">QuantLib::MakeMCBarrierEngine&lt; RNG, S &gt;::withBrownianBridge()</a>, <a class="el" href="mcbarrierengine_8hpp_source.html#l00334">QuantLib::MakeMCBarrierEngine&lt; RNG, S &gt;::withMaxSamples()</a>, <a class="el" href="mcbarrierengine_8hpp_source.html#l00313">QuantLib::MakeMCBarrierEngine&lt; RNG, S &gt;::withSamples()</a>, and <a class="el" href="mcbarrierengine_8hpp_source.html#l00348">QuantLib::MakeMCBarrierEngine&lt; RNG, S &gt;::withSeed()</a>.</p>

<p>Referenced by <a class="el" href="test-suite_2barrieroption_8cpp_source.html#l00702">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                             {

    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing barrier options against Beaglehole&#39;s values...&quot;</span>);


    <span class="comment">/*</span>
<span class="comment">        Data from</span>
<span class="comment">        &quot;Going to Extreme: Correcting Simulation Bias in Exotic</span>
<span class="comment">         Option Valuation&quot;</span>
<span class="comment">          - D.R. Beaglehole, P.H. Dybvig and G. Zhou</span>
<span class="comment">            Financial Analysts Journal; Jan / Feb 1997; 53, 1</span>
<span class="comment">    */</span>
    BarrierOptionData values[] = {
        { Barrier::DownOut, 0.50,   50,      45,  5.477,  0.0 }
    };

    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> underlyingPrice = 50.0;
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> rebate = 0.0;
    <a class="code" href="namespace_quant_lib.html#a919ba3567cc89fca373f8d6b8e80126b" title="interest rates">Rate</a> r = std::log(1.1);
    <a class="code" href="namespace_quant_lib.html#a919ba3567cc89fca373f8d6b8e80126b" title="interest rates">Rate</a> q = 0.00;

    <a class="code" href="class_quant_lib_1_1_day_counter.html" title="day counter class">DayCounter</a> dc = <a class="code" href="class_quant_lib_1_1_actual360.html" title="Actual/360 day count convention.">Actual360</a>();
    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> today = <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#ae1b42c838cf0f4cf17262f0b22bac899">Date::todaysDate</a>();

    boost::shared_ptr&lt;SimpleQuote&gt; underlying(
                                            <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(underlyingPrice));

    boost::shared_ptr&lt;SimpleQuote&gt; qH_SME(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(q));
    boost::shared_ptr&lt;YieldTermStructure&gt; qTS = <a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(today, qH_SME, dc);

    boost::shared_ptr&lt;SimpleQuote&gt; rH_SME(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(r));
    boost::shared_ptr&lt;YieldTermStructure&gt; rTS = <a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(today, rH_SME, dc);

    boost::shared_ptr&lt;SimpleQuote&gt; <a class="code" href="group__manips.html#ga9890b88f8d11494a518492be973b9046" title="output volatilities as percentages">volatility</a>(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(0.10));
    boost::shared_ptr&lt;BlackVolTermStructure&gt; volTS =
        <a class="code" href="namespace_quant_lib.html#a589d5c4b0b60b0bdd42ae07d820b2ed3">flatVol</a>(today, <a class="code" href="group__manips.html#ga9890b88f8d11494a518492be973b9046" title="output volatilities as percentages">volatility</a>, dc);


    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> exDate = today+360;
    boost::shared_ptr&lt;Exercise&gt; exercise(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_european_exercise.html" title="European exercise.">EuropeanExercise</a>(exDate));

    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(values); i++) {
        <a class="code" href="group__manips.html#ga9890b88f8d11494a518492be973b9046" title="output volatilities as percentages">volatility</a>-&gt;setValue(values[i].<a class="code" href="group__manips.html#ga9890b88f8d11494a518492be973b9046" title="output volatilities as percentages">volatility</a>);

        boost::shared_ptr&lt;StrikedTypePayoff&gt; callPayoff(<span class="keyword">new</span>
            <a class="code" href="class_quant_lib_1_1_plain_vanilla_payoff.html" title="Plain-vanilla payoff.">PlainVanillaPayoff</a>(Option::Call, values[i].strike));

        boost::shared_ptr&lt;BlackScholesMertonProcess&gt; stochProcess(<span class="keyword">new</span>
            <a class="code" href="class_quant_lib_1_1_black_scholes_merton_process.html" title="Merton (1973) extension to the Black-Scholes stochastic process.">BlackScholesMertonProcess</a>(<a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;Quote&gt;</a>(underlying),
                                      <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a>(qTS),
                                      <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a>(rTS),
                                      <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;BlackVolTermStructure&gt;</a>(volTS)));


        boost::shared_ptr&lt;PricingEngine&gt; <a class="code" href="class_quant_lib_1_1engine.html">engine</a>(
                                     <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_analytic_barrier_engine.html" title="Pricing engine for barrier options using analytical formulae.">AnalyticBarrierEngine</a>(stochProcess));

        <a class="code" href="class_quant_lib_1_1_barrier_option.html" title="Barrier option on a single asset.">BarrierOption</a> barrierCallOption(
                values[i].<a class="code" href="class_traits_1_1template_01curve_1_1type.html">type</a>,
                values[i].barrier,
                rebate,
                callPayoff,
                exercise);
        barrierCallOption.setPricingEngine(<a class="code" href="class_quant_lib_1_1engine.html">engine</a>);
        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> calculated = barrierCallOption.NPV();
        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> expected = values[i].callValue;
        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> maxErrorAllowed = 1.0e-3;
        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> error = std::fabs(calculated-expected);
        <span class="keywordflow">if</span> (error &gt; maxErrorAllowed) {
            <a class="code" href="test-suite_2barrieroption_8cpp.html#a622c348e4784d8cba117febdf58d4f6a">REPORT_FAILURE</a>(<span class="stringliteral">&quot;value&quot;</span>, values[i].<a class="code" href="class_traits_1_1template_01curve_1_1type.html">type</a>, values[i].barrier,
                           rebate, callPayoff, exercise, underlyingPrice,
                           q, r, today, values[i].volatility,
                           expected, calculated, error, maxErrorAllowed);
        }

        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> maxMcRelativeErrorAllowed = 0.01;
        boost::shared_ptr&lt;PricingEngine&gt; mcEngine =
            <a class="code" href="class_quant_lib_1_1_make_m_c_barrier_engine.html" title="Monte Carlo barrier-option engine factory.">MakeMCBarrierEngine&lt;LowDiscrepancy&gt;</a>(stochProcess)
            .withStepsPerYear(1)
            .<a class="code" href="class_quant_lib_1_1_make_m_c_barrier_engine.html#af3991ca5ed1a77a8758feba621fc1e48">withBrownianBridge</a>()
            .<a class="code" href="class_quant_lib_1_1_make_m_c_barrier_engine.html#a8bac556b1a9df061f8dd459a66d06b6e">withSamples</a>(131071) <span class="comment">// 2^17-1</span>
            .<a class="code" href="class_quant_lib_1_1_make_m_c_barrier_engine.html#aa699bfed7e288151ae94cb6bacad1508">withMaxSamples</a>(1048575) <span class="comment">// 2^20-1</span>
            .<a class="code" href="class_quant_lib_1_1_make_m_c_barrier_engine.html#a9a8118b5a8877af72e41336a9a1727ad">withSeed</a>(10);

        barrierCallOption.setPricingEngine(mcEngine);
        calculated = barrierCallOption.NPV();
        error = std::fabs(calculated-expected)/expected;
        <span class="keywordflow">if</span> (error&gt;maxMcRelativeErrorAllowed) {
            <a class="code" href="test-suite_2barrieroption_8cpp.html#a622c348e4784d8cba117febdf58d4f6a">REPORT_FAILURE</a>(<span class="stringliteral">&quot;value&quot;</span>, values[i].<a class="code" href="class_traits_1_1template_01curve_1_1type.html">type</a>, values[i].barrier,
                           rebate, callPayoff, exercise, underlyingPrice,
                           q, r, today, values[i].volatility,
                           expected, calculated, error,
                           maxMcRelativeErrorAllowed);
        }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="ace4b984e559303de3b03127c3aa7cf69"></a><!-- doxytag: member="BarrierOptionTest::testHaugValues" ref="ace4b984e559303de3b03127c3aa7cf69" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_barrier_option_test.html#ace4b984e559303de3b03127c3aa7cf69">BarrierOptionTest::testHaugValues</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2barrieroption_8cpp_source.html#l00110">110</a> of file <a class="el" href="test-suite_2barrieroption_8cpp_source.html">barrieroption.cpp</a>.</p>

<p>References <a class="el" href="option_8hpp_source.html#l00039">QuantLib::Option::Call</a>, <a class="el" href="barriertype_8hpp_source.html#l00036">QuantLib::Barrier::DownIn</a>, <a class="el" href="barriertype_8hpp_source.html#l00036">QuantLib::Barrier::DownOut</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00058">QuantLib::flatRate()</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00086">QuantLib::flatVol()</a>, <a class="el" href="test-suite_2utilities_8hpp_source.html#l00039">LENGTH</a>, <a class="el" href="instrument_8hpp_source.html#l00186">QuantLib::Instrument::NPV()</a>, <a class="el" href="option_8hpp_source.html#l00038">QuantLib::Option::Put</a>, <a class="el" href="test-suite_2barrieroption_8cpp_source.html#l00045">REPORT_FAILURE</a>, <a class="el" href="instrument_8hpp_source.html#l00133">QuantLib::Instrument::setPricingEngine()</a>, <a class="el" href="quantlibbenchmark_8cpp_source.html#l00150">anonymous_namespace{quantlibbenchmark.cpp}::t</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00124">anonymous_namespace{marketmodel.cpp}::todaysDate</a>, <a class="el" href="barriertype_8hpp_source.html#l00036">QuantLib::Barrier::UpIn</a>, <a class="el" href="barriertype_8hpp_source.html#l00036">QuantLib::Barrier::UpOut</a>, and <a class="el" href="perturbativebarrieroptionengine_8cpp_source.html#l00433">anonymous_namespace{perturbativebarrieroptionengine.cpp}::v()</a>.</p>

<p>Referenced by <a class="el" href="test-suite_2barrieroption_8cpp_source.html#l00702">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                       {

    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing barrier options against Haug&#39;s values...&quot;</span>);

    NewBarrierOptionData values[] = {
        <span class="comment">/* The data below are from</span>
<span class="comment">          &quot;Option pricing formulas&quot;, E.G. Haug, McGraw-Hill 1998 pag. 72</span>
<span class="comment">        */</span>
        <span class="comment">//     barrierType, barrier, rebate,         type, strike,     s,    q,    r,    t,    v,  result, tol</span>
        { Barrier::DownOut,    95.0,    3.0, Option::Call,     90, 100.0, 0.04, 0.08, 0.50, 0.25,  9.0246, 1.0e-4},
        { Barrier::DownOut,    95.0,    3.0, Option::Call,    100, 100.0, 0.04, 0.08, 0.50, 0.25,  6.7924, 1.0e-4},
        { Barrier::DownOut,    95.0,    3.0, Option::Call,    110, 100.0, 0.04, 0.08, 0.50, 0.25,  4.8759, 1.0e-4},
        { Barrier::DownOut,   100.0,    3.0, Option::Call,     90, 100.0, 0.04, 0.08, 0.50, 0.25,  3.0000, 1.0e-4},
        { Barrier::DownOut,   100.0,    3.0, Option::Call,    100, 100.0, 0.04, 0.08, 0.50, 0.25,  3.0000, 1.0e-4},
        { Barrier::DownOut,   100.0,    3.0, Option::Call,    110, 100.0, 0.04, 0.08, 0.50, 0.25,  3.0000, 1.0e-4},
        { Barrier::UpOut,     105.0,    3.0, Option::Call,     90, 100.0, 0.04, 0.08, 0.50, 0.25,  2.6789, 1.0e-4},
        { Barrier::UpOut,     105.0,    3.0, Option::Call,    100, 100.0, 0.04, 0.08, 0.50, 0.25,  2.3580, 1.0e-4},
        { Barrier::UpOut,     105.0,    3.0, Option::Call,    110, 100.0, 0.04, 0.08, 0.50, 0.25,  2.3453, 1.0e-4},

        { Barrier::DownIn,     95.0,    3.0, Option::Call,    90, 100.0, 0.04, 0.08, 0.50, 0.25,  7.7627, 1.0e-4},
        { Barrier::DownIn,     95.0,    3.0, Option::Call,   100, 100.0, 0.04, 0.08, 0.50, 0.25,  4.0109, 1.0e-4},
        { Barrier::DownIn,     95.0,    3.0, Option::Call,   110, 100.0, 0.04, 0.08, 0.50, 0.25,  2.0576, 1.0e-4},
        { Barrier::DownIn,    100.0,    3.0, Option::Call,    90, 100.0, 0.04, 0.08, 0.50, 0.25, 13.8333, 1.0e-4},
        { Barrier::DownIn,    100.0,    3.0, Option::Call,   100, 100.0, 0.04, 0.08, 0.50, 0.25,  7.8494, 1.0e-4},
        { Barrier::DownIn,    100.0,    3.0, Option::Call,   110, 100.0, 0.04, 0.08, 0.50, 0.25,  3.9795, 1.0e-4},
        { Barrier::UpIn,      105.0,    3.0, Option::Call,    90, 100.0, 0.04, 0.08, 0.50, 0.25, 14.1112, 1.0e-4},
        { Barrier::UpIn,      105.0,    3.0, Option::Call,   100, 100.0, 0.04, 0.08, 0.50, 0.25,  8.4482, 1.0e-4},
        { Barrier::UpIn,      105.0,    3.0, Option::Call,   110, 100.0, 0.04, 0.08, 0.50, 0.25,  4.5910, 1.0e-4},

        { Barrier::DownOut,    95.0,    3.0, Option::Call,    90, 100.0, 0.04, 0.08, 0.50, 0.30,  8.8334, 1.0e-4},
        { Barrier::DownOut,    95.0,    3.0, Option::Call,   100, 100.0, 0.04, 0.08, 0.50, 0.30,  7.0285, 1.0e-4},
        { Barrier::DownOut,    95.0,    3.0, Option::Call,   110, 100.0, 0.04, 0.08, 0.50, 0.30,  5.4137, 1.0e-4},
        { Barrier::DownOut,   100.0,    3.0, Option::Call,    90, 100.0, 0.04, 0.08, 0.50, 0.30,  3.0000, 1.0e-4},
        { Barrier::DownOut,   100.0,    3.0, Option::Call,   100, 100.0, 0.04, 0.08, 0.50, 0.30,  3.0000, 1.0e-4},
        { Barrier::DownOut,   100.0,    3.0, Option::Call,   110, 100.0, 0.04, 0.08, 0.50, 0.30,  3.0000, 1.0e-4},
        { Barrier::UpOut,     105.0,    3.0, Option::Call,    90, 100.0, 0.04, 0.08, 0.50, 0.30,  2.6341, 1.0e-4},
        { Barrier::UpOut,     105.0,    3.0, Option::Call,   100, 100.0, 0.04, 0.08, 0.50, 0.30,  2.4389, 1.0e-4},
        { Barrier::UpOut,     105.0,    3.0, Option::Call,   110, 100.0, 0.04, 0.08, 0.50, 0.30,  2.4315, 1.0e-4},

        { Barrier::DownIn,     95.0,    3.0, Option::Call,    90, 100.0, 0.04, 0.08, 0.50, 0.30,  9.0093, 1.0e-4},
        { Barrier::DownIn,     95.0,    3.0, Option::Call,   100, 100.0, 0.04, 0.08, 0.50, 0.30,  5.1370, 1.0e-4},
        { Barrier::DownIn,     95.0,    3.0, Option::Call,   110, 100.0, 0.04, 0.08, 0.50, 0.30,  2.8517, 1.0e-4},
        { Barrier::DownIn,    100.0,    3.0, Option::Call,    90, 100.0, 0.04, 0.08, 0.50, 0.30, 14.8816, 1.0e-4},
        { Barrier::DownIn,    100.0,    3.0, Option::Call,   100, 100.0, 0.04, 0.08, 0.50, 0.30,  9.2045, 1.0e-4},
        { Barrier::DownIn,    100.0,    3.0, Option::Call,   110, 100.0, 0.04, 0.08, 0.50, 0.30,  5.3043, 1.0e-4},
        { Barrier::UpIn,      105.0,    3.0, Option::Call,    90, 100.0, 0.04, 0.08, 0.50, 0.30, 15.2098, 1.0e-4},
        { Barrier::UpIn,      105.0,    3.0, Option::Call,   100, 100.0, 0.04, 0.08, 0.50, 0.30,  9.7278, 1.0e-4},
        { Barrier::UpIn,      105.0,    3.0, Option::Call,   110, 100.0, 0.04, 0.08, 0.50, 0.30,  5.8350, 1.0e-4},



        { Barrier::DownOut,    95.0,    3.0,  Option::Put,    90, 100.0, 0.04, 0.08, 0.50, 0.25,  2.2798, 1.0e-4 },
        { Barrier::DownOut,    95.0,    3.0,  Option::Put,   100, 100.0, 0.04, 0.08, 0.50, 0.25,  2.2947, 1.0e-4 },
        { Barrier::DownOut,    95.0,    3.0,  Option::Put,   110, 100.0, 0.04, 0.08, 0.50, 0.25,  2.6252, 1.0e-4 },
        { Barrier::DownOut,   100.0,    3.0,  Option::Put,    90, 100.0, 0.04, 0.08, 0.50, 0.25,  3.0000, 1.0e-4 },
        { Barrier::DownOut,   100.0,    3.0,  Option::Put,   100, 100.0, 0.04, 0.08, 0.50, 0.25,  3.0000, 1.0e-4 },
        { Barrier::DownOut,   100.0,    3.0,  Option::Put,   110, 100.0, 0.04, 0.08, 0.50, 0.25,  3.0000, 1.0e-4 },
        { Barrier::UpOut,     105.0,    3.0,  Option::Put,    90, 100.0, 0.04, 0.08, 0.50, 0.25,  3.7760, 1.0e-4 },
        { Barrier::UpOut,     105.0,    3.0,  Option::Put,   100, 100.0, 0.04, 0.08, 0.50, 0.25,  5.4932, 1.0e-4 },
        { Barrier::UpOut,     105.0,    3.0,  Option::Put,   110, 100.0, 0.04, 0.08, 0.50, 0.25,  7.5187, 1.0e-4 },

        { Barrier::DownIn,     95.0,    3.0,  Option::Put,    90, 100.0, 0.04, 0.08, 0.50, 0.25,  2.9586, 1.0e-4 },
        { Barrier::DownIn,     95.0,    3.0,  Option::Put,   100, 100.0, 0.04, 0.08, 0.50, 0.25,  6.5677, 1.0e-4 },
        { Barrier::DownIn,     95.0,    3.0,  Option::Put,   110, 100.0, 0.04, 0.08, 0.50, 0.25, 11.9752, 1.0e-4 },
        { Barrier::DownIn,    100.0,    3.0,  Option::Put,    90, 100.0, 0.04, 0.08, 0.50, 0.25,  2.2845, 1.0e-4 },
        { Barrier::DownIn,    100.0,    3.0,  Option::Put,   100, 100.0, 0.04, 0.08, 0.50, 0.25,  5.9085, 1.0e-4 },
        { Barrier::DownIn,    100.0,    3.0,  Option::Put,   110, 100.0, 0.04, 0.08, 0.50, 0.25, 11.6465, 1.0e-4 },
        { Barrier::UpIn,      105.0,    3.0,  Option::Put,    90, 100.0, 0.04, 0.08, 0.50, 0.25,  1.4653, 1.0e-4 },
        { Barrier::UpIn,      105.0,    3.0,  Option::Put,   100, 100.0, 0.04, 0.08, 0.50, 0.25,  3.3721, 1.0e-4 },
        { Barrier::UpIn,      105.0,    3.0,  Option::Put,   110, 100.0, 0.04, 0.08, 0.50, 0.25,  7.0846, 1.0e-4 },

        { Barrier::DownOut,    95.0,    3.0,  Option::Put,    90, 100.0, 0.04, 0.08, 0.50, 0.30,  2.4170, 1.0e-4 },
        { Barrier::DownOut,    95.0,    3.0,  Option::Put,   100, 100.0, 0.04, 0.08, 0.50, 0.30,  2.4258, 1.0e-4 },
        { Barrier::DownOut,    95.0,    3.0,  Option::Put,   110, 100.0, 0.04, 0.08, 0.50, 0.30,  2.6246, 1.0e-4 },
        { Barrier::DownOut,   100.0,    3.0,  Option::Put,    90, 100.0, 0.04, 0.08, 0.50, 0.30,  3.0000, 1.0e-4 },
        { Barrier::DownOut,   100.0,    3.0,  Option::Put,   100, 100.0, 0.04, 0.08, 0.50, 0.30,  3.0000, 1.0e-4 },
        { Barrier::DownOut,   100.0,    3.0,  Option::Put,   110, 100.0, 0.04, 0.08, 0.50, 0.30,  3.0000, 1.0e-4 },
        { Barrier::UpOut,     105.0,    3.0,  Option::Put,    90, 100.0, 0.04, 0.08, 0.50, 0.30,  4.2293, 1.0e-4 },
        { Barrier::UpOut,     105.0,    3.0,  Option::Put,   100, 100.0, 0.04, 0.08, 0.50, 0.30,  5.8032, 1.0e-4 },
        { Barrier::UpOut,     105.0,    3.0,  Option::Put,   110, 100.0, 0.04, 0.08, 0.50, 0.30,  7.5649, 1.0e-4 },

        { Barrier::DownIn,     95.0,    3.0,  Option::Put,    90, 100.0, 0.04, 0.08, 0.50, 0.30,  3.8769, 1.0e-4 },
        { Barrier::DownIn,     95.0,    3.0,  Option::Put,   100, 100.0, 0.04, 0.08, 0.50, 0.30,  7.7989, 1.0e-4 },
        { Barrier::DownIn,     95.0,    3.0,  Option::Put,   110, 100.0, 0.04, 0.08, 0.50, 0.30, 13.3078, 1.0e-4 },
        { Barrier::DownIn,    100.0,    3.0,  Option::Put,    90, 100.0, 0.04, 0.08, 0.50, 0.30,  3.3328, 1.0e-4 },
        { Barrier::DownIn,    100.0,    3.0,  Option::Put,   100, 100.0, 0.04, 0.08, 0.50, 0.30,  7.2636, 1.0e-4 },
        { Barrier::DownIn,    100.0,    3.0,  Option::Put,   110, 100.0, 0.04, 0.08, 0.50, 0.30, 12.9713, 1.0e-4 },
        { Barrier::UpIn,      105.0,    3.0,  Option::Put,    90, 100.0, 0.04, 0.08, 0.50, 0.30,  2.0658, 1.0e-4 },
        { Barrier::UpIn,      105.0,    3.0,  Option::Put,   100, 100.0, 0.04, 0.08, 0.50, 0.30,  4.4226, 1.0e-4 },
        { Barrier::UpIn,      105.0,    3.0,  Option::Put,   110, 100.0, 0.04, 0.08, 0.50, 0.30,  8.3686, 1.0e-4 }

        <span class="comment">/*</span>
<span class="comment">            Data from &quot;Going to Extreme: Correcting Simulation Bias in Exotic</span>
<span class="comment">            Option Valuation&quot;</span>
<span class="comment">            D.R. Beaglehole, P.H. Dybvig and G. Zhou</span>
<span class="comment">            Financial Analysts Journal; Jan / Feb 1997; 53, 1</span>
<span class="comment">        */</span>
        <span class="comment">//    barrierType, barrier, rebate,         type, strike,     s,    q,    r,    t,    v,  result, tol</span>
        <span class="comment">// { Barrier::DownOut,    45.0,    0.0,  Option::Put,     50,  50.0,-0.05, 0.10, 0.25, 0.50,   4.032, 1.0e-3 },</span>
        <span class="comment">// { Barrier::DownOut,    45.0,    0.0,  Option::Put,     50,  50.0,-0.05, 0.10, 1.00, 0.50,   5.477, 1.0e-3 }</span>

    };


    <a class="code" href="class_quant_lib_1_1_day_counter.html" title="day counter class">DayCounter</a> dc = <a class="code" href="class_quant_lib_1_1_actual360.html" title="Actual/360 day count convention.">Actual360</a>();
    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> today = <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#ae1b42c838cf0f4cf17262f0b22bac899">Date::todaysDate</a>();

    boost::shared_ptr&lt;SimpleQuote&gt; spot(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(0.0));
    boost::shared_ptr&lt;SimpleQuote&gt; qRate(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(0.0));
    boost::shared_ptr&lt;YieldTermStructure&gt; qTS = <a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(today, qRate, dc);
    boost::shared_ptr&lt;SimpleQuote&gt; rRate(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(0.0));
    boost::shared_ptr&lt;YieldTermStructure&gt; rTS = <a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(today, rRate, dc);
    boost::shared_ptr&lt;SimpleQuote&gt; vol(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(0.0));
    boost::shared_ptr&lt;BlackVolTermStructure&gt; volTS = <a class="code" href="namespace_quant_lib.html#a589d5c4b0b60b0bdd42ae07d820b2ed3">flatVol</a>(today, vol, dc);

    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(values); i++) {
        <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> exDate = today + <a class="code" href="namespace_quant_lib.html#a8ac1a45a37d8d3dda438a2e59e222620" title="integer number">Integer</a>(values[i].<a class="code" href="namespaceanonymous__namespace_02quantlibbenchmark_8cpp_03.html#a7a969063fde0030bd36b46055e824c34">t</a>*360+0.5);
        boost::shared_ptr&lt;Exercise&gt; exercise(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_european_exercise.html" title="European exercise.">EuropeanExercise</a>(exDate));

        spot -&gt;setValue(values[i].s);
        qRate-&gt;setValue(values[i].q);
        rRate-&gt;setValue(values[i].r);
        vol  -&gt;setValue(values[i].<a class="code" href="namespaceanonymous__namespace_02perturbativebarrieroptionengine_8cpp_03.html#a1c6cf95dc58d77fbce730d3c1f8ccda7">v</a>);

        boost::shared_ptr&lt;StrikedTypePayoff&gt; payoff(<span class="keyword">new</span>
            <a class="code" href="class_quant_lib_1_1_plain_vanilla_payoff.html" title="Plain-vanilla payoff.">PlainVanillaPayoff</a>(values[i].<a class="code" href="class_traits_1_1template_01curve_1_1type.html">type</a>, values[i].strike));

        boost::shared_ptr&lt;BlackScholesMertonProcess&gt; stochProcess(<span class="keyword">new</span>
            <a class="code" href="class_quant_lib_1_1_black_scholes_merton_process.html" title="Merton (1973) extension to the Black-Scholes stochastic process.">BlackScholesMertonProcess</a>(<a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;Quote&gt;</a>(spot),
                                      <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a>(qTS),
                                      <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a>(rTS),
                                      <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;BlackVolTermStructure&gt;</a>(volTS)));

        boost::shared_ptr&lt;PricingEngine&gt; <a class="code" href="class_quant_lib_1_1engine.html">engine</a>(
                                     <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_analytic_barrier_engine.html" title="Pricing engine for barrier options using analytical formulae.">AnalyticBarrierEngine</a>(stochProcess));

        <a class="code" href="class_quant_lib_1_1_barrier_option.html" title="Barrier option on a single asset.">BarrierOption</a> barrierOption(
                values[i].barrierType,
                values[i].barrier,
                values[i].rebate,
                payoff,
                exercise);
        barrierOption.setPricingEngine(<a class="code" href="class_quant_lib_1_1engine.html">engine</a>);

        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> calculated = barrierOption.NPV();
        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> expected = values[i].result;
        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> error = std::fabs(calculated-expected);
        <span class="keywordflow">if</span> (error&gt;values[i].tol) {
            <a class="code" href="test-suite_2barrieroption_8cpp.html#a622c348e4784d8cba117febdf58d4f6a">REPORT_FAILURE</a>(<span class="stringliteral">&quot;value&quot;</span>, values[i].barrierType, values[i].barrier,
                           values[i].rebate, payoff, exercise, values[i].s,
                           values[i].q, values[i].r, today, values[i].v,
                           expected, calculated, error, values[i].tol);
        }

        <a class="code" href="class_quant_lib_1_1engine.html">engine</a> = boost::shared_ptr&lt;PricingEngine&gt;(
                <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_fd_black_scholes_barrier_engine.html" title="Finite-Differences Black Scholes barrier option engine.">FdBlackScholesBarrierEngine</a>(stochProcess, 200, 400));
        barrierOption.setPricingEngine(<a class="code" href="class_quant_lib_1_1engine.html">engine</a>);

        calculated = barrierOption.NPV();
        expected = values[i].result;
        error = std::fabs(calculated-expected);
        <span class="keywordflow">if</span> (error&gt;5.0e-3) {
            <a class="code" href="test-suite_2barrieroption_8cpp.html#a622c348e4784d8cba117febdf58d4f6a">REPORT_FAILURE</a>(<span class="stringliteral">&quot;fd value&quot;</span>, values[i].barrierType, values[i].barrier,
                           values[i].rebate, payoff, exercise, values[i].s,
                           values[i].q, values[i].r, today, values[i].v,
                           expected, calculated, error, values[i].tol);
        }

    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9f004e352fd11be6e5e289f6b452bb9f"></a><!-- doxytag: member="BarrierOptionTest::testLocalVolAndHestonComparison" ref="a9f004e352fd11be6e5e289f6b452bb9f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_barrier_option_test.html#a9f004e352fd11be6e5e289f6b452bb9f">BarrierOptionTest::testLocalVolAndHestonComparison</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2barrieroption_8cpp_source.html#l00568">568</a> of file <a class="el" href="test-suite_2barrieroption_8cpp_source.html">barrieroption.cpp</a>.</p>

<p>References <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00128">anonymous_namespace{marketmodel.cpp}::calendar</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00125">anonymous_namespace{marketmodel.cpp}::dates</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00129">anonymous_namespace{marketmodel.cpp}::dayCounter</a>, <a class="el" href="fdmbackwardsolver_8cpp_source.html#l00040">QuantLib::FdmSchemeDesc::Douglas()</a>, <a class="el" href="barriertype_8hpp_source.html#l00036">QuantLib::Barrier::DownOut</a>, <a class="el" href="settings_8hpp_source.html#l00153">QuantLib::Settings::evaluationDate()</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00058">QuantLib::flatRate()</a>, <a class="el" href="class_quant_lib_1_1_singleton.html#ab79257029fa4841505227497a56cbd93">QuantLib::Singleton&lt; Settings &gt;::instance()</a>, <a class="el" href="date_8hpp_source.html#l00051">QuantLib::July</a>, <a class="el" href="test-suite_2utilities_8hpp_source.html#l00039">LENGTH</a>, <a class="el" href="timeunit_8hpp_source.html#l00039">QuantLib::Months</a>, <a class="el" href="instrument_8hpp_source.html#l00186">QuantLib::Instrument::NPV()</a>, <a class="el" href="option_8hpp_source.html#l00038">QuantLib::Option::Put</a>, <a class="el" href="instrument_8hpp_source.html#l00133">QuantLib::Instrument::setPricingEngine()</a>, <a class="el" href="distributions_8cpp_source.html#l00034">anonymous_namespace{distributions.cpp}::sigma</a>, <a class="el" href="quantlibbenchmark_8cpp_source.html#l00150">anonymous_namespace{quantlibbenchmark.cpp}::t</a>, and <a class="el" href="perturbativebarrieroptionengine_8cpp_source.html#l00433">anonymous_namespace{perturbativebarrieroptionengine.cpp}::v()</a>.</p>

<p>Referenced by <a class="el" href="test-suite_2barrieroption_8cpp_source.html#l00702">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                                        {
    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing local volatility and Heston FD engines &quot;</span>
                  <span class="stringliteral">&quot;for barrier options...&quot;</span>);

    <a class="code" href="class_quant_lib_1_1_saved_settings.html">SavedSettings</a> backup;

    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> settlementDate(5, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a6e2eb13b444eddc908b702f9e3030b15">July</a>, 2002);
    Settings::instance().evaluationDate() = settlementDate;

    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_day_counter.html" title="day counter class">DayCounter</a> <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#abc24484d02b5cded0a275ade16b95733">dayCounter</a> = <a class="code" href="class_quant_lib_1_1_actual365_fixed.html" title="Actual/365 (Fixed) day count convention.">Actual365Fixed</a>();
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_calendar.html" title="calendar class">Calendar</a> <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a86803e870514df19c0cf3863edb2b8f8">calendar</a> = <a class="code" href="class_quant_lib_1_1_t_a_r_g_e_t.html" title="TARGET calendar">TARGET</a>();

    <a class="code" href="namespace_quant_lib.html#a8ac1a45a37d8d3dda438a2e59e222620" title="integer number">Integer</a> <a class="code" href="namespaceanonymous__namespace_02quantlibbenchmark_8cpp_03.html#a7a969063fde0030bd36b46055e824c34">t</a>[] = { 13, 41, 75, 165, 256, 345, 524, 703 };
    <a class="code" href="namespace_quant_lib.html#a919ba3567cc89fca373f8d6b8e80126b" title="interest rates">Rate</a> r[] = { 0.0357,0.0349,0.0341,0.0355,0.0359,0.0368,0.0386,0.0401 };

    std::vector&lt;Rate&gt; rates(1, 0.0357);
    std::vector&lt;Date&gt; <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a800db345cacda47dd48925126ea05f91">dates</a>(1, settlementDate);
    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i = 0; i &lt; 8; ++i) {
        <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a800db345cacda47dd48925126ea05f91">dates</a>.push_back(settlementDate + t[i]);
        rates.push_back(r[i]);
    }
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> rTS(
            boost::shared_ptr&lt;YieldTermStructure&gt;(
                                    <span class="keyword">new</span> <a class="code" href="namespace_quant_lib.html#aba455dd6323746ed70a64eb4fa65c276" title="Term structure based on linear interpolation of zero yields.">ZeroCurve</a>(<a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a800db345cacda47dd48925126ea05f91">dates</a>, rates, dayCounter)));
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> qTS(
                                   <a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(settlementDate, 0.0, dayCounter));

    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;Quote&gt;</a> s0(boost::shared_ptr&lt;Quote&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(4500.00)));
    
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> tmp[] = { 100 ,500 ,2000,3400,3600,3800,4000,4200,4400,4500,
                   4600,4800,5000,5200,5400,5600,7500,10000,20000,30000 };
    <span class="keyword">const</span> std::vector&lt;Real&gt; strikes(tmp, tmp+<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(tmp));
    
    <a class="code" href="namespace_quant_lib.html#ae3abfa256de5aa2b506ab6bda014e4dc" title="volatility">Volatility</a> <a class="code" href="namespaceanonymous__namespace_02perturbativebarrieroptionengine_8cpp_03.html#a1c6cf95dc58d77fbce730d3c1f8ccda7">v</a>[] =
      { 1.015873, 1.015873, 1.015873, 0.89729, 0.796493, 0.730914, 0.631335, 0.568895,
        0.711309, 0.711309, 0.711309, 0.641309, 0.635593, 0.583653, 0.508045, 0.463182,
        0.516034, 0.500534, 0.500534, 0.500534, 0.448706, 0.416661, 0.375470, 0.353442,
        0.516034, 0.482263, 0.447713, 0.387703, 0.355064, 0.337438, 0.316966, 0.306859,
        0.497587, 0.464373, 0.430764, 0.374052, 0.344336, 0.328607, 0.310619, 0.301865,
        0.479511, 0.446815, 0.414194, 0.361010, 0.334204, 0.320301, 0.304664, 0.297180,
        0.461866, 0.429645, 0.398092, 0.348638, 0.324680, 0.312512, 0.299082, 0.292785,
        0.444801, 0.413014, 0.382634, 0.337026, 0.315788, 0.305239, 0.293855, 0.288660,
        0.428604, 0.397219, 0.368109, 0.326282, 0.307555, 0.298483, 0.288972, 0.284791,
        0.420971, 0.389782, 0.361317, 0.321274, 0.303697, 0.295302, 0.286655, 0.282948,
        0.413749, 0.382754, 0.354917, 0.316532, 0.300016, 0.292251, 0.284420, 0.281164,
        0.400889, 0.370272, 0.343525, 0.307904, 0.293204, 0.286549, 0.280189, 0.277767,
        0.390685, 0.360399, 0.334344, 0.300507, 0.287149, 0.281380, 0.276271, 0.274588,
        0.383477, 0.353434, 0.327580, 0.294408, 0.281867, 0.276746, 0.272655, 0.271617,
        0.379106, 0.349214, 0.323160, 0.289618, 0.277362, 0.272641, 0.269332, 0.268846,
        0.377073, 0.347258, 0.320776, 0.286077, 0.273617, 0.269057, 0.266293, 0.266265,
        0.399925, 0.369232, 0.338895, 0.289042, 0.265509, 0.255589, 0.249308, 0.249665,
        0.423432, 0.406891, 0.373720, 0.314667, 0.281009, 0.263281, 0.246451, 0.242166,
        0.453704, 0.453704, 0.453704, 0.381255, 0.334578, 0.305527, 0.268909, 0.251367,
        0.517748, 0.517748, 0.517748, 0.416577, 0.364770, 0.331595, 0.287423, 0.264285 };
    
    <a class="code" href="class_quant_lib_1_1_matrix.html" title="Matrix used in linear algebra.">Matrix</a> blackVolMatrix(strikes.size(), <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a800db345cacda47dd48925126ea05f91">dates</a>.<a class="code" href="class_quant_lib_1_1_schedule.html#a3f9f67b0f8653cb82f87eaeef9bfbbd8">size</a>()-1);
    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i &lt; strikes.size(); ++i)
        <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> j=1; j &lt; <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a800db345cacda47dd48925126ea05f91">dates</a>.<a class="code" href="class_quant_lib_1_1_schedule.html#a3f9f67b0f8653cb82f87eaeef9bfbbd8">size</a>(); ++j) {
            blackVolMatrix[i][j-1] = v[i*(<a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a800db345cacda47dd48925126ea05f91">dates</a>.<a class="code" href="class_quant_lib_1_1_schedule.html#a3f9f67b0f8653cb82f87eaeef9bfbbd8">size</a>()-1)+j-1];
        }
    
    <span class="keyword">const</span> boost::shared_ptr&lt;BlackVarianceSurface&gt; volTS(
        <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_black_variance_surface.html" title="Black volatility surface modelled as variance surface.">BlackVarianceSurface</a>(settlementDate, calendar,
                                 std::vector&lt;Date&gt;(<a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a800db345cacda47dd48925126ea05f91">dates</a>.<a class="code" href="class_quant_lib_1_1_schedule.html#a764a8f6829e22134a469ab033d990e6c">begin</a>()+1,<a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a800db345cacda47dd48925126ea05f91">dates</a>.<a class="code" href="class_quant_lib_1_1_schedule.html#a5e628116c0fa6da871e12a1312ac4f4b">end</a>()),
                                 strikes, blackVolMatrix,
                                 dayCounter));
    volTS-&gt;setInterpolation&lt;<a class="code" href="class_quant_lib_1_1_bicubic.html" title="bicubic-spline-interpolation factory">Bicubic</a>&gt;();
    <span class="keyword">const</span> boost::shared_ptr&lt;GeneralizedBlackScholesProcess&gt; localVolProcess(
        <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_black_scholes_merton_process.html" title="Merton (1973) extension to the Black-Scholes stochastic process.">BlackScholesMertonProcess</a>(s0, qTS, rTS, 
                                      <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;BlackVolTermStructure&gt;</a>(volTS)));
    
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> v0   =0.195662;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> kappa=5.6628;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> theta=0.0745911;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> <a class="code" href="namespaceanonymous__namespace_02distributions_8cpp_03.html#ab5b4e39d0154ccd92bd47cff2ea0f8da">sigma</a>=1.1619;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> rho  =-0.511493;

    boost::shared_ptr&lt;HestonProcess&gt; hestonProcess(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_process.html" title="Square-root stochastic-volatility Heston process.">HestonProcess</a>(
                                  rTS, qTS, s0, v0, kappa, theta, sigma, rho));

    boost::shared_ptr&lt;HestonModel&gt; hestonModel(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_model.html" title="Heston model for the stochastic volatility of an asset.">HestonModel</a>(hestonProcess));

    boost::shared_ptr&lt;PricingEngine&gt; fdHestonEngine(
                         <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_fd_heston_barrier_engine.html" title="Finite-Differences Heston Barrier Option engine.">FdHestonBarrierEngine</a>(hestonModel, 100, 400, 50));
    
    boost::shared_ptr&lt;PricingEngine&gt; fdLocalVolEngine(
                   <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_fd_black_scholes_barrier_engine.html" title="Finite-Differences Black Scholes barrier option engine.">FdBlackScholesBarrierEngine</a>(localVolProcess, 100, 400, 0,
                                                   FdmSchemeDesc::Douglas(), 
                                                   <span class="keyword">true</span>, 0.35));
    
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> strike  = s0-&gt;value();
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> barrier = 3000;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> rebate  = 100;
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> exDate  = settlementDate + <a class="code" href="class_quant_lib_1_1_period.html">Period</a>(20, <a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3a3d158b618e2bf6e66da9aca81f706dae">Months</a>);
    
    <span class="keyword">const</span> boost::shared_ptr&lt;StrikedTypePayoff&gt; payoff(<span class="keyword">new</span>
                                     <a class="code" href="class_quant_lib_1_1_plain_vanilla_payoff.html" title="Plain-vanilla payoff.">PlainVanillaPayoff</a>(Option::Put, strike));

    <span class="keyword">const</span> boost::shared_ptr&lt;Exercise&gt; exercise(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_european_exercise.html" title="European exercise.">EuropeanExercise</a>(exDate));

    <a class="code" href="class_quant_lib_1_1_barrier_option.html" title="Barrier option on a single asset.">BarrierOption</a> barrierOption(Barrier::DownOut, 
                                barrier, rebate, payoff, exercise);
    
    barrierOption.setPricingEngine(fdHestonEngine);
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> expectedHestonNPV = 111.5;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> calculatedHestonNPV = barrierOption.NPV();

    barrierOption.setPricingEngine(fdLocalVolEngine);
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> expectedLocalVolNPV = 132.8;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> calculatedLocalVolNPV = barrierOption.NPV();
    
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> tol = 0.01;
    
    <span class="keywordflow">if</span> (std::fabs(expectedHestonNPV - calculatedHestonNPV) 
                                                &gt; tol*expectedHestonNPV) {
        BOOST_FAIL(<span class="stringliteral">&quot;Failed to reproduce Heston barrier price for &quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;\n    strike:     &quot;</span> &lt;&lt; payoff-&gt;strike()
                   &lt;&lt; <span class="stringliteral">&quot;\n    barrier:    &quot;</span> &lt;&lt; barrier
                   &lt;&lt; <span class="stringliteral">&quot;\n    maturity:   &quot;</span> &lt;&lt; exDate
                   &lt;&lt; <span class="stringliteral">&quot;\n    calculated: &quot;</span> &lt;&lt; calculatedHestonNPV
                   &lt;&lt; <span class="stringliteral">&quot;\n    expected:   &quot;</span> &lt;&lt; expectedHestonNPV);
    }
    <span class="keywordflow">if</span> (std::fabs(expectedLocalVolNPV - calculatedLocalVolNPV) 
                                                &gt; tol*expectedLocalVolNPV) {
        BOOST_FAIL(<span class="stringliteral">&quot;Failed to reproduce Heston barrier price for &quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;\n    strike:     &quot;</span> &lt;&lt; payoff-&gt;strike()
                   &lt;&lt; <span class="stringliteral">&quot;\n    barrier:    &quot;</span> &lt;&lt; barrier
                   &lt;&lt; <span class="stringliteral">&quot;\n    maturity:   &quot;</span> &lt;&lt; exDate
                   &lt;&lt; <span class="stringliteral">&quot;\n    calculated: &quot;</span> &lt;&lt; calculatedHestonNPV
                   &lt;&lt; <span class="stringliteral">&quot;\n    expected:   &quot;</span> &lt;&lt; expectedHestonNPV);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9d851e6ca8b667ddcecdcec4ac5c855a"></a><!-- doxytag: member="BarrierOptionTest::testPerturbative" ref="a9d851e6ca8b667ddcecdcec4ac5c855a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_barrier_option_test.html#a9d851e6ca8b667ddcecdcec4ac5c855a">BarrierOptionTest::testPerturbative</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2barrieroption_8cpp_source.html#l00483">483</a> of file <a class="el" href="test-suite_2barrieroption_8cpp_source.html">barrieroption.cpp</a>.</p>

<p>References <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00125">anonymous_namespace{marketmodel.cpp}::dates</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00058">QuantLib::flatRate()</a>, <a class="el" href="instrument_8hpp_source.html#l00186">QuantLib::Instrument::NPV()</a>, <a class="el" href="option_8hpp_source.html#l00038">QuantLib::Option::Put</a>, <a class="el" href="instrument_8hpp_source.html#l00133">QuantLib::Instrument::setPricingEngine()</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00124">anonymous_namespace{marketmodel.cpp}::todaysDate</a>, <a class="el" href="test-suite_2gaussianquadratures_8cpp_source.html#l00032">anonymous_namespace{gaussianquadratures.cpp}::tolerance</a>, and <a class="el" href="barriertype_8hpp_source.html#l00036">QuantLib::Barrier::UpOut</a>.</p>

<p>Referenced by <a class="el" href="test-suite_2barrieroption_8cpp_source.html#l00702">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                         {
    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing perturbative engine for barrier options...&quot;</span>);

    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> <a class="code" href="class_s.html">S</a> = 100.0;
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> rebate = 0.0;
    <a class="code" href="namespace_quant_lib.html#a919ba3567cc89fca373f8d6b8e80126b" title="interest rates">Rate</a> r = 0.03;
    <a class="code" href="namespace_quant_lib.html#a919ba3567cc89fca373f8d6b8e80126b" title="interest rates">Rate</a> q = 0.02;

    <a class="code" href="class_quant_lib_1_1_day_counter.html" title="day counter class">DayCounter</a> dc = <a class="code" href="class_quant_lib_1_1_actual360.html" title="Actual/360 day count convention.">Actual360</a>();
    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> today = <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#ae1b42c838cf0f4cf17262f0b22bac899">Date::todaysDate</a>();

    boost::shared_ptr&lt;SimpleQuote&gt; underlying(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(S));
    boost::shared_ptr&lt;YieldTermStructure&gt; qTS = <a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(today, q, dc);
    boost::shared_ptr&lt;YieldTermStructure&gt; rTS = <a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(today, r, dc);

    std::vector&lt;Date&gt; <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a800db345cacda47dd48925126ea05f91">dates</a>(2);
    std::vector&lt;Volatility&gt; vols(2);

    <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a800db345cacda47dd48925126ea05f91">dates</a>[0] = today + 90;  vols[0] = 0.105;
    <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a800db345cacda47dd48925126ea05f91">dates</a>[1] = today + 180; vols[1] = 0.11;

    boost::shared_ptr&lt;BlackVolTermStructure&gt; volTS(
                              <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_black_variance_curve.html" title="Black volatility curve modelled as variance curve.">BlackVarianceCurve</a>(today, <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a800db345cacda47dd48925126ea05f91">dates</a>, vols, dc));

    boost::shared_ptr&lt;BlackScholesMertonProcess&gt; stochProcess(
        <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_black_scholes_merton_process.html" title="Merton (1973) extension to the Black-Scholes stochastic process.">BlackScholesMertonProcess</a>(<a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;Quote&gt;</a>(underlying),
                                      <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a>(qTS),
                                      <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a>(rTS),
                                      <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;BlackVolTermStructure&gt;</a>(volTS)));

    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> strike = 101.0;
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> barrier = 101.0;
    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> exDate = today+180;

    boost::shared_ptr&lt;Exercise&gt; exercise(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_european_exercise.html" title="European exercise.">EuropeanExercise</a>(exDate));
    boost::shared_ptr&lt;StrikedTypePayoff&gt; payoff(
                                 <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_plain_vanilla_payoff.html" title="Plain-vanilla payoff.">PlainVanillaPayoff</a>(Option::Put, strike));

    <a class="code" href="class_quant_lib_1_1_barrier_option.html" title="Barrier option on a single asset.">BarrierOption</a> option(Barrier::UpOut, barrier, rebate, payoff, exercise);

    <a class="code" href="namespace_quant_lib.html#a9adc2615d630d6006896b3402b09b03b" title="positive integer">Natural</a> order = 0;
    <span class="keywordtype">bool</span> zeroGamma = <span class="keyword">false</span>;
    boost::shared_ptr&lt;PricingEngine&gt; <a class="code" href="class_quant_lib_1_1engine.html">engine</a>(
         <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_perturbative_barrier_option_engine.html" title="perturbative barrier-option engine">PerturbativeBarrierOptionEngine</a>(stochProcess, order, zeroGamma));

    option.setPricingEngine(<a class="code" href="class_quant_lib_1_1engine.html">engine</a>);

    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> calculated = option.NPV();
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> expected = 0.897365;
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> <a class="code" href="namespaceanonymous__namespace_02gaussianquadratures_8cpp_03.html#a0f4d3028fdc8cebd7d9c568c16754cab">tolerance</a> = 1.0e-6;
    <span class="keywordflow">if</span> (std::fabs(calculated-expected) &gt; tolerance) {
        BOOST_ERROR(<span class="stringliteral">&quot;Failed to reproduce expected value&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;\n  calculated: &quot;</span> &lt;&lt; std::setprecision(5) &lt;&lt; calculated
                    &lt;&lt; <span class="stringliteral">&quot;\n  expected:   &quot;</span> &lt;&lt; std::setprecision(5) &lt;&lt; expected);
    }

    order = 1;
    <a class="code" href="class_quant_lib_1_1engine.html">engine</a> = boost::shared_ptr&lt;PricingEngine&gt;(
         <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_perturbative_barrier_option_engine.html" title="perturbative barrier-option engine">PerturbativeBarrierOptionEngine</a>(stochProcess, order, zeroGamma));

    option.setPricingEngine(<a class="code" href="class_quant_lib_1_1engine.html">engine</a>);

    calculated = option.NPV();
    expected = 0.894374;
    <span class="keywordflow">if</span> (std::fabs(calculated-expected) &gt; tolerance) {
        BOOST_ERROR(<span class="stringliteral">&quot;Failed to reproduce expected value&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;\n  calculated: &quot;</span> &lt;&lt; std::setprecision(5) &lt;&lt; calculated
                    &lt;&lt; <span class="stringliteral">&quot;\n  expected:   &quot;</span> &lt;&lt; std::setprecision(5) &lt;&lt; expected);
    }

    order = 2;
    <a class="code" href="class_quant_lib_1_1engine.html">engine</a> = boost::shared_ptr&lt;PricingEngine&gt;(
         <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_perturbative_barrier_option_engine.html" title="perturbative barrier-option engine">PerturbativeBarrierOptionEngine</a>(stochProcess, order, zeroGamma));

    option.setPricingEngine(<a class="code" href="class_quant_lib_1_1engine.html">engine</a>);

    calculated = option.NPV();
    expected = 0.894375;
    <span class="keywordflow">if</span> (std::fabs(calculated-expected) &gt; tolerance) {
        BOOST_ERROR(<span class="stringliteral">&quot;Failed to reproduce expected value&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;\n  calculated: &quot;</span> &lt;&lt; std::setprecision(5) &lt;&lt; calculated
                    &lt;&lt; <span class="stringliteral">&quot;\n  expected:   &quot;</span> &lt;&lt; std::setprecision(5) &lt;&lt; expected);
    }
}
</pre></div>
</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/home/deriversatile/QuantLib/QuantLibQt/test-suite/<a class="el" href="test-suite_2barrieroption_8hpp_source.html">barrieroption.hpp</a></li>
<li>/home/deriversatile/QuantLib/QuantLibQt/test-suite/<a class="el" href="test-suite_2barrieroption_8cpp_source.html">barrieroption.cpp</a></li>
</ul>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="class_barrier_option_test.html">BarrierOptionTest</a>      </li>

    <li class="footer">Generated on Sat Aug 25 2012 13:51:00 for QuantLib by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
