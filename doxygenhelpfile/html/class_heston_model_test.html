<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>QuantLib: HestonModelTest Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">QuantLib
   &#160;<span id="projectnumber">1.3</span>
   </div>
   <div id="projectbrief">ql1-3</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="dynsections.js"></script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('class_heston_model_test.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-static-methods">Static Public Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">HestonModelTest Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="HestonModelTest" -->
<p><code>#include &lt;<a class="el" href="test-suite_2hestonmodel_8hpp_source.html">hestonmodel.hpp</a>&gt;</code></p>

<p><a href="class_heston_model_test-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_heston_model_test.html#a27380e52abafd6136eee9ee650837270">testBlackCalibration</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_heston_model_test.html#a296d82e6a33d88133ae7ae0c549479f5">testDAXCalibration</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_heston_model_test.html#a56d0cc091c48414dfbf04e2464a2d264">testAnalyticVsBlack</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_heston_model_test.html#ae0f287f1e4578c8b819a0a6aa9462b14">testAnalyticVsCached</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_heston_model_test.html#ae37f08065f361d93a81d465878153245">testKahlJaeckelCase</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_heston_model_test.html#ade7ff0b8e84afe3ecafae9ce7aa75088">testMcVsCached</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_heston_model_test.html#ab75c691bed4106487b7873083251d8be">testFdBarrierVsCached</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_heston_model_test.html#a22b450728cf64c8e0fc33c2a4af6330b">testFdVanillaVsCached</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_heston_model_test.html#a8b51b8317a48980f0e71a3dda7b7ecd5">testDifferentIntegrals</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_heston_model_test.html#a22a2460b5b6f478e65121a59a9199adf">testMultipleStrikesEngine</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_heston_model_test.html#a2c7b33abb3eaf0c40bf2b2240239f78f">testAnalyticPiecewiseTimeDependent</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_heston_model_test.html#acc0d2b472dbb490c6472600dfa75e6b0">testDAXCalibrationOfTimeDependentModel</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_heston_model_test.html#ac55a62d30072322cc7d92c94764c26e8">testAlanLewisReferencePrices</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <br class="typebreak"/>
boost::unit_test_framework::test_suite *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_heston_model_test.html#a4bedeea751274cd9d2e669b54a54faac">suite</a> ()</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="test-suite_2hestonmodel_8hpp_source.html#l00028">28</a> of file <a class="el" href="test-suite_2hestonmodel_8hpp_source.html">hestonmodel.hpp</a>.</p>
</div><hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a4bedeea751274cd9d2e669b54a54faac"></a><!-- doxytag: member="HestonModelTest::suite" ref="a4bedeea751274cd9d2e669b54a54faac" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">test_suite * <a class="el" href="class_heston_model_test.html#a4bedeea751274cd9d2e669b54a54faac">HestonModelTest::suite</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l01213">1213</a> of file <a class="el" href="test-suite_2hestonmodel_8cpp_source.html">hestonmodel.cpp</a>.</p>

<p>References <a class="el" href="test-suite_2utilities_8hpp_source.html#l00061">QUANTLIB_TEST_CASE</a>, <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l01121">testAlanLewisReferencePrices()</a>, <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l00997">testAnalyticPiecewiseTimeDependent()</a>, <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l00288">testAnalyticVsBlack()</a>, <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l00356">testAnalyticVsCached()</a>, <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l00138">testBlackCalibration()</a>, <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l00236">testDAXCalibration()</a>, <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l01060">testDAXCalibrationOfTimeDependentModel()</a>, <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l00792">testDifferentIntegrals()</a>, <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l00507">testFdBarrierVsCached()</a>, <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l00560">testFdVanillaVsCached()</a>, <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l00682">testKahlJaeckelCase()</a>, <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l00452">testMcVsCached()</a>, and <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l00917">testMultipleStrikesEngine()</a>.</p>

<p>Referenced by <a class="el" href="quantlibtestsuite_8cpp_source.html#l00206">init_unit_test_suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                   {
    test_suite* <a class="code" href="class_heston_model_test.html#a4bedeea751274cd9d2e669b54a54faac">suite</a> = BOOST_TEST_SUITE(<span class="stringliteral">&quot;Heston model tests&quot;</span>);

    <span class="comment">// FLOATING_POINT_EXCEPTION</span>
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(&amp;<a class="code" href="class_heston_model_test.html#a27380e52abafd6136eee9ee650837270">HestonModelTest::testBlackCalibration</a>));
    <span class="comment">// FLOATING_POINT_EXCEPTION</span>
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(&amp;<a class="code" href="class_heston_model_test.html#a296d82e6a33d88133ae7ae0c549479f5">HestonModelTest::testDAXCalibration</a>));
    <span class="comment">// FLOATING_POINT_EXCEPTION</span>
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(&amp;<a class="code" href="class_heston_model_test.html#a56d0cc091c48414dfbf04e2464a2d264">HestonModelTest::testAnalyticVsBlack</a>));
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(&amp;<a class="code" href="class_heston_model_test.html#ae0f287f1e4578c8b819a0a6aa9462b14">HestonModelTest::testAnalyticVsCached</a>));
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(&amp;<a class="code" href="class_heston_model_test.html#ae37f08065f361d93a81d465878153245">HestonModelTest::testKahlJaeckelCase</a>));
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(&amp;<a class="code" href="class_heston_model_test.html#a8b51b8317a48980f0e71a3dda7b7ecd5">HestonModelTest::testDifferentIntegrals</a>));
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(&amp;<a class="code" href="class_heston_model_test.html#ab75c691bed4106487b7873083251d8be">HestonModelTest::testFdBarrierVsCached</a>));
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(&amp;<a class="code" href="class_heston_model_test.html#a22b450728cf64c8e0fc33c2a4af6330b">HestonModelTest::testFdVanillaVsCached</a>));
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(&amp;<a class="code" href="class_heston_model_test.html#a22a2460b5b6f478e65121a59a9199adf">HestonModelTest::testMultipleStrikesEngine</a>));
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(&amp;<a class="code" href="class_heston_model_test.html#ade7ff0b8e84afe3ecafae9ce7aa75088">HestonModelTest::testMcVsCached</a>));
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(
                    &amp;<a class="code" href="class_heston_model_test.html#a2c7b33abb3eaf0c40bf2b2240239f78f">HestonModelTest::testAnalyticPiecewiseTimeDependent</a>));
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(
                    &amp;<a class="code" href="class_heston_model_test.html#acc0d2b472dbb490c6472600dfa75e6b0">HestonModelTest::testDAXCalibrationOfTimeDependentModel</a>));
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(
                    &amp;<a class="code" href="class_heston_model_test.html#ac55a62d30072322cc7d92c94764c26e8">HestonModelTest::testAlanLewisReferencePrices</a>));

    <span class="keywordflow">return</span> <a class="code" href="class_heston_model_test.html#a4bedeea751274cd9d2e669b54a54faac">suite</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac55a62d30072322cc7d92c94764c26e8"></a><!-- doxytag: member="HestonModelTest::testAlanLewisReferencePrices" ref="ac55a62d30072322cc7d92c94764c26e8" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_heston_model_test.html#ac55a62d30072322cc7d92c94764c26e8">HestonModelTest::testAlanLewisReferencePrices</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l01121">1121</a> of file <a class="el" href="test-suite_2hestonmodel_8cpp_source.html">hestonmodel.cpp</a>.</p>

<p>References <a class="el" href="option_8hpp_source.html#l00039">QuantLib::Option::Call</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00129">anonymous_namespace{marketmodel.cpp}::dayCounter</a>, <a class="el" href="settings_8hpp_source.html#l00153">QuantLib::Settings::evaluationDate()</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00058">QuantLib::flatRate()</a>, <a class="el" href="class_quant_lib_1_1_singleton.html#ab79257029fa4841505227497a56cbd93">QuantLib::Singleton&lt; Settings &gt;::instance()</a>, <a class="el" href="date_8hpp_source.html#l00051">QuantLib::July</a>, <a class="el" href="test-suite_2utilities_8hpp_source.html#l00039">LENGTH</a>, <a class="el" href="instrument_8hpp_source.html#l00186">QuantLib::Instrument::NPV()</a>, <a class="el" href="option_8hpp_source.html#l00038">QuantLib::Option::Put</a>, <a class="el" href="qldefines_8hpp_source.html#l00135">QL_EPSILON</a>, <a class="el" href="instrument_8hpp_source.html#l00133">QuantLib::Instrument::setPricingEngine()</a>, and <a class="el" href="distributions_8cpp_source.html#l00034">anonymous_namespace{distributions.cpp}::sigma</a>.</p>

<p>Referenced by <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l01213">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                                   {
    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing Alan Lewis Reference Prices ...&quot;</span>);

    <span class="comment">/*</span>
<span class="comment">     * testing Alan Lewis reference prices posted in</span>
<span class="comment">     * http://wilmott.com/messageview.cfm?catid=34&amp;threadid=90957</span>
<span class="comment">     */</span>

    <a class="code" href="class_quant_lib_1_1_saved_settings.html">SavedSettings</a> backup;

    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> settlementDate(5, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a6e2eb13b444eddc908b702f9e3030b15">July</a>, 2002);
    Settings::instance().evaluationDate() = settlementDate;

    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> maturityDate(5, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a6e2eb13b444eddc908b702f9e3030b15">July</a>, 2003);
    <span class="keyword">const</span> boost::shared_ptr&lt;Exercise&gt; exercise(
        <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_european_exercise.html" title="European exercise.">EuropeanExercise</a>(maturityDate));

    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_day_counter.html" title="day counter class">DayCounter</a> <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#abc24484d02b5cded0a275ade16b95733">dayCounter</a> = <a class="code" href="class_quant_lib_1_1_actual365_fixed.html" title="Actual/365 (Fixed) day count convention.">Actual365Fixed</a>();
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> riskFreeTS(<a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(0.01, dayCounter));
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> dividendTS(<a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(0.02, dayCounter));

    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;Quote&gt;</a> s0(boost::shared_ptr&lt;Quote&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(100.0)));

    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> v0    =  0.04;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> rho   = -0.5;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> <a class="code" href="namespaceanonymous__namespace_02distributions_8cpp_03.html#ab5b4e39d0154ccd92bd47cff2ea0f8da">sigma</a> =  1.0;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> kappa =  4.0;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> theta =  0.25;

    <span class="keyword">const</span> boost::shared_ptr&lt;HestonProcess&gt; process(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_process.html" title="Square-root stochastic-volatility Heston process.">HestonProcess</a>(
        riskFreeTS, dividendTS, s0, v0, kappa, theta, sigma, rho));
    <span class="keyword">const</span> boost::shared_ptr&lt;HestonModel&gt; model(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_model.html" title="Heston model for the stochastic volatility of an asset.">HestonModel</a>(process));

    <span class="keyword">const</span> boost::shared_ptr&lt;PricingEngine&gt; laguerreEngine(
        <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_analytic_heston_engine.html" title="analytic Heston-model engine based on Fourier transform">AnalyticHestonEngine</a>(model, 192u));

    <span class="keyword">const</span> boost::shared_ptr&lt;PricingEngine&gt; gaussLobattoEngine(
        <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_analytic_heston_engine.html" title="analytic Heston-model engine based on Fourier transform">AnalyticHestonEngine</a>(model, <a class="code" href="group__limit_macros.html#ga4f2e6bcf6b19224bce1a5a6234286c17">QL_EPSILON</a>, 100000u));

    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> strikes[] = { 80, 90, 100, 110, 120 };
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_option.html#abaee7fc605354c444867545492cd5845">Option::Type</a> types[] = { Option::Put, Option::Call };
    <span class="keyword">const</span> boost::shared_ptr&lt;PricingEngine&gt; engines[]
        = { laguerreEngine, gaussLobattoEngine };

    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> expectedResults[][2] = {
        { 7.958878113256768285213263077598987193482161301733,
          26.774758743998854221382195325726949201687074848341 },
        { 12.017966707346304987709573290236471654992071308187,
          20.933349000596710388139445766564068085476194042256 },
        { 17.055270961270109413522653999411000974895436309183,
          16.070154917028834278213466703938231827658768230714 },
        { 23.017825898442800538908781834822560777763225722188,
          12.132211516709844867860534767549426052805766831181 },
        { 29.811026202682471843340682293165857439167301370697,
          9.024913483457835636553375454092357136489051667150  }
    };

    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> tol = 1e-12; <span class="comment">// 3e-15 works on linux/ia32,</span>
                            <span class="comment">// but keep some buffer for other platforms</span>

    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i &lt; <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(strikes); ++i) {
        <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> strike = strikes[i];

        <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> j=0; j &lt; <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(types); ++j) {
            <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_option.html#abaee7fc605354c444867545492cd5845">Option::Type</a> <a class="code" href="class_traits_1_1template_01curve_1_1type.html">type</a> = types[j];

            <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> k=0; k &lt; <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(engines); ++k) {
                <span class="keyword">const</span> boost::shared_ptr&lt;PricingEngine&gt; <a class="code" href="class_quant_lib_1_1engine.html">engine</a> = engines[k];

                <span class="keyword">const</span> boost::shared_ptr&lt;StrikedTypePayoff&gt; payoff(
                    <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_plain_vanilla_payoff.html" title="Plain-vanilla payoff.">PlainVanillaPayoff</a>(type, strike));

                <a class="code" href="class_quant_lib_1_1_vanilla_option.html" title="Vanilla option (no discrete dividends, no barriers) on a single asset.">VanillaOption</a> option(payoff, exercise);
                option.setPricingEngine(engine);

                <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> expected = expectedResults[i][j];
                <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> calculated = option.NPV();
                <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> relError = std::fabs(calculated-expected)/expected;

                <span class="keywordflow">if</span> (relError &gt; tol) {
                    BOOST_FAIL(
                           <span class="stringliteral">&quot;failed to reproduce Alan Lewis Reference prices &quot;</span>
                        &lt;&lt; <span class="stringliteral">&quot;\n    strike     : &quot;</span> &lt;&lt; strike
                        &lt;&lt; <span class="stringliteral">&quot;\n    option type: &quot;</span> &lt;&lt; type
                        &lt;&lt; <span class="stringliteral">&quot;\n    engine type: &quot;</span> &lt;&lt; k
                        &lt;&lt; <span class="stringliteral">&quot;\n    rel. error : &quot;</span> &lt;&lt; relError);
                }
            }
        }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a2c7b33abb3eaf0c40bf2b2240239f78f"></a><!-- doxytag: member="HestonModelTest::testAnalyticPiecewiseTimeDependent" ref="a2c7b33abb3eaf0c40bf2b2240239f78f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_heston_model_test.html#a2c7b33abb3eaf0c40bf2b2240239f78f">HestonModelTest::testAnalyticPiecewiseTimeDependent</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l00997">997</a> of file <a class="el" href="test-suite_2hestonmodel_8cpp_source.html">hestonmodel.cpp</a>.</p>

<p>References <a class="el" href="option_8hpp_source.html#l00039">QuantLib::Option::Call</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00125">anonymous_namespace{marketmodel.cpp}::dates</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00129">anonymous_namespace{marketmodel.cpp}::dayCounter</a>, <a class="el" href="date_8hpp_source.html#l00056">QuantLib::December</a>, <a class="el" href="settings_8hpp_source.html#l00153">QuantLib::Settings::evaluationDate()</a>, <a class="el" href="class_quant_lib_1_1_singleton.html#ab79257029fa4841505227497a56cbd93">QuantLib::Singleton&lt; Settings &gt;::instance()</a>, <a class="el" href="date_8hpp_source.html#l00045">QuantLib::January</a>, <a class="el" href="date_8hpp_source.html#l00047">QuantLib::March</a>, <a class="el" href="instrument_8hpp_source.html#l00186">QuantLib::Instrument::NPV()</a>, <a class="el" href="instrument_8hpp_source.html#l00133">QuantLib::Instrument::setPricingEngine()</a>, and <a class="el" href="distributions_8cpp_source.html#l00034">anonymous_namespace{distributions.cpp}::sigma</a>.</p>

<p>Referenced by <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l01213">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                                         {
    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing analytic piecewise time dependent Heston prices...&quot;</span>);

    <a class="code" href="class_quant_lib_1_1_saved_settings.html">SavedSettings</a> backup;

    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> settlementDate(27, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4ad4988bf6760edb92c088bb47d4b61dc5">December</a>, 2004);
    Settings::instance().evaluationDate() = settlementDate;
    <a class="code" href="class_quant_lib_1_1_day_counter.html" title="day counter class">DayCounter</a> <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#abc24484d02b5cded0a275ade16b95733">dayCounter</a> = <a class="code" href="class_quant_lib_1_1_actual_actual.html" title="Actual/Actual day count.">ActualActual</a>();
    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> exerciseDate(28, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a982c9e93cf4b41f4b71b5c256df6191c">March</a>, 2005);

    boost::shared_ptr&lt;StrikedTypePayoff&gt; payoff(
                                  <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_plain_vanilla_payoff.html" title="Plain-vanilla payoff.">PlainVanillaPayoff</a>(Option::Call, 1.0));
    boost::shared_ptr&lt;Exercise&gt; exercise(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_european_exercise.html" title="European exercise.">EuropeanExercise</a>(exerciseDate));

    std::vector&lt;Date&gt; <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a800db345cacda47dd48925126ea05f91">dates</a>; 
    dates.push_back(settlementDate); dates.push_back(<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(01, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a2c2c73e76831dec3bfead45af4e7e293">January</a>, 2007));
    std::vector&lt;Rate&gt; irates;
    irates.push_back(0.0); irates.push_back(0.2);
    <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> riskFreeTS(
            boost::shared_ptr&lt;YieldTermStructure&gt;(
                                    <span class="keyword">new</span> <a class="code" href="namespace_quant_lib.html#aba455dd6323746ed70a64eb4fa65c276" title="Term structure based on linear interpolation of zero yields.">ZeroCurve</a>(dates, irates, dayCounter)));

    std::vector&lt;Rate&gt; qrates;
    qrates.push_back(0.0); qrates.push_back(0.3);
    <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> dividendTS(
            boost::shared_ptr&lt;YieldTermStructure&gt;(
                                    <span class="keyword">new</span> <a class="code" href="namespace_quant_lib.html#aba455dd6323746ed70a64eb4fa65c276" title="Term structure based on linear interpolation of zero yields.">ZeroCurve</a>(dates, qrates, dayCounter)));
    

    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> v0 = 0.1;
    <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;Quote&gt;</a> s0(boost::shared_ptr&lt;Quote&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(1.0)));

    <a class="code" href="class_quant_lib_1_1_constant_parameter.html" title="Standard constant parameter .">ConstantParameter</a> theta(0.09, <a class="code" href="class_quant_lib_1_1_positive_constraint.html" title="Constraint imposing positivity to all arguments">PositiveConstraint</a>());
    <a class="code" href="class_quant_lib_1_1_constant_parameter.html" title="Standard constant parameter .">ConstantParameter</a> kappa(3.16, <a class="code" href="class_quant_lib_1_1_positive_constraint.html" title="Constraint imposing positivity to all arguments">PositiveConstraint</a>());
    <a class="code" href="class_quant_lib_1_1_constant_parameter.html" title="Standard constant parameter .">ConstantParameter</a> <a class="code" href="namespaceanonymous__namespace_02distributions_8cpp_03.html#ab5b4e39d0154ccd92bd47cff2ea0f8da">sigma</a>(4.40, <a class="code" href="class_quant_lib_1_1_positive_constraint.html" title="Constraint imposing positivity to all arguments">PositiveConstraint</a>());
    <a class="code" href="class_quant_lib_1_1_constant_parameter.html" title="Standard constant parameter .">ConstantParameter</a> rho  (-0.8, <a class="code" href="class_quant_lib_1_1_boundary_constraint.html" title="Constraint imposing all arguments to be in [low,high]">BoundaryConstraint</a>(-1.0, 1.0));

    boost::shared_ptr&lt;PiecewiseTimeDependentHestonModel&gt; model(
        <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_piecewise_time_dependent_heston_model.html" title="Piecewise time dependent Heston model.">PiecewiseTimeDependentHestonModel</a>(riskFreeTS, dividendTS,
                                              s0, v0, theta, kappa, 
                                              <a class="code" href="namespaceanonymous__namespace_02distributions_8cpp_03.html#ab5b4e39d0154ccd92bd47cff2ea0f8da">sigma</a>, rho, <a class="code" href="class_quant_lib_1_1_time_grid.html" title="time grid class">TimeGrid</a>(20.0, 2)));
    
    <a class="code" href="class_quant_lib_1_1_vanilla_option.html" title="Vanilla option (no discrete dividends, no barriers) on a single asset.">VanillaOption</a> option(payoff, exercise);
    option.setPricingEngine(boost::shared_ptr&lt;PricingEngine&gt;(
                                           <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_analytic_p_t_d_heston_engine.html" title="analytic piecewise constant time dependent Heston-model engine">AnalyticPTDHestonEngine</a>(model)));

    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> calculated = option.NPV();
    boost::shared_ptr&lt;HestonProcess&gt; hestonProcess(
        <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_process.html" title="Square-root stochastic-volatility Heston process.">HestonProcess</a>(riskFreeTS, dividendTS, s0, v0,
                          kappa(0.0), theta(0.0), <a class="code" href="namespaceanonymous__namespace_02distributions_8cpp_03.html#ab5b4e39d0154ccd92bd47cff2ea0f8da">sigma</a>(0.0), rho(0.0)));
    boost::shared_ptr&lt;HestonModel&gt; hestonModel(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_model.html" title="Heston model for the stochastic volatility of an asset.">HestonModel</a>(hestonProcess));
    option.setPricingEngine(boost::shared_ptr&lt;PricingEngine&gt;(
                                    <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_analytic_heston_engine.html" title="analytic Heston-model engine based on Fourier transform">AnalyticHestonEngine</a>(hestonModel)));
    
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> expected = option.NPV();
    
    <span class="keywordflow">if</span> (std::fabs(calculated-expected) &gt; 1e-12) {
        BOOST_FAIL(<span class="stringliteral">&quot;failed to reproduce heston prices &quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;\n    calculated: &quot;</span> &lt;&lt; calculated
                   &lt;&lt; <span class="stringliteral">&quot;\n    expected:   &quot;</span> &lt;&lt; expected);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a56d0cc091c48414dfbf04e2464a2d264"></a><!-- doxytag: member="HestonModelTest::testAnalyticVsBlack" ref="a56d0cc091c48414dfbf04e2464a2d264" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_heston_model_test.html#a56d0cc091c48414dfbf04e2464a2d264">HestonModelTest::testAnalyticVsBlack</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l00288">288</a> of file <a class="el" href="test-suite_2hestonmodel_8cpp_source.html">hestonmodel.cpp</a>.</p>

<p>References <a class="el" href="blackformula_8cpp_source.html#l00045">QuantLib::blackFormula()</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00129">anonymous_namespace{marketmodel.cpp}::dayCounter</a>, <a class="el" href="settings_8hpp_source.html#l00153">QuantLib::Settings::evaluationDate()</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00058">QuantLib::flatRate()</a>, <a class="el" href="class_quant_lib_1_1_singleton.html#ab79257029fa4841505227497a56cbd93">QuantLib::Singleton&lt; Settings &gt;::instance()</a>, <a class="el" href="timeunit_8hpp_source.html#l00039">QuantLib::Months</a>, <a class="el" href="instrument_8hpp_source.html#l00186">QuantLib::Instrument::NPV()</a>, <a class="el" href="option_8hpp_source.html#l00038">QuantLib::Option::Put</a>, <a class="el" href="test-suite_2utilities_8hpp_source.html#l00048">QL_SCIENTIFIC</a>, <a class="el" href="instrument_8hpp_source.html#l00133">QuantLib::Instrument::setPricingEngine()</a>, <a class="el" href="distributions_8cpp_source.html#l00034">anonymous_namespace{distributions.cpp}::sigma</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00124">anonymous_namespace{marketmodel.cpp}::todaysDate</a>, <a class="el" href="test-suite_2gaussianquadratures_8cpp_source.html#l00032">anonymous_namespace{gaussianquadratures.cpp}::tolerance</a>, and <a class="el" href="daycounter_8hpp_source.html#l00126">QuantLib::DayCounter::yearFraction()</a>.</p>

<p>Referenced by <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l01213">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                          {
    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing analytic Heston engine against Black formula...&quot;</span>);

    <a class="code" href="class_quant_lib_1_1_saved_settings.html">SavedSettings</a> backup;

    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> settlementDate = <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#ae1b42c838cf0f4cf17262f0b22bac899">Date::todaysDate</a>();
    Settings::instance().evaluationDate() = settlementDate;
    <a class="code" href="class_quant_lib_1_1_day_counter.html" title="day counter class">DayCounter</a> <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#abc24484d02b5cded0a275ade16b95733">dayCounter</a> = <a class="code" href="class_quant_lib_1_1_actual_actual.html" title="Actual/Actual day count.">ActualActual</a>();
    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> exerciseDate = settlementDate + 6*<a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3a3d158b618e2bf6e66da9aca81f706dae">Months</a>;

    boost::shared_ptr&lt;StrikedTypePayoff&gt; payoff(
                                     <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_plain_vanilla_payoff.html" title="Plain-vanilla payoff.">PlainVanillaPayoff</a>(Option::Put, 30));
    boost::shared_ptr&lt;Exercise&gt; exercise(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_european_exercise.html" title="European exercise.">EuropeanExercise</a>(exerciseDate));

    <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> riskFreeTS(<a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(0.1, dayCounter));
    <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> dividendTS(<a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(0.04, dayCounter));

    <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;Quote&gt;</a> s0(boost::shared_ptr&lt;Quote&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(32.0)));

    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> v0=0.05;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> kappa=5.0;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> theta=0.05;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> <a class="code" href="namespaceanonymous__namespace_02distributions_8cpp_03.html#ab5b4e39d0154ccd92bd47cff2ea0f8da">sigma</a>=1.0e-4;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> rho=0.0;

    boost::shared_ptr&lt;HestonProcess&gt; process(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_process.html" title="Square-root stochastic-volatility Heston process.">HestonProcess</a>(
                   riskFreeTS, dividendTS, s0, v0, kappa, theta, sigma, rho));

    <a class="code" href="class_quant_lib_1_1_vanilla_option.html" title="Vanilla option (no discrete dividends, no barriers) on a single asset.">VanillaOption</a> option(payoff, exercise);
    <span class="comment">// FLOATING_POINT_EXCEPTION</span>
    boost::shared_ptr&lt;PricingEngine&gt; <a class="code" href="class_quant_lib_1_1engine.html">engine</a>(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_analytic_heston_engine.html" title="analytic Heston-model engine based on Fourier transform">AnalyticHestonEngine</a>(
              boost::shared_ptr&lt;HestonModel&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_model.html" title="Heston model for the stochastic volatility of an asset.">HestonModel</a>(process)), 144));

    option.setPricingEngine(<a class="code" href="class_quant_lib_1_1engine.html">engine</a>);
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> calculated = option.NPV();

    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> yearFraction = dayCounter.<a class="code" href="class_quant_lib_1_1_day_counter.html#aba442c829252ee786e1b4ea3d0f04bd9" title="Returns the period between two dates as a fraction of year.">yearFraction</a>(settlementDate, exerciseDate);
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> forwardPrice = 32*std::exp((0.1-0.04)*yearFraction);
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> expected = <a class="code" href="namespace_quant_lib.html#a3389f4064f58cfc2d4a160d84e992c4f">blackFormula</a>(payoff-&gt;optionType(), payoff-&gt;strike(),
        forwardPrice, std::sqrt(0.05*yearFraction)) *
                                            std::exp(-0.1*yearFraction);
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> error = std::fabs(calculated - expected);
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> <a class="code" href="namespaceanonymous__namespace_02gaussianquadratures_8cpp_03.html#a0f4d3028fdc8cebd7d9c568c16754cab">tolerance</a> = 2.0e-7;
    <span class="keywordflow">if</span> (error &gt; tolerance) {
        BOOST_FAIL(<span class="stringliteral">&quot;failed to reproduce Black price with AnalyticHestonEngine&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;\n    calculated: &quot;</span> &lt;&lt; calculated
                   &lt;&lt; <span class="stringliteral">&quot;\n    expected:   &quot;</span> &lt;&lt; expected
                   &lt;&lt; <span class="stringliteral">&quot;\n    error:      &quot;</span> &lt;&lt; <a class="code" href="test-suite_2utilities_8hpp.html#a8aef6dd018d8f7ff76fa37cde97e5067">QL_SCIENTIFIC</a> &lt;&lt; error);
    }

    <a class="code" href="class_quant_lib_1_1engine.html">engine</a> = boost::shared_ptr&lt;PricingEngine&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_fd_heston_vanilla_engine.html" title="Finite-Differences Heston Vanilla Option engine.">FdHestonVanillaEngine</a>(
              boost::shared_ptr&lt;HestonModel&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_model.html" title="Heston model for the stochastic volatility of an asset.">HestonModel</a>(process)),
              200,200,100));
    option.setPricingEngine(<a class="code" href="class_quant_lib_1_1engine.html">engine</a>);

    calculated = option.NPV();
    error = std::fabs(calculated - expected);
    tolerance = 1.0e-3;
    <span class="keywordflow">if</span> (error &gt; tolerance) {
        BOOST_FAIL(<span class="stringliteral">&quot;failed to reproduce Black price with FdHestonVanillaEngine&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;\n    calculated: &quot;</span> &lt;&lt; calculated
                   &lt;&lt; <span class="stringliteral">&quot;\n    expected:   &quot;</span> &lt;&lt; expected
                   &lt;&lt; <span class="stringliteral">&quot;\n    error:      &quot;</span> &lt;&lt; <a class="code" href="test-suite_2utilities_8hpp.html#a8aef6dd018d8f7ff76fa37cde97e5067">QL_SCIENTIFIC</a> &lt;&lt; error);
    }

}
</pre></div>
</div>
</div>
<a class="anchor" id="ae0f287f1e4578c8b819a0a6aa9462b14"></a><!-- doxytag: member="HestonModelTest::testAnalyticVsCached" ref="ae0f287f1e4578c8b819a0a6aa9462b14" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_heston_model_test.html#ae0f287f1e4578c8b819a0a6aa9462b14">HestonModelTest::testAnalyticVsCached</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l00356">356</a> of file <a class="el" href="test-suite_2hestonmodel_8cpp_source.html">hestonmodel.cpp</a>.</p>

<p>References <a class="el" href="option_8hpp_source.html#l00039">QuantLib::Option::Call</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00129">anonymous_namespace{marketmodel.cpp}::dayCounter</a>, <a class="el" href="date_8hpp_source.html#l00056">QuantLib::December</a>, <a class="el" href="settings_8hpp_source.html#l00153">QuantLib::Settings::evaluationDate()</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00058">QuantLib::flatRate()</a>, <a class="el" href="class_quant_lib_1_1_singleton.html#ab79257029fa4841505227497a56cbd93">QuantLib::Singleton&lt; Settings &gt;::instance()</a>, <a class="el" href="date_8hpp_source.html#l00047">QuantLib::March</a>, <a class="el" href="instrument_8hpp_source.html#l00186">QuantLib::Instrument::NPV()</a>, <a class="el" href="date_8hpp_source.html#l00053">QuantLib::September</a>, <a class="el" href="instrument_8hpp_source.html#l00133">QuantLib::Instrument::setPricingEngine()</a>, <a class="el" href="distributions_8cpp_source.html#l00034">anonymous_namespace{distributions.cpp}::sigma</a>, <a class="el" href="test-suite_2gaussianquadratures_8cpp_source.html#l00032">anonymous_namespace{gaussianquadratures.cpp}::tolerance</a>, and <a class="el" href="daycounter_8hpp_source.html#l00126">QuantLib::DayCounter::yearFraction()</a>.</p>

<p>Referenced by <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l01213">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                           {
    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing analytic Heston engine against cached values...&quot;</span>);

    <a class="code" href="class_quant_lib_1_1_saved_settings.html">SavedSettings</a> backup;

    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> settlementDate(27, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4ad4988bf6760edb92c088bb47d4b61dc5">December</a>, 2004);
    Settings::instance().evaluationDate() = settlementDate;
    <a class="code" href="class_quant_lib_1_1_day_counter.html" title="day counter class">DayCounter</a> <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#abc24484d02b5cded0a275ade16b95733">dayCounter</a> = <a class="code" href="class_quant_lib_1_1_actual_actual.html" title="Actual/Actual day count.">ActualActual</a>();
    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> exerciseDate(28, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a982c9e93cf4b41f4b71b5c256df6191c">March</a>, 2005);

    boost::shared_ptr&lt;StrikedTypePayoff&gt; payoff(
                                  <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_plain_vanilla_payoff.html" title="Plain-vanilla payoff.">PlainVanillaPayoff</a>(Option::Call, 1.05));
    boost::shared_ptr&lt;Exercise&gt; exercise(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_european_exercise.html" title="European exercise.">EuropeanExercise</a>(exerciseDate));

    <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> riskFreeTS(<a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(0.0225, dayCounter));
    <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> dividendTS(<a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(0.02, dayCounter));

    <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;Quote&gt;</a> s0(boost::shared_ptr&lt;Quote&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(1.0)));
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> v0 = 0.1;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> kappa = 3.16;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> theta = 0.09;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> <a class="code" href="namespaceanonymous__namespace_02distributions_8cpp_03.html#ab5b4e39d0154ccd92bd47cff2ea0f8da">sigma</a> = 0.4;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> rho = -0.2;

    boost::shared_ptr&lt;HestonProcess&gt; process(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_process.html" title="Square-root stochastic-volatility Heston process.">HestonProcess</a>(
                   riskFreeTS, dividendTS, s0, v0, kappa, theta, sigma, rho));

    <a class="code" href="class_quant_lib_1_1_vanilla_option.html" title="Vanilla option (no discrete dividends, no barriers) on a single asset.">VanillaOption</a> option(payoff, exercise);

    boost::shared_ptr&lt;AnalyticHestonEngine&gt; <a class="code" href="class_quant_lib_1_1engine.html">engine</a>(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_analytic_heston_engine.html" title="analytic Heston-model engine based on Fourier transform">AnalyticHestonEngine</a>(
               boost::shared_ptr&lt;HestonModel&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_model.html" title="Heston model for the stochastic volatility of an asset.">HestonModel</a>(process)), 64));

    option.setPricingEngine(<a class="code" href="class_quant_lib_1_1engine.html">engine</a>);

    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> expected1 = 0.0404774515;
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> calculated1 = option.NPV();
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> <a class="code" href="namespaceanonymous__namespace_02gaussianquadratures_8cpp_03.html#a0f4d3028fdc8cebd7d9c568c16754cab">tolerance</a> = 1.0e-8;

    <span class="keywordflow">if</span> (std::fabs(calculated1 - expected1) &gt; tolerance) {
        BOOST_ERROR(<span class="stringliteral">&quot;Failed to reproduce cached analytic price&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;\n    calculated: &quot;</span> &lt;&lt; calculated1
                    &lt;&lt; <span class="stringliteral">&quot;\n    expected:   &quot;</span> &lt;&lt; expected1);
    }


    <span class="comment">// reference values from www.wilmott.com, technical forum</span>
    <span class="comment">// search for &quot;Heston or VG price check&quot;</span>

    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> K[] = {0.9,1.0,1.1};
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> expected2[] = { 0.1330371,0.0641016, 0.0270645 };
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> calculated2[6];

    <a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i;
    <span class="keywordflow">for</span> (i = 0; i &lt; 6; ++i) {
        <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> exerciseDate(8+i/3, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4ad4e26bc88f6e25cf9e31ba9400771d49">September</a>, 2005);

        boost::shared_ptr&lt;StrikedTypePayoff&gt; payoff(
                                <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_plain_vanilla_payoff.html" title="Plain-vanilla payoff.">PlainVanillaPayoff</a>(Option::Call, K[i%3]));
        boost::shared_ptr&lt;Exercise&gt; exercise(
                                          <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_european_exercise.html" title="European exercise.">EuropeanExercise</a>(exerciseDate));

        <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> riskFreeTS(<a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(0.05, dayCounter));
        <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> dividendTS(<a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(0.02, dayCounter));

        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> s = riskFreeTS-&gt;discount(0.7)/dividendTS-&gt;discount(0.7);
        <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;Quote&gt;</a> s0(boost::shared_ptr&lt;Quote&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(s)));

        boost::shared_ptr&lt;HestonProcess&gt; process(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_process.html" title="Square-root stochastic-volatility Heston process.">HestonProcess</a>(
                   riskFreeTS, dividendTS, s0, 0.09, 1.2, 0.08, 1.8, -0.45));

        <a class="code" href="class_quant_lib_1_1_vanilla_option.html" title="Vanilla option (no discrete dividends, no barriers) on a single asset.">VanillaOption</a> option(payoff, exercise);

        boost::shared_ptr&lt;PricingEngine&gt; <a class="code" href="class_quant_lib_1_1engine.html">engine</a>(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_analytic_heston_engine.html" title="analytic Heston-model engine based on Fourier transform">AnalyticHestonEngine</a>(
                   boost::shared_ptr&lt;HestonModel&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_model.html" title="Heston model for the stochastic volatility of an asset.">HestonModel</a>(process))));

        option.setPricingEngine(<a class="code" href="class_quant_lib_1_1engine.html">engine</a>);
        calculated2[i] = option.NPV();
    }

    <span class="comment">// we are after the value for T=0.7</span>
    <a class="code" href="class_time.html">Time</a> t1 = dayCounter.<a class="code" href="class_quant_lib_1_1_day_counter.html#aba442c829252ee786e1b4ea3d0f04bd9" title="Returns the period between two dates as a fraction of year.">yearFraction</a>(settlementDate, <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(8, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4ad4e26bc88f6e25cf9e31ba9400771d49">September</a>,2005));
    <a class="code" href="class_time.html">Time</a> t2 = dayCounter.<a class="code" href="class_quant_lib_1_1_day_counter.html#aba442c829252ee786e1b4ea3d0f04bd9" title="Returns the period between two dates as a fraction of year.">yearFraction</a>(settlementDate, <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(9, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4ad4e26bc88f6e25cf9e31ba9400771d49">September</a>,2005));

    <span class="keywordflow">for</span> (i = 0; i &lt; 3; ++i) {
        <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> interpolated =
            calculated2[i]+(calculated2[i+3]-calculated2[i])/(t2-t1)*(0.7-t1);

        <span class="keywordflow">if</span> (std::fabs(interpolated - expected2[i]) &gt; 100*<a class="code" href="namespaceanonymous__namespace_02gaussianquadratures_8cpp_03.html#a0f4d3028fdc8cebd7d9c568c16754cab">tolerance</a>) {
            BOOST_ERROR(<span class="stringliteral">&quot;Failed to reproduce cached analytic prices:&quot;</span>
                        &lt;&lt; <span class="stringliteral">&quot;\n    calculated: &quot;</span> &lt;&lt; interpolated
                        &lt;&lt; <span class="stringliteral">&quot;\n    expected:   &quot;</span> &lt;&lt; expected2[i] );
        }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a27380e52abafd6136eee9ee650837270"></a><!-- doxytag: member="HestonModelTest::testBlackCalibration" ref="a27380e52abafd6136eee9ee650837270" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_heston_model_test.html#a27380e52abafd6136eee9ee650837270">HestonModelTest::testBlackCalibration</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l00138">138</a> of file <a class="el" href="test-suite_2hestonmodel_8cpp_source.html">hestonmodel.cpp</a>.</p>

<p>References <a class="el" href="calendar_8cpp_source.html#l00073">QuantLib::Calendar::advance()</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00128">anonymous_namespace{marketmodel.cpp}::calendar</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00129">anonymous_namespace{marketmodel.cpp}::dayCounter</a>, <a class="el" href="settings_8hpp_source.html#l00153">QuantLib::Settings::evaluationDate()</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00058">QuantLib::flatRate()</a>, <a class="el" href="class_quant_lib_1_1_singleton.html#ab79257029fa4841505227497a56cbd93">QuantLib::Singleton&lt; Settings &gt;::instance()</a>, <a class="el" href="timeunit_8hpp_source.html#l00039">QuantLib::Months</a>, <a class="el" href="distributions_8cpp_source.html#l00034">anonymous_namespace{distributions.cpp}::sigma</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00124">anonymous_namespace{marketmodel.cpp}::todaysDate</a>, <a class="el" href="test-suite_2gaussianquadratures_8cpp_source.html#l00032">anonymous_namespace{gaussianquadratures.cpp}::tolerance</a>, <a class="el" href="dataformatters_8hpp_source.html#l00133">QuantLib::io::volatility()</a>, <a class="el" href="daycounter_8hpp_source.html#l00126">QuantLib::DayCounter::yearFraction()</a>, and <a class="el" href="timeunit_8hpp_source.html#l00040">QuantLib::Years</a>.</p>

<p>Referenced by <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l01213">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                           {
    BOOST_MESSAGE(
       <span class="stringliteral">&quot;Testing Heston model calibration using a flat volatility surface...&quot;</span>);

    <a class="code" href="class_quant_lib_1_1_saved_settings.html">SavedSettings</a> backup;

    <span class="comment">/* calibrate a Heston model to a constant volatility surface without</span>
<span class="comment">       smile. expected result is a vanishing volatility of the volatility.</span>
<span class="comment">       In addition theta and v0 should be equal to the constant variance */</span>

    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> today = <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#ae1b42c838cf0f4cf17262f0b22bac899">Date::todaysDate</a>();
    Settings::instance().evaluationDate() = today;

    <a class="code" href="class_quant_lib_1_1_day_counter.html" title="day counter class">DayCounter</a> <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#abc24484d02b5cded0a275ade16b95733">dayCounter</a> = <a class="code" href="class_quant_lib_1_1_actual360.html" title="Actual/360 day count convention.">Actual360</a>();
    <a class="code" href="class_quant_lib_1_1_calendar.html" title="calendar class">Calendar</a> <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a86803e870514df19c0cf3863edb2b8f8">calendar</a> = <a class="code" href="class_quant_lib_1_1_null_calendar.html" title="Calendar for reproducing theoretical calculations.">NullCalendar</a>();

    <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> riskFreeTS(<a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(0.04, dayCounter));
    <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> dividendTS(<a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(0.50, dayCounter));

    std::vector&lt;Period&gt; optionMaturities;
    optionMaturities.push_back(<a class="code" href="class_quant_lib_1_1_period.html">Period</a>(1, <a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3a3d158b618e2bf6e66da9aca81f706dae">Months</a>));
    optionMaturities.push_back(<a class="code" href="class_quant_lib_1_1_period.html">Period</a>(2, <a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3a3d158b618e2bf6e66da9aca81f706dae">Months</a>));
    optionMaturities.push_back(<a class="code" href="class_quant_lib_1_1_period.html">Period</a>(3, <a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3a3d158b618e2bf6e66da9aca81f706dae">Months</a>));
    optionMaturities.push_back(<a class="code" href="class_quant_lib_1_1_period.html">Period</a>(6, <a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3a3d158b618e2bf6e66da9aca81f706dae">Months</a>));
    optionMaturities.push_back(<a class="code" href="class_quant_lib_1_1_period.html">Period</a>(9, <a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3a3d158b618e2bf6e66da9aca81f706dae">Months</a>));
    optionMaturities.push_back(<a class="code" href="class_quant_lib_1_1_period.html">Period</a>(1, <a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3ae2d856134531729a1696e66bebeafb32">Years</a>));
    optionMaturities.push_back(<a class="code" href="class_quant_lib_1_1_period.html">Period</a>(2, <a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3ae2d856134531729a1696e66bebeafb32">Years</a>));

    std::vector&lt;boost::shared_ptr&lt;CalibrationHelper&gt; &gt; options;
    <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;Quote&gt;</a> s0(boost::shared_ptr&lt;Quote&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(1.0)));
    <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;Quote&gt;</a> vol(boost::shared_ptr&lt;Quote&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(0.1)));
    <a class="code" href="namespace_quant_lib.html#ae3abfa256de5aa2b506ab6bda014e4dc" title="volatility">Volatility</a> <a class="code" href="group__manips.html#ga9890b88f8d11494a518492be973b9046" title="output volatilities as percentages">volatility</a> = vol-&gt;<a class="code" href="struct_quant_lib_1_1detail_1_1percent__holder.html#ac530959c772318b6a65285038849263a">value</a>();

    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i = 0; i &lt; optionMaturities.size(); ++i) {
        <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> moneyness = -1.0; moneyness &lt; 2.0; moneyness += 1.0) {
            <span class="comment">// FLOATING_POINT_EXCEPTION</span>
            <span class="keyword">const</span> <a class="code" href="class_time.html">Time</a> tau = dayCounter.<a class="code" href="class_quant_lib_1_1_day_counter.html#aba442c829252ee786e1b4ea3d0f04bd9" title="Returns the period between two dates as a fraction of year.">yearFraction</a>(
                                 riskFreeTS-&gt;referenceDate(),
                                 calendar.<a class="code" href="class_quant_lib_1_1_calendar.html#a1b8d9da28e4f012b89b00bf0ef388cc9">advance</a>(riskFreeTS-&gt;referenceDate(),
                                                  optionMaturities[i]));
        <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> fwdPrice = s0-&gt;value()*dividendTS-&gt;discount(tau)
                            / riskFreeTS-&gt;discount(tau);
        <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> strikePrice = fwdPrice * std::exp(-moneyness * volatility
                                                     * std::sqrt(tau));

        options.push_back(boost::shared_ptr&lt;CalibrationHelper&gt;(
                          <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_model_helper.html" title="calibration helper for Heston model">HestonModelHelper</a>(optionMaturities[i], calendar,
                                                s0-&gt;value(), strikePrice, vol,
                                                riskFreeTS, dividendTS)));
        }
    }

    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> <a class="code" href="namespaceanonymous__namespace_02distributions_8cpp_03.html#ab5b4e39d0154ccd92bd47cff2ea0f8da">sigma</a> = 0.1; <a class="code" href="namespaceanonymous__namespace_02distributions_8cpp_03.html#ab5b4e39d0154ccd92bd47cff2ea0f8da">sigma</a> &lt; 0.7; <a class="code" href="namespaceanonymous__namespace_02distributions_8cpp_03.html#ab5b4e39d0154ccd92bd47cff2ea0f8da">sigma</a> += 0.2) {
        <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> v0=0.01;
        <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> kappa=0.2;
        <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> theta=0.02;
        <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> rho=-0.75;

        boost::shared_ptr&lt;HestonProcess&gt; process(
            <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_process.html" title="Square-root stochastic-volatility Heston process.">HestonProcess</a>(riskFreeTS, dividendTS,
                              s0, v0, kappa, theta, <a class="code" href="namespaceanonymous__namespace_02distributions_8cpp_03.html#ab5b4e39d0154ccd92bd47cff2ea0f8da">sigma</a>, rho));

        boost::shared_ptr&lt;HestonModel&gt; model(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_model.html" title="Heston model for the stochastic volatility of an asset.">HestonModel</a>(process));
        boost::shared_ptr&lt;PricingEngine&gt; <a class="code" href="class_quant_lib_1_1engine.html">engine</a>(
                                         <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_analytic_heston_engine.html" title="analytic Heston-model engine based on Fourier transform">AnalyticHestonEngine</a>(model, 96));

        <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i = 0; i &lt; options.size(); ++i)
            options[i]-&gt;setPricingEngine(<a class="code" href="class_quant_lib_1_1engine.html">engine</a>);

        <a class="code" href="class_quant_lib_1_1_levenberg_marquardt.html" title="Levenberg-Marquardt optimization method.">LevenbergMarquardt</a> om(1e-8, 1e-8, 1e-8);
        model-&gt;calibrate(options, om, <a class="code" href="class_quant_lib_1_1_end_criteria.html" title="Criteria to end optimization process:">EndCriteria</a>(400, 40, 1.0e-8,
                                                  1.0e-8, 1.0e-8));

        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> <a class="code" href="namespaceanonymous__namespace_02gaussianquadratures_8cpp_03.html#a0f4d3028fdc8cebd7d9c568c16754cab">tolerance</a> = 3.0e-3;

        <span class="keywordflow">if</span> (model-&gt;sigma() &gt; <a class="code" href="namespaceanonymous__namespace_02gaussianquadratures_8cpp_03.html#a0f4d3028fdc8cebd7d9c568c16754cab">tolerance</a>) {
            BOOST_ERROR(<span class="stringliteral">&quot;Failed to reproduce expected sigma&quot;</span>
                        &lt;&lt; <span class="stringliteral">&quot;\n    calculated: &quot;</span> &lt;&lt; model-&gt;sigma()
                        &lt;&lt; <span class="stringliteral">&quot;\n    expected:   &quot;</span> &lt;&lt; 0.0
                        &lt;&lt; <span class="stringliteral">&quot;\n    tolerance:  &quot;</span> &lt;&lt; <a class="code" href="namespaceanonymous__namespace_02gaussianquadratures_8cpp_03.html#a0f4d3028fdc8cebd7d9c568c16754cab">tolerance</a>);
        }

        <span class="keywordflow">if</span> (std::fabs(model-&gt;kappa()
                  *(model-&gt;theta()-volatility*<a class="code" href="group__manips.html#ga9890b88f8d11494a518492be973b9046" title="output volatilities as percentages">volatility</a>)) &gt; <a class="code" href="namespaceanonymous__namespace_02gaussianquadratures_8cpp_03.html#a0f4d3028fdc8cebd7d9c568c16754cab">tolerance</a>) {
            BOOST_ERROR(<span class="stringliteral">&quot;Failed to reproduce expected theta&quot;</span>
                        &lt;&lt; <span class="stringliteral">&quot;\n    calculated: &quot;</span> &lt;&lt; model-&gt;theta()
                        &lt;&lt; <span class="stringliteral">&quot;\n    expected:   &quot;</span> &lt;&lt; volatility*<a class="code" href="group__manips.html#ga9890b88f8d11494a518492be973b9046" title="output volatilities as percentages">volatility</a>);
        }

        <span class="keywordflow">if</span> (std::fabs(model-&gt;v0()-volatility*<a class="code" href="group__manips.html#ga9890b88f8d11494a518492be973b9046" title="output volatilities as percentages">volatility</a>) &gt; tolerance) {
            BOOST_ERROR(<span class="stringliteral">&quot;Failed to reproduce expected v0&quot;</span>
                        &lt;&lt; <span class="stringliteral">&quot;\n    calculated: &quot;</span> &lt;&lt; model-&gt;v0()
                        &lt;&lt; <span class="stringliteral">&quot;\n    expected:   &quot;</span> &lt;&lt; volatility*<a class="code" href="group__manips.html#ga9890b88f8d11494a518492be973b9046" title="output volatilities as percentages">volatility</a>);
        }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a296d82e6a33d88133ae7ae0c549479f5"></a><!-- doxytag: member="HestonModelTest::testDAXCalibration" ref="a296d82e6a33d88133ae7ae0c549479f5" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_heston_model_test.html#a296d82e6a33d88133ae7ae0c549479f5">HestonModelTest::testDAXCalibration</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l00236">236</a> of file <a class="el" href="test-suite_2hestonmodel_8cpp_source.html">hestonmodel.cpp</a>.</p>

<p>References <a class="el" href="settings_8hpp_source.html#l00153">QuantLib::Settings::evaluationDate()</a>, <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l00062">anonymous_namespace{hestonmodel.cpp}::getDAXCalibrationMarketData()</a>, <a class="el" href="class_quant_lib_1_1_singleton.html#ab79257029fa4841505227497a56cbd93">QuantLib::Singleton&lt; Settings &gt;::instance()</a>, <a class="el" href="date_8hpp_source.html#l00051">QuantLib::July</a>, and <a class="el" href="distributions_8cpp_source.html#l00034">anonymous_namespace{distributions.cpp}::sigma</a>.</p>

<p>Referenced by <a class="el" href="quantlibbenchmark_8cpp_source.html#l00222">init_unit_test_suite()</a>, and <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l01213">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                         {

    BOOST_MESSAGE(
             <span class="stringliteral">&quot;Testing Heston model calibration using DAX volatility data...&quot;</span>);

    <a class="code" href="class_quant_lib_1_1_saved_settings.html">SavedSettings</a> backup;

    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> settlementDate(5, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a6e2eb13b444eddc908b702f9e3030b15">July</a>, 2002);
    Settings::instance().evaluationDate() = settlementDate;

    CalibrationMarketData marketData = <a class="code" href="namespaceanonymous__namespace_02hestonmodel_8cpp_03.html#a2796fb73922d0236026c39dfafff2da2">getDAXCalibrationMarketData</a>();
    
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> riskFreeTS = marketData.riskFreeTS;
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> dividendTS = marketData.dividendYield;
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;Quote&gt;</a> s0 = marketData.s0;

    <span class="keyword">const</span> std::vector&lt;boost::shared_ptr&lt;CalibrationHelper&gt; &gt; options
                                                    = marketData.options;

    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> v0=0.1;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> kappa=1.0;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> theta=0.1;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> <a class="code" href="namespaceanonymous__namespace_02distributions_8cpp_03.html#ab5b4e39d0154ccd92bd47cff2ea0f8da">sigma</a>=0.5;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> rho=-0.5;

    boost::shared_ptr&lt;HestonProcess&gt; process(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_process.html" title="Square-root stochastic-volatility Heston process.">HestonProcess</a>(
              riskFreeTS, dividendTS, s0, v0, kappa, theta, sigma, rho));

    boost::shared_ptr&lt;HestonModel&gt; model(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_model.html" title="Heston model for the stochastic volatility of an asset.">HestonModel</a>(process));

    boost::shared_ptr&lt;PricingEngine&gt; <a class="code" href="class_quant_lib_1_1engine.html">engine</a>(
                                         <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_analytic_heston_engine.html" title="analytic Heston-model engine based on Fourier transform">AnalyticHestonEngine</a>(model, 64));

    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i = 0; i &lt; options.size(); ++i)
        options[i]-&gt;setPricingEngine(<a class="code" href="class_quant_lib_1_1engine.html">engine</a>);

    <a class="code" href="class_quant_lib_1_1_levenberg_marquardt.html" title="Levenberg-Marquardt optimization method.">LevenbergMarquardt</a> om(1e-8, 1e-8, 1e-8);
    model-&gt;calibrate(options, om, <a class="code" href="class_quant_lib_1_1_end_criteria.html" title="Criteria to end optimization process:">EndCriteria</a>(400, 40, 1.0e-8, 1.0e-8, 1.0e-8));

    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> sse = 0;
    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i = 0; i &lt; 13*8; ++i) {
        <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> diff = options[i]-&gt;calibrationError()*100.0;
        sse += diff*diff;
    }
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> expected = 177.2; <span class="comment">//see article by A. Sepp.</span>
    <span class="keywordflow">if</span> (std::fabs(sse - expected) &gt; 1.0) {
        BOOST_FAIL(<span class="stringliteral">&quot;Failed to reproduce calibration error&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;\n    calculated: &quot;</span> &lt;&lt; sse
                   &lt;&lt; <span class="stringliteral">&quot;\n    expected:   &quot;</span> &lt;&lt; expected);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="acc0d2b472dbb490c6472600dfa75e6b0"></a><!-- doxytag: member="HestonModelTest::testDAXCalibrationOfTimeDependentModel" ref="acc0d2b472dbb490c6472600dfa75e6b0" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_heston_model_test.html#acc0d2b472dbb490c6472600dfa75e6b0">HestonModelTest::testDAXCalibrationOfTimeDependentModel</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l01060">1060</a> of file <a class="el" href="test-suite_2hestonmodel_8cpp_source.html">hestonmodel.cpp</a>.</p>

<p>References <a class="el" href="settings_8hpp_source.html#l00153">QuantLib::Settings::evaluationDate()</a>, <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l00062">anonymous_namespace{hestonmodel.cpp}::getDAXCalibrationMarketData()</a>, <a class="el" href="class_quant_lib_1_1_singleton.html#ab79257029fa4841505227497a56cbd93">QuantLib::Singleton&lt; Settings &gt;::instance()</a>, <a class="el" href="date_8hpp_source.html#l00051">QuantLib::July</a>, <a class="el" href="parameter_8hpp_source.html#l00050">QuantLib::Parameter::setParam()</a>, and <a class="el" href="distributions_8cpp_source.html#l00034">anonymous_namespace{distributions.cpp}::sigma</a>.</p>

<p>Referenced by <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l01213">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                                             {
    BOOST_MESSAGE(
             <span class="stringliteral">&quot;Testing Time dependent Heston model calibration ...&quot;</span>);

    <a class="code" href="class_quant_lib_1_1_saved_settings.html">SavedSettings</a> backup;

    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> settlementDate(5, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a6e2eb13b444eddc908b702f9e3030b15">July</a>, 2002);
    Settings::instance().evaluationDate() = settlementDate;

    CalibrationMarketData marketData = <a class="code" href="namespaceanonymous__namespace_02hestonmodel_8cpp_03.html#a2796fb73922d0236026c39dfafff2da2">getDAXCalibrationMarketData</a>();
    
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> riskFreeTS = marketData.riskFreeTS;
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> dividendTS = marketData.dividendYield;
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;Quote&gt;</a> s0 = marketData.s0;

    <span class="keyword">const</span> std::vector&lt;boost::shared_ptr&lt;CalibrationHelper&gt; &gt; options
                                                    = marketData.options;

    std::vector&lt;Time&gt; modelTimes;
    modelTimes.push_back(0.25);
    modelTimes.push_back(10.0);
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_time_grid.html" title="time grid class">TimeGrid</a> modelGrid(modelTimes.begin(), modelTimes.end());

    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> v0=0.1;
    <a class="code" href="class_quant_lib_1_1_constant_parameter.html" title="Standard constant parameter .">ConstantParameter</a> <a class="code" href="namespaceanonymous__namespace_02distributions_8cpp_03.html#ab5b4e39d0154ccd92bd47cff2ea0f8da">sigma</a>( 0.5, <a class="code" href="class_quant_lib_1_1_positive_constraint.html" title="Constraint imposing positivity to all arguments">PositiveConstraint</a>());
    <a class="code" href="class_quant_lib_1_1_constant_parameter.html" title="Standard constant parameter .">ConstantParameter</a> theta( 0.1, <a class="code" href="class_quant_lib_1_1_positive_constraint.html" title="Constraint imposing positivity to all arguments">PositiveConstraint</a>());
    <a class="code" href="class_quant_lib_1_1_constant_parameter.html" title="Standard constant parameter .">ConstantParameter</a> rho( -0.5, <a class="code" href="class_quant_lib_1_1_boundary_constraint.html" title="Constraint imposing all arguments to be in [low,high]">BoundaryConstraint</a>(-1.0, 1.0));
   
    std::vector&lt;Time&gt; pTimes(1, 0.25);
    <a class="code" href="class_quant_lib_1_1_piecewise_constant_parameter.html" title="Piecewise-constant parameter.">PiecewiseConstantParameter</a> kappa(pTimes, <a class="code" href="class_quant_lib_1_1_positive_constraint.html" title="Constraint imposing positivity to all arguments">PositiveConstraint</a>());
    
    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i &lt; pTimes.size()+1; ++i) {
        kappa.setParam(i, 10.0);
    }

    boost::shared_ptr&lt;PiecewiseTimeDependentHestonModel&gt; model(
        <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_piecewise_time_dependent_heston_model.html" title="Piecewise time dependent Heston model.">PiecewiseTimeDependentHestonModel</a>(riskFreeTS, dividendTS,
                                              s0, v0, theta, kappa, 
                                              <a class="code" href="namespaceanonymous__namespace_02distributions_8cpp_03.html#ab5b4e39d0154ccd92bd47cff2ea0f8da">sigma</a>, rho, modelGrid));
    
    boost::shared_ptr&lt;PricingEngine&gt; <a class="code" href="class_quant_lib_1_1engine.html">engine</a>(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_analytic_p_t_d_heston_engine.html" title="analytic piecewise constant time dependent Heston-model engine">AnalyticPTDHestonEngine</a>(model));
    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i = 0; i &lt; options.size(); ++i)
        options[i]-&gt;setPricingEngine(<a class="code" href="class_quant_lib_1_1engine.html">engine</a>);

    <a class="code" href="class_quant_lib_1_1_levenberg_marquardt.html" title="Levenberg-Marquardt optimization method.">LevenbergMarquardt</a> om(1e-8, 1e-8, 1e-8);
    model-&gt;calibrate(options, om, <a class="code" href="class_quant_lib_1_1_end_criteria.html" title="Criteria to end optimization process:">EndCriteria</a>(400, 40, 1.0e-8, 1.0e-8, 1.0e-8));

    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> sse = 0;
    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i = 0; i &lt; 13*8; ++i) {
        <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> diff = options[i]-&gt;calibrationError()*100.0;
        sse += diff*diff;
    }
    
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> expected = 74.4;
    <span class="keywordflow">if</span> (std::fabs(sse - expected) &gt; 1.0) {
        BOOST_FAIL(<span class="stringliteral">&quot;Failed to reproduce calibration error&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;\n    calculated: &quot;</span> &lt;&lt; sse
                   &lt;&lt; <span class="stringliteral">&quot;\n    expected:   &quot;</span> &lt;&lt; expected);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8b51b8317a48980f0e71a3dda7b7ecd5"></a><!-- doxytag: member="HestonModelTest::testDifferentIntegrals" ref="a8b51b8317a48980f0e71a3dda7b7ecd5" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_heston_model_test.html#a8b51b8317a48980f0e71a3dda7b7ecd5">HestonModelTest::testDifferentIntegrals</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l00792">792</a> of file <a class="el" href="test-suite_2hestonmodel_8cpp_source.html">hestonmodel.cpp</a>.</p>

<p>References <a class="el" href="option_8hpp_source.html#l00039">QuantLib::Option::Call</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00129">anonymous_namespace{marketmodel.cpp}::dayCounter</a>, <a class="el" href="date_8hpp_source.html#l00056">QuantLib::December</a>, <a class="el" href="settings_8hpp_source.html#l00153">QuantLib::Settings::evaluationDate()</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00058">QuantLib::flatRate()</a>, <a class="el" href="analytichestonengine_8hpp_source.html#l00084">QuantLib::AnalyticHestonEngine::Gatheral</a>, <a class="el" href="analytichestonengine_8cpp_source.html#l00489">QuantLib::AnalyticHestonEngine::Integration::gaussChebyshev()</a>, <a class="el" href="analytichestonengine_8cpp_source.html#l00496">QuantLib::AnalyticHestonEngine::Integration::gaussChebyshev2nd()</a>, <a class="el" href="analytichestonengine_8cpp_source.html#l00482">QuantLib::AnalyticHestonEngine::Integration::gaussLegendre()</a>, <a class="el" href="class_quant_lib_1_1_singleton.html#ab79257029fa4841505227497a56cbd93">QuantLib::Singleton&lt; Settings &gt;::instance()</a>, <a class="el" href="test-suite_2utilities_8hpp_source.html#l00039">LENGTH</a>, <a class="el" href="test-suite_2brownianbridge_8cpp_source.html#l00038">anonymous_namespace{brownianbridge.cpp}::maxDiff()</a>, <a class="el" href="timeunit_8hpp_source.html#l00039">QuantLib::Months</a>, <a class="el" href="instrument_8hpp_source.html#l00186">QuantLib::Instrument::NPV()</a>, <a class="el" href="option_8hpp_source.html#l00038">QuantLib::Option::Put</a>, and <a class="el" href="instrument_8hpp_source.html#l00133">QuantLib::Instrument::setPricingEngine()</a>.</p>

<p>Referenced by <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l01213">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                             {
    BOOST_MESSAGE(
       <span class="stringliteral">&quot;Testing different numerical Heston integration algorithms...&quot;</span>);

    <a class="code" href="class_quant_lib_1_1_saved_settings.html">SavedSettings</a> backup;

    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> settlementDate(27, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4ad4988bf6760edb92c088bb47d4b61dc5">December</a>, 2004);
    Settings::instance().evaluationDate() = settlementDate;

    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_day_counter.html" title="day counter class">DayCounter</a> <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#abc24484d02b5cded0a275ade16b95733">dayCounter</a> = <a class="code" href="class_quant_lib_1_1_actual_actual.html" title="Actual/Actual day count.">ActualActual</a>();

    <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> riskFreeTS(<a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(0.05, dayCounter));
    <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> dividendTS(<a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(0.03, dayCounter));

    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> strikes[] = { 0.5, 0.7, 1.0, 1.25, 1.5, 2.0 };
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a8ac1a45a37d8d3dda438a2e59e222620" title="integer number">Integer</a> maturities[] = { 1, 2, 3, 12, 60, 120, 360};
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_option.html#abaee7fc605354c444867545492cd5845">Option::Type</a> types[] ={ Option::Put, Option::Call };

    <span class="keyword">const</span> HestonParameter equityfx      = { 0.07, 2.0, 0.04, 0.55, -0.8 };
    <span class="keyword">const</span> HestonParameter highCorr      = { 0.07, 1.0, 0.04, 0.55,  0.995 };
    <span class="keyword">const</span> HestonParameter lowVolOfVol   = { 0.07, 1.0, 0.04, 0.025, -0.75 };
    <span class="keyword">const</span> HestonParameter highVolOfVol  = { 0.07, 1.0, 0.04, 5.0, -0.75 };
    <span class="keyword">const</span> HestonParameter kappaEqSigRho = { 0.07, 0.4, 0.04, 0.5, 0.8 };

    std::vector&lt;HestonParameter&gt; params;
    params.push_back(equityfx);
    params.push_back(highCorr);
    params.push_back(lowVolOfVol);
    params.push_back(highVolOfVol);
    params.push_back(kappaEqSigRho);

    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> tol[] = { 1e-3, 1e-3, 0.2, 0.01, 1e-3 };

    <span class="keywordflow">for</span> (std::vector&lt;HestonParameter&gt;::const_iterator iter = params.begin();
         iter != params.end(); ++iter) {

        <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;Quote&gt;</a> s0(boost::shared_ptr&lt;Quote&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(1.0)));
        boost::shared_ptr&lt;HestonProcess&gt; process(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_process.html" title="Square-root stochastic-volatility Heston process.">HestonProcess</a>(
            riskFreeTS, dividendTS,
            s0, iter-&gt;v0, iter-&gt;kappa,
            iter-&gt;theta, iter-&gt;sigma, iter-&gt;rho));

        boost::shared_ptr&lt;HestonModel&gt; model(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_model.html" title="Heston model for the stochastic volatility of an asset.">HestonModel</a>(process));

        boost::shared_ptr&lt;AnalyticHestonEngine&gt; lobattoEngine(
                              <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_analytic_heston_engine.html" title="analytic Heston-model engine based on Fourier transform">AnalyticHestonEngine</a>(model, 1e-10,
                                                       1000000));
        boost::shared_ptr&lt;AnalyticHestonEngine&gt; laguerreEngine(
                                        <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_analytic_heston_engine.html" title="analytic Heston-model engine based on Fourier transform">AnalyticHestonEngine</a>(model, 192));
        boost::shared_ptr&lt;AnalyticHestonEngine&gt; legendreEngine(
            <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_analytic_heston_engine.html" title="analytic Heston-model engine based on Fourier transform">AnalyticHestonEngine</a>(
                model, AnalyticHestonEngine::Gatheral,
                AnalyticHestonEngine::Integration::gaussLegendre(512)));
        boost::shared_ptr&lt;AnalyticHestonEngine&gt; chebyshevEngine(
            <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_analytic_heston_engine.html" title="analytic Heston-model engine based on Fourier transform">AnalyticHestonEngine</a>(
                model, AnalyticHestonEngine::Gatheral,
                AnalyticHestonEngine::Integration::gaussChebyshev(512)));
        boost::shared_ptr&lt;AnalyticHestonEngine&gt; chebyshev2ndEngine(
            <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_analytic_heston_engine.html" title="analytic Heston-model engine based on Fourier transform">AnalyticHestonEngine</a>(
                model, AnalyticHestonEngine::Gatheral,
                AnalyticHestonEngine::Integration::gaussChebyshev2nd(512)));

        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> maxLegendreDiff    = 0.0;
        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> maxChebyshevDiff   = 0.0;
        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> maxChebyshev2ndDiff= 0.0;
        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> maxLaguerreDiff    = 0.0;

        <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i &lt; <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(maturities); ++i) {
            boost::shared_ptr&lt;Exercise&gt; exercise(
                <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_european_exercise.html" title="European exercise.">EuropeanExercise</a>(settlementDate
                                     + <a class="code" href="class_quant_lib_1_1_period.html">Period</a>(maturities[i], <a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3a3d158b618e2bf6e66da9aca81f706dae">Months</a>)));

            <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> j=0; j &lt; <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(strikes); ++j) {
                <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> k=0; k &lt; <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(types); ++k) {

                    boost::shared_ptr&lt;StrikedTypePayoff&gt; payoff(
                        <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_plain_vanilla_payoff.html" title="Plain-vanilla payoff.">PlainVanillaPayoff</a>(types[k], strikes[j]));

                    <a class="code" href="class_quant_lib_1_1_vanilla_option.html" title="Vanilla option (no discrete dividends, no barriers) on a single asset.">VanillaOption</a> option(payoff, exercise);

                    option.setPricingEngine(lobattoEngine);
                    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> lobattoNPV = option.NPV();

                    option.setPricingEngine(laguerreEngine);
                    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> laguerre = option.NPV();

                    option.setPricingEngine(legendreEngine);
                    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> legendre = option.NPV();

                    option.setPricingEngine(chebyshevEngine);
                    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> chebyshev = option.NPV();

                    option.setPricingEngine(chebyshev2ndEngine);
                    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> chebyshev2nd = option.NPV();

                    maxLaguerreDiff
                        = std::max(maxLaguerreDiff,
                                   std::fabs(lobattoNPV-laguerre));
                    maxLegendreDiff
                        = std::max(maxLegendreDiff,
                                   std::fabs(lobattoNPV-legendre));
                    maxChebyshevDiff
                        = std::max(maxChebyshevDiff,
                                   std::fabs(lobattoNPV-chebyshev));
                    maxChebyshev2ndDiff
                        = std::max(maxChebyshev2ndDiff,
                                   std::fabs(lobattoNPV-chebyshev2nd));

                }
            }
        }
        <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> <a class="code" href="namespaceanonymous__namespace_02brownianbridge_8cpp_03.html#a14172217d34262f9c6403d95f266de1c">maxDiff</a> = std::max(std::max(
            std::max(maxLaguerreDiff,maxLegendreDiff),
                                     maxChebyshevDiff), maxChebyshev2ndDiff);

        <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> tr = tol[iter - params.begin()];
        <span class="keywordflow">if</span> (maxDiff &gt; tr) {
            BOOST_ERROR(<span class="stringliteral">&quot;Failed to reproduce Heston pricing values &quot;</span>
                        <span class="stringliteral">&quot;within given tolerance&quot;</span>
                        &lt;&lt; <span class="stringliteral">&quot;\n    maxDifference: &quot;</span> &lt;&lt; maxDiff
                        &lt;&lt; <span class="stringliteral">&quot;\n    tolerance:     &quot;</span> &lt;&lt; tr);
        }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab75c691bed4106487b7873083251d8be"></a><!-- doxytag: member="HestonModelTest::testFdBarrierVsCached" ref="ab75c691bed4106487b7873083251d8be" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_heston_model_test.html#ab75c691bed4106487b7873083251d8be">HestonModelTest::testFdBarrierVsCached</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l00507">507</a> of file <a class="el" href="test-suite_2hestonmodel_8cpp_source.html">hestonmodel.cpp</a>.</p>

<p>References <a class="el" href="option_8hpp_source.html#l00039">QuantLib::Option::Call</a>, <a class="el" href="barriertype_8hpp_source.html#l00036">QuantLib::Barrier::DownIn</a>, <a class="el" href="barriertype_8hpp_source.html#l00036">QuantLib::Barrier::DownOut</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00058">QuantLib::flatRate()</a>, <a class="el" href="test-suite_2utilities_8hpp_source.html#l00048">QL_SCIENTIFIC</a>, and <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00124">anonymous_namespace{marketmodel.cpp}::todaysDate</a>.</p>

<p>Referenced by <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l01213">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                            {
    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing FD barrier Heston engine against cached values...&quot;</span>);

    <a class="code" href="class_quant_lib_1_1_saved_settings.html">SavedSettings</a> backup;

    <a class="code" href="class_quant_lib_1_1_day_counter.html" title="day counter class">DayCounter</a> dc = <a class="code" href="class_quant_lib_1_1_actual360.html" title="Actual/360 day count convention.">Actual360</a>();
    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> today = <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#ae1b42c838cf0f4cf17262f0b22bac899">Date::todaysDate</a>();

    <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;Quote&gt;</a> s0(boost::shared_ptr&lt;Quote&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(100.0)));
    <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> rTS(<a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(today, 0.08, dc));
    <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> qTS(<a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(today, 0.04, dc));

    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> exDate = today + <a class="code" href="namespace_quant_lib.html#a8ac1a45a37d8d3dda438a2e59e222620" title="integer number">Integer</a>(0.5*360+0.5);
    boost::shared_ptr&lt;Exercise&gt; exercise(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_european_exercise.html" title="European exercise.">EuropeanExercise</a>(exDate));

    boost::shared_ptr&lt;StrikedTypePayoff&gt; payoff(<span class="keyword">new</span>
            <a class="code" href="class_quant_lib_1_1_plain_vanilla_payoff.html" title="Plain-vanilla payoff.">PlainVanillaPayoff</a>(Option::Call, 90.0));

    boost::shared_ptr&lt;HestonProcess&gt; process(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_process.html" title="Square-root stochastic-volatility Heston process.">HestonProcess</a>(
            rTS, qTS, s0, 0.25*0.25, 1.0, 0.25*0.25, 0.001, 0.0));

    boost::shared_ptr&lt;PricingEngine&gt; <a class="code" href="class_quant_lib_1_1engine.html">engine</a>;
    engine = boost::shared_ptr&lt;PricingEngine&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_fd_heston_barrier_engine.html" title="Finite-Differences Heston Barrier Option engine.">FdHestonBarrierEngine</a>(
                    boost::shared_ptr&lt;HestonModel&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_model.html" title="Heston model for the stochastic volatility of an asset.">HestonModel</a>(process)),
                    200,400,100));

    <a class="code" href="class_quant_lib_1_1_barrier_option.html" title="Barrier option on a single asset.">BarrierOption</a> option(Barrier::DownOut, 95.0, 3.0, payoff, exercise);
    option.setPricingEngine(engine);

    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> calculated = option.NPV();
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> expected = 9.0246;
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> error = std::fabs(calculated-expected);
    <span class="keywordflow">if</span> (error &gt; 1.0e-3) {
        BOOST_FAIL(<span class="stringliteral">&quot;failed to reproduce cached price with FD Barrier engine&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;\n    calculated: &quot;</span> &lt;&lt; calculated
                   &lt;&lt; <span class="stringliteral">&quot;\n    expected:   &quot;</span> &lt;&lt; expected
                   &lt;&lt; <span class="stringliteral">&quot;\n    error:      &quot;</span> &lt;&lt; <a class="code" href="test-suite_2utilities_8hpp.html#a8aef6dd018d8f7ff76fa37cde97e5067">QL_SCIENTIFIC</a> &lt;&lt; error);
    }

    option = <a class="code" href="class_quant_lib_1_1_barrier_option.html" title="Barrier option on a single asset.">BarrierOption</a>(Barrier::DownIn, 95.0, 3.0, payoff, exercise);
    option.setPricingEngine(engine);

    calculated = option.NPV();
    expected = 7.7627;
    error = std::fabs(calculated-expected);
    <span class="keywordflow">if</span> (error &gt; 1.0e-3) {
        BOOST_FAIL(<span class="stringliteral">&quot;failed to reproduce cached price with FD Barrier engine&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;\n    calculated: &quot;</span> &lt;&lt; calculated
                   &lt;&lt; <span class="stringliteral">&quot;\n    expected:   &quot;</span> &lt;&lt; expected
                   &lt;&lt; <span class="stringliteral">&quot;\n    error:      &quot;</span> &lt;&lt; <a class="code" href="test-suite_2utilities_8hpp.html#a8aef6dd018d8f7ff76fa37cde97e5067">QL_SCIENTIFIC</a> &lt;&lt; error);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a22b450728cf64c8e0fc33c2a4af6330b"></a><!-- doxytag: member="HestonModelTest::testFdVanillaVsCached" ref="a22b450728cf64c8e0fc33c2a4af6330b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_heston_model_test.html#a22b450728cf64c8e0fc33c2a4af6330b">HestonModelTest::testFdVanillaVsCached</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l00560">560</a> of file <a class="el" href="test-suite_2hestonmodel_8cpp_source.html">hestonmodel.cpp</a>.</p>

<p>References <a class="el" href="option_8hpp_source.html#l00039">QuantLib::Option::Call</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00137">anonymous_namespace{marketmodel.cpp}::d</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00129">anonymous_namespace{marketmodel.cpp}::dayCounter</a>, <a class="el" href="date_8hpp_source.html#l00056">QuantLib::December</a>, <a class="el" href="settings_8hpp_source.html#l00153">QuantLib::Settings::evaluationDate()</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00058">QuantLib::flatRate()</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00086">QuantLib::flatVol()</a>, <a class="el" href="class_quant_lib_1_1_singleton.html#ab79257029fa4841505227497a56cbd93">QuantLib::Singleton&lt; Settings &gt;::instance()</a>, <a class="el" href="date_8hpp_source.html#l00047">QuantLib::March</a>, <a class="el" href="timeunit_8hpp_source.html#l00039">QuantLib::Months</a>, <a class="el" href="instrument_8hpp_source.html#l00186">QuantLib::Instrument::NPV()</a>, <a class="el" href="option_8hpp_source.html#l00038">QuantLib::Option::Put</a>, <a class="el" href="test-suite_2utilities_8hpp_source.html#l00048">QL_SCIENTIFIC</a>, <a class="el" href="instrument_8hpp_source.html#l00133">QuantLib::Instrument::setPricingEngine()</a>, and <a class="el" href="test-suite_2gaussianquadratures_8cpp_source.html#l00032">anonymous_namespace{gaussianquadratures.cpp}::tolerance</a>.</p>

<p>Referenced by <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l01213">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                            {
    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing FD vanilla Heston engine against cached values...&quot;</span>);

    <a class="code" href="class_quant_lib_1_1_saved_settings.html">SavedSettings</a> backup;

    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> settlementDate(27, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4ad4988bf6760edb92c088bb47d4b61dc5">December</a>, 2004);
    Settings::instance().evaluationDate() = settlementDate;

    <a class="code" href="class_quant_lib_1_1_day_counter.html" title="day counter class">DayCounter</a> <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#abc24484d02b5cded0a275ade16b95733">dayCounter</a> = <a class="code" href="class_quant_lib_1_1_actual_actual.html" title="Actual/Actual day count.">ActualActual</a>();
    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> exerciseDate(28, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a982c9e93cf4b41f4b71b5c256df6191c">March</a>, 2005);

    boost::shared_ptr&lt;StrikedTypePayoff&gt; payoff(
                                   <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_plain_vanilla_payoff.html" title="Plain-vanilla payoff.">PlainVanillaPayoff</a>(Option::Put, 1.05));
    boost::shared_ptr&lt;Exercise&gt; exercise(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_european_exercise.html" title="European exercise.">EuropeanExercise</a>(exerciseDate));

    <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> riskFreeTS(<a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(0.7, dayCounter));
    <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> dividendTS(<a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(0.4, dayCounter));

    <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;Quote&gt;</a> s0(boost::shared_ptr&lt;Quote&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(1.05)));

    <a class="code" href="class_quant_lib_1_1_vanilla_option.html" title="Vanilla option (no discrete dividends, no barriers) on a single asset.">VanillaOption</a> option(payoff, exercise);

    boost::shared_ptr&lt;HestonProcess&gt; process(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_process.html" title="Square-root stochastic-volatility Heston process.">HestonProcess</a>(
                   riskFreeTS, dividendTS, s0, 0.3, 1.16, 0.2, 0.8, 0.8));

    boost::shared_ptr&lt;PricingEngine&gt; <a class="code" href="class_quant_lib_1_1engine.html">engine</a>;
    engine = boost::shared_ptr&lt;PricingEngine&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_fd_heston_vanilla_engine.html" title="Finite-Differences Heston Vanilla Option engine.">FdHestonVanillaEngine</a>(
                    boost::shared_ptr&lt;HestonModel&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_model.html" title="Heston model for the stochastic volatility of an asset.">HestonModel</a>(process)),
                    100,200,100));
    option.setPricingEngine(engine);

    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> expected = 0.06325;
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> calculated = option.NPV();
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> error = std::fabs(calculated - expected);
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> <a class="code" href="namespaceanonymous__namespace_02gaussianquadratures_8cpp_03.html#a0f4d3028fdc8cebd7d9c568c16754cab">tolerance</a> = 1.0e-4;

    <span class="keywordflow">if</span> (error &gt; tolerance) {
        BOOST_FAIL(<span class="stringliteral">&quot;failed to reproduce cached price with FD engine&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;\n    calculated: &quot;</span> &lt;&lt; calculated
                   &lt;&lt; <span class="stringliteral">&quot;\n    expected:   &quot;</span> &lt;&lt; expected
                   &lt;&lt; <span class="stringliteral">&quot;\n    error:      &quot;</span> &lt;&lt; <a class="code" href="test-suite_2utilities_8hpp.html#a8aef6dd018d8f7ff76fa37cde97e5067">QL_SCIENTIFIC</a> &lt;&lt; error);
    }

    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing FD vanilla Heston engine for discrete dividends...&quot;</span>);

    payoff = boost::shared_ptr&lt;StrikedTypePayoff&gt;(
                          <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_plain_vanilla_payoff.html" title="Plain-vanilla payoff.">PlainVanillaPayoff</a>(Option::Call, 95.0));
    s0 = <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;Quote&gt;</a>(boost::shared_ptr&lt;Quote&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(100.0)));

    riskFreeTS = <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a>(<a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(0.05, dayCounter));
    dividendTS = <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a>(<a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(0.0, dayCounter));

    exerciseDate = <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(28, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a982c9e93cf4b41f4b71b5c256df6191c">March</a>, 2006);
    exercise = boost::shared_ptr&lt;Exercise&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_european_exercise.html" title="European exercise.">EuropeanExercise</a>(exerciseDate));

    std::vector&lt;Date&gt; dividendDates;
    std::vector&lt;Real&gt; dividends;
    <span class="keywordflow">for</span> (<a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a06d0bee201af9d379ec8f9563ecf7f66">d</a> = settlementDate + 3*<a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3a3d158b618e2bf6e66da9aca81f706dae">Months</a>;
              <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a06d0bee201af9d379ec8f9563ecf7f66">d</a> &lt; exercise-&gt;lastDate();
              <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a06d0bee201af9d379ec8f9563ecf7f66">d</a> += 6*<a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3a3d158b618e2bf6e66da9aca81f706dae">Months</a>) {
        dividendDates.push_back(<a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a06d0bee201af9d379ec8f9563ecf7f66">d</a>);
        dividends.push_back(1.0);
    }

    <a class="code" href="class_quant_lib_1_1_dividend_vanilla_option.html" title="Single-asset vanilla option (no barriers) with discrete dividends.">DividendVanillaOption</a> divOption(payoff, exercise,
                                    dividendDates, dividends);
    process = boost::shared_ptr&lt;HestonProcess&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_process.html" title="Square-root stochastic-volatility Heston process.">HestonProcess</a>(
                   riskFreeTS, dividendTS, s0, 0.04, 1.0, 0.04, 0.001, 0.0));
    engine = boost::shared_ptr&lt;PricingEngine&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_fd_heston_vanilla_engine.html" title="Finite-Differences Heston Vanilla Option engine.">FdHestonVanillaEngine</a>(
                    boost::shared_ptr&lt;HestonModel&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_model.html" title="Heston model for the stochastic volatility of an asset.">HestonModel</a>(process)),
                    200,400,100));
    divOption.setPricingEngine(engine);
    calculated = divOption.NPV();
    <span class="comment">// Value calculated with an independent FD framework, validated with</span>
    <span class="comment">// an independent MC framework</span>
    expected = 12.946;
    error = std::fabs(calculated - expected);
    tolerance = 5.0e-3;

    <span class="keywordflow">if</span> (error &gt; tolerance) {
        BOOST_FAIL(<span class="stringliteral">&quot;failed to reproduce discrete dividend price with FD engine&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;\n    calculated: &quot;</span> &lt;&lt; calculated
                   &lt;&lt; <span class="stringliteral">&quot;\n    expected:   &quot;</span> &lt;&lt; expected
                   &lt;&lt; <span class="stringliteral">&quot;\n    error:      &quot;</span> &lt;&lt; <a class="code" href="test-suite_2utilities_8hpp.html#a8aef6dd018d8f7ff76fa37cde97e5067">QL_SCIENTIFIC</a> &lt;&lt; error);
    }

    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing FD vanilla Heston engine for american exercise...&quot;</span>);

    dividendTS = <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a>(<a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(0.03, dayCounter));
    process = boost::shared_ptr&lt;HestonProcess&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_process.html" title="Square-root stochastic-volatility Heston process.">HestonProcess</a>(
                   riskFreeTS, dividendTS, s0, 0.04, 1.0, 0.04, 0.001, 0.0));
    engine = boost::shared_ptr&lt;PricingEngine&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_fd_heston_vanilla_engine.html" title="Finite-Differences Heston Vanilla Option engine.">FdHestonVanillaEngine</a>(
                    boost::shared_ptr&lt;HestonModel&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_model.html" title="Heston model for the stochastic volatility of an asset.">HestonModel</a>(process)),
                    200,400,100));
    payoff = boost::shared_ptr&lt;StrikedTypePayoff&gt;(
                          <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_plain_vanilla_payoff.html" title="Plain-vanilla payoff.">PlainVanillaPayoff</a>(Option::Put, 95.0));
    exercise = boost::shared_ptr&lt;Exercise&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_american_exercise.html" title="American exercise.">AmericanExercise</a>(
            settlementDate, exerciseDate));
    option = <a class="code" href="class_quant_lib_1_1_vanilla_option.html" title="Vanilla option (no discrete dividends, no barriers) on a single asset.">VanillaOption</a>(payoff, exercise);
    option.setPricingEngine(engine);
    calculated = option.NPV();

    <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;BlackVolTermStructure&gt;</a> volTS(<a class="code" href="namespace_quant_lib.html#a589d5c4b0b60b0bdd42ae07d820b2ed3">flatVol</a>(settlementDate, 0.2,
                                                  dayCounter));
    boost::shared_ptr&lt;BlackScholesMertonProcess&gt; ref_process(
        <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_black_scholes_merton_process.html" title="Merton (1973) extension to the Black-Scholes stochastic process.">BlackScholesMertonProcess</a>(s0, dividendTS, riskFreeTS, volTS));
    boost::shared_ptr&lt;PricingEngine&gt; ref_engine(
                  <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_f_d_american_engine.html" title="Finite-differences pricing engine for American one asset options.">FDAmericanEngine&lt;CrankNicolson&gt;</a>(ref_process, 200, 400));
    option.setPricingEngine(ref_engine);
    expected = option.NPV();

    error = std::fabs(calculated - expected);
    tolerance = 1.0e-3;

    <span class="keywordflow">if</span> (error &gt; tolerance) {
        BOOST_FAIL(<span class="stringliteral">&quot;failed to reproduce american option price with FD engine&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;\n    calculated: &quot;</span> &lt;&lt; calculated
                   &lt;&lt; <span class="stringliteral">&quot;\n    expected:   &quot;</span> &lt;&lt; expected
                   &lt;&lt; <span class="stringliteral">&quot;\n    error:      &quot;</span> &lt;&lt; <a class="code" href="test-suite_2utilities_8hpp.html#a8aef6dd018d8f7ff76fa37cde97e5067">QL_SCIENTIFIC</a> &lt;&lt; error);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae37f08065f361d93a81d465878153245"></a><!-- doxytag: member="HestonModelTest::testKahlJaeckelCase" ref="ae37f08065f361d93a81d465878153245" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_heston_model_test.html#ae37f08065f361d93a81d465878153245">HestonModelTest::testKahlJaeckelCase</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l00682">682</a> of file <a class="el" href="test-suite_2hestonmodel_8cpp_source.html">hestonmodel.cpp</a>.</p>

<p>References <a class="el" href="option_8hpp_source.html#l00039">QuantLib::Option::Call</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00129">anonymous_namespace{marketmodel.cpp}::dayCounter</a>, <a class="el" href="instrument_8hpp_source.html#l00192">QuantLib::Instrument::errorEstimate()</a>, <a class="el" href="settings_8hpp_source.html#l00153">QuantLib::Settings::evaluationDate()</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00058">QuantLib::flatRate()</a>, <a class="el" href="class_quant_lib_1_1_singleton.html#ab79257029fa4841505227497a56cbd93">QuantLib::Singleton&lt; Settings &gt;::instance()</a>, <a class="el" href="date_8hpp_source.html#l00047">QuantLib::March</a>, <a class="el" href="hestonprocess_8hpp_source.html#l00051">QuantLib::HestonProcess::NonCentralChiSquareVariance</a>, <a class="el" href="instrument_8hpp_source.html#l00186">QuantLib::Instrument::NPV()</a>, <a class="el" href="test-suite_2utilities_8hpp_source.html#l00048">QL_SCIENTIFIC</a>, <a class="el" href="hestonprocess_8hpp_source.html#l00053">QuantLib::HestonProcess::QuadraticExponentialMartingale</a>, <a class="el" href="instrument_8hpp_source.html#l00133">QuantLib::Instrument::setPricingEngine()</a>, <a class="el" href="test-suite_2gaussianquadratures_8cpp_source.html#l00032">anonymous_namespace{gaussianquadratures.cpp}::tolerance</a>, <a class="el" href="mceuropeanhestonengine_8hpp_source.html#l00169">QuantLib::MakeMCEuropeanHestonEngine&lt; RNG, S &gt;::withAbsoluteTolerance()</a>, <a class="el" href="mceuropeanhestonengine_8hpp_source.html#l00195">QuantLib::MakeMCEuropeanHestonEngine&lt; RNG, S &gt;::withAntitheticVariate()</a>, and <a class="el" href="mceuropeanhestonengine_8hpp_source.html#l00188">QuantLib::MakeMCEuropeanHestonEngine&lt; RNG, S &gt;::withSeed()</a>.</p>

<p>Referenced by <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l01213">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                          {
    BOOST_MESSAGE(
          <span class="stringliteral">&quot;Testing MC and FD Heston engines for the Kahl-Jaeckel example...&quot;</span>);

    <span class="comment">/* Example taken from Wilmott mag (Sept. 2005).</span>
<span class="comment">       &quot;Not-so-complex logarithms in the Heston model&quot;,</span>
<span class="comment">       Example was also discussed within the Wilmott thread</span>
<span class="comment">       &quot;QuantLib code is very high quatlity&quot;</span>
<span class="comment">    */</span>

    <a class="code" href="class_quant_lib_1_1_saved_settings.html">SavedSettings</a> backup;

    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> settlementDate(30, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a982c9e93cf4b41f4b71b5c256df6191c">March</a>, 2007);
    Settings::instance().evaluationDate() = settlementDate;

    <a class="code" href="class_quant_lib_1_1_day_counter.html" title="day counter class">DayCounter</a> <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#abc24484d02b5cded0a275ade16b95733">dayCounter</a> = <a class="code" href="class_quant_lib_1_1_actual_actual.html" title="Actual/Actual day count.">ActualActual</a>();
    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> exerciseDate(30, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a982c9e93cf4b41f4b71b5c256df6191c">March</a>, 2017);

    boost::shared_ptr&lt;StrikedTypePayoff&gt; payoff(
                                   <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_plain_vanilla_payoff.html" title="Plain-vanilla payoff.">PlainVanillaPayoff</a>(Option::Call, 200));
    boost::shared_ptr&lt;Exercise&gt; exercise(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_european_exercise.html" title="European exercise.">EuropeanExercise</a>(exerciseDate));

    <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> riskFreeTS(<a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(0.0, dayCounter));
    <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> dividendTS(<a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(0.0, dayCounter));

    <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;Quote&gt;</a> s0(boost::shared_ptr&lt;Quote&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(100)));

    boost::shared_ptr&lt;HestonProcess&gt; processNonCentral(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_process.html" title="Square-root stochastic-volatility Heston process.">HestonProcess</a>(
                   riskFreeTS, dividendTS, s0, 0.16, 1.0, 0.16, 2.0, -0.8,
                   HestonProcess::NonCentralChiSquareVariance));

    boost::shared_ptr&lt;HestonProcess&gt; processQE_M(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_process.html" title="Square-root stochastic-volatility Heston process.">HestonProcess</a>(
                   riskFreeTS, dividendTS, s0, 0.16, 1.0, 0.16, 2.0, -0.8,
                   HestonProcess::QuadraticExponentialMartingale));


    <a class="code" href="class_quant_lib_1_1_vanilla_option.html" title="Vanilla option (no discrete dividends, no barriers) on a single asset.">VanillaOption</a> option(payoff, exercise);

    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> <a class="code" href="namespaceanonymous__namespace_02gaussianquadratures_8cpp_03.html#a0f4d3028fdc8cebd7d9c568c16754cab">tolerance</a> = 0.1;

    boost::shared_ptr&lt;PricingEngine&gt; <a class="code" href="class_quant_lib_1_1engine.html">engine</a> =
        <a class="code" href="class_quant_lib_1_1_make_m_c_european_heston_engine.html" title="Monte Carlo Heston European engine factory.">MakeMCEuropeanHestonEngine&lt;PseudoRandom&gt;</a>(processNonCentral)
        .withSteps(10)
        .<a class="code" href="class_quant_lib_1_1_make_m_c_european_heston_engine.html#ada4b189a85a9b2314ead5e0e820b4724">withAntitheticVariate</a>()
        .<a class="code" href="class_quant_lib_1_1_make_m_c_european_heston_engine.html#a082553a9b12ce2955b5af23ec0095f65">withAbsoluteTolerance</a>(tolerance)
        .<a class="code" href="class_quant_lib_1_1_make_m_c_european_heston_engine.html#a5ae0aa8a83228f658e849e95ecb8d212">withSeed</a>(1234);
    option.setPricingEngine(engine);

    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> expected = 4.95212;
          <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> calculated = option.NPV();
          <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> errorEstimate = option.errorEstimate();

    <span class="keywordflow">if</span> (std::fabs(calculated - expected) &gt; 2.34*errorEstimate) {
        BOOST_ERROR(<span class="stringliteral">&quot;Failed to reproduce cached price with MC engine&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;\n    calculated: &quot;</span> &lt;&lt; calculated
                    &lt;&lt; <span class="stringliteral">&quot;\n    expected:   &quot;</span> &lt;&lt; expected
                    &lt;&lt; <span class="stringliteral">&quot; +/- &quot;</span> &lt;&lt; errorEstimate);
    }

    <span class="keywordflow">if</span> (errorEstimate &gt; tolerance) {
        BOOST_ERROR(<span class="stringliteral">&quot;failed to reproduce error estimate with MC engine&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;\n    calculated: &quot;</span> &lt;&lt; errorEstimate
                    &lt;&lt; <span class="stringliteral">&quot;\n    expected:   &quot;</span> &lt;&lt; tolerance);
    }

    engine =
        <a class="code" href="class_quant_lib_1_1_make_m_c_european_heston_engine.html" title="Monte Carlo Heston European engine factory.">MakeMCEuropeanHestonEngine&lt;PseudoRandom&gt;</a>(processQE_M)
        .withSteps(100)
        .<a class="code" href="class_quant_lib_1_1_make_m_c_european_heston_engine.html#ada4b189a85a9b2314ead5e0e820b4724">withAntitheticVariate</a>()
        .<a class="code" href="class_quant_lib_1_1_make_m_c_european_heston_engine.html#a082553a9b12ce2955b5af23ec0095f65">withAbsoluteTolerance</a>(tolerance)
        .<a class="code" href="class_quant_lib_1_1_make_m_c_european_heston_engine.html#a5ae0aa8a83228f658e849e95ecb8d212">withSeed</a>(1234);
    option.setPricingEngine(engine);

    calculated = option.NPV();
    errorEstimate = option.errorEstimate();

    <span class="keywordflow">if</span> (std::fabs(calculated - expected) &gt; 2.34*errorEstimate) {
        BOOST_ERROR(<span class="stringliteral">&quot;Failed to reproduce cached price with MC engine&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;\n    calculated: &quot;</span> &lt;&lt; calculated
                    &lt;&lt; <span class="stringliteral">&quot;\n    expected:   &quot;</span> &lt;&lt; expected
                    &lt;&lt; <span class="stringliteral">&quot; +/- &quot;</span> &lt;&lt; errorEstimate);
    }

    <span class="keywordflow">if</span> (errorEstimate &gt; tolerance) {
        BOOST_ERROR(<span class="stringliteral">&quot;failed to reproduce error estimate with MC engine&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;\n    calculated: &quot;</span> &lt;&lt; errorEstimate
                    &lt;&lt; <span class="stringliteral">&quot;\n    expected:   &quot;</span> &lt;&lt; tolerance);
    }

    engine = boost::shared_ptr&lt;PricingEngine&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_fd_heston_vanilla_engine.html" title="Finite-Differences Heston Vanilla Option engine.">FdHestonVanillaEngine</a>(
                 boost::shared_ptr&lt;HestonModel&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_model.html" title="Heston model for the stochastic volatility of an asset.">HestonModel</a>(processQE_M)),
                 200,400,100));
    option.setPricingEngine(engine);

    calculated = option.NPV();
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> error = std::fabs(calculated - expected);
    tolerance = 5.0e-2;
    <span class="keywordflow">if</span> (error &gt; tolerance) {
        BOOST_FAIL(<span class="stringliteral">&quot;failed to reproduce cached price with FD engine&quot;</span>
                   &lt;&lt; <span class="stringliteral">&quot;\n    calculated: &quot;</span> &lt;&lt; calculated
                   &lt;&lt; <span class="stringliteral">&quot;\n    expected:   &quot;</span> &lt;&lt; expected
                   &lt;&lt; <span class="stringliteral">&quot;\n    error:      &quot;</span> &lt;&lt; <a class="code" href="test-suite_2utilities_8hpp.html#a8aef6dd018d8f7ff76fa37cde97e5067">QL_SCIENTIFIC</a> &lt;&lt; error);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="ade7ff0b8e84afe3ecafae9ce7aa75088"></a><!-- doxytag: member="HestonModelTest::testMcVsCached" ref="ade7ff0b8e84afe3ecafae9ce7aa75088" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_heston_model_test.html#ade7ff0b8e84afe3ecafae9ce7aa75088">HestonModelTest::testMcVsCached</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l00452">452</a> of file <a class="el" href="test-suite_2hestonmodel_8cpp_source.html">hestonmodel.cpp</a>.</p>

<p>References <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00129">anonymous_namespace{marketmodel.cpp}::dayCounter</a>, <a class="el" href="date_8hpp_source.html#l00056">QuantLib::December</a>, <a class="el" href="instrument_8hpp_source.html#l00192">QuantLib::Instrument::errorEstimate()</a>, <a class="el" href="settings_8hpp_source.html#l00153">QuantLib::Settings::evaluationDate()</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00058">QuantLib::flatRate()</a>, <a class="el" href="class_quant_lib_1_1_singleton.html#ab79257029fa4841505227497a56cbd93">QuantLib::Singleton&lt; Settings &gt;::instance()</a>, <a class="el" href="date_8hpp_source.html#l00047">QuantLib::March</a>, <a class="el" href="instrument_8hpp_source.html#l00186">QuantLib::Instrument::NPV()</a>, <a class="el" href="option_8hpp_source.html#l00038">QuantLib::Option::Put</a>, <a class="el" href="hestonprocess_8hpp_source.html#l00053">QuantLib::HestonProcess::QuadraticExponentialMartingale</a>, <a class="el" href="instrument_8hpp_source.html#l00133">QuantLib::Instrument::setPricingEngine()</a>, <a class="el" href="test-suite_2gaussianquadratures_8cpp_source.html#l00032">anonymous_namespace{gaussianquadratures.cpp}::tolerance</a>, <a class="el" href="mceuropeanhestonengine_8hpp_source.html#l00195">QuantLib::MakeMCEuropeanHestonEngine&lt; RNG, S &gt;::withAntitheticVariate()</a>, <a class="el" href="mceuropeanhestonengine_8hpp_source.html#l00160">QuantLib::MakeMCEuropeanHestonEngine&lt; RNG, S &gt;::withSamples()</a>, and <a class="el" href="mceuropeanhestonengine_8hpp_source.html#l00188">QuantLib::MakeMCEuropeanHestonEngine&lt; RNG, S &gt;::withSeed()</a>.</p>

<p>Referenced by <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l01213">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                     {
    BOOST_MESSAGE(
                <span class="stringliteral">&quot;Testing Monte Carlo Heston engine against cached values...&quot;</span>);

    <a class="code" href="class_quant_lib_1_1_saved_settings.html">SavedSettings</a> backup;

    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> settlementDate(27, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4ad4988bf6760edb92c088bb47d4b61dc5">December</a>, 2004);
    Settings::instance().evaluationDate() = settlementDate;

    <a class="code" href="class_quant_lib_1_1_day_counter.html" title="day counter class">DayCounter</a> <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#abc24484d02b5cded0a275ade16b95733">dayCounter</a> = <a class="code" href="class_quant_lib_1_1_actual_actual.html" title="Actual/Actual day count.">ActualActual</a>();
    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> exerciseDate(28, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a982c9e93cf4b41f4b71b5c256df6191c">March</a>, 2005);

    boost::shared_ptr&lt;StrikedTypePayoff&gt; payoff(
                                   <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_plain_vanilla_payoff.html" title="Plain-vanilla payoff.">PlainVanillaPayoff</a>(Option::Put, 1.05));
    boost::shared_ptr&lt;Exercise&gt; exercise(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_european_exercise.html" title="European exercise.">EuropeanExercise</a>(exerciseDate));

    <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> riskFreeTS(<a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(0.7, dayCounter));
    <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> dividendTS(<a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(0.4, dayCounter));

    <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;Quote&gt;</a> s0(boost::shared_ptr&lt;Quote&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(1.05)));

    boost::shared_ptr&lt;HestonProcess&gt; process(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_process.html" title="Square-root stochastic-volatility Heston process.">HestonProcess</a>(
                   riskFreeTS, dividendTS, s0, 0.3, 1.16, 0.2, 0.8, 0.8,
                   HestonProcess::QuadraticExponentialMartingale));

    <a class="code" href="class_quant_lib_1_1_vanilla_option.html" title="Vanilla option (no discrete dividends, no barriers) on a single asset.">VanillaOption</a> option(payoff, exercise);

    boost::shared_ptr&lt;PricingEngine&gt; <a class="code" href="class_quant_lib_1_1engine.html">engine</a>;
    engine = <a class="code" href="class_quant_lib_1_1_make_m_c_european_heston_engine.html" title="Monte Carlo Heston European engine factory.">MakeMCEuropeanHestonEngine&lt;PseudoRandom&gt;</a>(process)
        .withStepsPerYear(11)
        .<a class="code" href="class_quant_lib_1_1_make_m_c_european_heston_engine.html#ada4b189a85a9b2314ead5e0e820b4724">withAntitheticVariate</a>()
        .<a class="code" href="class_quant_lib_1_1_make_m_c_european_heston_engine.html#a55548e87523e1b7e9ae54e56a1b20c28">withSamples</a>(50000)
        .<a class="code" href="class_quant_lib_1_1_make_m_c_european_heston_engine.html#a5ae0aa8a83228f658e849e95ecb8d212">withSeed</a>(1234);

    option.setPricingEngine(engine);

    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> expected = 0.0632851308977151;
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> calculated = option.NPV();
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> errorEstimate = option.errorEstimate();
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> <a class="code" href="namespaceanonymous__namespace_02gaussianquadratures_8cpp_03.html#a0f4d3028fdc8cebd7d9c568c16754cab">tolerance</a> = 7.5e-4;

    <span class="keywordflow">if</span> (std::fabs(calculated - expected) &gt; 2.34*errorEstimate) {
        BOOST_ERROR(<span class="stringliteral">&quot;Failed to reproduce cached price&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;\n    calculated: &quot;</span> &lt;&lt; calculated
                    &lt;&lt; <span class="stringliteral">&quot;\n    expected:   &quot;</span> &lt;&lt; expected
                    &lt;&lt; <span class="stringliteral">&quot; +/- &quot;</span> &lt;&lt; errorEstimate);
    }

    <span class="keywordflow">if</span> (errorEstimate &gt; tolerance) {
        BOOST_ERROR(<span class="stringliteral">&quot;failed to reproduce error estimate&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;\n    calculated: &quot;</span> &lt;&lt; errorEstimate
                    &lt;&lt; <span class="stringliteral">&quot;\n    expected:   &quot;</span> &lt;&lt; tolerance);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a22a2460b5b6f478e65121a59a9199adf"></a><!-- doxytag: member="HestonModelTest::testMultipleStrikesEngine" ref="a22a2460b5b6f478e65121a59a9199adf" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_heston_model_test.html#a22a2460b5b6f478e65121a59a9199adf">HestonModelTest::testMultipleStrikesEngine</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l00917">917</a> of file <a class="el" href="test-suite_2hestonmodel_8cpp_source.html">hestonmodel.cpp</a>.</p>

<p>References <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00129">anonymous_namespace{marketmodel.cpp}::dayCounter</a>, <a class="el" href="date_8hpp_source.html#l00056">QuantLib::December</a>, <a class="el" href="oneassetoption_8cpp_source.html#l00037">QuantLib::OneAssetOption::delta()</a>, <a class="el" href="settings_8hpp_source.html#l00153">QuantLib::Settings::evaluationDate()</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00058">QuantLib::flatRate()</a>, <a class="el" href="oneassetoption_8cpp_source.html#l00056">QuantLib::OneAssetOption::gamma()</a>, <a class="el" href="class_quant_lib_1_1_singleton.html#ab79257029fa4841505227497a56cbd93">QuantLib::Singleton&lt; Settings &gt;::instance()</a>, <a class="el" href="date_8hpp_source.html#l00047">QuantLib::March</a>, <a class="el" href="instrument_8hpp_source.html#l00186">QuantLib::Instrument::NPV()</a>, <a class="el" href="option_8hpp_source.html#l00038">QuantLib::Option::Put</a>, <a class="el" href="test-suite_2utilities_8hpp_source.html#l00048">QL_SCIENTIFIC</a>, <a class="el" href="instrument_8hpp_source.html#l00133">QuantLib::Instrument::setPricingEngine()</a>, and <a class="el" href="oneassetoption_8cpp_source.html#l00062">QuantLib::OneAssetOption::theta()</a>.</p>

<p>Referenced by <a class="el" href="test-suite_2hestonmodel_8cpp_source.html#l01213">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                                {
    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing multiple-strikes FD Heston engine...&quot;</span>);

    <a class="code" href="class_quant_lib_1_1_saved_settings.html">SavedSettings</a> backup;

    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> settlementDate(27, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4ad4988bf6760edb92c088bb47d4b61dc5">December</a>, 2004);
    Settings::instance().evaluationDate() = settlementDate;

    <a class="code" href="class_quant_lib_1_1_day_counter.html" title="day counter class">DayCounter</a> <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#abc24484d02b5cded0a275ade16b95733">dayCounter</a> = <a class="code" href="class_quant_lib_1_1_actual_actual.html" title="Actual/Actual day count.">ActualActual</a>();
    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> exerciseDate(28, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a982c9e93cf4b41f4b71b5c256df6191c">March</a>, 2006);

    boost::shared_ptr&lt;Exercise&gt; exercise(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_european_exercise.html" title="European exercise.">EuropeanExercise</a>(exerciseDate));

    <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> riskFreeTS(<a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(0.06, dayCounter));
    <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> dividendTS(<a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(0.02, dayCounter));

    <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;Quote&gt;</a> s0(boost::shared_ptr&lt;Quote&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(1.05)));

    boost::shared_ptr&lt;HestonProcess&gt; process(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_process.html" title="Square-root stochastic-volatility Heston process.">HestonProcess</a>(
                     riskFreeTS, dividendTS, s0, 0.16, 2.5, 0.09, 0.8, -0.8));
    boost::shared_ptr&lt;HestonModel&gt; model(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_model.html" title="Heston model for the stochastic volatility of an asset.">HestonModel</a>(process));

    std::vector&lt;Real&gt; strikes;
    strikes.push_back(1.0);  strikes.push_back(0.5);
    strikes.push_back(0.75); strikes.push_back(1.5); strikes.push_back(2.0);

    boost::shared_ptr&lt;FdHestonVanillaEngine&gt; singleStrikeEngine(
                             <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_fd_heston_vanilla_engine.html" title="Finite-Differences Heston Vanilla Option engine.">FdHestonVanillaEngine</a>(model, 20, 400, 50));
    boost::shared_ptr&lt;FdHestonVanillaEngine&gt; multiStrikeEngine(
                             <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_fd_heston_vanilla_engine.html" title="Finite-Differences Heston Vanilla Option engine.">FdHestonVanillaEngine</a>(model, 20, 400, 50));
    multiStrikeEngine-&gt;enableMultipleStrikesCaching(strikes);

    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> relTol = 5e-3;
    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i &lt; strikes.size(); ++i) {
        boost::shared_ptr&lt;StrikedTypePayoff&gt; payoff(
                           <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_plain_vanilla_payoff.html" title="Plain-vanilla payoff.">PlainVanillaPayoff</a>(Option::Put, strikes[i]));

        <a class="code" href="class_quant_lib_1_1_vanilla_option.html" title="Vanilla option (no discrete dividends, no barriers) on a single asset.">VanillaOption</a> aOption(payoff, exercise);
        aOption.setPricingEngine(multiStrikeEngine);

        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> npvCalculated   = aOption.NPV();
        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> deltaCalculated = aOption.delta();
        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> gammaCalculated = aOption.gamma();
        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> thetaCalculated = aOption.theta();

        aOption.setPricingEngine(singleStrikeEngine);
        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> npvExpected   = aOption.NPV();
        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> deltaExpected = aOption.delta();
        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> gammaExpected = aOption.gamma();
        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> thetaExpected = aOption.theta();

        <span class="keywordflow">if</span> (std::fabs(npvCalculated-npvExpected)/npvExpected &gt; relTol) {
            BOOST_FAIL(<span class="stringliteral">&quot;failed to reproduce price with FD multi strike engine&quot;</span>
                       &lt;&lt; <span class="stringliteral">&quot;\n    calculated: &quot;</span> &lt;&lt; npvCalculated
                       &lt;&lt; <span class="stringliteral">&quot;\n    expected:   &quot;</span> &lt;&lt; npvExpected
                       &lt;&lt; <span class="stringliteral">&quot;\n    error:      &quot;</span> &lt;&lt; <a class="code" href="test-suite_2utilities_8hpp.html#a8aef6dd018d8f7ff76fa37cde97e5067">QL_SCIENTIFIC</a> &lt;&lt; relTol);
        }
        <span class="keywordflow">if</span> (std::fabs(deltaCalculated-deltaExpected)/deltaExpected &gt; relTol) {
            BOOST_FAIL(<span class="stringliteral">&quot;failed to reproduce delta with FD multi strike engine&quot;</span>
                       &lt;&lt; <span class="stringliteral">&quot;\n    calculated: &quot;</span> &lt;&lt; deltaCalculated
                       &lt;&lt; <span class="stringliteral">&quot;\n    expected:   &quot;</span> &lt;&lt; deltaExpected
                       &lt;&lt; <span class="stringliteral">&quot;\n    error:      &quot;</span> &lt;&lt; <a class="code" href="test-suite_2utilities_8hpp.html#a8aef6dd018d8f7ff76fa37cde97e5067">QL_SCIENTIFIC</a> &lt;&lt; relTol);
        }
        <span class="keywordflow">if</span> (std::fabs(gammaCalculated-gammaExpected)/gammaExpected &gt; relTol) {
            BOOST_FAIL(<span class="stringliteral">&quot;failed to reproduce gamma with FD multi strike engine&quot;</span>
                       &lt;&lt; <span class="stringliteral">&quot;\n    calculated: &quot;</span> &lt;&lt; gammaCalculated
                       &lt;&lt; <span class="stringliteral">&quot;\n    expected:   &quot;</span> &lt;&lt; gammaExpected
                       &lt;&lt; <span class="stringliteral">&quot;\n    error:      &quot;</span> &lt;&lt; <a class="code" href="test-suite_2utilities_8hpp.html#a8aef6dd018d8f7ff76fa37cde97e5067">QL_SCIENTIFIC</a> &lt;&lt; relTol);
        }
        <span class="keywordflow">if</span> (std::fabs(thetaCalculated-thetaExpected)/thetaExpected &gt; relTol) {
            BOOST_FAIL(<span class="stringliteral">&quot;failed to reproduce theta with FD multi strike engine&quot;</span>
                       &lt;&lt; <span class="stringliteral">&quot;\n    calculated: &quot;</span> &lt;&lt; thetaCalculated
                       &lt;&lt; <span class="stringliteral">&quot;\n    expected:   &quot;</span> &lt;&lt; thetaExpected
                       &lt;&lt; <span class="stringliteral">&quot;\n    error:      &quot;</span> &lt;&lt; <a class="code" href="test-suite_2utilities_8hpp.html#a8aef6dd018d8f7ff76fa37cde97e5067">QL_SCIENTIFIC</a> &lt;&lt; relTol);
        }
    }
}
</pre></div>
</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/home/deriversatile/QuantLib/QuantLibQt/test-suite/<a class="el" href="test-suite_2hestonmodel_8hpp_source.html">hestonmodel.hpp</a></li>
<li>/home/deriversatile/QuantLib/QuantLibQt/test-suite/<a class="el" href="test-suite_2hestonmodel_8cpp_source.html">hestonmodel.cpp</a></li>
</ul>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="class_heston_model_test.html">HestonModelTest</a>      </li>

    <li class="footer">Generated on Sat Aug 25 2012 13:51:01 for QuantLib by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
