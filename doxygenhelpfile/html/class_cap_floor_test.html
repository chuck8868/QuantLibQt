<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>QuantLib: CapFloorTest Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">QuantLib
   &#160;<span id="projectnumber">1.3</span>
   </div>
   <div id="projectbrief">ql1-3</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="dynsections.js"></script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('class_cap_floor_test.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-static-methods">Static Public Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">CapFloorTest Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="CapFloorTest" -->
<p><code>#include &lt;<a class="el" href="test-suite_2capfloor_8hpp_source.html">capfloor.hpp</a>&gt;</code></p>

<p><a href="class_cap_floor_test-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_cap_floor_test.html#a7cf31b254cd4d8c46a136fd6f5c2925f">testStrikeDependency</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_cap_floor_test.html#a1473b7e7604b2501f11684b59f21af3c">testConsistency</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_cap_floor_test.html#a171c951ce1c0db55a61ae3428f45deb6">testParity</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_cap_floor_test.html#a3fbdef65bd0746e69ad91f18524f45b6">testVega</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_cap_floor_test.html#afdba37b93d93db5053f5e9a4e756138d">testATMRate</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_cap_floor_test.html#a7570a1138d55d0b4af37b810f9bd5e33">testImpliedVolatility</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_cap_floor_test.html#ae92e6f355805a1eedddaa7860348ffbe">testCachedValue</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <br class="typebreak"/>
boost::unit_test_framework::test_suite *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_cap_floor_test.html#a4b090e18fb7490ff799539c0855c0d37">suite</a> ()</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="test-suite_2capfloor_8hpp_source.html#l00029">29</a> of file <a class="el" href="test-suite_2capfloor_8hpp_source.html">capfloor.hpp</a>.</p>
</div><hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a4b090e18fb7490ff799539c0855c0d37"></a><!-- doxytag: member="CapFloorTest::suite" ref="a4b090e18fb7490ff799539c0855c0d37" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">test_suite * <a class="el" href="class_cap_floor_test.html#a4b090e18fb7490ff799539c0855c0d37">CapFloorTest::suite</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2capfloor_8cpp_source.html#l00612">612</a> of file <a class="el" href="test-suite_2capfloor_8cpp_source.html">capfloor.cpp</a>.</p>

<p>References <a class="el" href="test-suite_2utilities_8hpp_source.html#l00061">QUANTLIB_TEST_CASE</a>, <a class="el" href="test-suite_2capfloor_8cpp_source.html#l00422">testATMRate()</a>, <a class="el" href="test-suite_2capfloor_8cpp_source.html#l00570">testCachedValue()</a>, <a class="el" href="test-suite_2capfloor_8cpp_source.html#l00257">testConsistency()</a>, <a class="el" href="test-suite_2capfloor_8cpp_source.html#l00484">testImpliedVolatility()</a>, <a class="el" href="test-suite_2capfloor_8cpp_source.html#l00371">testParity()</a>, <a class="el" href="test-suite_2capfloor_8cpp_source.html#l00195">testStrikeDependency()</a>, and <a class="el" href="test-suite_2capfloor_8cpp_source.html#l00140">testVega()</a>.</p>

<p>Referenced by <a class="el" href="quantlibtestsuite_8cpp_source.html#l00206">init_unit_test_suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                {
    test_suite* <a class="code" href="class_cap_floor_test.html#a4b090e18fb7490ff799539c0855c0d37">suite</a> = BOOST_TEST_SUITE(<span class="stringliteral">&quot;Cap/floor tests&quot;</span>);
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(&amp;<a class="code" href="class_cap_floor_test.html#a7cf31b254cd4d8c46a136fd6f5c2925f">CapFloorTest::testStrikeDependency</a>));
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(&amp;<a class="code" href="class_cap_floor_test.html#a1473b7e7604b2501f11684b59f21af3c">CapFloorTest::testConsistency</a>));
    <span class="comment">// FLOATING_POINT_EXCEPTION</span>
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(&amp;<a class="code" href="class_cap_floor_test.html#a171c951ce1c0db55a61ae3428f45deb6">CapFloorTest::testParity</a>));
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(&amp;<a class="code" href="class_cap_floor_test.html#a3fbdef65bd0746e69ad91f18524f45b6">CapFloorTest::testVega</a>));
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(&amp;<a class="code" href="class_cap_floor_test.html#afdba37b93d93db5053f5e9a4e756138d">CapFloorTest::testATMRate</a>));
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(&amp;<a class="code" href="class_cap_floor_test.html#a7570a1138d55d0b4af37b810f9bd5e33">CapFloorTest::testImpliedVolatility</a>));
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(&amp;<a class="code" href="class_cap_floor_test.html#ae92e6f355805a1eedddaa7860348ffbe">CapFloorTest::testCachedValue</a>));
    <span class="keywordflow">return</span> <a class="code" href="class_cap_floor_test.html#a4b090e18fb7490ff799539c0855c0d37">suite</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="afdba37b93d93db5053f5e9a4e756138d"></a><!-- doxytag: member="CapFloorTest::testATMRate" ref="afdba37b93d93db5053f5e9a4e756138d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_cap_floor_test.html#afdba37b93d93db5053f5e9a4e756138d">CapFloorTest::testATMRate</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2capfloor_8cpp_source.html#l00422">422</a> of file <a class="el" href="test-suite_2capfloor_8cpp_source.html">capfloor.cpp</a>.</p>

<p>References <a class="el" href="date_8cpp_source.html#l00151">QuantLib::Date::advance()</a>, <a class="el" href="ql_2instruments_2capfloor_8hpp_source.html#l00056">QuantLib::CapFloor::Cap</a>, <a class="el" href="test-suite_2capfloor_8cpp_source.html#l00120">anonymous_namespace{capfloor.cpp}::checkAbsError()</a>, <a class="el" href="ql_2instruments_2capfloor_8hpp_source.html#l00056">QuantLib::CapFloor::Floor</a>, <a class="el" href="dategenerationrule_8hpp_source.html#l00043">QuantLib::DateGeneration::Forward</a>, <a class="el" href="test-suite_2utilities_8hpp_source.html#l00039">LENGTH</a>, <a class="el" href="test-suite_2swaption_8cpp_source.html#l00045">anonymous_namespace{swaption.cpp}::lengths</a>, <a class="el" href="vanillaswap_8hpp_source.html#l00067">QuantLib::VanillaSwap::Payer</a>, <a class="el" href="dataformatters_8hpp_source.html#l00129">QuantLib::io::rate()</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00115">QuantLib::relativeError()</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00124">anonymous_namespace{marketmodel.cpp}::startDate</a>, <a class="el" href="complexarray_8hpp_source.html#l00547">QuantLib::swap()</a>, <a class="el" href="dataformatters_8hpp_source.html#l00133">QuantLib::io::volatility()</a>, and <a class="el" href="timeunit_8hpp_source.html#l00040">QuantLib::Years</a>.</p>

<p>Referenced by <a class="el" href="test-suite_2capfloor_8cpp_source.html#l00612">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                               {

    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing cap/floor ATM rate...&quot;</span>);

    CommonVars vars;

    <a class="code" href="namespace_quant_lib.html#a8ac1a45a37d8d3dda438a2e59e222620" title="integer number">Integer</a> <a class="code" href="namespaceanonymous__namespace_02swaption_8cpp_03.html#ad503f595f6a4cbf42c9e537eb32a4369">lengths</a>[] = { 1, 2, 3, 5, 7, 10, 15, 20 };
    <a class="code" href="namespace_quant_lib.html#a919ba3567cc89fca373f8d6b8e80126b" title="interest rates">Rate</a> strikes[] = { 0., 0.03, 0.04, 0.05, 0.06, 0.07 };
    <a class="code" href="namespace_quant_lib.html#ae3abfa256de5aa2b506ab6bda014e4dc" title="volatility">Volatility</a> vols[] = { 0.01, 0.05, 0.10, 0.15, 0.20 };

    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a5f839cd623254225993e6a977033e607">startDate</a> = vars.termStructure-&gt;referenceDate();

    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(lengths); i++) {
        <a class="code" href="namespace_quant_lib.html#abdb8d18844749e7614125fe36661bb11" title="Sequence of cash-flows.">Leg</a> leg = vars.makeLeg(startDate,lengths[i]);
        <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> maturity = vars.calendar.<a class="code" href="class_quant_lib_1_1_date.html#a0eb2b32bac68e01a7eab2a47e3b2f1c0">advance</a>(startDate,lengths[i],<a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3ae2d856134531729a1696e66bebeafb32">Years</a>,
                                  vars.convention);
        <a class="code" href="class_quant_lib_1_1_schedule.html" title="Payment schedule.">Schedule</a> schedule(startDate,maturity,
                          <a class="code" href="class_quant_lib_1_1_period.html">Period</a>(vars.frequency),vars.calendar,
                          vars.convention,vars.convention,
                          DateGeneration::Forward,<span class="keyword">false</span>);

        <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> j=0; j&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(strikes); j++) {
            <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> k=0; k&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(vols); k++) {
                boost::shared_ptr&lt;CapFloor&gt; cap =
                    vars.makeCapFloor(CapFloor::Cap, leg, strikes[j],vols[k]);
                boost::shared_ptr&lt;CapFloor&gt; floor =
                    vars.makeCapFloor(CapFloor::Floor, leg, strikes[j],vols[k]);
                <a class="code" href="namespace_quant_lib.html#a919ba3567cc89fca373f8d6b8e80126b" title="interest rates">Rate</a> capATMRate = cap-&gt;atmRate(**vars.termStructure);
                <a class="code" href="namespace_quant_lib.html#a919ba3567cc89fca373f8d6b8e80126b" title="interest rates">Rate</a> floorATMRate = floor-&gt;atmRate(**vars.termStructure);
                <span class="keywordflow">if</span> (!<a class="code" href="namespaceanonymous__namespace_02capfloor_8cpp_03.html#a4c4e355493e7ff65c2e575c827868a21">checkAbsError</a>(floorATMRate, capATMRate, 1.0e-10))
                    BOOST_FAIL(
                      <span class="stringliteral">&quot;Cap ATM Rate and floor ATM Rate should be equal :\n&quot;</span>
                      &lt;&lt; <span class="stringliteral">&quot;   length:        &quot;</span> &lt;&lt; lengths[i] &lt;&lt; <span class="stringliteral">&quot; years\n&quot;</span>
                      &lt;&lt; <span class="stringliteral">&quot;   volatility:    &quot;</span> &lt;&lt; <a class="code" href="group__manips.html#ga9890b88f8d11494a518492be973b9046" title="output volatilities as percentages">io::volatility</a>(vols[k]) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
                      &lt;&lt; <span class="stringliteral">&quot;   strike:        &quot;</span> &lt;&lt; <a class="code" href="group__manips.html#gac9152aad6a69c41f5d30bb1dcb9b2236" title="output rates and spreads as percentages">io::rate</a>(strikes[j]) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
                      &lt;&lt; <span class="stringliteral">&quot;   cap ATM rate:  &quot;</span> &lt;&lt; capATMRate &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
                      &lt;&lt; <span class="stringliteral">&quot;   floor ATM rate:&quot;</span> &lt;&lt; floorATMRate &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
                      &lt;&lt; <span class="stringliteral">&quot;   relative Error:&quot;</span>
                      &lt;&lt; <a class="code" href="namespace_quant_lib.html#aafcda44785eaeebddfc54147a234d11a">relativeError</a>(capATMRate, floorATMRate,
                                       capATMRate)*100 &lt;&lt; <span class="stringliteral">&quot;%&quot;</span> );
                <a class="code" href="class_quant_lib_1_1_vanilla_swap.html" title="Plain-vanilla swap: fix vs floating leg.">VanillaSwap</a> <a class="code" href="namespace_quant_lib.html#a68c12b666ea6ffeba405c5e5e5303b03">swap</a>(VanillaSwap::Payer, vars.nominals[0],
                                 schedule, floorATMRate,
                                 vars.index-&gt;dayCounter(),
                                 schedule, vars.index, 0.0,
                                 vars.index-&gt;dayCounter());
                <a class="code" href="namespace_quant_lib.html#a68c12b666ea6ffeba405c5e5e5303b03">swap</a>.setPricingEngine(boost::shared_ptr&lt;PricingEngine&gt;(
                              <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_discounting_swap_engine.html">DiscountingSwapEngine</a>(vars.termStructure)));
                <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> swapNPV = <a class="code" href="namespace_quant_lib.html#a68c12b666ea6ffeba405c5e5e5303b03">swap</a>.NPV();
                <span class="keywordflow">if</span> (!<a class="code" href="namespaceanonymous__namespace_02capfloor_8cpp_03.html#a4c4e355493e7ff65c2e575c827868a21">checkAbsError</a>(swapNPV, 0, 1.0e-10))
                    BOOST_FAIL(
                      <span class="stringliteral">&quot;the NPV of a Swap struck at ATM rate &quot;</span>
                      <span class="stringliteral">&quot;should be equal to 0:\n&quot;</span>
                      &lt;&lt; <span class="stringliteral">&quot;   length:        &quot;</span> &lt;&lt; lengths[i] &lt;&lt; <span class="stringliteral">&quot; years\n&quot;</span>
                      &lt;&lt; <span class="stringliteral">&quot;   volatility:    &quot;</span> &lt;&lt; <a class="code" href="group__manips.html#ga9890b88f8d11494a518492be973b9046" title="output volatilities as percentages">io::volatility</a>(vols[k]) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
                      &lt;&lt; <span class="stringliteral">&quot;   ATM rate:      &quot;</span> &lt;&lt; <a class="code" href="group__manips.html#gac9152aad6a69c41f5d30bb1dcb9b2236" title="output rates and spreads as percentages">io::rate</a>(floorATMRate) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
                      &lt;&lt; <span class="stringliteral">&quot;   swap NPV:      &quot;</span> &lt;&lt; swapNPV);
        }
      }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae92e6f355805a1eedddaa7860348ffbe"></a><!-- doxytag: member="CapFloorTest::testCachedValue" ref="ae92e6f355805a1eedddaa7860348ffbe" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_cap_floor_test.html#ae92e6f355805a1eedddaa7860348ffbe">CapFloorTest::testCachedValue</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2capfloor_8cpp_source.html#l00570">570</a> of file <a class="el" href="test-suite_2capfloor_8cpp_source.html">capfloor.cpp</a>.</p>

<p>References <a class="el" href="ql_2instruments_2capfloor_8hpp_source.html#l00056">QuantLib::CapFloor::Cap</a>, <a class="el" href="settings_8hpp_source.html#l00153">QuantLib::Settings::evaluationDate()</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00058">QuantLib::flatRate()</a>, <a class="el" href="ql_2instruments_2capfloor_8hpp_source.html#l00056">QuantLib::CapFloor::Floor</a>, <a class="el" href="class_quant_lib_1_1_singleton.html#ab79257029fa4841505227497a56cbd93">QuantLib::Singleton&lt; Settings &gt;::instance()</a>, <a class="el" href="date_8hpp_source.html#l00047">QuantLib::March</a>, and <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00124">anonymous_namespace{marketmodel.cpp}::startDate</a>.</p>

<p>Referenced by <a class="el" href="test-suite_2capfloor_8cpp_source.html#l00612">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                   {

    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing Black cap/floor price against cached values...&quot;</span>);

    CommonVars vars;

    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> cachedToday(14,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a982c9e93cf4b41f4b71b5c256df6191c">March</a>,2002),
         cachedSettlement(18,<a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a982c9e93cf4b41f4b71b5c256df6191c">March</a>,2002);
    Settings::instance().evaluationDate() = cachedToday;
    vars.termStructure.linkTo(<a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(cachedSettlement, 0.05, <a class="code" href="class_quant_lib_1_1_actual360.html" title="Actual/360 day count convention.">Actual360</a>()));
    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a5f839cd623254225993e6a977033e607">startDate</a> = vars.termStructure-&gt;referenceDate();
    <a class="code" href="namespace_quant_lib.html#abdb8d18844749e7614125fe36661bb11" title="Sequence of cash-flows.">Leg</a> leg = vars.makeLeg(startDate,20);
    boost::shared_ptr&lt;Instrument&gt; cap = vars.makeCapFloor(CapFloor::Cap,leg,
                                                          0.07,0.20);
    boost::shared_ptr&lt;Instrument&gt; floor = vars.makeCapFloor(CapFloor::Floor,leg,
                                                            0.03,0.20);
<span class="preprocessor">#ifndef QL_USE_INDEXED_COUPON</span>
<span class="preprocessor"></span>    <span class="comment">// par coupon price</span>
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> cachedCapNPV   = 6.87570026732,
         cachedFloorNPV = 2.65812927959;
<span class="preprocessor">#else</span>
<span class="preprocessor"></span>    <span class="comment">// index fixing price</span>
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> cachedCapNPV   = 6.87630307745,
         cachedFloorNPV = 2.65796764715;
<span class="preprocessor">#endif</span>
<span class="preprocessor"></span>    <span class="comment">// test Black cap price against cached value</span>
    <span class="keywordflow">if</span> (std::fabs(cap-&gt;NPV()-cachedCapNPV) &gt; 1.0e-11)
        BOOST_ERROR(
            <span class="stringliteral">&quot;failed to reproduce cached cap value:\n&quot;</span>
            &lt;&lt; std::setprecision(12)
            &lt;&lt; <span class="stringliteral">&quot;    calculated: &quot;</span> &lt;&lt; cap-&gt;NPV() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
            &lt;&lt; <span class="stringliteral">&quot;    expected:   &quot;</span> &lt;&lt; cachedCapNPV);
    <span class="comment">// test Black floor price against cached value</span>
    <span class="keywordflow">if</span> (std::fabs(floor-&gt;NPV()-cachedFloorNPV) &gt; 1.0e-11)
        BOOST_ERROR(
            <span class="stringliteral">&quot;failed to reproduce cached floor value:\n&quot;</span>
            &lt;&lt; std::setprecision(12)
            &lt;&lt; <span class="stringliteral">&quot;    calculated: &quot;</span> &lt;&lt; floor-&gt;NPV() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
            &lt;&lt; <span class="stringliteral">&quot;    expected:   &quot;</span> &lt;&lt; cachedFloorNPV);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1473b7e7604b2501f11684b59f21af3c"></a><!-- doxytag: member="CapFloorTest::testConsistency" ref="a1473b7e7604b2501f11684b59f21af3c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_cap_floor_test.html#a1473b7e7604b2501f11684b59f21af3c">CapFloorTest::testConsistency</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2capfloor_8cpp_source.html#l00257">257</a> of file <a class="el" href="test-suite_2capfloor_8cpp_source.html">capfloor.cpp</a>.</p>

<p>References <a class="el" href="ql_2instruments_2capfloor_8hpp_source.html#l00056">QuantLib::CapFloor::Cap</a>, <a class="el" href="ql_2instruments_2capfloor_8hpp_source.html#l00056">QuantLib::CapFloor::Floor</a>, <a class="el" href="test-suite_2utilities_8hpp_source.html#l00039">LENGTH</a>, <a class="el" href="test-suite_2swaption_8cpp_source.html#l00045">anonymous_namespace{swaption.cpp}::lengths</a>, <a class="el" href="instrument_8hpp_source.html#l00186">QuantLib::Instrument::NPV()</a>, <a class="el" href="ql_2instruments_2capfloor_8cpp_source.html#l00178">QuantLib::CapFloor::optionlet()</a>, <a class="el" href="dataformatters_8hpp_source.html#l00129">QuantLib::io::rate()</a>, <a class="el" href="instrument_8hpp_source.html#l00133">QuantLib::Instrument::setPricingEngine()</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00124">anonymous_namespace{marketmodel.cpp}::startDate</a>, and <a class="el" href="dataformatters_8hpp_source.html#l00133">QuantLib::io::volatility()</a>.</p>

<p>Referenced by <a class="el" href="test-suite_2capfloor_8cpp_source.html#l00612">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                   {

    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing consistency between cap, floor and collar...&quot;</span>);

    CommonVars vars;

    <a class="code" href="namespace_quant_lib.html#a8ac1a45a37d8d3dda438a2e59e222620" title="integer number">Integer</a> <a class="code" href="namespaceanonymous__namespace_02swaption_8cpp_03.html#ad503f595f6a4cbf42c9e537eb32a4369">lengths</a>[] = { 1, 2, 3, 5, 7, 10, 15, 20 };
    <a class="code" href="namespace_quant_lib.html#a919ba3567cc89fca373f8d6b8e80126b" title="interest rates">Rate</a> cap_rates[] = { 0.03, 0.04, 0.05, 0.06, 0.07 };
    <a class="code" href="namespace_quant_lib.html#a919ba3567cc89fca373f8d6b8e80126b" title="interest rates">Rate</a> floor_rates[] = { 0.03, 0.04, 0.05, 0.06, 0.07 };
    <a class="code" href="namespace_quant_lib.html#ae3abfa256de5aa2b506ab6bda014e4dc" title="volatility">Volatility</a> vols[] = { 0.01, 0.05, 0.10, 0.15, 0.20 };

    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a5f839cd623254225993e6a977033e607">startDate</a> = vars.termStructure-&gt;referenceDate();

    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(lengths); i++) {
      <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> j=0; j&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(cap_rates); j++) {
        <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> k=0; k&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(floor_rates); k++) {
          <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> l=0; l&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(vols); l++) {

              <a class="code" href="namespace_quant_lib.html#abdb8d18844749e7614125fe36661bb11" title="Sequence of cash-flows.">Leg</a> leg = vars.makeLeg(startDate,lengths[i]);
              boost::shared_ptr&lt;CapFloor&gt; cap =
                  vars.makeCapFloor(CapFloor::Cap,leg,
                                    cap_rates[j],vols[l]);
              boost::shared_ptr&lt;CapFloor&gt; floor =
                  vars.makeCapFloor(CapFloor::Floor,leg,
                                    floor_rates[k],vols[l]);
              <a class="code" href="class_quant_lib_1_1_collar.html" title="Concrete collar class.">Collar</a> collar(leg,std::vector&lt;Rate&gt;(1,cap_rates[j]),
                            std::vector&lt;Rate&gt;(1,floor_rates[k]));
              collar.setPricingEngine(vars.makeEngine(vols[l]));

              <span class="keywordflow">if</span> (std::fabs((cap-&gt;NPV()-floor-&gt;NPV())-collar.NPV()) &gt; 1e-10) {
                  BOOST_FAIL(
                    <span class="stringliteral">&quot;inconsistency between cap, floor and collar:\n&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;    length:       &quot;</span> &lt;&lt; lengths[i] &lt;&lt; <span class="stringliteral">&quot; years\n&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;    volatility:   &quot;</span> &lt;&lt; <a class="code" href="group__manips.html#ga9890b88f8d11494a518492be973b9046" title="output volatilities as percentages">io::volatility</a>(vols[l]) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;    cap value:    &quot;</span> &lt;&lt; cap-&gt;NPV()
                    &lt;&lt; <span class="stringliteral">&quot; at strike: &quot;</span> &lt;&lt; <a class="code" href="group__manips.html#gac9152aad6a69c41f5d30bb1dcb9b2236" title="output rates and spreads as percentages">io::rate</a>(cap_rates[j]) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;    floor value:  &quot;</span> &lt;&lt; floor-&gt;NPV()
                    &lt;&lt; <span class="stringliteral">&quot; at strike: &quot;</span> &lt;&lt; <a class="code" href="group__manips.html#gac9152aad6a69c41f5d30bb1dcb9b2236" title="output rates and spreads as percentages">io::rate</a>(floor_rates[k]) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;    collar value: &quot;</span> &lt;&lt; collar.NPV());


              <span class="comment">// test re-composition by optionlets, N.B. two per year</span>
              <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> capletsNPV = 0.0;
              std::vector&lt;boost::shared_ptr&lt;CapFloor&gt; &gt; caplets;
              <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#a8ac1a45a37d8d3dda438a2e59e222620" title="integer number">Integer</a> m=0; m&lt;lengths[i]*2; m++) {
                caplets.push_back(cap-&gt;optionlet(m));
                caplets[m]-&gt;setPricingEngine(vars.makeEngine(vols[l]));
                capletsNPV += caplets[m]-&gt;NPV();
              }

              <span class="keywordflow">if</span> (std::fabs(cap-&gt;NPV() - capletsNPV) &gt; 1e-10) {
                BOOST_FAIL(
                  <span class="stringliteral">&quot;sum of caplet NPVs does not equal cap NPV:\n&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;    length:       &quot;</span> &lt;&lt; lengths[i] &lt;&lt; <span class="stringliteral">&quot; years\n&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;    volatility:   &quot;</span> &lt;&lt; <a class="code" href="group__manips.html#ga9890b88f8d11494a518492be973b9046" title="output volatilities as percentages">io::volatility</a>(vols[l]) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;    cap value:    &quot;</span> &lt;&lt; cap-&gt;NPV()
                    &lt;&lt; <span class="stringliteral">&quot; at strike: &quot;</span> &lt;&lt; <a class="code" href="group__manips.html#gac9152aad6a69c41f5d30bb1dcb9b2236" title="output rates and spreads as percentages">io::rate</a>(cap_rates[j]) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;    sum of caplets value:  &quot;</span> &lt;&lt; capletsNPV
                    &lt;&lt; <span class="stringliteral">&quot; at strike (first): &quot;</span> &lt;&lt; <a class="code" href="group__manips.html#gac9152aad6a69c41f5d30bb1dcb9b2236" title="output rates and spreads as percentages">io::rate</a>(caplets[0]-&gt;capRates()[0]) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
                );
              }

              <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> floorletsNPV = 0.0;
              std::vector&lt;boost::shared_ptr&lt;CapFloor&gt; &gt; floorlets;
              <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#a8ac1a45a37d8d3dda438a2e59e222620" title="integer number">Integer</a> m=0; m&lt;lengths[i]*2; m++) {
                floorlets.push_back(floor-&gt;optionlet(m));
                floorlets[m]-&gt;setPricingEngine(vars.makeEngine(vols[l]));
                floorletsNPV += floorlets[m]-&gt;NPV();
              }

              <span class="keywordflow">if</span> (std::fabs(floor-&gt;NPV() - floorletsNPV) &gt; 1e-10) {
                BOOST_FAIL(
                  <span class="stringliteral">&quot;sum of floorlet NPVs does not equal floor NPV:\n&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;    length:       &quot;</span> &lt;&lt; lengths[i] &lt;&lt; <span class="stringliteral">&quot; years\n&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;    volatility:   &quot;</span> &lt;&lt; <a class="code" href="group__manips.html#ga9890b88f8d11494a518492be973b9046" title="output volatilities as percentages">io::volatility</a>(vols[l]) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;    cap value:    &quot;</span> &lt;&lt; floor-&gt;NPV()
                    &lt;&lt; <span class="stringliteral">&quot; at strike: &quot;</span> &lt;&lt; <a class="code" href="group__manips.html#gac9152aad6a69c41f5d30bb1dcb9b2236" title="output rates and spreads as percentages">io::rate</a>(floor_rates[j]) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;    sum of floorlets value:  &quot;</span> &lt;&lt; floorletsNPV
                    &lt;&lt; <span class="stringliteral">&quot; at strike (first): &quot;</span> &lt;&lt; <a class="code" href="group__manips.html#gac9152aad6a69c41f5d30bb1dcb9b2236" title="output rates and spreads as percentages">io::rate</a>(floorlets[0]-&gt;floorRates()[0]) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
                );
              }

              <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> collarletsNPV = 0.0;
              std::vector&lt;boost::shared_ptr&lt;CapFloor&gt; &gt; collarlets;
              <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#a8ac1a45a37d8d3dda438a2e59e222620" title="integer number">Integer</a> m=0; m&lt;lengths[i]*2; m++) {
                collarlets.push_back(collar.optionlet(m));
                collarlets[m]-&gt;setPricingEngine(vars.makeEngine(vols[l]));
                collarletsNPV += collarlets[m]-&gt;NPV();
              }

              <span class="keywordflow">if</span> (std::fabs(collar.NPV() - collarletsNPV) &gt; 1e-10) {
                BOOST_FAIL(
                  <span class="stringliteral">&quot;sum of collarlet NPVs does not equal floor NPV:\n&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;    length:       &quot;</span> &lt;&lt; lengths[i] &lt;&lt; <span class="stringliteral">&quot; years\n&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;    volatility:   &quot;</span> &lt;&lt; <a class="code" href="group__manips.html#ga9890b88f8d11494a518492be973b9046" title="output volatilities as percentages">io::volatility</a>(vols[l]) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;    cap value:    &quot;</span> &lt;&lt; collar.NPV()
                    &lt;&lt; <span class="stringliteral">&quot; at strike floor: &quot;</span> &lt;&lt; <a class="code" href="group__manips.html#gac9152aad6a69c41f5d30bb1dcb9b2236" title="output rates and spreads as percentages">io::rate</a>(floor_rates[j])
                    &lt;&lt; <span class="stringliteral">&quot; at strike cap: &quot;</span> &lt;&lt; <a class="code" href="group__manips.html#gac9152aad6a69c41f5d30bb1dcb9b2236" title="output rates and spreads as percentages">io::rate</a>(cap_rates[j]) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;    sum of collarlets value:  &quot;</span> &lt;&lt; collarletsNPV
                    &lt;&lt; <span class="stringliteral">&quot; at strike floor (first): &quot;</span> &lt;&lt; <a class="code" href="group__manips.html#gac9152aad6a69c41f5d30bb1dcb9b2236" title="output rates and spreads as percentages">io::rate</a>(collarlets[0]-&gt;floorRates()[0])
                    &lt;&lt; <span class="stringliteral">&quot; at strike cap (first): &quot;</span> &lt;&lt; <a class="code" href="group__manips.html#gac9152aad6a69c41f5d30bb1dcb9b2236" title="output rates and spreads as percentages">io::rate</a>(collarlets[0]-&gt;capRates()[0]) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
                );
              }




              }
          }
        }
      }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7570a1138d55d0b4af37b810f9bd5e33"></a><!-- doxytag: member="CapFloorTest::testImpliedVolatility" ref="a7570a1138d55d0b4af37b810f9bd5e33" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_cap_floor_test.html#a7570a1138d55d0b4af37b810f9bd5e33">CapFloorTest::testImpliedVolatility</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2capfloor_8cpp_source.html#l00484">484</a> of file <a class="el" href="test-suite_2capfloor_8cpp_source.html">capfloor.cpp</a>.</p>

<p>References <a class="el" href="ql_2instruments_2capfloor_8hpp_source.html#l00056">QuantLib::CapFloor::Cap</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00058">QuantLib::flatRate()</a>, <a class="el" href="ql_2instruments_2capfloor_8hpp_source.html#l00056">QuantLib::CapFloor::Floor</a>, <a class="el" href="test-suite_2utilities_8hpp_source.html#l00039">LENGTH</a>, <a class="el" href="test-suite_2swaption_8cpp_source.html#l00045">anonymous_namespace{swaption.cpp}::lengths</a>, <a class="el" href="dataformatters_8hpp_source.html#l00129">QuantLib::io::rate()</a>, <a class="el" href="test-suite_2gaussianquadratures_8cpp_source.html#l00032">anonymous_namespace{gaussianquadratures.cpp}::tolerance</a>, <a class="el" href="test-suite_2capfloor_8cpp_source.html#l00124">anonymous_namespace{capfloor.cpp}::typeToString()</a>, <a class="el" href="perturbativebarrieroptionengine_8cpp_source.html#l00433">anonymous_namespace{perturbativebarrieroptionengine.cpp}::v()</a>, and <a class="el" href="dataformatters_8hpp_source.html#l00133">QuantLib::io::volatility()</a>.</p>

<p>Referenced by <a class="el" href="test-suite_2capfloor_8cpp_source.html#l00612">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                         {

    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing implied term volatility for cap and floor...&quot;</span>);

    CommonVars vars;

    <a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> maxEvaluations = 100;
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> <a class="code" href="namespaceanonymous__namespace_02gaussianquadratures_8cpp_03.html#a0f4d3028fdc8cebd7d9c568c16754cab">tolerance</a> = 1.0e-8;

    <a class="code" href="class_quant_lib_1_1_cap_floor.html#acb87beb1b21d83b5a1a252f69c4ce09c">CapFloor::Type</a> types[] = { CapFloor::Cap, CapFloor::Floor };
    <a class="code" href="namespace_quant_lib.html#a919ba3567cc89fca373f8d6b8e80126b" title="interest rates">Rate</a> strikes[] = { 0.02, 0.03, 0.04 };
    <a class="code" href="namespace_quant_lib.html#a8ac1a45a37d8d3dda438a2e59e222620" title="integer number">Integer</a> <a class="code" href="namespaceanonymous__namespace_02swaption_8cpp_03.html#ad503f595f6a4cbf42c9e537eb32a4369">lengths</a>[] = { 1, 5, 10 };

    <span class="comment">// test data</span>
    <a class="code" href="namespace_quant_lib.html#a919ba3567cc89fca373f8d6b8e80126b" title="interest rates">Rate</a> rRates[] = { 0.02, 0.03, 0.04, 0.05, 0.06, 0.07 };
    <a class="code" href="namespace_quant_lib.html#ae3abfa256de5aa2b506ab6bda014e4dc" title="volatility">Volatility</a> vols[] = { 0.01, 0.05, 0.10, 0.20, 0.30, 0.70, 0.90 };

    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> k=0; k&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(lengths); k++) {
        <a class="code" href="namespace_quant_lib.html#abdb8d18844749e7614125fe36661bb11" title="Sequence of cash-flows.">Leg</a> leg = vars.makeLeg(vars.settlement, lengths[k]);

        <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(types); i++) {
            <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> j=0; j&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(strikes); j++) {

                boost::shared_ptr&lt;CapFloor&gt; capfloor =
                    vars.makeCapFloor(types[i], leg, strikes[j], 0.0);

                <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> n=0; n&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(rRates); n++) {
                    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> m=0; m&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(vols); m++) {

                        <a class="code" href="namespace_quant_lib.html#a919ba3567cc89fca373f8d6b8e80126b" title="interest rates">Rate</a> r = rRates[n];
                        <a class="code" href="namespace_quant_lib.html#ae3abfa256de5aa2b506ab6bda014e4dc" title="volatility">Volatility</a> <a class="code" href="namespaceanonymous__namespace_02perturbativebarrieroptionengine_8cpp_03.html#a1c6cf95dc58d77fbce730d3c1f8ccda7">v</a> = vols[m];
                        vars.termStructure.linkTo(<a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(vars.settlement,r,
                                                       <a class="code" href="class_quant_lib_1_1_actual360.html" title="Actual/360 day count convention.">Actual360</a>()));
                        capfloor-&gt;setPricingEngine(vars.makeEngine(v));

                        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> value = capfloor-&gt;NPV();
                        <a class="code" href="namespace_quant_lib.html#ae3abfa256de5aa2b506ab6bda014e4dc" title="volatility">Volatility</a> implVol = 0.0;
                        <span class="keywordflow">try</span> {
                            implVol =
                                capfloor-&gt;impliedVolatility(value,
                                                            vars.termStructure,
                                                            0.10,
                                                            tolerance,
                                                            maxEvaluations);
                        } <span class="keywordflow">catch</span> (std::exception&amp; e) {
                            <span class="comment">// couldn&#39;t bracket?</span>
                            capfloor-&gt;setPricingEngine(vars.makeEngine(0.0));
                            <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> value2 = capfloor-&gt;NPV();
                            <span class="keywordflow">if</span> (std::fabs(value-value2) &lt; tolerance) {
                                <span class="comment">// ok, just skip:</span>
                                <span class="keywordflow">continue</span>;
                            }
                            <span class="comment">// otherwise, report error</span>
                            BOOST_ERROR(<span class="stringliteral">&quot;implied vol failure: &quot;</span> &lt;&lt;
                                        <a class="code" href="namespaceanonymous__namespace_02capfloor_8cpp_03.html#a79a82814d31c1558a30a85b49d806452">typeToString</a>(types[i]) &lt;&lt;
                                        <span class="stringliteral">&quot;\n  strike:     &quot;</span> &lt;&lt; <a class="code" href="group__manips.html#gac9152aad6a69c41f5d30bb1dcb9b2236" title="output rates and spreads as percentages">io::rate</a>(strikes[j]) &lt;&lt;
                                        <span class="stringliteral">&quot;\n  risk-free:  &quot;</span> &lt;&lt; <a class="code" href="group__manips.html#gac9152aad6a69c41f5d30bb1dcb9b2236" title="output rates and spreads as percentages">io::rate</a>(r) &lt;&lt;
                                        <span class="stringliteral">&quot;\n  length:     &quot;</span> &lt;&lt; lengths[k] &lt;&lt; <span class="stringliteral">&quot;Y&quot;</span> &lt;&lt;
                                        <span class="stringliteral">&quot;\n  volatility: &quot;</span> &lt;&lt; <a class="code" href="group__manips.html#ga9890b88f8d11494a518492be973b9046" title="output volatilities as percentages">io::volatility</a>(v) &lt;&lt;
                                        <span class="stringliteral">&quot;\n  price:      &quot;</span> &lt;&lt; value &lt;&lt;
                                        <span class="stringliteral">&quot;\n&quot;</span> &lt;&lt; e.what());
                        }
                        <span class="keywordflow">if</span> (std::fabs(implVol-v) &gt; <a class="code" href="namespaceanonymous__namespace_02gaussianquadratures_8cpp_03.html#a0f4d3028fdc8cebd7d9c568c16754cab">tolerance</a>) {
                            <span class="comment">// the difference might not matter</span>
                            capfloor-&gt;setPricingEngine(
                                                    vars.makeEngine(implVol));
                            <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> value2 = capfloor-&gt;NPV();
                            <span class="keywordflow">if</span> (std::fabs(value-value2) &gt; tolerance) {
                            BOOST_FAIL(<span class="stringliteral">&quot;implied vol failure: &quot;</span> &lt;&lt;
                                       <a class="code" href="namespaceanonymous__namespace_02capfloor_8cpp_03.html#a79a82814d31c1558a30a85b49d806452">typeToString</a>(types[i]) &lt;&lt;
                                       <span class="stringliteral">&quot;\n  strike:        &quot;</span> &lt;&lt; <a class="code" href="group__manips.html#gac9152aad6a69c41f5d30bb1dcb9b2236" title="output rates and spreads as percentages">io::rate</a>(strikes[j]) &lt;&lt;
                                       <span class="stringliteral">&quot;\n  risk-free:     &quot;</span> &lt;&lt; <a class="code" href="group__manips.html#gac9152aad6a69c41f5d30bb1dcb9b2236" title="output rates and spreads as percentages">io::rate</a>(r) &lt;&lt;
                                       <span class="stringliteral">&quot;\n  length:        &quot;</span> &lt;&lt; lengths[k] &lt;&lt; <span class="stringliteral">&quot;Y&quot;</span> &lt;&lt;
                                       <span class="stringliteral">&quot;\n  volatility:    &quot;</span> &lt;&lt; <a class="code" href="group__manips.html#ga9890b88f8d11494a518492be973b9046" title="output volatilities as percentages">io::volatility</a>(v) &lt;&lt;
                                       <span class="stringliteral">&quot;\n  price:         &quot;</span> &lt;&lt; value &lt;&lt;
                                       <span class="stringliteral">&quot;\n  implied vol:   &quot;</span> &lt;&lt; <a class="code" href="group__manips.html#ga9890b88f8d11494a518492be973b9046" title="output volatilities as percentages">io::volatility</a>(implVol) &lt;&lt;
                                       <span class="stringliteral">&quot;\n  implied price: &quot;</span> &lt;&lt; value2);
                            }
                        }
                    }
                }
            }
        }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a171c951ce1c0db55a61ae3428f45deb6"></a><!-- doxytag: member="CapFloorTest::testParity" ref="a171c951ce1c0db55a61ae3428f45deb6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_cap_floor_test.html#a171c951ce1c0db55a61ae3428f45deb6">CapFloorTest::testParity</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2capfloor_8cpp_source.html#l00371">371</a> of file <a class="el" href="test-suite_2capfloor_8cpp_source.html">capfloor.cpp</a>.</p>

<p>References <a class="el" href="date_8cpp_source.html#l00151">QuantLib::Date::advance()</a>, <a class="el" href="ql_2instruments_2capfloor_8hpp_source.html#l00056">QuantLib::CapFloor::Cap</a>, <a class="el" href="ql_2instruments_2capfloor_8hpp_source.html#l00056">QuantLib::CapFloor::Floor</a>, <a class="el" href="dategenerationrule_8hpp_source.html#l00043">QuantLib::DateGeneration::Forward</a>, <a class="el" href="test-suite_2utilities_8hpp_source.html#l00039">LENGTH</a>, <a class="el" href="test-suite_2swaption_8cpp_source.html#l00045">anonymous_namespace{swaption.cpp}::lengths</a>, <a class="el" href="vanillaswap_8hpp_source.html#l00067">QuantLib::VanillaSwap::Payer</a>, <a class="el" href="dataformatters_8hpp_source.html#l00129">QuantLib::io::rate()</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00124">anonymous_namespace{marketmodel.cpp}::startDate</a>, <a class="el" href="complexarray_8hpp_source.html#l00547">QuantLib::swap()</a>, <a class="el" href="dataformatters_8hpp_source.html#l00133">QuantLib::io::volatility()</a>, and <a class="el" href="timeunit_8hpp_source.html#l00040">QuantLib::Years</a>.</p>

<p>Referenced by <a class="el" href="test-suite_2capfloor_8cpp_source.html#l00612">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                              {

    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing cap/floor parity...&quot;</span>);

    CommonVars vars;

    <a class="code" href="namespace_quant_lib.html#a8ac1a45a37d8d3dda438a2e59e222620" title="integer number">Integer</a> <a class="code" href="namespaceanonymous__namespace_02swaption_8cpp_03.html#ad503f595f6a4cbf42c9e537eb32a4369">lengths</a>[] = { 1, 2, 3, 5, 7, 10, 15, 20 };
    <a class="code" href="namespace_quant_lib.html#a919ba3567cc89fca373f8d6b8e80126b" title="interest rates">Rate</a> strikes[] = { 0., 0.03, 0.04, 0.05, 0.06, 0.07 };
    <a class="code" href="namespace_quant_lib.html#ae3abfa256de5aa2b506ab6bda014e4dc" title="volatility">Volatility</a> vols[] = { 0.01, 0.05, 0.10, 0.15, 0.20 };

    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a5f839cd623254225993e6a977033e607">startDate</a> = vars.termStructure-&gt;referenceDate();

    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(lengths); i++) {
      <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> j=0; j&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(strikes); j++) {
        <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> k=0; k&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(vols); k++) {

            <a class="code" href="namespace_quant_lib.html#abdb8d18844749e7614125fe36661bb11" title="Sequence of cash-flows.">Leg</a> leg = vars.makeLeg(startDate,lengths[i]);
            boost::shared_ptr&lt;Instrument&gt; cap =
                vars.makeCapFloor(CapFloor::Cap,leg,
                                  strikes[j],vols[k]);
            boost::shared_ptr&lt;Instrument&gt; floor =
                vars.makeCapFloor(CapFloor::Floor,leg,
                                  strikes[j],vols[k]);
            <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> maturity = vars.calendar.<a class="code" href="class_quant_lib_1_1_date.html#a0eb2b32bac68e01a7eab2a47e3b2f1c0">advance</a>(startDate,lengths[i],<a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3ae2d856134531729a1696e66bebeafb32">Years</a>,
                                              vars.convention);
            <a class="code" href="class_quant_lib_1_1_schedule.html" title="Payment schedule.">Schedule</a> schedule(startDate,maturity,
                              <a class="code" href="class_quant_lib_1_1_period.html">Period</a>(vars.frequency),vars.calendar,
                              vars.convention,vars.convention,
                              DateGeneration::Forward,<span class="keyword">false</span>);
            <a class="code" href="class_quant_lib_1_1_vanilla_swap.html" title="Plain-vanilla swap: fix vs floating leg.">VanillaSwap</a> <a class="code" href="namespace_quant_lib.html#a68c12b666ea6ffeba405c5e5e5303b03">swap</a>(VanillaSwap::Payer, vars.nominals[0],
                             schedule, strikes[j], vars.index-&gt;dayCounter(),
                             schedule, vars.index, 0.0,
                             vars.index-&gt;dayCounter());
            <a class="code" href="namespace_quant_lib.html#a68c12b666ea6ffeba405c5e5e5303b03">swap</a>.setPricingEngine(boost::shared_ptr&lt;PricingEngine&gt;(
                              <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_discounting_swap_engine.html">DiscountingSwapEngine</a>(vars.termStructure)));
            <span class="comment">// FLOATING_POINT_EXCEPTION</span>
            <span class="keywordflow">if</span> (std::fabs((cap-&gt;NPV()-floor-&gt;NPV()) - <a class="code" href="namespace_quant_lib.html#a68c12b666ea6ffeba405c5e5e5303b03">swap</a>.NPV()) &gt; 1.0e-10) {
                BOOST_FAIL(
                    <span class="stringliteral">&quot;put/call parity violated:\n&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;    length:      &quot;</span> &lt;&lt; lengths[i] &lt;&lt; <span class="stringliteral">&quot; years\n&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;    volatility:  &quot;</span> &lt;&lt; <a class="code" href="group__manips.html#ga9890b88f8d11494a518492be973b9046" title="output volatilities as percentages">io::volatility</a>(vols[k]) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;    strike:      &quot;</span> &lt;&lt; <a class="code" href="group__manips.html#gac9152aad6a69c41f5d30bb1dcb9b2236" title="output rates and spreads as percentages">io::rate</a>(strikes[j]) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;    cap value:   &quot;</span> &lt;&lt; cap-&gt;NPV() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;    floor value: &quot;</span> &lt;&lt; floor-&gt;NPV() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;    swap value:  &quot;</span> &lt;&lt; <a class="code" href="namespace_quant_lib.html#a68c12b666ea6ffeba405c5e5e5303b03">swap</a>.NPV());
            }
        }
      }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7cf31b254cd4d8c46a136fd6f5c2925f"></a><!-- doxytag: member="CapFloorTest::testStrikeDependency" ref="a7cf31b254cd4d8c46a136fd6f5c2925f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_cap_floor_test.html#a7cf31b254cd4d8c46a136fd6f5c2925f">CapFloorTest::testStrikeDependency</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2capfloor_8cpp_source.html#l00195">195</a> of file <a class="el" href="test-suite_2capfloor_8cpp_source.html">capfloor.cpp</a>.</p>

<p>References <a class="el" href="ql_2instruments_2capfloor_8hpp_source.html#l00056">QuantLib::CapFloor::Cap</a>, <a class="el" href="ql_2instruments_2capfloor_8hpp_source.html#l00056">QuantLib::CapFloor::Floor</a>, <a class="el" href="test-suite_2utilities_8hpp_source.html#l00039">LENGTH</a>, <a class="el" href="test-suite_2swaption_8cpp_source.html#l00045">anonymous_namespace{swaption.cpp}::lengths</a>, <a class="el" href="dataformatters_8hpp_source.html#l00129">QuantLib::io::rate()</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00124">anonymous_namespace{marketmodel.cpp}::startDate</a>, and <a class="el" href="dataformatters_8hpp_source.html#l00133">QuantLib::io::volatility()</a>.</p>

<p>Referenced by <a class="el" href="test-suite_2capfloor_8cpp_source.html#l00612">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                        {

    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing cap/floor dependency on strike...&quot;</span>);

    CommonVars vars;

    <a class="code" href="namespace_quant_lib.html#a8ac1a45a37d8d3dda438a2e59e222620" title="integer number">Integer</a> <a class="code" href="namespaceanonymous__namespace_02swaption_8cpp_03.html#ad503f595f6a4cbf42c9e537eb32a4369">lengths</a>[] = { 1, 2, 3, 5, 7, 10, 15, 20 };
    <a class="code" href="namespace_quant_lib.html#ae3abfa256de5aa2b506ab6bda014e4dc" title="volatility">Volatility</a> vols[] = { 0.01, 0.05, 0.10, 0.15, 0.20 };
    <a class="code" href="namespace_quant_lib.html#a919ba3567cc89fca373f8d6b8e80126b" title="interest rates">Rate</a> strikes[] = { 0.03, 0.04, 0.05, 0.06, 0.07 };

    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a5f839cd623254225993e6a977033e607">startDate</a> = vars.termStructure-&gt;referenceDate();

    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(lengths); i++) {
        <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> j=0; j&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(vols); j++) {
            <span class="comment">// store the results for different strikes...</span>
            std::vector&lt;Real&gt; cap_values, floor_values;
            <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> k=0; k&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(strikes); k++) {
                <a class="code" href="namespace_quant_lib.html#abdb8d18844749e7614125fe36661bb11" title="Sequence of cash-flows.">Leg</a> leg = vars.makeLeg(startDate,lengths[i]);
                boost::shared_ptr&lt;Instrument&gt; cap =
                    vars.makeCapFloor(CapFloor::Cap,leg,
                                      strikes[k],vols[j]);
                cap_values.push_back(cap-&gt;NPV());
                boost::shared_ptr&lt;Instrument&gt; floor =
                    vars.makeCapFloor(CapFloor::Floor,leg,
                                      strikes[k],vols[j]);
                floor_values.push_back(floor-&gt;NPV());
            }
            <span class="comment">// and check that they go the right way</span>
            std::vector&lt;Real&gt;::iterator it =
                std::adjacent_find(cap_values.begin(),cap_values.end(),
                                   std::less&lt;Real&gt;());
            <span class="keywordflow">if</span> (it != cap_values.end()) {
                <a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> n = it - cap_values.begin();
                BOOST_FAIL(
                    <span class="stringliteral">&quot;NPV is increasing with the strike in a cap: \n&quot;</span>
                    &lt;&lt; std::setprecision(2)
                    &lt;&lt; <span class="stringliteral">&quot;    length:     &quot;</span> &lt;&lt; lengths[i] &lt;&lt; <span class="stringliteral">&quot; years\n&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;    volatility: &quot;</span> &lt;&lt; <a class="code" href="group__manips.html#ga9890b88f8d11494a518492be973b9046" title="output volatilities as percentages">io::volatility</a>(vols[j]) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;    value:      &quot;</span> &lt;&lt; cap_values[n]
                    &lt;&lt; <span class="stringliteral">&quot; at strike: &quot;</span> &lt;&lt; <a class="code" href="group__manips.html#gac9152aad6a69c41f5d30bb1dcb9b2236" title="output rates and spreads as percentages">io::rate</a>(strikes[n]) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;    value:      &quot;</span> &lt;&lt; cap_values[n+1]
                    &lt;&lt; <span class="stringliteral">&quot; at strike: &quot;</span> &lt;&lt; <a class="code" href="group__manips.html#gac9152aad6a69c41f5d30bb1dcb9b2236" title="output rates and spreads as percentages">io::rate</a>(strikes[n+1]));
            }
            <span class="comment">// same for floors</span>
            it = std::adjacent_find(floor_values.begin(),floor_values.end(),
                                    std::greater&lt;Real&gt;());
            <span class="keywordflow">if</span> (it != floor_values.end()) {
                <a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> n = it - floor_values.begin();
                BOOST_FAIL(
                    <span class="stringliteral">&quot;NPV is decreasing with the strike in a floor: \n&quot;</span>
                    &lt;&lt; std::setprecision(2)
                    &lt;&lt; <span class="stringliteral">&quot;    length:     &quot;</span> &lt;&lt; lengths[i] &lt;&lt; <span class="stringliteral">&quot; years\n&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;    volatility: &quot;</span> &lt;&lt; <a class="code" href="group__manips.html#ga9890b88f8d11494a518492be973b9046" title="output volatilities as percentages">io::volatility</a>(vols[j]) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;    value:      &quot;</span> &lt;&lt; floor_values[n]
                    &lt;&lt; <span class="stringliteral">&quot; at strike: &quot;</span> &lt;&lt; <a class="code" href="group__manips.html#gac9152aad6a69c41f5d30bb1dcb9b2236" title="output rates and spreads as percentages">io::rate</a>(strikes[n]) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;    value:      &quot;</span> &lt;&lt; floor_values[n+1]
                    &lt;&lt; <span class="stringliteral">&quot; at strike: &quot;</span> &lt;&lt; <a class="code" href="group__manips.html#gac9152aad6a69c41f5d30bb1dcb9b2236" title="output rates and spreads as percentages">io::rate</a>(strikes[n+1]));
            }
        }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3fbdef65bd0746e69ad91f18524f45b6"></a><!-- doxytag: member="CapFloorTest::testVega" ref="a3fbdef65bd0746e69ad91f18524f45b6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_cap_floor_test.html#a3fbdef65bd0746e69ad91f18524f45b6">CapFloorTest::testVega</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2capfloor_8cpp_source.html#l00140">140</a> of file <a class="el" href="test-suite_2capfloor_8cpp_source.html">capfloor.cpp</a>.</p>

<p>References <a class="el" href="ql_2instruments_2capfloor_8hpp_source.html#l00056">QuantLib::CapFloor::Cap</a>, <a class="el" href="ql_2instruments_2capfloor_8hpp_source.html#l00056">QuantLib::CapFloor::Floor</a>, <a class="el" href="test-suite_2utilities_8hpp_source.html#l00039">LENGTH</a>, <a class="el" href="test-suite_2swaption_8cpp_source.html#l00045">anonymous_namespace{swaption.cpp}::lengths</a>, <a class="el" href="test-suite_2utilities_8hpp_source.html#l00047">QL_FIXED</a>, <a class="el" href="dataformatters_8hpp_source.html#l00129">QuantLib::io::rate()</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00124">anonymous_namespace{marketmodel.cpp}::startDate</a>, <a class="el" href="test-suite_2gaussianquadratures_8cpp_source.html#l00032">anonymous_namespace{gaussianquadratures.cpp}::tolerance</a>, and <a class="el" href="timeunit_8hpp_source.html#l00040">QuantLib::Years</a>.</p>

<p>Referenced by <a class="el" href="test-suite_2capfloor_8cpp_source.html#l00612">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                            {

    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing cap/floor vega...&quot;</span>);

    CommonVars vars;

    <a class="code" href="namespace_quant_lib.html#a8ac1a45a37d8d3dda438a2e59e222620" title="integer number">Integer</a> <a class="code" href="namespaceanonymous__namespace_02swaption_8cpp_03.html#ad503f595f6a4cbf42c9e537eb32a4369">lengths</a>[] = { 1, 2, 3, 4, 5, 6, 7, 10, 15, 20, 30 };
    <a class="code" href="namespace_quant_lib.html#ae3abfa256de5aa2b506ab6bda014e4dc" title="volatility">Volatility</a> vols[] = { 0.01, 0.05, 0.10, 0.15, 0.20 };
    <a class="code" href="namespace_quant_lib.html#a919ba3567cc89fca373f8d6b8e80126b" title="interest rates">Rate</a> strikes[] = { 0.01, 0.02, 0.03, 0.04, 0.05, 0.06, 0.07, 0.08, 0.09 };
    <a class="code" href="class_quant_lib_1_1_cap_floor.html#acb87beb1b21d83b5a1a252f69c4ce09c">CapFloor::Type</a> types[] = { CapFloor::Cap, CapFloor::Floor};

    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a5f839cd623254225993e6a977033e607">startDate</a> = vars.termStructure-&gt;referenceDate();
    <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> shift = 1e-8;
    <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> <a class="code" href="namespaceanonymous__namespace_02gaussianquadratures_8cpp_03.html#a0f4d3028fdc8cebd7d9c568c16754cab">tolerance</a> = 0.005;

    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(lengths); i++) {
        <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> j=0; j&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(vols); j++) {
            <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> k=0; k&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(strikes); k++) {
                <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> h=0; h&lt;<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(types); h++) {
                    <a class="code" href="namespace_quant_lib.html#abdb8d18844749e7614125fe36661bb11" title="Sequence of cash-flows.">Leg</a> leg = vars.makeLeg(startDate, lengths[i]);
                    boost::shared_ptr&lt;CapFloor&gt; capFloor =
                        vars.makeCapFloor(types[h],leg,
                                          strikes[k],vols[j]);
                    boost::shared_ptr&lt;CapFloor&gt; shiftedCapFloor2 =
                        vars.makeCapFloor(types[h],leg,
                                          strikes[k],vols[j]+shift);
                     boost::shared_ptr&lt;CapFloor&gt; shiftedCapFloor1 =
                        vars.makeCapFloor(types[h],leg,
                                          strikes[k],vols[j]-shift);
                    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> value1 = shiftedCapFloor1-&gt;NPV();
                    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> value2 = shiftedCapFloor2-&gt;NPV();
                    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> numericalVega = (value2 - value1) / (2*shift);
                    <span class="keywordflow">if</span> (numericalVega&gt;1.0e-4) {
                        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> analyticalVega = capFloor-&gt;result&lt;<a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a>&gt;(<span class="stringliteral">&quot;vega&quot;</span>);
                        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> discrepancy =
                            std::fabs(numericalVega - analyticalVega);
                        discrepancy /= numericalVega;
                        <span class="keywordflow">if</span> (discrepancy &gt; tolerance)
                            BOOST_FAIL(
                                <span class="stringliteral">&quot;failed to compute cap/floor vega:&quot;</span> &lt;&lt;
                                <span class="stringliteral">&quot;\n   lengths:     &quot;</span> &lt;&lt; lengths[j]*<a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3ae2d856134531729a1696e66bebeafb32">Years</a> &lt;&lt;
                                <span class="stringliteral">&quot;\n   strike:      &quot;</span> &lt;&lt; <a class="code" href="group__manips.html#gac9152aad6a69c41f5d30bb1dcb9b2236" title="output rates and spreads as percentages">io::rate</a>(strikes[k]) &lt;&lt;
                                <span class="comment">//&quot;\n   types:       &quot; &lt;&lt; types[h] &lt;&lt;</span>
                                <a class="code" href="test-suite_2utilities_8hpp.html#a474537ac904cd54ef53b96dbb95548b0">QL_FIXED</a> &lt;&lt; std::setprecision(12) &lt;&lt;
                                <span class="stringliteral">&quot;\n   calculated:  &quot;</span> &lt;&lt; analyticalVega &lt;&lt;
                                <span class="stringliteral">&quot;\n   expected:    &quot;</span> &lt;&lt; numericalVega &lt;&lt;
                                <span class="stringliteral">&quot;\n   discrepancy: &quot;</span> &lt;&lt; <a class="code" href="group__manips.html#gac9152aad6a69c41f5d30bb1dcb9b2236" title="output rates and spreads as percentages">io::rate</a>(discrepancy) &lt;&lt;
                                <span class="stringliteral">&quot;\n   tolerance:   &quot;</span> &lt;&lt; <a class="code" href="group__manips.html#gac9152aad6a69c41f5d30bb1dcb9b2236" title="output rates and spreads as percentages">io::rate</a>(tolerance));
                     }
                }
            }
        }
    }
}
</pre></div>
</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/home/deriversatile/QuantLib/QuantLibQt/test-suite/<a class="el" href="test-suite_2capfloor_8hpp_source.html">capfloor.hpp</a></li>
<li>/home/deriversatile/QuantLib/QuantLibQt/test-suite/<a class="el" href="test-suite_2capfloor_8cpp_source.html">capfloor.cpp</a></li>
</ul>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="class_cap_floor_test.html">CapFloorTest</a>      </li>

    <li class="footer">Generated on Sat Aug 25 2012 13:51:00 for QuantLib by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
