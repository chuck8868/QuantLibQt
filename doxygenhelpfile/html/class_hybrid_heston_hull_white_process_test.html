<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>QuantLib: HybridHestonHullWhiteProcessTest Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">QuantLib
   &#160;<span id="projectnumber">1.3</span>
   </div>
   <div id="projectbrief">ql1-3</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="dynsections.js"></script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('class_hybrid_heston_hull_white_process_test.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-static-methods">Static Public Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">HybridHestonHullWhiteProcessTest Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="HybridHestonHullWhiteProcessTest" -->
<p><code>#include &lt;<a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8hpp_source.html">hybridhestonhullwhiteprocess.hpp</a>&gt;</code></p>

<p><a href="class_hybrid_heston_hull_white_process_test-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hybrid_heston_hull_white_process_test.html#a0763c2be18c006dde19cb1b657b35a64">testBsmHullWhiteEngine</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hybrid_heston_hull_white_process_test.html#a8b0ff4563302e7ec333888646cb539ff">testCompareBsmHWandHestonHW</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hybrid_heston_hull_white_process_test.html#a8fe611b184813d440398e8a9e0511d4b">testZeroBondPricing</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hybrid_heston_hull_white_process_test.html#a7fa250948076d9acf06d4aaab9b65e8a">testMcVanillaPricing</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hybrid_heston_hull_white_process_test.html#acc2fbb9b3b86099e432533e89c09096e">testMcPureHestonPricing</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hybrid_heston_hull_white_process_test.html#aa8acb961e66963bcef326d0d67c00964">testAnalyticHestonHullWhitePricing</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hybrid_heston_hull_white_process_test.html#ad3c9adbaa569f956b2636bb3a924cde0">testCallableEquityPricing</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hybrid_heston_hull_white_process_test.html#acd8dcf93ea0cbb21657290419e19da29">testDiscretizationError</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hybrid_heston_hull_white_process_test.html#a9f7602624202d6eb86a4f3d2b81f391d">testFdmHestonHullWhiteEngine</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hybrid_heston_hull_white_process_test.html#a1b0d89b6767fb329341b849a69a3efe0">testBsmHullWhitePricing</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hybrid_heston_hull_white_process_test.html#ab010c40b341593c66ba5dcb6ea038c40">testSpatialDiscretizatinError</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hybrid_heston_hull_white_process_test.html#a6127f45f96e8afc9667669000b7e161d">testHestonHullWhiteCalibration</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <br class="typebreak"/>
boost::unit_test_framework::test_suite *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hybrid_heston_hull_white_process_test.html#abd39d614b8ecca85549098f38ddda7c1">suite</a> ()</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8hpp_source.html#l00028">28</a> of file <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8hpp_source.html">hybridhestonhullwhiteprocess.hpp</a>.</p>
</div><hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="abd39d614b8ecca85549098f38ddda7c1"></a><!-- doxytag: member="HybridHestonHullWhiteProcessTest::suite" ref="abd39d614b8ecca85549098f38ddda7c1" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">test_suite * <a class="el" href="class_hybrid_heston_hull_white_process_test.html#abd39d614b8ecca85549098f38ddda7c1">HybridHestonHullWhiteProcessTest::suite</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l01422">1422</a> of file <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html">hybridhestonhullwhiteprocess.cpp</a>.</p>

<p>References <a class="el" href="test-suite_2utilities_8hpp_source.html#l00061">QUANTLIB_TEST_CASE</a>, <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l00565">testAnalyticHestonHullWhitePricing()</a>, <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l00058">testBsmHullWhiteEngine()</a>, <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l01044">testBsmHullWhitePricing()</a>, <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l00656">testCallableEquityPricing()</a>, <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l00155">testCompareBsmHWandHestonHW()</a>, <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l00771">testDiscretizationError()</a>, <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l00867">testFdmHestonHullWhiteEngine()</a>, <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l01223">testHestonHullWhiteCalibration()</a>, <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l00473">testMcPureHestonPricing()</a>, <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l00375">testMcVanillaPricing()</a>, <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l01134">testSpatialDiscretizatinError()</a>, and <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l00255">testZeroBondPricing()</a>.</p>

<p>Referenced by <a class="el" href="quantlibtestsuite_8cpp_source.html#l00206">init_unit_test_suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                                    {
    test_suite* <a class="code" href="class_hybrid_heston_hull_white_process_test.html#abd39d614b8ecca85549098f38ddda7c1">suite</a> = BOOST_TEST_SUITE(<span class="stringliteral">&quot;Hybrid Heston-HullWhite tests&quot;</span>);

    <span class="comment">// FLOATING_POINT_EXCEPTION</span>
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(
        &amp;<a class="code" href="class_hybrid_heston_hull_white_process_test.html#a0763c2be18c006dde19cb1b657b35a64">HybridHestonHullWhiteProcessTest::testBsmHullWhiteEngine</a>));
    <span class="comment">// FLOATING_POINT_EXCEPTION</span>
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(
        &amp;<a class="code" href="class_hybrid_heston_hull_white_process_test.html#a8b0ff4563302e7ec333888646cb539ff">HybridHestonHullWhiteProcessTest::testCompareBsmHWandHestonHW</a>));
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(
        &amp;<a class="code" href="class_hybrid_heston_hull_white_process_test.html#a8fe611b184813d440398e8a9e0511d4b">HybridHestonHullWhiteProcessTest::testZeroBondPricing</a>));
    <span class="comment">// FLOATING_POINT_EXCEPTION</span>
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(
        &amp;<a class="code" href="class_hybrid_heston_hull_white_process_test.html#a7fa250948076d9acf06d4aaab9b65e8a">HybridHestonHullWhiteProcessTest::testMcVanillaPricing</a>));
    <span class="comment">// FLOATING_POINT_EXCEPTION</span>
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(
        &amp;<a class="code" href="class_hybrid_heston_hull_white_process_test.html#acc2fbb9b3b86099e432533e89c09096e">HybridHestonHullWhiteProcessTest::testMcPureHestonPricing</a>));
    <span class="comment">// FLOATING_POINT_EXCEPTION</span>
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(
      &amp;<a class="code" href="class_hybrid_heston_hull_white_process_test.html#aa8acb961e66963bcef326d0d67c00964">HybridHestonHullWhiteProcessTest::testAnalyticHestonHullWhitePricing</a>));
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(
        &amp;<a class="code" href="class_hybrid_heston_hull_white_process_test.html#ad3c9adbaa569f956b2636bb3a924cde0">HybridHestonHullWhiteProcessTest::testCallableEquityPricing</a>));
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(
        &amp;<a class="code" href="class_hybrid_heston_hull_white_process_test.html#acd8dcf93ea0cbb21657290419e19da29">HybridHestonHullWhiteProcessTest::testDiscretizationError</a>));
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(
        &amp;<a class="code" href="class_hybrid_heston_hull_white_process_test.html#a9f7602624202d6eb86a4f3d2b81f391d">HybridHestonHullWhiteProcessTest::testFdmHestonHullWhiteEngine</a>));
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(
        &amp;<a class="code" href="class_hybrid_heston_hull_white_process_test.html#a6127f45f96e8afc9667669000b7e161d">HybridHestonHullWhiteProcessTest::testHestonHullWhiteCalibration</a>));
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(
        &amp;<a class="code" href="class_hybrid_heston_hull_white_process_test.html#a1b0d89b6767fb329341b849a69a3efe0">HybridHestonHullWhiteProcessTest::testBsmHullWhitePricing</a>));
    suite-&gt;add(<a class="code" href="test-suite_2utilities_8hpp.html#a80550c9c9a7264738072a40a2fc8fd8d">QUANTLIB_TEST_CASE</a>(
        &amp;<a class="code" href="class_hybrid_heston_hull_white_process_test.html#ab010c40b341593c66ba5dcb6ea038c40">HybridHestonHullWhiteProcessTest::testSpatialDiscretizatinError</a>));

    <span class="keywordflow">return</span> <a class="code" href="class_hybrid_heston_hull_white_process_test.html#abd39d614b8ecca85549098f38ddda7c1">suite</a>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa8acb961e66963bcef326d0d67c00964"></a><!-- doxytag: member="HybridHestonHullWhiteProcessTest::testAnalyticHestonHullWhitePricing" ref="aa8acb961e66963bcef326d0d67c00964" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_hybrid_heston_hull_white_process_test.html#aa8acb961e66963bcef326d0d67c00964">HybridHestonHullWhiteProcessTest::testAnalyticHestonHullWhitePricing</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l00565">565</a> of file <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html">hybridhestonhullwhiteprocess.cpp</a>.</p>

<p>References <a class="el" href="option_8hpp_source.html#l00039">QuantLib::Option::Call</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00125">anonymous_namespace{marketmodel.cpp}::dates</a>, <a class="el" href="instrument_8hpp_source.html#l00192">QuantLib::Instrument::errorEstimate()</a>, <a class="el" href="ql_2processes_2hybridhestonhullwhiteprocess_8hpp_source.html#l00044">QuantLib::HybridHestonHullWhiteProcess::Euler</a>, <a class="el" href="settings_8hpp_source.html#l00153">QuantLib::Settings::evaluationDate()</a>, <a class="el" href="class_quant_lib_1_1_singleton.html#ab79257029fa4841505227497a56cbd93">QuantLib::Singleton&lt; Settings &gt;::instance()</a>, <a class="el" href="test-suite_2utilities_8hpp_source.html#l00039">LENGTH</a>, <a class="el" href="instrument_8hpp_source.html#l00186">QuantLib::Instrument::NPV()</a>, <a class="el" href="option_8hpp_source.html#l00038">QuantLib::Option::Put</a>, <a class="el" href="instrument_8hpp_source.html#l00133">QuantLib::Instrument::setPricingEngine()</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00124">anonymous_namespace{marketmodel.cpp}::todaysDate</a>, <a class="el" href="daycounter_8hpp_source.html#l00126">QuantLib::DayCounter::yearFraction()</a>, and <a class="el" href="timeunit_8hpp_source.html#l00040">QuantLib::Years</a>.</p>

<p>Referenced by <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l01422">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                                                          {
    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing analytic Heston Hull-White option pricing...&quot;</span>);

    <a class="code" href="class_quant_lib_1_1_saved_settings.html">SavedSettings</a> backup;

    <a class="code" href="class_quant_lib_1_1_day_counter.html" title="day counter class">DayCounter</a> dc = <a class="code" href="class_quant_lib_1_1_actual360.html" title="Actual/360 day count convention.">Actual360</a>();
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> today = <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#ae1b42c838cf0f4cf17262f0b22bac899">Date::todaysDate</a>();

    Settings::instance().evaluationDate() = today;

    <span class="comment">// construct a strange yield curve to check drifts and discounting</span>
    <span class="comment">// of the joint stochastic process</span>

    std::vector&lt;Date&gt; <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a800db345cacda47dd48925126ea05f91">dates</a>;
    std::vector&lt;Time&gt; times;
    std::vector&lt;Rate&gt; rates, divRates;

    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i &lt;= 40; ++i) {
        dates.push_back(today+<a class="code" href="class_quant_lib_1_1_period.html">Period</a>(i, <a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3ae2d856134531729a1696e66bebeafb32">Years</a>));
        <span class="comment">// FLOATING_POINT_EXCEPTION</span>
        rates.push_back(0.03 + 0.0001*std::exp(std::sin(i/4.0)));
        divRates.push_back(0.02 + 0.0002*std::exp(std::sin(i/3.0)));
        times.push_back(dc.<a class="code" href="class_quant_lib_1_1_day_counter.html#aba442c829252ee786e1b4ea3d0f04bd9" title="Returns the period between two dates as a fraction of year.">yearFraction</a>(today, dates.back()));
    }

    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> maturity = today + <a class="code" href="class_quant_lib_1_1_period.html">Period</a>(5, <a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3ae2d856134531729a1696e66bebeafb32">Years</a>);
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;Quote&gt;</a> s0(boost::shared_ptr&lt;Quote&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(100)));
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> rTS(
       boost::shared_ptr&lt;YieldTermStructure&gt;(<span class="keyword">new</span> <a class="code" href="namespace_quant_lib.html#aba455dd6323746ed70a64eb4fa65c276" title="Term structure based on linear interpolation of zero yields.">ZeroCurve</a>(dates, rates, dc)));
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> qTS(
       boost::shared_ptr&lt;YieldTermStructure&gt;(
                                          <span class="keyword">new</span> <a class="code" href="namespace_quant_lib.html#aba455dd6323746ed70a64eb4fa65c276" title="Term structure based on linear interpolation of zero yields.">ZeroCurve</a>(dates, divRates, dc)));

    <span class="keyword">const</span> boost::shared_ptr&lt;HestonProcess&gt; hestonProcess(
            <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_process.html" title="Square-root stochastic-volatility Heston process.">HestonProcess</a>(rTS, qTS, s0, 0.08, 1.5, 0.0625, 0.5, -0.8));
    <span class="keyword">const</span> boost::shared_ptr&lt;HestonModel&gt; hestonModel(
                                            <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_model.html" title="Heston model for the stochastic volatility of an asset.">HestonModel</a>(hestonProcess));

    <span class="keyword">const</span> boost::shared_ptr&lt;HullWhiteForwardProcess&gt; hwFwdProcess(
              <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_hull_white_forward_process.html" title="Forward Hull-White stochastic process">HullWhiteForwardProcess</a>(rTS, 0.01, 0.01));
    hwFwdProcess-&gt;setForwardMeasureTime(dc.<a class="code" href="class_quant_lib_1_1_day_counter.html#aba442c829252ee786e1b4ea3d0f04bd9" title="Returns the period between two dates as a fraction of year.">yearFraction</a>(today, maturity));
    <span class="keyword">const</span> boost::shared_ptr&lt;HullWhite&gt; hullWhiteModel(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_hull_white.html" title="Single-factor Hull-White (extended Vasicek) model class.">HullWhite</a>(
                               rTS, hwFwdProcess-&gt;a(), hwFwdProcess-&gt;sigma()));

    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> tol = 0.001;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> strike[] = { 80, 120 };
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_option.html#abaee7fc605354c444867545492cd5845">Option::Type</a> types[] = { Option::Put, Option::Call };

    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i &lt; <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(types); ++i) {
        <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> j=0; j &lt; <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(strike); ++j) {
            boost::shared_ptr&lt;HybridHestonHullWhiteProcess&gt; jointProcess(
                <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_hybrid_heston_hull_white_process.html" title="Hybrid Heston Hull-White stochastic process.">HybridHestonHullWhiteProcess</a>(
                        hestonProcess, hwFwdProcess, 0.0,
                        HybridHestonHullWhiteProcess::Euler));

            boost::shared_ptr&lt;StrikedTypePayoff&gt; payoff(
                               <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_plain_vanilla_payoff.html" title="Plain-vanilla payoff.">PlainVanillaPayoff</a>(types[i], strike[j]));
            boost::shared_ptr&lt;Exercise&gt; exercise(
                               <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_european_exercise.html" title="European exercise.">EuropeanExercise</a>(maturity));

            <a class="code" href="class_quant_lib_1_1_vanilla_option.html" title="Vanilla option (no discrete dividends, no barriers) on a single asset.">VanillaOption</a> optionHestonHW(payoff, exercise);
            optionHestonHW.setPricingEngine(
                    <a class="code" href="class_quant_lib_1_1_make_m_c_heston_hull_white_engine.html" title="Monte Carlo Heston/Hull-White engine factory.">MakeMCHestonHullWhiteEngine&lt;PseudoRandom&gt;</a>(jointProcess)
                    .withSteps(1)
                    .withAntitheticVariate()
                    .withControlVariate()
                    .withAbsoluteTolerance(tol)
                    .withSeed(42));

            <a class="code" href="class_quant_lib_1_1_vanilla_option.html" title="Vanilla option (no discrete dividends, no barriers) on a single asset.">VanillaOption</a> optionPureHeston(payoff, exercise);
            optionPureHeston.setPricingEngine(
                boost::shared_ptr&lt;PricingEngine&gt;(
                    <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_analytic_heston_hull_white_engine.html" title="Analytic Heston engine incl. stochastic interest rates.">AnalyticHestonHullWhiteEngine</a>(hestonModel,
                                                      hullWhiteModel, 192)));

            <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> calculated = optionHestonHW.NPV();
            <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> error      = optionHestonHW.errorEstimate();
            <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> expected   = optionPureHeston.NPV();

            <span class="keywordflow">if</span> (   std::fabs(calculated - expected) &gt; 3*error
                &amp;&amp; std::fabs(calculated - expected) &gt; tol) {
                BOOST_ERROR(<span class="stringliteral">&quot;Failed to reproduce hw heston vanilla prices&quot;</span>
                        &lt;&lt; <span class="stringliteral">&quot;\n   strike:     &quot;</span> &lt;&lt; strike[j]
                        &lt;&lt; <span class="stringliteral">&quot;\n   calculated: &quot;</span> &lt;&lt; calculated
                        &lt;&lt; <span class="stringliteral">&quot;\n   error:      &quot;</span> &lt;&lt; error
                        &lt;&lt; <span class="stringliteral">&quot;\n   expected:   &quot;</span> &lt;&lt; expected);
            }
        }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0763c2be18c006dde19cb1b657b35a64"></a><!-- doxytag: member="HybridHestonHullWhiteProcessTest::testBsmHullWhiteEngine" ref="a0763c2be18c006dde19cb1b657b35a64" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_hybrid_heston_hull_white_process_test.html#a0763c2be18c006dde19cb1b657b35a64">HybridHestonHullWhiteProcessTest::testBsmHullWhiteEngine</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l00058">58</a> of file <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html">hybridhestonhullwhiteprocess.cpp</a>.</p>

<p>References <a class="el" href="option_8hpp_source.html#l00039">QuantLib::Option::Call</a>, <a class="el" href="oneassetoption_8cpp_source.html#l00037">QuantLib::OneAssetOption::delta()</a>, <a class="el" href="settings_8hpp_source.html#l00153">QuantLib::Settings::evaluationDate()</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00058">QuantLib::flatRate()</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00086">QuantLib::flatVol()</a>, <a class="el" href="oneassetoption_8cpp_source.html#l00056">QuantLib::OneAssetOption::gamma()</a>, <a class="el" href="vanillaoption_8cpp_source.html#l00038">QuantLib::VanillaOption::impliedVolatility()</a>, <a class="el" href="class_quant_lib_1_1_singleton.html#ab79257029fa4841505227497a56cbd93">QuantLib::Singleton&lt; Settings &gt;::instance()</a>, <a class="el" href="test-suite_2utilities_8hpp_source.html#l00039">LENGTH</a>, <a class="el" href="instrument_8hpp_source.html#l00186">QuantLib::Instrument::NPV()</a>, <a class="el" href="instrument_8hpp_source.html#l00133">QuantLib::Instrument::setPricingEngine()</a>, <a class="el" href="oneassetoption_8cpp_source.html#l00062">QuantLib::OneAssetOption::theta()</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00124">anonymous_namespace{marketmodel.cpp}::todaysDate</a>, <a class="el" href="oneassetoption_8cpp_source.html#l00074">QuantLib::OneAssetOption::vega()</a>, and <a class="el" href="timeunit_8hpp_source.html#l00040">QuantLib::Years</a>.</p>

<p>Referenced by <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l01422">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                                              {
    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing European option pricing for a BSM process&quot;</span>
                  <span class="stringliteral">&quot; with one-factor Hull-White model...&quot;</span>);

    <a class="code" href="class_quant_lib_1_1_saved_settings.html">SavedSettings</a> backup;

    <a class="code" href="class_quant_lib_1_1_day_counter.html" title="day counter class">DayCounter</a> dc = <a class="code" href="class_quant_lib_1_1_actual365_fixed.html" title="Actual/365 (Fixed) day count convention.">Actual365Fixed</a>();

    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> today = <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#ae1b42c838cf0f4cf17262f0b22bac899">Date::todaysDate</a>();
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> maturity = today + <a class="code" href="class_quant_lib_1_1_period.html">Period</a>(20, <a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3ae2d856134531729a1696e66bebeafb32">Years</a>);

    Settings::instance().evaluationDate() = today;

    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;Quote&gt;</a> spot(
                         boost::shared_ptr&lt;Quote&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(100.0)));
    boost::shared_ptr&lt;SimpleQuote&gt; qRate(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(0.04));
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> qTS(<a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(today, qRate, dc));
    boost::shared_ptr&lt;SimpleQuote&gt; rRate(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(0.0525));
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> rTS(<a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(today, rRate, dc));
    boost::shared_ptr&lt;SimpleQuote&gt; vol(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(0.25));
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;BlackVolTermStructure&gt;</a> volTS(<a class="code" href="namespace_quant_lib.html#a589d5c4b0b60b0bdd42ae07d820b2ed3">flatVol</a>(today, vol, dc));

    <span class="comment">// FLOATING_POINT_EXCEPTION</span>
    boost::shared_ptr&lt;HullWhite&gt; hullWhiteModel(
        <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_hull_white.html" title="Single-factor Hull-White (extended Vasicek) model class.">HullWhite</a>(<a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a>(rTS), 0.00883, 0.00526));

    boost::shared_ptr&lt;BlackScholesMertonProcess&gt; stochProcess(
                      <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_black_scholes_merton_process.html" title="Merton (1973) extension to the Black-Scholes stochastic process.">BlackScholesMertonProcess</a>(spot, qTS, rTS, volTS));

    boost::shared_ptr&lt;Exercise&gt; exercise(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_european_exercise.html" title="European exercise.">EuropeanExercise</a>(maturity));

    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> fwd = spot-&gt;value()*qTS-&gt;discount(maturity)/rTS-&gt;discount(maturity);
    boost::shared_ptr&lt;StrikedTypePayoff&gt; payoff(<span class="keyword">new</span>
                                      <a class="code" href="class_quant_lib_1_1_plain_vanilla_payoff.html" title="Plain-vanilla payoff.">PlainVanillaPayoff</a>(Option::Call, fwd));

    <a class="code" href="class_quant_lib_1_1_european_option.html" title="European option on a single asset.">EuropeanOption</a> option(payoff, exercise);

    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> tol = 1e-8;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> corr[] = {-0.75, -0.25, 0.0, 0.25, 0.75 };
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#ae3abfa256de5aa2b506ab6bda014e4dc" title="volatility">Volatility</a> expectedVol[] = { 0.217064577, 0.243995801,
                                       0.256402830, 0.268236596, 0.290461343 };

    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i &lt; <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(corr); ++i) {
        boost::shared_ptr&lt;PricingEngine&gt; bsmhwEngine(
                         <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_analytic_b_s_m_hull_white_engine.html" title="analytic european option pricer including stochastic interest rates">AnalyticBSMHullWhiteEngine</a>(corr[i], stochProcess,
                                                        hullWhiteModel));

        option.setPricingEngine(bsmhwEngine);
        <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> npv = option.NPV();

        <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;BlackVolTermStructure&gt;</a> compVolTS(
                                        <a class="code" href="namespace_quant_lib.html#a589d5c4b0b60b0bdd42ae07d820b2ed3">flatVol</a>(today, expectedVol[i], dc));

        boost::shared_ptr&lt;BlackScholesMertonProcess&gt; bsProcess(
                    <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_black_scholes_merton_process.html" title="Merton (1973) extension to the Black-Scholes stochastic process.">BlackScholesMertonProcess</a>(spot, qTS, rTS, compVolTS));
        boost::shared_ptr&lt;PricingEngine&gt; bsEngine(
                                       <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_analytic_european_engine.html" title="Pricing engine for European vanilla options using analytical formulae.">AnalyticEuropeanEngine</a>(bsProcess));

        <a class="code" href="class_quant_lib_1_1_european_option.html" title="European option on a single asset.">EuropeanOption</a> comp(payoff, exercise);
        comp.setPricingEngine(bsEngine);

        <a class="code" href="namespace_quant_lib.html#ae3abfa256de5aa2b506ab6bda014e4dc" title="volatility">Volatility</a> impliedVol =
            comp.impliedVolatility(npv, bsProcess, 1e-10, 100);

        <span class="keywordflow">if</span> (std::fabs(impliedVol - expectedVol[i]) &gt; tol) {
            BOOST_FAIL(<span class="stringliteral">&quot;Failed to reproduce implied volatility&quot;</span>
                       &lt;&lt; <span class="stringliteral">&quot;\n    calculated: &quot;</span> &lt;&lt; impliedVol
                       &lt;&lt; <span class="stringliteral">&quot;\n    expected  : &quot;</span> &lt;&lt; expectedVol[i]);
        }
        <span class="keywordflow">if</span> (std::fabs((comp.NPV() - npv)/npv) &gt; tol) {
            BOOST_FAIL(<span class="stringliteral">&quot;Failed to reproduce NPV&quot;</span>
                       &lt;&lt; <span class="stringliteral">&quot;\n    calculated: &quot;</span> &lt;&lt; npv
                       &lt;&lt; <span class="stringliteral">&quot;\n    expected  : &quot;</span> &lt;&lt; comp.NPV());
        }
        <span class="keywordflow">if</span> (std::fabs(comp.delta() - option.delta()) &gt; tol) {
            BOOST_FAIL(<span class="stringliteral">&quot;Failed to reproduce NPV&quot;</span>
                       &lt;&lt; <span class="stringliteral">&quot;\n    calculated: &quot;</span> &lt;&lt; npv
                       &lt;&lt; <span class="stringliteral">&quot;\n    expected  : &quot;</span> &lt;&lt; comp.NPV());
        }
        <span class="keywordflow">if</span> (std::fabs((comp.gamma() - option.gamma())/npv) &gt; tol) {
            BOOST_FAIL(<span class="stringliteral">&quot;Failed to reproduce NPV&quot;</span>
                       &lt;&lt; <span class="stringliteral">&quot;\n    calculated: &quot;</span> &lt;&lt; npv
                       &lt;&lt; <span class="stringliteral">&quot;\n    expected  : &quot;</span> &lt;&lt; comp.NPV());
        }
        <span class="keywordflow">if</span> (std::fabs((comp.theta() - option.theta())/npv) &gt; tol) {
            BOOST_FAIL(<span class="stringliteral">&quot;Failed to reproduce NPV&quot;</span>
                       &lt;&lt; <span class="stringliteral">&quot;\n    calculated: &quot;</span> &lt;&lt; npv
                       &lt;&lt; <span class="stringliteral">&quot;\n    expected  : &quot;</span> &lt;&lt; comp.NPV());
        }
        <span class="keywordflow">if</span> (std::fabs((comp.vega() - option.vega())/npv) &gt; tol) {
            BOOST_FAIL(<span class="stringliteral">&quot;Failed to reproduce NPV&quot;</span>
                       &lt;&lt; <span class="stringliteral">&quot;\n    calculated: &quot;</span> &lt;&lt; npv
                       &lt;&lt; <span class="stringliteral">&quot;\n    expected  : &quot;</span> &lt;&lt; comp.NPV());
        }
   }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1b0d89b6767fb329341b849a69a3efe0"></a><!-- doxytag: member="HybridHestonHullWhiteProcessTest::testBsmHullWhitePricing" ref="a1b0d89b6767fb329341b849a69a3efe0" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_hybrid_heston_hull_white_process_test.html#a1b0d89b6767fb329341b849a69a3efe0">HybridHestonHullWhiteProcessTest::testBsmHullWhitePricing</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l01044">1044</a> of file <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html">hybridhestonhullwhiteprocess.cpp</a>.</p>

<p>References <a class="el" href="option_8hpp_source.html#l00039">QuantLib::Option::Call</a>, <a class="el" href="date_8hpp_source.html#l00056">QuantLib::December</a>, <a class="el" href="settings_8hpp_source.html#l00153">QuantLib::Settings::evaluationDate()</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00086">QuantLib::flatVol()</a>, <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l00991">anonymous_namespace{hybridhestonhullwhiteprocess.cpp}::hullWhiteModels</a>, <a class="el" href="class_quant_lib_1_1_singleton.html#ab79257029fa4841505227497a56cbd93">QuantLib::Singleton&lt; Settings &gt;::instance()</a>, <a class="el" href="test-suite_2utilities_8hpp_source.html#l00039">LENGTH</a>, <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l01015">anonymous_namespace{hybridhestonhullwhiteprocess.cpp}::makeHestonProcess()</a>, <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l01030">anonymous_namespace{hybridhestonhullwhiteprocess.cpp}::makeVanillaOption()</a>, <a class="el" href="qldefines_8hpp_source.html#l00135">QL_EPSILON</a>, and <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l01001">anonymous_namespace{hybridhestonhullwhiteprocess.cpp}::schemes</a>.</p>

<p>Referenced by <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l01422">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                                               {
    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing convergence speed of Heston-Hull-White engine...&quot;</span>);
    
    <a class="code" href="class_quant_lib_1_1_saved_settings.html">SavedSettings</a> backup;
    
    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> today(27, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4ad4988bf6760edb92c088bb47d4b61dc5">December</a>, 2004);
    Settings::instance().evaluationDate() = today;

    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> maturity = 5.0;
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> equityIrCorr = -0.4;
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> strikes[] = {75,85,90,95,100,105,110,115,120,125,130,140,150};
    <a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> listOfTimeStepsPerYear[] = { 20 };

    HestonModelData hestonModelData 
        = { <span class="stringliteral">&quot;BSM-HW Model&quot;</span>, 0.09, 1.0, 0.09, <a class="code" href="group__limit_macros.html#ga4f2e6bcf6b19224bce1a5a6234286c17">QL_EPSILON</a>, 0.0, 0.04, 0.03 };
    HullWhiteModelData hwModelData = <a class="code" href="namespaceanonymous__namespace_02hybridhestonhullwhiteprocess_8cpp_03.html#aaf13a7613af2bb57ca7da066c5f5432a">hullWhiteModels</a>[0];
    <span class="keywordtype">bool</span> controlVariate[] = { <span class="keyword">true</span>, <span class="keyword">false</span> };

    boost::shared_ptr&lt;HestonProcess&gt; hp(<a class="code" href="namespaceanonymous__namespace_02hybridhestonhullwhiteprocess_8cpp_03.html#af2b555ca19d8f5d47cfadd6d04089f54">makeHestonProcess</a>(hestonModelData));
    boost::shared_ptr&lt;HestonModel&gt; hestonModel(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_model.html" title="Heston model for the stochastic volatility of an asset.">HestonModel</a>(hp));
    
    boost::shared_ptr&lt;HullWhiteProcess&gt; hwProcess(
        <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_hull_white_process.html" title="Hull-White stochastic process.">HullWhiteProcess</a>(hp-&gt;riskFreeRate(),
                             hwModelData.a, hwModelData.sigma));
    boost::shared_ptr&lt;HullWhite&gt; hullWhiteModel(
        <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_hull_white.html" title="Single-factor Hull-White (extended Vasicek) model class.">HullWhite</a>(hp-&gt;riskFreeRate(), 
                      hwProcess-&gt;a(), hwProcess-&gt;sigma()));


    boost::shared_ptr&lt;BlackScholesMertonProcess&gt; bsmProcess(
        <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_black_scholes_merton_process.html" title="Merton (1973) extension to the Black-Scholes stochastic process.">BlackScholesMertonProcess</a>(
            hp-&gt;s0(), hp-&gt;dividendYield(), hp-&gt;riskFreeRate(), 
            <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;BlackVolTermStructure&gt;</a>(
                <a class="code" href="namespace_quant_lib.html#a589d5c4b0b60b0bdd42ae07d820b2ed3">flatVol</a>(today, std::sqrt(hestonModelData.theta),
                        hp-&gt;riskFreeRate()-&gt;dayCounter()))));
    
    boost::shared_ptr&lt;PricingEngine&gt; bsmhwEngine(
                     <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_analytic_b_s_m_hull_white_engine.html" title="analytic european option pricer including stochastic interest rates">AnalyticBSMHullWhiteEngine</a>(equityIrCorr, bsmProcess,
                                                    hullWhiteModel));
    
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> tolWithCV[]    = { 2e-4, 2e-4, 2e-4, 2e-4, 0.01 };
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> tolWithOutCV[] = { 5e-3, 5e-3, 5e-3, 5e-3, 0.02 };
    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> l=0; l &lt; <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(<a class="code" href="namespaceanonymous__namespace_02hybridhestonhullwhiteprocess_8cpp_03.html#a0924164a332bb279b968d047a7f4dad5">schemes</a>); ++l) {
        SchemeData scheme = <a class="code" href="namespaceanonymous__namespace_02hybridhestonhullwhiteprocess_8cpp_03.html#a0924164a332bb279b968d047a7f4dad5">schemes</a>[l];
        <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i &lt; <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(controlVariate); ++i) {
            <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> u=0; u &lt; <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(listOfTimeStepsPerYear); ++u) {
                <a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> tSteps = <a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a>(maturity*listOfTimeStepsPerYear[u]);
    
                boost::shared_ptr&lt;FdHestonHullWhiteVanillaEngine&gt; fdEngine(
                    <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_fd_heston_hull_white_vanilla_engine.html" title="Finite-Differences Heston Hull-White Vanilla Option engine.">FdHestonHullWhiteVanillaEngine</a>(
                                    hestonModel, hwProcess, equityIrCorr,  
                                    tSteps, 400, 2, 10, 0, controlVariate[i],
                                    scheme.schemeDesc));
                fdEngine-&gt;enableMultipleStrikesCaching(
                    std::vector&lt;Real&gt;(strikes, strikes + <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(strikes)));
    
                <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> avgPriceDiff = 0.0;
                <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> k=0; k &lt; <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(strikes); ++k) {
                    VanillaOptionData optionData 
                                  = { strikes[k], maturity, Option::Call }; 
                    boost::shared_ptr&lt;VanillaOption&gt; option 
                                        = <a class="code" href="namespaceanonymous__namespace_02hybridhestonhullwhiteprocess_8cpp_03.html#a361df59d90c358f6a2d051102fd78694">makeVanillaOption</a>(optionData);
                    option-&gt;setPricingEngine(bsmhwEngine);
                    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> expected = option-&gt;NPV();
     
                    option-&gt;setPricingEngine(fdEngine);
                    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> calculated = option-&gt;NPV();
                    avgPriceDiff
                        +=std::fabs(expected-calculated)/<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(strikes);
                }
                
                <span class="keywordflow">if</span> (controlVariate[i] &amp;&amp; tolWithCV[l] &lt; avgPriceDiff) {
                     BOOST_ERROR(<span class="stringliteral">&quot;Failed to reproduce BSM-Hull-White prices&quot;</span>
                             &lt;&lt; <span class="stringliteral">&quot;\n   scheme       : &quot;</span> &lt;&lt; scheme.name
                             &lt;&lt; <span class="stringliteral">&quot;\n   model        : &quot;</span> &lt;&lt; hestonModelData.name
                             &lt;&lt; <span class="stringliteral">&quot;\n   CV           : on&quot;</span>);                     
                }
                
                
                <span class="keywordflow">if</span> (!controlVariate[i] &amp;&amp; tolWithOutCV[l] &lt; avgPriceDiff) {
                    BOOST_ERROR(<span class="stringliteral">&quot;Failed to reproduce BSM-Hull-White prices&quot;</span>
                            &lt;&lt; <span class="stringliteral">&quot;\n   scheme       : &quot;</span> &lt;&lt; scheme.name
                            &lt;&lt; <span class="stringliteral">&quot;\n   model        : &quot;</span> &lt;&lt; hestonModelData.name
                            &lt;&lt; <span class="stringliteral">&quot;\n   CV           : off&quot;</span>);                     
                }
            }
        }    
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="ad3c9adbaa569f956b2636bb3a924cde0"></a><!-- doxytag: member="HybridHestonHullWhiteProcessTest::testCallableEquityPricing" ref="ad3c9adbaa569f956b2636bb3a924cde0" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_hybrid_heston_hull_white_process_test.html#ad3c9adbaa569f956b2636bb3a924cde0">HybridHestonHullWhiteProcessTest::testCallableEquityPricing</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l00656">656</a> of file <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html">hybridhestonhullwhiteprocess.cpp</a>.</p>

<p>References <a class="el" href="generalstatistics_8hpp_source.html#l00222">QuantLib::GeneralStatistics::add()</a>, <a class="el" href="multipathgenerator_8hpp_source.html#l00098">QuantLib::MultiPathGenerator&lt; GSG &gt;::antithetic()</a>, <a class="el" href="ql_2time_2schedule_8hpp_source.html#l00082">QuantLib::Schedule::begin()</a>, <a class="el" href="ql_2time_2schedule_8hpp_source.html#l00083">QuantLib::Schedule::end()</a>, <a class="el" href="generalstatistics_8hpp_source.html#l00205">QuantLib::GeneralStatistics::errorEstimate()</a>, <a class="el" href="settings_8hpp_source.html#l00153">QuantLib::Settings::evaluationDate()</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00058">QuantLib::flatRate()</a>, <a class="el" href="businessdayconvention_8hpp_source.html#l00042">QuantLib::Following</a>, <a class="el" href="dategenerationrule_8hpp_source.html#l00043">QuantLib::DateGeneration::Forward</a>, <a class="el" href="class_quant_lib_1_1_singleton.html#ab79257029fa4841505227497a56cbd93">QuantLib::Singleton&lt; Settings &gt;::instance()</a>, <a class="el" href="ql_2math_2randomnumbers_2rngtraits_8hpp_source.html#l00052">QuantLib::GenericPseudoRandom&lt; URNG, IC &gt;::make_sequence_generator()</a>, <a class="el" href="generalstatistics_8cpp_source.html#l00035">QuantLib::GeneralStatistics::mean()</a>, <a class="el" href="multipathgenerator_8hpp_source.html#l00092">QuantLib::MultiPathGenerator&lt; GSG &gt;::next()</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00124">anonymous_namespace{marketmodel.cpp}::todaysDate</a>, <a class="el" href="daycounter_8hpp_source.html#l00126">QuantLib::DayCounter::yearFraction()</a>, and <a class="el" href="timeunit_8hpp_source.html#l00040">QuantLib::Years</a>.</p>

<p>Referenced by <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l01422">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                                                 {
    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing the pricing of a callable equity product...&quot;</span>);

    <a class="code" href="class_quant_lib_1_1_saved_settings.html">SavedSettings</a> backup;

    <span class="comment">/*</span>
<span class="comment">       For the definition of the example product see</span>
<span class="comment">       Alexander Giese, On the Pricing of Auto-Callable Equity</span>
<span class="comment">       Structures in the Presence of Stochastic Volatility and</span>
<span class="comment">       Stochastic Interest Rates .</span>
<span class="comment">       http://workshop.mathfinance.de/2006/papers/giese/slides.pdf</span>
<span class="comment">    */</span>

    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> maturity = 7;
    <a class="code" href="class_quant_lib_1_1_day_counter.html" title="day counter class">DayCounter</a> dc = <a class="code" href="class_quant_lib_1_1_actual365_fixed.html" title="Actual/365 (Fixed) day count convention.">Actual365Fixed</a>();
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> today = <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#ae1b42c838cf0f4cf17262f0b22bac899">Date::todaysDate</a>();

    Settings::instance().evaluationDate() = today;

    <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;Quote&gt;</a> spot(boost::shared_ptr&lt;Quote&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(100.0)));
    boost::shared_ptr&lt;SimpleQuote&gt; qRate(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(0.04));
    <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> qTS(<a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(today, qRate, dc));
    boost::shared_ptr&lt;SimpleQuote&gt; rRate(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(0.04));
    <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> rTS(<a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(today, rRate, dc));

    <span class="keyword">const</span> boost::shared_ptr&lt;HestonProcess&gt; hestonProcess(
            <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_process.html" title="Square-root stochastic-volatility Heston process.">HestonProcess</a>(rTS, qTS, spot, 0.0625, 1.0,
                              0.24*0.24, 1e-4, 0.0));
    <span class="comment">// FLOATING_POINT_EXCEPTION</span>
    <span class="keyword">const</span> boost::shared_ptr&lt;HullWhiteForwardProcess&gt; hwProcess(
            <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_hull_white_forward_process.html" title="Forward Hull-White stochastic process">HullWhiteForwardProcess</a>(rTS, 0.00883, 0.00526));
    hwProcess-&gt;setForwardMeasureTime(
                      dc.<a class="code" href="class_quant_lib_1_1_day_counter.html#aba442c829252ee786e1b4ea3d0f04bd9" title="Returns the period between two dates as a fraction of year.">yearFraction</a>(today, today+<a class="code" href="class_quant_lib_1_1_period.html">Period</a>(maturity+1, <a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3ae2d856134531729a1696e66bebeafb32">Years</a>)));

    <span class="keyword">const</span> boost::shared_ptr&lt;HybridHestonHullWhiteProcess&gt; jointProcess(
        <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_hybrid_heston_hull_white_process.html" title="Hybrid Heston Hull-White stochastic process.">HybridHestonHullWhiteProcess</a>(hestonProcess, hwProcess, -0.4));

    <a class="code" href="class_quant_lib_1_1_schedule.html" title="Payment schedule.">Schedule</a> schedule(today, today + <a class="code" href="class_quant_lib_1_1_period.html">Period</a>(maturity, <a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3ae2d856134531729a1696e66bebeafb32">Years</a>),
                      <a class="code" href="class_quant_lib_1_1_period.html">Period</a>(1, <a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3ae2d856134531729a1696e66bebeafb32">Years</a>), <a class="code" href="class_quant_lib_1_1_t_a_r_g_e_t.html" title="TARGET calendar">TARGET</a>(),
                      <a class="code" href="namespace_quant_lib.html#ac95a4b5bc8017f1eb4ad0b54a9af3881ad881bac893a17d75191f0041eefda956">Following</a>, <a class="code" href="namespace_quant_lib.html#ac95a4b5bc8017f1eb4ad0b54a9af3881ad881bac893a17d75191f0041eefda956">Following</a>,
                      DateGeneration::Forward, <span class="keyword">false</span>);

    std::vector&lt;Time&gt; times(maturity+1);
    std::transform(schedule.begin(), schedule.end(), times.begin(),
                   boost::bind(&amp;Actual365Fixed::yearFraction,
                               dc, today, _1, <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(), <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>()));

    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i&lt;=maturity; ++i)
        times[i] = static_cast&lt;Time&gt;(i);

    <a class="code" href="class_quant_lib_1_1_time_grid.html" title="time grid class">TimeGrid</a> grid(times.begin(), times.end());

    std::vector&lt;Real&gt; redemption(maturity);
    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i &lt; maturity; ++i) {
        redemption[i] = 1.07 + 0.03*i;
    }

    <span class="keyword">typedef</span> <a class="code" href="class_quant_lib_1_1_inverse_cumulative_rsg.html" title="Inverse cumulative random sequence generator.">PseudoRandom::rsg_type</a> rsg_type;
    <span class="keyword">typedef</span> <a class="code" href="struct_quant_lib_1_1_sample.html">MultiPathGenerator&lt;rsg_type&gt;::sample_type</a> sample_type;

    <a class="code" href="namespace_quant_lib.html#a9fbc8c414c2b597d214cca2f9e914740" title="large positive integer">BigNatural</a> seed = 42;
    rsg_type rsg = PseudoRandom::make_sequence_generator(
                              jointProcess-&gt;factors()*(grid.size()-1), seed);

    <a class="code" href="class_quant_lib_1_1_multi_path_generator.html" title="Generates a multipath from a random number generator.">MultiPathGenerator&lt;rsg_type&gt;</a> generator(jointProcess, grid, rsg, <span class="keyword">false</span>);
    <a class="code" href="class_quant_lib_1_1_general_statistics.html" title="Statistics tool.">GeneralStatistics</a> stat;

    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> antitheticPayoff=0;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> nrTrails = 40000;
    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i &lt; nrTrails; ++i) {
        <span class="keyword">const</span> <span class="keywordtype">bool</span> antithetic = (i%2)==0 ? <span class="keyword">false</span> : <span class="keyword">true</span>;

        sample_type path = antithetic ? generator.antithetic()
                                      : generator.next();

        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> payoff=0;
        <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> j=1; j &lt;= maturity; ++j) {
            <span class="keywordflow">if</span> (path.value[0][j] &gt; spot-&gt;value()) {
                <a class="code" href="class_quant_lib_1_1_array.html" title="1-D array used in linear algebra.">Array</a> states(3);
                <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> k=0; k &lt; 3; ++k) {
                    states[k] = path.value[k][j];
                }
                payoff = redemption[j-1]
                    / jointProcess-&gt;numeraire(grid[j], states);
                <span class="keywordflow">break</span>;
            }
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (j == maturity) {
                <a class="code" href="class_quant_lib_1_1_array.html" title="1-D array used in linear algebra.">Array</a> states(3);
                <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> k=0; k &lt; 3; ++k) {
                    states[k] = path.value[k][j];
                }
                payoff = 1.0 / jointProcess-&gt;numeraire(grid[j], states);
            }
        }

        <span class="keywordflow">if</span> (antithetic){
            stat.<a class="code" href="class_quant_lib_1_1_general_statistics.html#ad3a191db3b8499fe3ca40b2767566c37" title="adds a datum to the set, possibly with a weight">add</a>(0.5*(antitheticPayoff + payoff));
        }
        <span class="keywordflow">else</span> {
            antitheticPayoff = payoff;
        }
    }

    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> expected = 0.938;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> calculated = stat.<a class="code" href="class_quant_lib_1_1_general_statistics.html#a054bb4330c1dcde6176dd281f76e87a1">mean</a>();
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> error = stat.<a class="code" href="class_quant_lib_1_1_general_statistics.html#af6a95e6f21454454e9f8f7caba211f8f">errorEstimate</a>();

    <span class="keywordflow">if</span> (std::fabs(expected - calculated) &gt; 3*error) {
        BOOST_ERROR(<span class="stringliteral">&quot;Failed to reproduce auto-callable equity structure price&quot;</span>
                    &lt;&lt; <span class="stringliteral">&quot;\n   calculated: &quot;</span> &lt;&lt; calculated
                    &lt;&lt; <span class="stringliteral">&quot;\n   error:      &quot;</span> &lt;&lt; error
                    &lt;&lt; <span class="stringliteral">&quot;\n   expected:   &quot;</span> &lt;&lt; expected);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8b0ff4563302e7ec333888646cb539ff"></a><!-- doxytag: member="HybridHestonHullWhiteProcessTest::testCompareBsmHWandHestonHW" ref="a8b0ff4563302e7ec333888646cb539ff" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_hybrid_heston_hull_white_process_test.html#a8b0ff4563302e7ec333888646cb539ff">HybridHestonHullWhiteProcessTest::testCompareBsmHWandHestonHW</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l00155">155</a> of file <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html">hybridhestonhullwhiteprocess.cpp</a>.</p>

<p>References <a class="el" href="option_8hpp_source.html#l00039">QuantLib::Option::Call</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00125">anonymous_namespace{marketmodel.cpp}::dates</a>, <a class="el" href="settings_8hpp_source.html#l00153">QuantLib::Settings::evaluationDate()</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00086">QuantLib::flatVol()</a>, <a class="el" href="class_quant_lib_1_1_singleton.html#ab79257029fa4841505227497a56cbd93">QuantLib::Singleton&lt; Settings &gt;::instance()</a>, <a class="el" href="test-suite_2utilities_8hpp_source.html#l00039">LENGTH</a>, <a class="el" href="instrument_8hpp_source.html#l00186">QuantLib::Instrument::NPV()</a>, <a class="el" href="option_8hpp_source.html#l00038">QuantLib::Option::Put</a>, <a class="el" href="instrument_8hpp_source.html#l00133">QuantLib::Instrument::setPricingEngine()</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00124">anonymous_namespace{marketmodel.cpp}::todaysDate</a>, <a class="el" href="daycounter_8hpp_source.html#l00126">QuantLib::DayCounter::yearFraction()</a>, and <a class="el" href="timeunit_8hpp_source.html#l00040">QuantLib::Years</a>.</p>

<p>Referenced by <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l01422">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                                                   {
    BOOST_MESSAGE(<span class="stringliteral">&quot;Comparing European option pricing for a BSM process&quot;</span>
                  <span class="stringliteral">&quot; with one-factor Hull-White model...&quot;</span>);

    <a class="code" href="class_quant_lib_1_1_saved_settings.html">SavedSettings</a> backup;

    <a class="code" href="class_quant_lib_1_1_day_counter.html" title="day counter class">DayCounter</a> dc = <a class="code" href="class_quant_lib_1_1_actual365_fixed.html" title="Actual/365 (Fixed) day count convention.">Actual365Fixed</a>();

    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> today = <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#ae1b42c838cf0f4cf17262f0b22bac899">Date::todaysDate</a>();

    Settings::instance().evaluationDate() = today;

    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;Quote&gt;</a> spot(
                         boost::shared_ptr&lt;Quote&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(100.0)));
    std::vector&lt;Date&gt; <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a800db345cacda47dd48925126ea05f91">dates</a>;
    std::vector&lt;Time&gt; times;
    std::vector&lt;Rate&gt; rates, divRates;

    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i &lt;= 40; ++i) {
        dates.push_back(today+<a class="code" href="class_quant_lib_1_1_period.html">Period</a>(i, <a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3ae2d856134531729a1696e66bebeafb32">Years</a>));
        <span class="comment">// FLOATING_POINT_EXCEPTION</span>
        rates.push_back(0.01 + 0.0002*std::exp(std::sin(i/4.0)));
        divRates.push_back(0.02 + 0.0001*std::exp(std::sin(i/5.0)));
        times.push_back(dc.<a class="code" href="class_quant_lib_1_1_day_counter.html#aba442c829252ee786e1b4ea3d0f04bd9" title="Returns the period between two dates as a fraction of year.">yearFraction</a>(today, dates.back()));
    }

    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;Quote&gt;</a> s0(boost::shared_ptr&lt;Quote&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(100)));
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> rTS(
       boost::shared_ptr&lt;YieldTermStructure&gt;(<span class="keyword">new</span> <a class="code" href="namespace_quant_lib.html#aba455dd6323746ed70a64eb4fa65c276" title="Term structure based on linear interpolation of zero yields.">ZeroCurve</a>(dates, rates, dc)));
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> qTS(
       boost::shared_ptr&lt;YieldTermStructure&gt;(
                                          <span class="keyword">new</span> <a class="code" href="namespace_quant_lib.html#aba455dd6323746ed70a64eb4fa65c276" title="Term structure based on linear interpolation of zero yields.">ZeroCurve</a>(dates, divRates, dc)));

    boost::shared_ptr&lt;SimpleQuote&gt; vol(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(0.25));
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;BlackVolTermStructure&gt;</a> volTS(<a class="code" href="namespace_quant_lib.html#a589d5c4b0b60b0bdd42ae07d820b2ed3">flatVol</a>(today, vol, dc));

    boost::shared_ptr&lt;BlackScholesMertonProcess&gt; bsmProcess(
                      <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_black_scholes_merton_process.html" title="Merton (1973) extension to the Black-Scholes stochastic process.">BlackScholesMertonProcess</a>(spot, qTS, rTS, volTS));

    boost::shared_ptr&lt;HestonProcess&gt; hestonProcess(
                   <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_process.html" title="Square-root stochastic-volatility Heston process.">HestonProcess</a>(rTS, qTS, spot,
                                     vol-&gt;value()*vol-&gt;value(), 1.0,
                                     vol-&gt;value()*vol-&gt;value(), 1e-4, 0.0));

    boost::shared_ptr&lt;HestonModel&gt; hestonModel(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_model.html" title="Heston model for the stochastic volatility of an asset.">HestonModel</a>(hestonProcess));

    boost::shared_ptr&lt;HullWhite&gt; hullWhiteModel(
        <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_hull_white.html" title="Single-factor Hull-White (extended Vasicek) model class.">HullWhite</a>(<a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a>(rTS), 0.01, 0.01));

    boost::shared_ptr&lt;PricingEngine&gt; bsmhwEngine(
             <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_analytic_b_s_m_hull_white_engine.html" title="analytic european option pricer including stochastic interest rates">AnalyticBSMHullWhiteEngine</a>(0.0, bsmProcess, hullWhiteModel));

    boost::shared_ptr&lt;PricingEngine&gt; hestonHwEngine(
          <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_analytic_heston_hull_white_engine.html" title="Analytic Heston engine incl. stochastic interest rates.">AnalyticHestonHullWhiteEngine</a>(hestonModel, hullWhiteModel, 192));


    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> tol = 1e-6;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> strike[] = { 0.25, 0.5, 0.75, 0.8, 0.9,
                            1.0, 1.1, 1.2, 1.5, 2.0, 4.0 };
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> maturity[] = { 1, 2, 3, 5, 10, 15, 20, 25, 30 };
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_option.html#abaee7fc605354c444867545492cd5845">Option::Type</a> types[] = { Option::Put, Option::Call };

    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i &lt; <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(types); ++i) {
        <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> j=0; j &lt; <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(strike); ++j) {
            <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> l=0; l &lt; <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(maturity); ++l) {
                <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> maturityDate = today + <a class="code" href="class_quant_lib_1_1_period.html">Period</a>(maturity[l], <a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3ae2d856134531729a1696e66bebeafb32">Years</a>);

                boost::shared_ptr&lt;Exercise&gt; exercise(
                                         <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_european_exercise.html" title="European exercise.">EuropeanExercise</a>(maturityDate));

                <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> fwd = strike[j] * spot-&gt;value()
                    *qTS-&gt;discount(maturityDate)/rTS-&gt;discount(maturityDate);

                boost::shared_ptr&lt;StrikedTypePayoff&gt; payoff(<span class="keyword">new</span>
                                          <a class="code" href="class_quant_lib_1_1_plain_vanilla_payoff.html" title="Plain-vanilla payoff.">PlainVanillaPayoff</a>(types[i], fwd));

                <a class="code" href="class_quant_lib_1_1_european_option.html" title="European option on a single asset.">EuropeanOption</a> option(payoff, exercise);

                option.setPricingEngine(bsmhwEngine);
                <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> calculated = option.NPV();

                option.setPricingEngine(hestonHwEngine);
                <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> expected = option.NPV();

                <span class="keywordflow">if</span> (std::fabs(calculated-expected) &gt; calculated*tol &amp;&amp;
                    std::fabs(calculated-expected) &gt; tol) {
                    BOOST_ERROR(<span class="stringliteral">&quot;Failed to reproduce npvs&quot;</span>
                                &lt;&lt; <span class="stringliteral">&quot;\n    calculated: &quot;</span> &lt;&lt; calculated
                                &lt;&lt; <span class="stringliteral">&quot;\n    expected  : &quot;</span> &lt;&lt; expected
                                &lt;&lt; <span class="stringliteral">&quot;\n    strike    : &quot;</span> &lt;&lt; strike[j]
                                &lt;&lt; <span class="stringliteral">&quot;\n    maturity  : &quot;</span> &lt;&lt; maturity[l]
                                &lt;&lt; <span class="stringliteral">&quot;\n    type      : &quot;</span>
                                &lt;&lt; ((types[i] == Option::Put)? <span class="stringliteral">&quot;Put&quot;</span> : <span class="stringliteral">&quot;Call&quot;</span>)
                                );
                }
            }
        }
   }
}
</pre></div>
</div>
</div>
<a class="anchor" id="acd8dcf93ea0cbb21657290419e19da29"></a><!-- doxytag: member="HybridHestonHullWhiteProcessTest::testDiscretizationError" ref="acd8dcf93ea0cbb21657290419e19da29" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_hybrid_heston_hull_white_process_test.html#acd8dcf93ea0cbb21657290419e19da29">HybridHestonHullWhiteProcessTest::testDiscretizationError</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l00771">771</a> of file <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html">hybridhestonhullwhiteprocess.cpp</a>.</p>

<p>References <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00125">anonymous_namespace{marketmodel.cpp}::dates</a>, <a class="el" href="instrument_8hpp_source.html#l00192">QuantLib::Instrument::errorEstimate()</a>, <a class="el" href="settings_8hpp_source.html#l00153">QuantLib::Settings::evaluationDate()</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00086">QuantLib::flatVol()</a>, <a class="el" href="class_quant_lib_1_1_singleton.html#ab79257029fa4841505227497a56cbd93">QuantLib::Singleton&lt; Settings &gt;::instance()</a>, <a class="el" href="test-suite_2utilities_8hpp_source.html#l00039">LENGTH</a>, <a class="el" href="instrument_8hpp_source.html#l00186">QuantLib::Instrument::NPV()</a>, <a class="el" href="option_8hpp_source.html#l00038">QuantLib::Option::Put</a>, <a class="el" href="instrument_8hpp_source.html#l00133">QuantLib::Instrument::setPricingEngine()</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00124">anonymous_namespace{marketmodel.cpp}::todaysDate</a>, <a class="el" href="perturbativebarrieroptionengine_8cpp_source.html#l00433">anonymous_namespace{perturbativebarrieroptionengine.cpp}::v()</a>, <a class="el" href="daycounter_8hpp_source.html#l00126">QuantLib::DayCounter::yearFraction()</a>, and <a class="el" href="timeunit_8hpp_source.html#l00040">QuantLib::Years</a>.</p>

<p>Referenced by <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l01422">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                                               {
    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing the discretization error of the &quot;</span>
                  <span class="stringliteral">&quot;Heston Hull-White process...&quot;</span>);

    <a class="code" href="class_quant_lib_1_1_saved_settings.html">SavedSettings</a> backup;

    <a class="code" href="class_quant_lib_1_1_day_counter.html" title="day counter class">DayCounter</a> dc = <a class="code" href="class_quant_lib_1_1_actual360.html" title="Actual/360 day count convention.">Actual360</a>();
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> today = <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#ae1b42c838cf0f4cf17262f0b22bac899">Date::todaysDate</a>();

    Settings::instance().evaluationDate() = today;

    <span class="comment">// construct a strange yield curve to check drifts and discounting</span>
    <span class="comment">// of the joint stochastic process</span>

    std::vector&lt;Date&gt; <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a800db345cacda47dd48925126ea05f91">dates</a>;
    std::vector&lt;Time&gt; times;
    std::vector&lt;Rate&gt; rates, divRates;

    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i &lt;= 31; ++i) {
        dates.push_back(today+<a class="code" href="class_quant_lib_1_1_period.html">Period</a>(i, <a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3ae2d856134531729a1696e66bebeafb32">Years</a>));
        <span class="comment">// FLOATING_POINT_EXCEPTION</span>
        rates.push_back(0.04 + 0.0001*std::exp(std::sin(<span class="keywordtype">double</span>(i))));
        divRates.push_back(0.04 + 0.0001*std::exp(std::sin(<span class="keywordtype">double</span>(i))));
        times.push_back(dc.<a class="code" href="class_quant_lib_1_1_day_counter.html#aba442c829252ee786e1b4ea3d0f04bd9" title="Returns the period between two dates as a fraction of year.">yearFraction</a>(today, dates.back()));
    }

    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> maturity = today + <a class="code" href="class_quant_lib_1_1_period.html">Period</a>(10, <a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3ae2d856134531729a1696e66bebeafb32">Years</a>);
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#ae3abfa256de5aa2b506ab6bda014e4dc" title="volatility">Volatility</a> <a class="code" href="namespaceanonymous__namespace_02perturbativebarrieroptionengine_8cpp_03.html#a1c6cf95dc58d77fbce730d3c1f8ccda7">v</a> = 0.25;

    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;Quote&gt;</a> s0(boost::shared_ptr&lt;Quote&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(100)));
    <span class="keyword">const</span> boost::shared_ptr&lt;SimpleQuote&gt; vol(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(v));
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;BlackVolTermStructure&gt;</a> volTS(<a class="code" href="namespace_quant_lib.html#a589d5c4b0b60b0bdd42ae07d820b2ed3">flatVol</a>(today, vol, dc));
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> rTS(
       boost::shared_ptr&lt;YieldTermStructure&gt;(<span class="keyword">new</span> <a class="code" href="namespace_quant_lib.html#aba455dd6323746ed70a64eb4fa65c276" title="Term structure based on linear interpolation of zero yields.">ZeroCurve</a>(dates, rates, dc)));
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> qTS(
       boost::shared_ptr&lt;YieldTermStructure&gt;(
                                          <span class="keyword">new</span> <a class="code" href="namespace_quant_lib.html#aba455dd6323746ed70a64eb4fa65c276" title="Term structure based on linear interpolation of zero yields.">ZeroCurve</a>(dates, divRates, dc)));

    <span class="keyword">const</span> boost::shared_ptr&lt;BlackScholesMertonProcess&gt; bsmProcess(
                          <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_black_scholes_merton_process.html" title="Merton (1973) extension to the Black-Scholes stochastic process.">BlackScholesMertonProcess</a>(s0, qTS, rTS, volTS));

    <span class="keyword">const</span> boost::shared_ptr&lt;HestonProcess&gt; hestonProcess(
           <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_process.html" title="Square-root stochastic-volatility Heston process.">HestonProcess</a>(rTS, qTS, s0, v*v, 1, v*v, 1e-6, -0.4));

    <span class="keyword">const</span> boost::shared_ptr&lt;HullWhiteForwardProcess&gt; hwProcess(
              <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_hull_white_forward_process.html" title="Forward Hull-White stochastic process">HullWhiteForwardProcess</a>(rTS, 0.01, 0.01));
    hwProcess-&gt;setForwardMeasureTime(20.1472222222222222);

    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> tol = 0.05;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> corr[] = {-0.85, 0.5 };
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> strike[] = { 50, 100, 125 };

    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i &lt; <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(corr); ++i) {
        <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> j=0; j &lt; <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(strike); ++j) {
            boost::shared_ptr&lt;StrikedTypePayoff&gt; payoff(
                               <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_plain_vanilla_payoff.html" title="Plain-vanilla payoff.">PlainVanillaPayoff</a>(Option::Put, strike[j]));
            boost::shared_ptr&lt;Exercise&gt; exercise(
                               <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_european_exercise.html" title="European exercise.">EuropeanExercise</a>(maturity));

            <a class="code" href="class_quant_lib_1_1_vanilla_option.html" title="Vanilla option (no discrete dividends, no barriers) on a single asset.">VanillaOption</a> optionBsmHW(payoff, exercise);
            <span class="keyword">const</span> boost::shared_ptr&lt;HullWhite&gt; hwModel(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_hull_white.html" title="Single-factor Hull-White (extended Vasicek) model class.">HullWhite</a>(
                               rTS, hwProcess-&gt;a(), hwProcess-&gt;sigma()));
            optionBsmHW.setPricingEngine(
                boost::shared_ptr&lt;PricingEngine&gt;(
                         <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_analytic_b_s_m_hull_white_engine.html" title="analytic european option pricer including stochastic interest rates">AnalyticBSMHullWhiteEngine</a>(corr[i], bsmProcess,
                                                        hwModel)));

            <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> expected = optionBsmHW.NPV();

            <a class="code" href="class_quant_lib_1_1_vanilla_option.html" title="Vanilla option (no discrete dividends, no barriers) on a single asset.">VanillaOption</a> optionHestonHW(payoff, exercise);
            boost::shared_ptr&lt;HybridHestonHullWhiteProcess&gt; jointProcess(
                <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_hybrid_heston_hull_white_process.html" title="Hybrid Heston Hull-White stochastic process.">HybridHestonHullWhiteProcess</a>(hestonProcess,
                                                 hwProcess, corr[i]));
            optionHestonHW.setPricingEngine(
                    <a class="code" href="class_quant_lib_1_1_make_m_c_heston_hull_white_engine.html" title="Monte Carlo Heston/Hull-White engine factory.">MakeMCHestonHullWhiteEngine&lt;PseudoRandom&gt;</a>(jointProcess)
                    .withSteps(1)
                    .withAntitheticVariate()
                    .withAbsoluteTolerance(tol)
                    .withSeed(42));

            <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> calculated = optionHestonHW.NPV();
            <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> error      = optionHestonHW.errorEstimate();

            <span class="keywordflow">if</span> ((   std::fabs(calculated - expected) &gt; 3*error
                 &amp;&amp; std::fabs(calculated - expected) &gt; 1e-5)) {
                BOOST_ERROR(<span class="stringliteral">&quot;Failed to reproduce discretization error&quot;</span>
                        &lt;&lt; <span class="stringliteral">&quot;\n   corr:       &quot;</span> &lt;&lt; corr[i]
                        &lt;&lt; <span class="stringliteral">&quot;\n   strike:     &quot;</span> &lt;&lt; strike[j]
                        &lt;&lt; <span class="stringliteral">&quot;\n   calculated: &quot;</span> &lt;&lt; calculated
                        &lt;&lt; <span class="stringliteral">&quot;\n   error:      &quot;</span> &lt;&lt; error
                        &lt;&lt; <span class="stringliteral">&quot;\n   expected:   &quot;</span> &lt;&lt; expected);
            }
        }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a9f7602624202d6eb86a4f3d2b81f391d"></a><!-- doxytag: member="HybridHestonHullWhiteProcessTest::testFdmHestonHullWhiteEngine" ref="a9f7602624202d6eb86a4f3d2b81f391d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_hybrid_heston_hull_white_process_test.html#a9f7602624202d6eb86a4f3d2b81f391d">HybridHestonHullWhiteProcessTest::testFdmHestonHullWhiteEngine</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l00867">867</a> of file <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html">hybridhestonhullwhiteprocess.cpp</a>.</p>

<p>References <a class="el" href="option_8hpp_source.html#l00039">QuantLib::Option::Call</a>, <a class="el" href="oneassetoption_8cpp_source.html#l00037">QuantLib::OneAssetOption::delta()</a>, <a class="el" href="settings_8hpp_source.html#l00153">QuantLib::Settings::evaluationDate()</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00058">QuantLib::flatRate()</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00086">QuantLib::flatVol()</a>, <a class="el" href="oneassetoption_8cpp_source.html#l00056">QuantLib::OneAssetOption::gamma()</a>, <a class="el" href="class_quant_lib_1_1_singleton.html#ab79257029fa4841505227497a56cbd93">QuantLib::Singleton&lt; Settings &gt;::instance()</a>, <a class="el" href="test-suite_2utilities_8hpp_source.html#l00039">LENGTH</a>, <a class="el" href="date_8hpp_source.html#l00047">QuantLib::March</a>, <a class="el" href="instrument_8hpp_source.html#l00186">QuantLib::Instrument::NPV()</a>, and <a class="el" href="instrument_8hpp_source.html#l00133">QuantLib::Instrument::setPricingEngine()</a>.</p>

<p>Referenced by <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l01422">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                                                    {
    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing the FDM Heston Hull-White engine...&quot;</span>);

    <a class="code" href="class_quant_lib_1_1_saved_settings.html">SavedSettings</a> backup;

    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> today = <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(28, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a982c9e93cf4b41f4b71b5c256df6191c">March</a>, 2004);
    Settings::instance().evaluationDate() = today;
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> exerciseDate = <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(28, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a982c9e93cf4b41f4b71b5c256df6191c">March</a>, 2012);
    <a class="code" href="class_quant_lib_1_1_day_counter.html" title="day counter class">DayCounter</a> dc = <a class="code" href="class_quant_lib_1_1_actual365_fixed.html" title="Actual/365 (Fixed) day count convention.">Actual365Fixed</a>();
    
    <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;Quote&gt;</a> s0(boost::shared_ptr&lt;Quote&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(100.0)));

    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> rTS(<a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(0.05, dc));
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> qTS(<a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(0.02, dc));

    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#ae3abfa256de5aa2b506ab6bda014e4dc" title="volatility">Volatility</a> vol = 0.30;
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;BlackVolTermStructure&gt;</a> volTS(<a class="code" href="namespace_quant_lib.html#a589d5c4b0b60b0bdd42ae07d820b2ed3">flatVol</a>(vol, dc));

    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> v0 = vol*vol;
    boost::shared_ptr&lt;HestonProcess&gt; hestonProcess(
        <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_process.html" title="Square-root stochastic-volatility Heston process.">HestonProcess</a>(rTS, qTS, s0, v0, 1.0, v0, 0.000001, 0.0));

    boost::shared_ptr&lt;BlackScholesMertonProcess&gt; stochProcess(
                      <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_black_scholes_merton_process.html" title="Merton (1973) extension to the Black-Scholes stochastic process.">BlackScholesMertonProcess</a>(s0, qTS, rTS, volTS));

    boost::shared_ptr&lt;HullWhiteProcess&gt; hwProcess(
                              <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_hull_white_process.html" title="Hull-White stochastic process.">HullWhiteProcess</a>(rTS, 0.00883, 0.01));
    boost::shared_ptr&lt;HullWhite&gt; hwModel(
                    <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_hull_white.html" title="Single-factor Hull-White (extended Vasicek) model class.">HullWhite</a>(rTS, hwProcess-&gt;a(), hwProcess-&gt;sigma()));
    
    boost::shared_ptr&lt;Exercise&gt; exercise(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_european_exercise.html" title="European exercise.">EuropeanExercise</a>(exerciseDate));
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> corr[] = {-0.85, 0.5 };
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> strike[] = { 75, 120, 160 };

    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i &lt; <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(corr); ++i) {
        <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> j=0; j &lt; <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(strike); ++j) {
            boost::shared_ptr&lt;StrikedTypePayoff&gt; payoff(
                              <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_plain_vanilla_payoff.html" title="Plain-vanilla payoff.">PlainVanillaPayoff</a>(Option::Call, strike[j]));
            <a class="code" href="class_quant_lib_1_1_vanilla_option.html" title="Vanilla option (no discrete dividends, no barriers) on a single asset.">VanillaOption</a> option(payoff, exercise);
            
            option.setPricingEngine(boost::shared_ptr&lt;PricingEngine&gt;(
                <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_fd_heston_hull_white_vanilla_engine.html" title="Finite-Differences Heston Hull-White Vanilla Option engine.">FdHestonHullWhiteVanillaEngine</a>(
                    boost::shared_ptr&lt;HestonModel&gt;(
                        <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_model.html" title="Heston model for the stochastic volatility of an asset.">HestonModel</a>(hestonProcess)),
                                        hwProcess, corr[i], 50, 200, 10, 15)));
            <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> calculated = option.NPV();
            <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> calculatedDelta = option.delta();
            <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> calculatedGamma = option.gamma();
            
            option.setPricingEngine(boost::shared_ptr&lt;PricingEngine&gt;(
                <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_analytic_b_s_m_hull_white_engine.html" title="analytic european option pricer including stochastic interest rates">AnalyticBSMHullWhiteEngine</a>(corr[i],
                                               stochProcess, hwModel)));
            <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> expected = option.NPV();
            <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> expectedDelta = option.delta();
            <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> expectedGamma = option.gamma();

            <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> npvTol = 0.01;
            <span class="keywordflow">if</span> (std::fabs(calculated - expected) &gt; npvTol) {
                 BOOST_ERROR(<span class="stringliteral">&quot;Failed to reproduce analytic npv values&quot;</span>
                         &lt;&lt; <span class="stringliteral">&quot;\n   corr:       &quot;</span> &lt;&lt; corr[i]
                         &lt;&lt; <span class="stringliteral">&quot;\n   strike:     &quot;</span> &lt;&lt; strike[j]
                         &lt;&lt; <span class="stringliteral">&quot;\n   calculated: &quot;</span> &lt;&lt; calculated
                         &lt;&lt; <span class="stringliteral">&quot;\n   expected:   &quot;</span> &lt;&lt; expected);
            }
            <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> deltaTol = 0.001;
            <span class="keywordflow">if</span> (std::fabs(calculatedDelta - expectedDelta) &gt; deltaTol) {
                 BOOST_ERROR(<span class="stringliteral">&quot;Failed to reproduce analytic delta values&quot;</span>
                         &lt;&lt; <span class="stringliteral">&quot;\n   corr:       &quot;</span> &lt;&lt; corr[i]
                         &lt;&lt; <span class="stringliteral">&quot;\n   strike:     &quot;</span> &lt;&lt; strike[j]
                         &lt;&lt; <span class="stringliteral">&quot;\n   calculated: &quot;</span> &lt;&lt; calculated
                         &lt;&lt; <span class="stringliteral">&quot;\n   expected:   &quot;</span> &lt;&lt; expected);
            }
            <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> gammaTol = 0.001;
            <span class="keywordflow">if</span> (std::fabs(calculatedGamma - expectedGamma) &gt; gammaTol) {
                 BOOST_ERROR(<span class="stringliteral">&quot;Failed to reproduce analytic gamma values&quot;</span>
                         &lt;&lt; <span class="stringliteral">&quot;\n   corr:       &quot;</span> &lt;&lt; corr[i]
                         &lt;&lt; <span class="stringliteral">&quot;\n   strike:     &quot;</span> &lt;&lt; strike[j]
                         &lt;&lt; <span class="stringliteral">&quot;\n   calculated: &quot;</span> &lt;&lt; calculated
                         &lt;&lt; <span class="stringliteral">&quot;\n   expected:   &quot;</span> &lt;&lt; expected);
            }
        }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6127f45f96e8afc9667669000b7e161d"></a><!-- doxytag: member="HybridHestonHullWhiteProcessTest::testHestonHullWhiteCalibration" ref="a6127f45f96e8afc9667669000b7e161d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_hybrid_heston_hull_white_process_test.html#a6127f45f96e8afc9667669000b7e161d">HybridHestonHullWhiteProcessTest::testHestonHullWhiteCalibration</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l01223">1223</a> of file <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html">hybridhestonhullwhiteprocess.cpp</a>.</p>

<p>References <a class="el" href="impliedvolatility_8cpp_source.html#l00062">QuantLib::detail::ImpliedVolatilityHelper::calculate()</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00128">anonymous_namespace{marketmodel.cpp}::calendar</a>, <a class="el" href="option_8hpp_source.html#l00039">QuantLib::Option::Call</a>, <a class="el" href="impliedvolatility_8cpp_source.html#l00085">QuantLib::detail::ImpliedVolatilityHelper::clone()</a>, <a class="el" href="settings_8hpp_source.html#l00153">QuantLib::Settings::evaluationDate()</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00058">QuantLib::flatRate()</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00086">QuantLib::flatVol()</a>, <a class="el" href="class_quant_lib_1_1_singleton.html#ab79257029fa4841505227497a56cbd93">QuantLib::Singleton&lt; Settings &gt;::instance()</a>, <a class="el" href="test-suite_2utilities_8hpp_source.html#l00039">LENGTH</a>, <a class="el" href="date_8hpp_source.html#l00047">QuantLib::March</a>, <a class="el" href="timeunit_8hpp_source.html#l00039">QuantLib::Months</a>, <a class="el" href="calibrationhelper_8hpp_source.html#l00039">QuantLib::CalibrationHelper::PriceError</a>, and <a class="el" href="perturbativebarrieroptionengine_8cpp_source.html#l00433">anonymous_namespace{perturbativebarrieroptionengine.cpp}::v()</a>.</p>

<p>Referenced by <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l01422">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                                                      {
    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing the Heston Hull-White calibration...&quot;</span>);

    <span class="comment">// Calibration of a hybrid Heston-Hull-White model using </span>
    <span class="comment">// the finite difference HestonHullWhite pricing engine</span>
    <span class="comment">//</span>
    <span class="comment">// Imput surface is based on a Heston-Hull-White model with</span>
    <span class="comment">// Hull-White: a = 0.00883, \sigma = 0.00631</span>
    <span class="comment">// Heston    : \nu = 0.12, \kappa = 2.0, </span>
    <span class="comment">//             \theta = 0.09, \sigma = 0.5, \rho=-0.75</span>
    
    <a class="code" href="class_quant_lib_1_1_saved_settings.html">SavedSettings</a> backup;

    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_day_counter.html" title="day counter class">DayCounter</a> dc = <a class="code" href="class_quant_lib_1_1_actual365_fixed.html" title="Actual/365 (Fixed) day count convention.">Actual365Fixed</a>();
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_calendar.html" title="calendar class">Calendar</a> <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a86803e870514df19c0cf3863edb2b8f8">calendar</a> = <a class="code" href="class_quant_lib_1_1_t_a_r_g_e_t.html" title="TARGET calendar">TARGET</a>();
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> today = <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a>(28, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4a982c9e93cf4b41f4b71b5c256df6191c">March</a>, 2004);
    Settings::instance().evaluationDate() = today;

    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> rTS(<a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(0.05, dc));

    <span class="comment">// assuming, that the Hull-White process is already calibrated </span>
    <span class="comment">// on a given set of pure interest rate calibration instruments.</span>
    boost::shared_ptr&lt;HullWhiteProcess&gt; hwProcess(
                              <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_hull_white_process.html" title="Hull-White stochastic process.">HullWhiteProcess</a>(rTS, 0.00883, 0.00631));
    boost::shared_ptr&lt;HullWhite&gt; hullWhiteModel(
                    <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_hull_white.html" title="Single-factor Hull-White (extended Vasicek) model class.">HullWhite</a>(rTS, hwProcess-&gt;a(), hwProcess-&gt;sigma()));
                    
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> qTS(<a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(0.02, dc));
    <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;Quote&gt;</a> s0(boost::shared_ptr&lt;Quote&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(100.0)));

    <span class="comment">// starting point the the pure Heston calibration</span>
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> start_v0    = 0.2*0.2;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> start_theta = start_v0;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> start_kappa = 0.5;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> start_sigma = 0.25;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> start_rho   = -0.5;
    
    boost::shared_ptr&lt;HestonProcess&gt; hestonProcess(
        <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_process.html" title="Square-root stochastic-volatility Heston process.">HestonProcess</a>(rTS, qTS, s0, start_v0, start_kappa, 
                          start_theta, start_sigma, start_rho));
    boost::shared_ptr&lt;HestonModel&gt; analyticHestonModel
                                            (<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_model.html" title="Heston model for the stochastic volatility of an asset.">HestonModel</a>(hestonProcess));
    boost::shared_ptr&lt;PricingEngine&gt; analyticHestonEngine(
                         <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_analytic_heston_engine.html" title="analytic Heston-model engine based on Fourier transform">AnalyticHestonEngine</a>(analyticHestonModel, 164));
    boost::shared_ptr&lt;HestonModel&gt; fdmHestonModel
                                            (<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_model.html" title="Heston model for the stochastic volatility of an asset.">HestonModel</a>(hestonProcess));
  
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> equityShortRateCorr = -0.5;
    
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> strikes[]    = { 50, 75, 90, 100, 110, 125, 150, 200 };
    <span class="keyword">const</span> <a class="code" href="class_time.html">Time</a> maturities[] = { 1/12., 3/12., 0.5, 1.0, 2.0, 3.0, 5.0, 7.5, 10};
    
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#ae3abfa256de5aa2b506ab6bda014e4dc" title="volatility">Volatility</a> vol[] = {
        0.482627,0.407617,0.366682,0.340110,0.314266,0.280241,0.252471,0.325552,
        0.464811,0.393336,0.354664,0.329758,0.305668,0.273563,0.244024,0.244886,
        0.441864,0.375618,0.340464,0.318249,0.297127,0.268839,0.237972,0.225553,
        0.407506,0.351125,0.322571,0.305173,0.289034,0.267361,0.239315,0.213761,
        0.366761,0.326166,0.306764,0.295279,0.284765,0.270592,0.250702,0.222928,
        0.345671,0.314748,0.300259,0.291744,0.283971,0.273475,0.258503,0.235683,
        0.324512,0.303631,0.293981,0.288338,0.283193,0.276248,0.266271,0.250506,
        0.311278,0.296340,0.289481,0.285482,0.281840,0.276924,0.269856,0.258609,
        0.303219,0.291534,0.286187,0.283073,0.280239,0.276414,0.270926,0.262173
    };
    
    std::vector&lt;boost::shared_ptr&lt;CalibrationHelper&gt; &gt; options;
    
    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i &lt; <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(maturities); ++i) {
        <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_period.html">Period</a> maturity((<span class="keywordtype">int</span>)(maturities[i]*12.0+0.5), <a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3a3d158b618e2bf6e66da9aca81f706dae">Months</a>);
        boost::shared_ptr&lt;Exercise&gt; exercise(
                                        <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_european_exercise.html" title="European exercise.">EuropeanExercise</a>(today + maturity));

        <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> j=0; j &lt; <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(strikes); ++j) {
            boost::shared_ptr&lt;StrikedTypePayoff&gt; payoff(
                             <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_plain_vanilla_payoff.html" title="Plain-vanilla payoff.">PlainVanillaPayoff</a>(Option::Call, strikes[j]));
            <a class="code" href="class_quant_lib_1_1_relinkable_handle.html">RelinkableHandle&lt;Quote&gt;</a> <a class="code" href="namespaceanonymous__namespace_02perturbativebarrieroptionengine_8cpp_03.html#a1c6cf95dc58d77fbce730d3c1f8ccda7">v</a>(boost::shared_ptr&lt;Quote&gt;(
                                   <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(vol[i*<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(strikes)+j])));
            options.push_back(boost::shared_ptr&lt;CalibrationHelper&gt;(
                <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_model_helper.html" title="calibration helper for Heston model">HestonModelHelper</a>(maturity, calendar,s0-&gt;value(), 
                                      strikes[j], <a class="code" href="namespaceanonymous__namespace_02perturbativebarrieroptionengine_8cpp_03.html#a1c6cf95dc58d77fbce730d3c1f8ccda7">v</a>, rTS, qTS,
                                      CalibrationHelper::PriceError)));
            <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> marketValue = options.back()-&gt;marketValue();
            
            <span class="comment">// Improve the quality of the starting point </span>
            <span class="comment">// for the full Heston-Hull-White calibration </span>
            boost::shared_ptr&lt;SimpleQuote&gt; volQuote(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>);
            boost::shared_ptr&lt;GeneralizedBlackScholesProcess&gt; bsProcess =
                detail::ImpliedVolatilityHelper::clone(
                    boost::shared_ptr&lt;GeneralizedBlackScholesProcess&gt;(
                        <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_generalized_black_scholes_process.html" title="Generalized Black-Scholes stochastic process.">GeneralizedBlackScholesProcess</a>(
                            s0, qTS, rTS, <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;BlackVolTermStructure&gt;</a>(
                                                    <a class="code" href="namespace_quant_lib.html#a589d5c4b0b60b0bdd42ae07d820b2ed3">flatVol</a>(v-&gt;value(), dc)))),
                        volQuote);
            
            <a class="code" href="class_quant_lib_1_1_vanilla_option.html" title="Vanilla option (no discrete dividends, no barriers) on a single asset.">VanillaOption</a> dummyOption(payoff, exercise);

            boost::shared_ptr&lt;PricingEngine&gt; bshwEngine(
                <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_analytic_b_s_m_hull_white_engine.html" title="analytic european option pricer including stochastic interest rates">AnalyticBSMHullWhiteEngine</a>(equityShortRateCorr, 
                                               bsProcess, hullWhiteModel));
            
            <a class="code" href="namespace_quant_lib.html#ae3abfa256de5aa2b506ab6bda014e4dc" title="volatility">Volatility</a> vt = detail::ImpliedVolatilityHelper::calculate(
                dummyOption, *bshwEngine, *volQuote, 
                marketValue, 1e-8, 100, 0.0001, 10);
            
            v.linkTo(boost::shared_ptr&lt;Quote&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(vt)));
            
            options.back()-&gt;setPricingEngine(
                boost::shared_ptr&lt;PricingEngine&gt;(analyticHestonEngine));
        }
    }    
        
    HestonHullWhiteCorrelationConstraint corrConstraint(equityShortRateCorr);
    <a class="code" href="class_quant_lib_1_1_levenberg_marquardt.html" title="Levenberg-Marquardt optimization method.">LevenbergMarquardt</a> om(1e-6, 1e-8, 1e-8);
    analyticHestonModel-&gt;calibrate(options, om, 
                                   <a class="code" href="class_quant_lib_1_1_end_criteria.html" title="Criteria to end optimization process:">EndCriteria</a>(400, 40, 1.0e-8, 1.0e-4, 1.0e-8),
                                   corrConstraint);

    options.clear();
    fdmHestonModel-&gt;setParams(analyticHestonModel-&gt;params());

    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i &lt; <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(maturities); ++i) {
        <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> tGrid = <span class="keyword">static_cast&lt;</span><a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a><span class="keyword">&gt;</span>(std::max(10.0, maturities[i]*10.0));
        boost::shared_ptr&lt;FdHestonHullWhiteVanillaEngine&gt; <a class="code" href="class_quant_lib_1_1engine.html">engine</a>(
            <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_fd_heston_hull_white_vanilla_engine.html" title="Finite-Differences Heston Hull-White Vanilla Option engine.">FdHestonHullWhiteVanillaEngine</a>(fdmHestonModel, hwProcess, 
                                               equityShortRateCorr, 
                                               tGrid, 61, 13, 9, 0, <span class="keyword">true</span>));
        
        <a class="code" href="class_quant_lib_1_1engine.html">engine</a>-&gt;enableMultipleStrikesCaching(
                     std::vector&lt;Real&gt;(strikes, strikes + <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(strikes)));
        
        <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_period.html">Period</a> maturity((<span class="keywordtype">int</span>)(maturities[i]*12.0+0.5), <a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3a3d158b618e2bf6e66da9aca81f706dae">Months</a>);
        
        <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> j=0; j &lt; <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(strikes); ++j) {
            <span class="comment">// multiple strikes engine works best if the first option</span>
            <span class="comment">// per maturity has the average strike (because the first option</span>
            <span class="comment">// is priced first during the calibration and the first pricing</span>
            <span class="comment">// is used to calculate the prices for all strikes</span>
            <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> js = (j + (<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(strikes)-1)/2) % <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(strikes);
 
            boost::shared_ptr&lt;StrikedTypePayoff&gt; payoff(
                             <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_plain_vanilla_payoff.html" title="Plain-vanilla payoff.">PlainVanillaPayoff</a>(Option::Call, strikes[js]));
            <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;Quote&gt;</a> <a class="code" href="namespaceanonymous__namespace_02perturbativebarrieroptionengine_8cpp_03.html#a1c6cf95dc58d77fbce730d3c1f8ccda7">v</a>(boost::shared_ptr&lt;Quote&gt;(
                                   <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(vol[i*<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(strikes)+js])));
            options.push_back(boost::shared_ptr&lt;CalibrationHelper&gt;(
                <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_model_helper.html" title="calibration helper for Heston model">HestonModelHelper</a>(maturity, calendar, s0-&gt;value(), 
                                      strikes[js], <a class="code" href="namespaceanonymous__namespace_02perturbativebarrieroptionengine_8cpp_03.html#a1c6cf95dc58d77fbce730d3c1f8ccda7">v</a>, rTS, qTS,
                                      CalibrationHelper::PriceError)));
            
            options.back()-&gt;setPricingEngine(<a class="code" href="class_quant_lib_1_1engine.html">engine</a>);
        }
    }    

    <a class="code" href="class_quant_lib_1_1_levenberg_marquardt.html" title="Levenberg-Marquardt optimization method.">LevenbergMarquardt</a> vm(1e-6, 1e-2, 1e-2);
    fdmHestonModel-&gt;calibrate(options, vm, 
                              <a class="code" href="class_quant_lib_1_1_end_criteria.html" title="Criteria to end optimization process:">EndCriteria</a>(400, 40, 1.0e-8, 1.0e-4, 1.0e-8),
                              corrConstraint);
    
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> relTol = 0.01;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> expected_v0    =  0.12;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> expected_kappa =  2.0;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> expected_theta =  0.09;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> expected_sigma =  0.5;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> expected_rho   = -0.75;
    
    <span class="keywordflow">if</span> (std::fabs(fdmHestonModel-&gt;v0() - expected_v0)/expected_v0 &gt; relTol) {
         BOOST_ERROR(<span class="stringliteral">&quot;Failed to reproduce Heston-Hull-White model&quot;</span>
                 &lt;&lt; <span class="stringliteral">&quot;\n   v0 calculated: &quot;</span> &lt;&lt; fdmHestonModel-&gt;v0()
                 &lt;&lt; <span class="stringliteral">&quot;\n   v0 expected  : &quot;</span> &lt;&lt; expected_v0
                 &lt;&lt; <span class="stringliteral">&quot;\n   relatove tol : &quot;</span> &lt;&lt; relTol);
    }
    <span class="keywordflow">if</span> (std::fabs(fdmHestonModel-&gt;theta() - expected_theta)/expected_theta 
                                                                    &gt; relTol) {
         BOOST_ERROR(<span class="stringliteral">&quot;Failed to reproduce Heston-Hull-White model&quot;</span>
                 &lt;&lt; <span class="stringliteral">&quot;\n   theta calculated: &quot;</span> &lt;&lt; fdmHestonModel-&gt;theta()
                 &lt;&lt; <span class="stringliteral">&quot;\n   theta expected  : &quot;</span> &lt;&lt; expected_theta
                 &lt;&lt; <span class="stringliteral">&quot;\n   relatove tol    : &quot;</span> &lt;&lt; relTol);
    }
    <span class="keywordflow">if</span> (std::fabs(fdmHestonModel-&gt;kappa() - expected_kappa)/expected_kappa 
                                                                    &gt; relTol) {
        BOOST_ERROR(<span class="stringliteral">&quot;Failed to reproduce Heston-Hull-White model&quot;</span>
                &lt;&lt; <span class="stringliteral">&quot;\n   kappa calculated: &quot;</span> &lt;&lt; fdmHestonModel-&gt;kappa()
                &lt;&lt; <span class="stringliteral">&quot;\n   kappa expected  : &quot;</span> &lt;&lt; expected_kappa
                &lt;&lt; <span class="stringliteral">&quot;\n   relatove tol    : &quot;</span> &lt;&lt; relTol);
    }
    <span class="keywordflow">if</span> (std::fabs(fdmHestonModel-&gt;sigma() - expected_sigma)/expected_sigma 
                                                                    &gt; relTol) {
       BOOST_ERROR(<span class="stringliteral">&quot;Failed to reproduce Heston-Hull-White model&quot;</span>
               &lt;&lt; <span class="stringliteral">&quot;\n   sigma calculated: &quot;</span> &lt;&lt; fdmHestonModel-&gt;sigma()
               &lt;&lt; <span class="stringliteral">&quot;\n   sigma expected  : &quot;</span> &lt;&lt; expected_sigma
               &lt;&lt; <span class="stringliteral">&quot;\n   relatove tol    : &quot;</span> &lt;&lt; relTol);
    }
    <span class="keywordflow">if</span> (std::fabs(fdmHestonModel-&gt;rho() - expected_rho)/expected_rho &gt; relTol) {
         BOOST_ERROR(<span class="stringliteral">&quot;Failed to reproduce Heston-Hull-White model&quot;</span>
                 &lt;&lt; <span class="stringliteral">&quot;\n   rho calculated: &quot;</span> &lt;&lt; fdmHestonModel-&gt;rho()
                 &lt;&lt; <span class="stringliteral">&quot;\n   rho expected  : &quot;</span> &lt;&lt; expected_rho
                 &lt;&lt; <span class="stringliteral">&quot;\n   relatove tol  : &quot;</span> &lt;&lt; relTol);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="acc2fbb9b3b86099e432533e89c09096e"></a><!-- doxytag: member="HybridHestonHullWhiteProcessTest::testMcPureHestonPricing" ref="acc2fbb9b3b86099e432533e89c09096e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_hybrid_heston_hull_white_process_test.html#acc2fbb9b3b86099e432533e89c09096e">HybridHestonHullWhiteProcessTest::testMcPureHestonPricing</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l00473">473</a> of file <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html">hybridhestonhullwhiteprocess.cpp</a>.</p>

<p>References <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00125">anonymous_namespace{marketmodel.cpp}::dates</a>, <a class="el" href="instrument_8hpp_source.html#l00192">QuantLib::Instrument::errorEstimate()</a>, <a class="el" href="ql_2processes_2hybridhestonhullwhiteprocess_8hpp_source.html#l00044">QuantLib::HybridHestonHullWhiteProcess::Euler</a>, <a class="el" href="settings_8hpp_source.html#l00153">QuantLib::Settings::evaluationDate()</a>, <a class="el" href="class_quant_lib_1_1_singleton.html#ab79257029fa4841505227497a56cbd93">QuantLib::Singleton&lt; Settings &gt;::instance()</a>, <a class="el" href="test-suite_2utilities_8hpp_source.html#l00039">LENGTH</a>, <a class="el" href="timeunit_8hpp_source.html#l00039">QuantLib::Months</a>, <a class="el" href="instrument_8hpp_source.html#l00186">QuantLib::Instrument::NPV()</a>, <a class="el" href="option_8hpp_source.html#l00038">QuantLib::Option::Put</a>, <a class="el" href="instrument_8hpp_source.html#l00133">QuantLib::Instrument::setPricingEngine()</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00124">anonymous_namespace{marketmodel.cpp}::todaysDate</a>, <a class="el" href="daycounter_8hpp_source.html#l00126">QuantLib::DayCounter::yearFraction()</a>, and <a class="el" href="timeunit_8hpp_source.html#l00040">QuantLib::Years</a>.</p>

<p>Referenced by <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l01422">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                                               {
    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing Monte-Carlo Heston option pricing...&quot;</span>);

    <a class="code" href="class_quant_lib_1_1_saved_settings.html">SavedSettings</a> backup;

    <a class="code" href="class_quant_lib_1_1_day_counter.html" title="day counter class">DayCounter</a> dc = <a class="code" href="class_quant_lib_1_1_actual360.html" title="Actual/360 day count convention.">Actual360</a>();
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> today = <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#ae1b42c838cf0f4cf17262f0b22bac899">Date::todaysDate</a>();

    Settings::instance().evaluationDate() = today;

    <span class="comment">// construct a strange yield curve to check drifts and discounting</span>
    <span class="comment">// of the joint stochastic process</span>

    std::vector&lt;Date&gt; <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a800db345cacda47dd48925126ea05f91">dates</a>;
    std::vector&lt;Time&gt; times;
    std::vector&lt;Rate&gt; rates, divRates;

    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i &lt;= 100; ++i) {
        dates.push_back(today+<a class="code" href="class_quant_lib_1_1_period.html">Period</a>(i, <a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3a3d158b618e2bf6e66da9aca81f706dae">Months</a>));
        <span class="comment">// FLOATING_POINT_EXCEPTION</span>
        rates.push_back(0.02 + 0.0002*std::exp(std::sin(i/10.0)));
        divRates.push_back(0.02 + 0.0001*std::exp(std::sin(i/20.0)));
        times.push_back(dc.<a class="code" href="class_quant_lib_1_1_day_counter.html#aba442c829252ee786e1b4ea3d0f04bd9" title="Returns the period between two dates as a fraction of year.">yearFraction</a>(today, dates.back()));
    }

    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> maturity = today + <a class="code" href="class_quant_lib_1_1_period.html">Period</a>(2, <a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3ae2d856134531729a1696e66bebeafb32">Years</a>);

    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;Quote&gt;</a> s0(boost::shared_ptr&lt;Quote&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(100)));
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> rTS(
       boost::shared_ptr&lt;YieldTermStructure&gt;(<span class="keyword">new</span> <a class="code" href="namespace_quant_lib.html#aba455dd6323746ed70a64eb4fa65c276" title="Term structure based on linear interpolation of zero yields.">ZeroCurve</a>(dates, rates, dc)));
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> qTS(
       boost::shared_ptr&lt;YieldTermStructure&gt;(
                                          <span class="keyword">new</span> <a class="code" href="namespace_quant_lib.html#aba455dd6323746ed70a64eb4fa65c276" title="Term structure based on linear interpolation of zero yields.">ZeroCurve</a>(dates, divRates, dc)));

    <span class="keyword">const</span> boost::shared_ptr&lt;HestonProcess&gt; hestonProcess(
              <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_process.html" title="Square-root stochastic-volatility Heston process.">HestonProcess</a>(rTS, qTS, s0, 0.08, 1.5, 0.0625, 0.5, -0.8));
    <span class="keyword">const</span> boost::shared_ptr&lt;HullWhiteForwardProcess&gt; hwProcess(
              <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_hull_white_forward_process.html" title="Forward Hull-White stochastic process">HullWhiteForwardProcess</a>(rTS, 0.1, 1e-8));
    hwProcess-&gt;setForwardMeasureTime(dc.<a class="code" href="class_quant_lib_1_1_day_counter.html#aba442c829252ee786e1b4ea3d0f04bd9" title="Returns the period between two dates as a fraction of year.">yearFraction</a>(
                                        today, maturity+<a class="code" href="class_quant_lib_1_1_period.html">Period</a>(1, <a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3ae2d856134531729a1696e66bebeafb32">Years</a>)));

    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> tol = 0.001;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> corr[] = { -0.45, 0.45, 0.25 };
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> strike[] = { 100, 75, 50, 150 };

    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i &lt; <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(corr); ++i) {
        <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> j=0; j &lt; <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(strike); ++j) {
            boost::shared_ptr&lt;HybridHestonHullWhiteProcess&gt; jointProcess(
                <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_hybrid_heston_hull_white_process.html" title="Hybrid Heston Hull-White stochastic process.">HybridHestonHullWhiteProcess</a>(
                        hestonProcess, hwProcess,
                        corr[i], HybridHestonHullWhiteProcess::Euler));

            boost::shared_ptr&lt;StrikedTypePayoff&gt; payoff(
                               <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_plain_vanilla_payoff.html" title="Plain-vanilla payoff.">PlainVanillaPayoff</a>(Option::Put, strike[j]));
            boost::shared_ptr&lt;Exercise&gt; exercise(
                               <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_european_exercise.html" title="European exercise.">EuropeanExercise</a>(maturity));

            <a class="code" href="class_quant_lib_1_1_vanilla_option.html" title="Vanilla option (no discrete dividends, no barriers) on a single asset.">VanillaOption</a> optionHestonHW(payoff, exercise);
            <a class="code" href="class_quant_lib_1_1_vanilla_option.html" title="Vanilla option (no discrete dividends, no barriers) on a single asset.">VanillaOption</a> optionPureHeston(payoff, exercise);
            optionPureHeston.setPricingEngine(
                boost::shared_ptr&lt;PricingEngine&gt;(
                    <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_analytic_heston_engine.html" title="analytic Heston-model engine based on Fourier transform">AnalyticHestonEngine</a>(
                          boost::shared_ptr&lt;HestonModel&gt;(
                                           <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_model.html" title="Heston model for the stochastic volatility of an asset.">HestonModel</a>(hestonProcess)))));

            <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> expected   = optionPureHeston.NPV();

            optionHestonHW.setPricingEngine(
                <a class="code" href="class_quant_lib_1_1_make_m_c_heston_hull_white_engine.html" title="Monte Carlo Heston/Hull-White engine factory.">MakeMCHestonHullWhiteEngine&lt;PseudoRandom&gt;</a>(jointProcess)
                .withSteps(2)
                .withAntitheticVariate()
                .withControlVariate()
                .withAbsoluteTolerance(tol)
                .withSeed(42));

            <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> calculated = optionHestonHW.NPV();
            <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> error      = optionHestonHW.errorEstimate();

            <span class="keywordflow">if</span> (   std::fabs(calculated - expected) &gt; 3*error
                &amp;&amp; std::fabs(calculated - expected) &gt; tol) {
                BOOST_ERROR(<span class="stringliteral">&quot;Failed to reproduce pure heston vanilla prices&quot;</span>
                        &lt;&lt; <span class="stringliteral">&quot;\n   corr:       &quot;</span> &lt;&lt; corr[i]
                        &lt;&lt; <span class="stringliteral">&quot;\n   strike:     &quot;</span> &lt;&lt; strike[j]
                        &lt;&lt; <span class="stringliteral">&quot;\n   calculated: &quot;</span> &lt;&lt; calculated
                        &lt;&lt; <span class="stringliteral">&quot;\n   error:      &quot;</span> &lt;&lt; error
                        &lt;&lt; <span class="stringliteral">&quot;\n   expected:   &quot;</span> &lt;&lt; expected);
            }
        }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7fa250948076d9acf06d4aaab9b65e8a"></a><!-- doxytag: member="HybridHestonHullWhiteProcessTest::testMcVanillaPricing" ref="a7fa250948076d9acf06d4aaab9b65e8a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_hybrid_heston_hull_white_process_test.html#a7fa250948076d9acf06d4aaab9b65e8a">HybridHestonHullWhiteProcessTest::testMcVanillaPricing</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l00375">375</a> of file <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html">hybridhestonhullwhiteprocess.cpp</a>.</p>

<p>References <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00125">anonymous_namespace{marketmodel.cpp}::dates</a>, <a class="el" href="instrument_8hpp_source.html#l00192">QuantLib::Instrument::errorEstimate()</a>, <a class="el" href="settings_8hpp_source.html#l00153">QuantLib::Settings::evaluationDate()</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00086">QuantLib::flatVol()</a>, <a class="el" href="class_quant_lib_1_1_singleton.html#ab79257029fa4841505227497a56cbd93">QuantLib::Singleton&lt; Settings &gt;::instance()</a>, <a class="el" href="test-suite_2utilities_8hpp_source.html#l00039">LENGTH</a>, <a class="el" href="instrument_8hpp_source.html#l00186">QuantLib::Instrument::NPV()</a>, <a class="el" href="option_8hpp_source.html#l00038">QuantLib::Option::Put</a>, <a class="el" href="instrument_8hpp_source.html#l00133">QuantLib::Instrument::setPricingEngine()</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00124">anonymous_namespace{marketmodel.cpp}::todaysDate</a>, <a class="el" href="mchestonhullwhiteengine_8hpp_source.html#l00272">QuantLib::MakeMCHestonHullWhiteEngine&lt; RNG, S &gt;::withAbsoluteTolerance()</a>, <a class="el" href="mchestonhullwhiteengine_8hpp_source.html#l00249">QuantLib::MakeMCHestonHullWhiteEngine&lt; RNG, S &gt;::withAntitheticVariate()</a>, <a class="el" href="mchestonhullwhiteengine_8hpp_source.html#l00256">QuantLib::MakeMCHestonHullWhiteEngine&lt; RNG, S &gt;::withControlVariate()</a>, <a class="el" href="mchestonhullwhiteengine_8hpp_source.html#l00291">QuantLib::MakeMCHestonHullWhiteEngine&lt; RNG, S &gt;::withSeed()</a>, <a class="el" href="daycounter_8hpp_source.html#l00126">QuantLib::DayCounter::yearFraction()</a>, and <a class="el" href="timeunit_8hpp_source.html#l00040">QuantLib::Years</a>.</p>

<p>Referenced by <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l01422">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                                            {
    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing Monte-Carlo vanilla option pricing...&quot;</span>);

    <a class="code" href="class_quant_lib_1_1_saved_settings.html">SavedSettings</a> backup;

    <a class="code" href="class_quant_lib_1_1_day_counter.html" title="day counter class">DayCounter</a> dc = <a class="code" href="class_quant_lib_1_1_actual360.html" title="Actual/360 day count convention.">Actual360</a>();
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> today = <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#ae1b42c838cf0f4cf17262f0b22bac899">Date::todaysDate</a>();

    Settings::instance().evaluationDate() = today;

    <span class="comment">// construct a strange yield curve to check drifts and discounting</span>
    <span class="comment">// of the joint stochastic process</span>

    std::vector&lt;Date&gt; <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a800db345cacda47dd48925126ea05f91">dates</a>;
    std::vector&lt;Time&gt; times;
    std::vector&lt;Rate&gt; rates, divRates;

    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i &lt;= 40; ++i) {
        dates.push_back(today+<a class="code" href="class_quant_lib_1_1_period.html">Period</a>(i, <a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3ae2d856134531729a1696e66bebeafb32">Years</a>));
        <span class="comment">// FLOATING_POINT_EXCEPTION</span>
        rates.push_back(0.03 + 0.0003*std::exp(std::sin(i/4.0)));
        divRates.push_back(0.02 + 0.0001*std::exp(std::sin(i/5.0)));
        times.push_back(dc.<a class="code" href="class_quant_lib_1_1_day_counter.html#aba442c829252ee786e1b4ea3d0f04bd9" title="Returns the period between two dates as a fraction of year.">yearFraction</a>(today, dates.back()));
    }

    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> maturity = today + <a class="code" href="class_quant_lib_1_1_period.html">Period</a>(20, <a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3ae2d856134531729a1696e66bebeafb32">Years</a>);

    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;Quote&gt;</a> s0(boost::shared_ptr&lt;Quote&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(100)));
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> rTS(
       boost::shared_ptr&lt;YieldTermStructure&gt;(<span class="keyword">new</span> <a class="code" href="namespace_quant_lib.html#aba455dd6323746ed70a64eb4fa65c276" title="Term structure based on linear interpolation of zero yields.">ZeroCurve</a>(dates, rates, dc)));
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> qTS(
       boost::shared_ptr&lt;YieldTermStructure&gt;(
                                          <span class="keyword">new</span> <a class="code" href="namespace_quant_lib.html#aba455dd6323746ed70a64eb4fa65c276" title="Term structure based on linear interpolation of zero yields.">ZeroCurve</a>(dates, divRates, dc)));
    boost::shared_ptr&lt;SimpleQuote&gt; vol(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(0.25));
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;BlackVolTermStructure&gt;</a> volTS(<a class="code" href="namespace_quant_lib.html#a589d5c4b0b60b0bdd42ae07d820b2ed3">flatVol</a>(today, vol, dc));

    <span class="keyword">const</span> boost::shared_ptr&lt;BlackScholesMertonProcess&gt; bsmProcess(
              <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_black_scholes_merton_process.html" title="Merton (1973) extension to the Black-Scholes stochastic process.">BlackScholesMertonProcess</a>(s0, qTS, rTS, volTS));
    <span class="keyword">const</span> boost::shared_ptr&lt;HestonProcess&gt; hestonProcess(
              <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_process.html" title="Square-root stochastic-volatility Heston process.">HestonProcess</a>(rTS, qTS, s0, 0.0625, 0.5, 0.0625, 1e-5, 0.3));
    <span class="keyword">const</span> boost::shared_ptr&lt;HullWhiteForwardProcess&gt; hwProcess(
              <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_hull_white_forward_process.html" title="Forward Hull-White stochastic process">HullWhiteForwardProcess</a>(rTS, 0.01, 0.01));
    hwProcess-&gt;setForwardMeasureTime(dc.<a class="code" href="class_quant_lib_1_1_day_counter.html#aba442c829252ee786e1b4ea3d0f04bd9" title="Returns the period between two dates as a fraction of year.">yearFraction</a>(today, maturity));

    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> tol = 0.05;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> corr[] = {-0.9, -0.5, 0.0, 0.5, 0.9 };
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> strike[] = { 100 };

    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i &lt; <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(corr); ++i) {
        <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> j=0; j &lt; <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(strike); ++j) {
            boost::shared_ptr&lt;HybridHestonHullWhiteProcess&gt; jointProcess(
                <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_hybrid_heston_hull_white_process.html" title="Hybrid Heston Hull-White stochastic process.">HybridHestonHullWhiteProcess</a>(hestonProcess,
                                                 hwProcess, corr[i]));

            boost::shared_ptr&lt;StrikedTypePayoff&gt; payoff(
                               <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_plain_vanilla_payoff.html" title="Plain-vanilla payoff.">PlainVanillaPayoff</a>(Option::Put, strike[j]));
            boost::shared_ptr&lt;Exercise&gt; exercise(
                               <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_european_exercise.html" title="European exercise.">EuropeanExercise</a>(maturity));

            <a class="code" href="class_quant_lib_1_1_vanilla_option.html" title="Vanilla option (no discrete dividends, no barriers) on a single asset.">VanillaOption</a> optionHestonHW(payoff, exercise);
            boost::shared_ptr&lt;PricingEngine&gt; <a class="code" href="class_quant_lib_1_1engine.html">engine</a> =
                <a class="code" href="class_quant_lib_1_1_make_m_c_heston_hull_white_engine.html" title="Monte Carlo Heston/Hull-White engine factory.">MakeMCHestonHullWhiteEngine&lt;PseudoRandom&gt;</a>(jointProcess)
                .withSteps(1)
                .<a class="code" href="class_quant_lib_1_1_make_m_c_heston_hull_white_engine.html#a71252813e5c70cff2cbd39bfe5acb900">withAntitheticVariate</a>()
                .<a class="code" href="class_quant_lib_1_1_make_m_c_heston_hull_white_engine.html#a3ffc04f0ce23d0e2da1cffd45566b63e">withControlVariate</a>()
                .<a class="code" href="class_quant_lib_1_1_make_m_c_heston_hull_white_engine.html#a6a9dd3a8b37df7fc80837b83922af77f">withAbsoluteTolerance</a>(tol)
                .<a class="code" href="class_quant_lib_1_1_make_m_c_heston_hull_white_engine.html#abecbb7d1eb546b731ce60fb352e47e12">withSeed</a>(42);

            optionHestonHW.setPricingEngine(engine);

            <span class="keyword">const</span> boost::shared_ptr&lt;HullWhite&gt; hwModel(
                        <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_hull_white.html" title="Single-factor Hull-White (extended Vasicek) model class.">HullWhite</a>(<a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a>(rTS),
                                      hwProcess-&gt;a(), hwProcess-&gt;sigma()));

            <a class="code" href="class_quant_lib_1_1_vanilla_option.html" title="Vanilla option (no discrete dividends, no barriers) on a single asset.">VanillaOption</a> optionBsmHW(payoff, exercise);
            optionBsmHW.setPricingEngine(
                boost::shared_ptr&lt;PricingEngine&gt;(
                           <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_analytic_b_s_m_hull_white_engine.html" title="analytic european option pricer including stochastic interest rates">AnalyticBSMHullWhiteEngine</a>(corr[i], bsmProcess,
                                                          hwModel)));

            <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> calculated = optionHestonHW.NPV();
            <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> error      = optionHestonHW.errorEstimate();
            <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> expected   = optionBsmHW.NPV();

            <span class="keywordflow">if</span> (  (corr[i] != 0.0 &amp;&amp; std::fabs(calculated - expected) &gt; 3*error)
                ||(corr[i] == 0.0 &amp;&amp;  std::fabs(calculated - expected)&gt; 1e-4)) {
                BOOST_ERROR(<span class="stringliteral">&quot;Failed to reproduce BSM-HW vanilla prices&quot;</span>
                        &lt;&lt; <span class="stringliteral">&quot;\n   corr:       &quot;</span> &lt;&lt; corr[i]
                        &lt;&lt; <span class="stringliteral">&quot;\n   strike:     &quot;</span> &lt;&lt; strike[j]
                        &lt;&lt; <span class="stringliteral">&quot;\n   calculated: &quot;</span> &lt;&lt; calculated
                        &lt;&lt; <span class="stringliteral">&quot;\n   error:      &quot;</span> &lt;&lt; error
                        &lt;&lt; <span class="stringliteral">&quot;\n   expected:   &quot;</span> &lt;&lt; expected);
            }
        }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab010c40b341593c66ba5dcb6ea038c40"></a><!-- doxytag: member="HybridHestonHullWhiteProcessTest::testSpatialDiscretizatinError" ref="ab010c40b341593c66ba5dcb6ea038c40" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_hybrid_heston_hull_white_process_test.html#ab010c40b341593c66ba5dcb6ea038c40">HybridHestonHullWhiteProcessTest::testSpatialDiscretizatinError</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l01134">1134</a> of file <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html">hybridhestonhullwhiteprocess.cpp</a>.</p>

<p>References <a class="el" href="option_8hpp_source.html#l00039">QuantLib::Option::Call</a>, <a class="el" href="date_8hpp_source.html#l00056">QuantLib::December</a>, <a class="el" href="settings_8hpp_source.html#l00153">QuantLib::Settings::evaluationDate()</a>, <a class="el" href="test-suite_2batesmodel_8cpp_source.html#l00285">anonymous_namespace{batesmodel.cpp}::hestonModels</a>, <a class="el" href="class_quant_lib_1_1_singleton.html#ab79257029fa4841505227497a56cbd93">QuantLib::Singleton&lt; Settings &gt;::instance()</a>, <a class="el" href="test-suite_2utilities_8hpp_source.html#l00039">LENGTH</a>, <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l01015">anonymous_namespace{hybridhestonhullwhiteprocess.cpp}::makeHestonProcess()</a>, <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l01030">anonymous_namespace{hybridhestonhullwhiteprocess.cpp}::makeVanillaOption()</a>, and <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l01001">anonymous_namespace{hybridhestonhullwhiteprocess.cpp}::schemes</a>.</p>

<p>Referenced by <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l01422">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                                                     {
    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing spatial convergence speed of Heston engine...&quot;</span>);
    
    <a class="code" href="class_quant_lib_1_1_saved_settings.html">SavedSettings</a> backup;
    
    <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> today(27, <a class="code" href="namespace_quant_lib.html#afc504c75e7ee54a75e255256d99781e4ad4988bf6760edb92c088bb47d4b61dc5">December</a>, 2004);
    Settings::instance().evaluationDate() = today;

    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> maturity=1.0;
    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> strikes[] = {75,85,90,95,100,105,110,115,120,125,130,140,150};
    <a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> listOfTimeStepsPerYear[] = { 40 };
    
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> tol[] = { 0.02, 0.02, 0.02, 0.02, 0.05 };
    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> u=0; u &lt; <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(listOfTimeStepsPerYear); ++u) {
        <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i &lt; <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(<a class="code" href="namespaceanonymous__namespace_02hybridhestonhullwhiteprocess_8cpp_03.html#a0924164a332bb279b968d047a7f4dad5">schemes</a>); ++i) {
            <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> j=0; j &lt; <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(<a class="code" href="namespaceanonymous__namespace_02batesmodel_8cpp_03.html#a6dcee93ad815dbe925e29444439daee3">hestonModels</a>); ++j) {
                <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> avgPriceDiff = 0;
                boost::shared_ptr&lt;HestonProcess&gt; hestonProcess(
                                        <a class="code" href="namespaceanonymous__namespace_02hybridhestonhullwhiteprocess_8cpp_03.html#af2b555ca19d8f5d47cfadd6d04089f54">makeHestonProcess</a>(<a class="code" href="namespaceanonymous__namespace_02batesmodel_8cpp_03.html#a6dcee93ad815dbe925e29444439daee3">hestonModels</a>[j]));
                boost::shared_ptr&lt;HestonModel&gt; hestonModel(
                                        <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_model.html" title="Heston model for the stochastic volatility of an asset.">HestonModel</a>(hestonProcess));
    
                boost::shared_ptr&lt;PricingEngine&gt; analyticEngine(
                               <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_analytic_heston_engine.html" title="analytic Heston-model engine based on Fourier transform">AnalyticHestonEngine</a>(hestonModel, 172));
    
                <a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> tSteps = <a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a>(maturity*listOfTimeStepsPerYear[u]);
    
                boost::shared_ptr&lt;FdHestonVanillaEngine&gt; fdEngine(
                    <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_fd_heston_vanilla_engine.html" title="Finite-Differences Heston Vanilla Option engine.">FdHestonVanillaEngine</a>(
                        hestonModel, tSteps, 200, 40, 0,
                        <a class="code" href="namespaceanonymous__namespace_02hybridhestonhullwhiteprocess_8cpp_03.html#a0924164a332bb279b968d047a7f4dad5">schemes</a>[i].schemeDesc));
                fdEngine-&gt;enableMultipleStrikesCaching(
                    std::vector&lt;Real&gt;(strikes, strikes + <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(strikes)));
    
                <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> k=0; k &lt; <a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(strikes); ++k) {
                    VanillaOptionData optionData 
                                  = { strikes[k], maturity, Option::Call }; 
                    boost::shared_ptr&lt;VanillaOption&gt; option 
                                        = <a class="code" href="namespaceanonymous__namespace_02hybridhestonhullwhiteprocess_8cpp_03.html#a361df59d90c358f6a2d051102fd78694">makeVanillaOption</a>(optionData);
                    option-&gt;setPricingEngine(analyticEngine);
                    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> expected = option-&gt;NPV();
     
                    option-&gt;setPricingEngine(fdEngine);
                    <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> calculated = option-&gt;NPV();
     
                    avgPriceDiff
                        +=std::fabs(expected-calculated)/<a class="code" href="test-suite_2utilities_8hpp.html#ad0e13d94164219be2d5bbd4d65e71d1e">LENGTH</a>(strikes);
                }
    
                <span class="keywordflow">if</span> (avgPriceDiff &gt; tol[i]) {
                    BOOST_ERROR(<span class="stringliteral">&quot;\nFailed to reproduce Heston prices&quot;</span> &lt;&lt;
                        <span class="stringliteral">&quot;\n scheme    : &quot;</span> &lt;&lt; <a class="code" href="namespaceanonymous__namespace_02hybridhestonhullwhiteprocess_8cpp_03.html#a0924164a332bb279b968d047a7f4dad5">schemes</a>[i].name &lt;&lt;
                        <span class="stringliteral">&quot;\n model     : &quot;</span> &lt;&lt; <a class="code" href="namespaceanonymous__namespace_02batesmodel_8cpp_03.html#a6dcee93ad815dbe925e29444439daee3">hestonModels</a>[j].name &lt;&lt;
                        <span class="stringliteral">&quot;\n error     : &quot;</span> &lt;&lt; avgPriceDiff &lt;&lt;
                        <span class="stringliteral">&quot;\n tolerance : &quot;</span> &lt;&lt; tol[i]);
                }
            }
        }
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a8fe611b184813d440398e8a9e0511d4b"></a><!-- doxytag: member="HybridHestonHullWhiteProcessTest::testZeroBondPricing" ref="a8fe611b184813d440398e8a9e0511d4b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_hybrid_heston_hull_white_process_test.html#a8fe611b184813d440398e8a9e0511d4b">HybridHestonHullWhiteProcessTest::testZeroBondPricing</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l00255">255</a> of file <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html">hybridhestonhullwhiteprocess.cpp</a>.</p>

<p>References <a class="el" href="option_8hpp_source.html#l00039">QuantLib::Option::Call</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00125">anonymous_namespace{marketmodel.cpp}::dates</a>, <a class="el" href="settings_8hpp_source.html#l00153">QuantLib::Settings::evaluationDate()</a>, <a class="el" href="test-suite_2utilities_8cpp_source.html#l00058">QuantLib::flatRate()</a>, <a class="el" href="class_quant_lib_1_1_singleton.html#ab79257029fa4841505227497a56cbd93">QuantLib::Singleton&lt; Settings &gt;::instance()</a>, <a class="el" href="timeunit_8hpp_source.html#l00039">QuantLib::Months</a>, <a class="el" href="multipathgenerator_8hpp_source.html#l00092">QuantLib::MultiPathGenerator&lt; GSG &gt;::next()</a>, <a class="el" href="quantlibbenchmark_8cpp_source.html#l00150">anonymous_namespace{quantlibbenchmark.cpp}::t</a>, <a class="el" href="test-suite_2marketmodel_8cpp_source.html#l00124">anonymous_namespace{marketmodel.cpp}::todaysDate</a>, <a class="el" href="daycounter_8hpp_source.html#l00126">QuantLib::DayCounter::yearFraction()</a>, and <a class="el" href="timeunit_8hpp_source.html#l00040">QuantLib::Years</a>.</p>

<p>Referenced by <a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html#l01422">suite()</a>.</p>
<div class="fragment"><pre class="fragment">                                                           {
    BOOST_MESSAGE(<span class="stringliteral">&quot;Testing Monte-Carlo zero bond pricing...&quot;</span>);

    <a class="code" href="class_quant_lib_1_1_saved_settings.html">SavedSettings</a> backup;

    <a class="code" href="class_quant_lib_1_1_day_counter.html" title="day counter class">DayCounter</a> dc = <a class="code" href="class_quant_lib_1_1_actual360.html" title="Actual/360 day count convention.">Actual360</a>();
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> today = <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#ae1b42c838cf0f4cf17262f0b22bac899">Date::todaysDate</a>();

    Settings::instance().evaluationDate() = today;

    <span class="comment">// construct a strange yield curve to check drifts and discounting</span>
    <span class="comment">// of the joint stochastic process</span>

    std::vector&lt;Date&gt; <a class="code" href="namespaceanonymous__namespace_02marketmodel_8cpp_03.html#a800db345cacda47dd48925126ea05f91">dates</a>;
    std::vector&lt;Time&gt; times;
    std::vector&lt;Rate&gt; rates;

    dates.push_back(today);
    rates.push_back(0.02);
    times.push_back(0.0);
    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=120; i &lt; 240; ++i) {
        dates.push_back(today+<a class="code" href="class_quant_lib_1_1_period.html">Period</a>(i, <a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3a3d158b618e2bf6e66da9aca81f706dae">Months</a>));
        rates.push_back(0.02 + 0.0002*std::exp(std::sin(i/8.0)));
        times.push_back(dc.<a class="code" href="class_quant_lib_1_1_day_counter.html#aba442c829252ee786e1b4ea3d0f04bd9" title="Returns the period between two dates as a fraction of year.">yearFraction</a>(today, dates.back()));
    }

    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> maturity = dates.back() + <a class="code" href="class_quant_lib_1_1_period.html">Period</a>(10, <a class="code" href="namespace_quant_lib.html#a6cdac5e2dae1e972076cc8e3302e4ad3ae2d856134531729a1696e66bebeafb32">Years</a>);
    dates.push_back(maturity);
    rates.push_back(0.04);
    times.push_back(dc.<a class="code" href="class_quant_lib_1_1_day_counter.html#aba442c829252ee786e1b4ea3d0f04bd9" title="Returns the period between two dates as a fraction of year.">yearFraction</a>(today, dates.back()));

    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;Quote&gt;</a> s0(boost::shared_ptr&lt;Quote&gt;(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_simple_quote.html" title="market element returning a stored value">SimpleQuote</a>(100)));

    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> ts(
       boost::shared_ptr&lt;YieldTermStructure&gt;(<span class="keyword">new</span> <a class="code" href="namespace_quant_lib.html#aba455dd6323746ed70a64eb4fa65c276" title="Term structure based on linear interpolation of zero yields.">ZeroCurve</a>(dates, rates, dc)));
    <span class="keyword">const</span> <a class="code" href="class_quant_lib_1_1_handle.html">Handle&lt;YieldTermStructure&gt;</a> ds(<a class="code" href="namespace_quant_lib.html#a1309465a856634dcd0caff78af7ca223">flatRate</a>(today, 0.0, dc));

    <span class="keyword">const</span> boost::shared_ptr&lt;HestonProcess&gt; hestonProcess(
            <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_heston_process.html" title="Square-root stochastic-volatility Heston process.">HestonProcess</a>(ts, ds, s0, 0.02, 1.0, 0.2, 0.5, -0.8));
    <span class="keyword">const</span> boost::shared_ptr&lt;HullWhiteForwardProcess&gt; hwProcess(
                   <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_hull_white_forward_process.html" title="Forward Hull-White stochastic process">HullWhiteForwardProcess</a>(ts, 0.05, 0.05));
    hwProcess-&gt;setForwardMeasureTime(dc.<a class="code" href="class_quant_lib_1_1_day_counter.html#aba442c829252ee786e1b4ea3d0f04bd9" title="Returns the period between two dates as a fraction of year.">yearFraction</a>(today, maturity));
    <span class="keyword">const</span> boost::shared_ptr&lt;HullWhite&gt; hwModel(<span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_hull_white.html" title="Single-factor Hull-White (extended Vasicek) model class.">HullWhite</a>(ts, 0.05, 0.05));

    <span class="keyword">const</span> boost::shared_ptr&lt;HybridHestonHullWhiteProcess&gt; jointProcess(
        <span class="keyword">new</span> <a class="code" href="class_quant_lib_1_1_hybrid_heston_hull_white_process.html" title="Hybrid Heston Hull-White stochastic process.">HybridHestonHullWhiteProcess</a>(hestonProcess, hwProcess, -0.4));

    <a class="code" href="class_quant_lib_1_1_time_grid.html" title="time grid class">TimeGrid</a> grid(times.begin(), times.end()-1);

    <span class="keyword">typedef</span> <a class="code" href="class_quant_lib_1_1_sobol_brownian_bridge_rsg.html">SobolBrownianBridgeRsg</a> rsg_type;
    <span class="keyword">typedef</span> <a class="code" href="struct_quant_lib_1_1_sample.html">MultiPathGenerator&lt;rsg_type&gt;::sample_type</a> sample_type;

    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> factors = jointProcess-&gt;factors();
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> steps = grid.size()-1;
    rsg_type rsg = rsg_type(factors, steps);
    <a class="code" href="class_quant_lib_1_1_multi_path_generator.html" title="Generates a multipath from a random number generator.">MultiPathGenerator&lt;rsg_type&gt;</a> generator(jointProcess, grid, rsg, <span class="keyword">false</span>);

    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> m = 90;
    std::vector&lt;GeneralStatistics&gt; zeroStat(m);
    std::vector&lt;GeneralStatistics&gt; optionStat(m);

    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> nrTrails = 4095;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> optionTenor = 24;
    <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a05e8e288a4bdedfe5b4e16d8cec14f1c" title="discount factor between dates">DiscountFactor</a> strike = 0.5;

    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> i=0; i &lt; nrTrails; ++i) {
        sample_type path =  generator.next();

        <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> j=1; j &lt; m; ++j) {
            <span class="keyword">const</span> <a class="code" href="class_time.html">Time</a> <a class="code" href="namespaceanonymous__namespace_02quantlibbenchmark_8cpp_03.html#a7a969063fde0030bd36b46055e824c34">t</a> = grid[j];            <span class="comment">// zero end and option maturity</span>
            <span class="keyword">const</span> <a class="code" href="class_time.html">Time</a> <a class="code" href="class_t.html">T</a> = grid[j+optionTenor];<span class="comment">// maturity of zero bond</span>
                                               <span class="comment">// of option</span>

            <a class="code" href="class_quant_lib_1_1_array.html" title="1-D array used in linear algebra.">Array</a> states(3);
            <a class="code" href="class_quant_lib_1_1_array.html" title="1-D array used in linear algebra.">Array</a> optionStates(3);
            <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> k=0; k &lt; jointProcess-&gt;size(); ++k) {
                states[k]       = path.value[k][j];
                optionStates[k] = path.value[k][j+optionTenor];
            }

            <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a05e8e288a4bdedfe5b4e16d8cec14f1c" title="discount factor between dates">DiscountFactor</a> zeroBond
                = 1.0/jointProcess-&gt;numeraire(t, states);
            <span class="keyword">const</span> <a class="code" href="namespace_quant_lib.html#a05e8e288a4bdedfe5b4e16d8cec14f1c" title="discount factor between dates">DiscountFactor</a> zeroOption = zeroBond
                * std::max(0.0, hwModel-&gt;discountBond(t, T, states[2])-strike);

            zeroStat[j].add(zeroBond);
            optionStat[j].add(zeroOption);
        }
    }

    <span class="keywordflow">for</span> (<a class="code" href="namespace_quant_lib.html#af4cc4ef40b52c17cc455ead2a97aedb3" title="size of a container">Size</a> j=1; j &lt; m; ++j) {
        <span class="keyword">const</span> <a class="code" href="class_time.html">Time</a> t = grid[j];
        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> calculated = zeroStat[j].mean();
        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> error = zeroStat[j].errorEstimate();
        <a class="code" href="namespace_quant_lib.html#a372ac5c1a422a6b276fe0552d4d83f50" title="real number">Real</a> expected = ts-&gt;discount(t);

        <span class="keywordflow">if</span> (std::fabs(calculated - expected) &gt; 0.025) {
            BOOST_ERROR(<span class="stringliteral">&quot;Failed to reproduce expected zero bond prices&quot;</span>
                        &lt;&lt; <span class="stringliteral">&quot;\n   t:          &quot;</span> &lt;&lt; t
                        &lt;&lt; <span class="stringliteral">&quot;\n   calculated: &quot;</span> &lt;&lt; calculated
                        &lt;&lt; <span class="stringliteral">&quot;\n   error:      &quot;</span> &lt;&lt; error
                        &lt;&lt; <span class="stringliteral">&quot;\n   expected:   &quot;</span> &lt;&lt; expected);
        }

        <span class="keyword">const</span> <a class="code" href="class_time.html">Time</a> T = grid[j+optionTenor];

        calculated = optionStat[j].mean();
        expected = hwModel-&gt;discountBondOption(Option::Call, strike, t, T);

        <span class="keywordflow">if</span> (std::fabs(calculated - expected) &gt; 0.0035) {
            BOOST_ERROR(<span class="stringliteral">&quot;Failed to reproduce expected zero bond option prices&quot;</span>
                        &lt;&lt; <span class="stringliteral">&quot;\n   t:          &quot;</span> &lt;&lt; t
                        &lt;&lt; <span class="stringliteral">&quot;\n   T:          &quot;</span> &lt;&lt; T
                        &lt;&lt; <span class="stringliteral">&quot;\n   calculated: &quot;</span> &lt;&lt; calculated
                        &lt;&lt; <span class="stringliteral">&quot;\n   error:      &quot;</span> &lt;&lt; error
                        &lt;&lt; <span class="stringliteral">&quot;\n   expected:   &quot;</span> &lt;&lt; expected);
        }
    }
}
</pre></div>
</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/home/deriversatile/QuantLib/QuantLibQt/test-suite/<a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8hpp_source.html">hybridhestonhullwhiteprocess.hpp</a></li>
<li>/home/deriversatile/QuantLib/QuantLibQt/test-suite/<a class="el" href="test-suite_2hybridhestonhullwhiteprocess_8cpp_source.html">hybridhestonhullwhiteprocess.cpp</a></li>
</ul>
</div><!-- contents -->
</div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="class_hybrid_heston_hull_white_process_test.html">HybridHestonHullWhiteProcessTest</a>      </li>

    <li class="footer">Generated on Sat Aug 25 2012 13:51:01 for QuantLib by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.6.1 </li>
   </ul>
 </div>


</body>
</html>
